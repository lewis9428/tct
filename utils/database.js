const _0x1dadbd=_0x18a2;(function(_0x3facd4,_0x5221c1){const _0x3d4fff=_0x18a2,_0x23d3fd=_0x3facd4();while(!![]){try{const _0x1e0f44=-parseInt(_0x3d4fff(0x1ff))/(-0xece+0x1*0x266e+-0x179f*0x1)+-parseInt(_0x3d4fff(0x218))/(0x8e2+0x644*-0x1+-0x14e*0x2)*(-parseInt(_0x3d4fff(0x20c))/(-0x17de+-0x25d8+-0x17*-0x2af))+parseInt(_0x3d4fff(0x260))/(0x22b0+0x19a1+-0x3c4d)+parseInt(_0x3d4fff(0x25f))/(-0x2218+-0x1fd5+0x41f2)*(parseInt(_0x3d4fff(0x1d2))/(0x2530+-0x2b4+-0x2276))+parseInt(_0x3d4fff(0x214))/(0xedd+0x1*0x9a9+-0x187f*0x1)+-parseInt(_0x3d4fff(0x207))/(-0x5e*-0x35+-0x2*0x179+-0x107c*0x1)*(-parseInt(_0x3d4fff(0x23d))/(0x19d3+0x1*0x8a9+-0x2273))+-parseInt(_0x3d4fff(0x281))/(-0xf*0x74+0x1d70+-0x169a)*(parseInt(_0x3d4fff(0x24e))/(0x44e+0x1312+-0x1755));if(_0x1e0f44===_0x5221c1)break;else _0x23d3fd['push'](_0x23d3fd['shift']());}catch(_0x3cef94){_0x23d3fd['push'](_0x23d3fd['shift']());}}}(_0x584f,0x3959c+0x88fd9+0x103b*-0x4f));import _0x4134ab from'sqlite3';import{open}from'sqlite';import _0x124323 from'fs-extra';import _0x3ce179 from'path';import{getConfig}from'./config.js';function _0x18a2(_0x59789f,_0x5e3a9c){const _0x483b6b=_0x584f();return _0x18a2=function(_0x17f2fe,_0x306fcb){_0x17f2fe=_0x17f2fe-(-0xd*-0x1b1+-0x6f5+-0xd3b);let _0x155444=_0x483b6b[_0x17f2fe];return _0x155444;},_0x18a2(_0x59789f,_0x5e3a9c);}import{info,error,warn}from'./logger.js';let db,setStmt,deleteStmt,logStmt,dbReady=![],writeQueue=[],queueBytes=0x9d+-0x1599+0x14fc,maxTotalBytes=-0x1457+-0x1*0x1ee3+0x333a,isFlushing=![],flushTimer,cache;function estimateQueueItemSize(_0x3aa9fb){const _0x2b460e=_0x18a2,_0x4b3323=0x1587+0xa33+-0x1f6a;switch(_0x3aa9fb[_0x2b460e(0x253)]){case _0x2b460e(0x265):return Buffer[_0x2b460e(0x1e1)](_0x3aa9fb[_0x2b460e(0x219)],_0x2b460e(0x1ee))+Buffer['byteLength'](_0x3aa9fb[_0x2b460e(0x222)],_0x2b460e(0x1ee))+_0x4b3323;case _0x2b460e(0x203):return Buffer[_0x2b460e(0x1e1)](_0x3aa9fb[_0x2b460e(0x219)],_0x2b460e(0x1ee))+_0x4b3323;case _0x2b460e(0x21a):return Object['values'](_0x3aa9fb[_0x2b460e(0x27d)])['reduce']((_0x11be28,_0x2860cf)=>_0x11be28+Buffer['byteLength'](String(_0x2860cf),_0x2b460e(0x1ee)),-0x4ed+0x77e+-0x291)+_0x4b3323;default:return-0x17bc+0x19e8+-0x1ac;}}function _0x584f(){const _0x14b2ee=['6DjHNQn','ocess\x20comp','COMMIT;','ransaction','DB_NAME','e\x20TEXT);','y_value_st','g\x20persist.','sage)\x20VALU','size','push','extname','CRITICAL:\x20','exec','zed\x20at\x20','byteLength','\x20KEY,\x20valu','tem\x20\x22','est\x20item\x20t','Skipping\x20c','e...','_value_sto','stat','slice','once',',\x20message\x20','Database\x20s','dy\x20for\x20get','utf8','ERE\x20key\x20=\x20','h\x20complete','_addToTail','ache\x20for\x20o','_moveToTai','CREATE\x20TAB','unshift','prev','DB_CACHE_M','DB_FLUSH_I','ror:\x20','now','ose:','\x20operation','llback:\x20','=\x2010000;','831144zNHTOP','Write\x20queu','exit','BEGIN\x20TRAN','delete','atabase\x20cl','basename','M\x20key_valu','4504pdoHuh','message','LE\x20IF\x20NOT\x20','N/A','versized\x20i','398115ExEEbP','ackup\x20fail','scarded\x20af','PRAGMA\x20bus','serialized','module','ax\x20','DELETE\x20FRO','686322QwaNdx','.\x20System\x20i','\x20bytes\x20>\x20m','join','6aWZuTN','key','log','shift','SACTION;','INSERT\x20INT','y_timeout\x20','\x20NORMAL;','=\x20WAL;','O\x20logs\x20(ts','value','SELECT\x20val','s\x20ready.','DB_BATCH_S','DB\x20flush\x20t','maxBytes','shing\x20queu','close',',\x20module,\x20','ng\x20for\x20ret','hutdown\x20pr','run','parse','IZE','uccessfull','copy','splice','process\x20DB','stringify','l\x20be\x20handl','reduce','ocess\x20init','ule\x20TEXT,\x20','leted\x20succ','timestamp','_removeNod','s\x20(ts\x20INTE','8469xnnPqW','XT\x20PRIMARY','EXISTS\x20key','Database\x20c','has','estimateSi','Value\x20for\x20','PROJECT_RO','level\x20TEXT','chronous\x20=','ype:\x20','ng\x20final\x20d','Final\x20flus','level,\x20mes','PRAGMA\x20syn','get','head','127479ZrTbAV','mtimeMs','length','PRAGMA\x20for','finally','type','pathExists','Database\x20i','\x20item,\x20wil','e_store\x20WH','DB\x20init\x20er','anly.','map','Database','Failed\x20to\x20','k.\x20Prepari','saction\x20ro','932780UHSrhG','2060852AYOrYd','\x20limits.\x20T','dirname','ue_store\x20(','AX_BYTES','set','prepare','ed\x20by\x20tran',',\x20Key:\x20','PRAGMA\x20jou','Y\x20KEY,\x20mod','Database\x20b','next','\x22\x20(','ync','nitializat','finalize',')\x20VALUES\x20(','onnection\x20','ore\x20WHERE\x20','ailed:','ion\x20proces','e\x20memory\x20p','rnal_mode\x20','bytes','key,\x20value','tail','le\x20failure','retries','data','DB_PATH','ue\x20FROM\x20ke','EXISTS\x20log','370lwQOJw','SIGINT','?,\x20?)','ed:\x20','ensureDirS','TEXT);'];_0x584f=function(){return _0x14b2ee;};return _0x584f();}class MemoryCache{constructor(_0x2c2b5b){const _0x4462d5=_0x18a2;this[_0x4462d5(0x227)]=_0x2c2b5b,this['bytes']=0xc19*0x1+-0x1e*0x3b+-0x52f*0x1,this[_0x4462d5(0x25a)]=new Map(),this['head']={'prev':null,'next':null},this['tail']={'prev':null,'next':null},this[_0x4462d5(0x24d)][_0x4462d5(0x26c)]=this[_0x4462d5(0x27a)],this[_0x4462d5(0x27a)][_0x4462d5(0x1f6)]=this[_0x4462d5(0x24d)];}static[_0x1dadbd(0x242)+'ze'](_0x1fa558,_0x5992f8){const _0x13d477=_0x1dadbd,_0x14d6a1=Buffer[_0x13d477(0x1e1)](String(_0x1fa558),_0x13d477(0x1ee)),_0x1bfda4=Buffer['byteLength'](_0x5992f8??'',_0x13d477(0x1ee));return _0x14d6a1+_0x1bfda4+(-0x639*0x1+-0xe28*0x2+0x22c9);}[_0x1dadbd(0x23b)+'e'](_0x4ba4f7){const _0x3c4b56=_0x1dadbd;_0x4ba4f7['prev']['next']=_0x4ba4f7[_0x3c4b56(0x26c)],_0x4ba4f7[_0x3c4b56(0x26c)][_0x3c4b56(0x1f6)]=_0x4ba4f7[_0x3c4b56(0x1f6)];}['_addToTail'](_0x12872b){const _0x411e60=_0x1dadbd;_0x12872b['prev']=this['tail'][_0x411e60(0x1f6)],_0x12872b['next']=this[_0x411e60(0x27a)],this[_0x411e60(0x27a)][_0x411e60(0x1f6)][_0x411e60(0x26c)]=_0x12872b,this[_0x411e60(0x27a)][_0x411e60(0x1f6)]=_0x12872b;}['_moveToTai'+'l'](_0x1d9a1a){const _0x4d8c31=_0x1dadbd;this[_0x4d8c31(0x23b)+'e'](_0x1d9a1a),this['_addToTail'](_0x1d9a1a);}[_0x1dadbd(0x241)](_0x1db164){const _0x30d1e=_0x1dadbd;return this[_0x30d1e(0x25a)]['has'](_0x1db164);}['get'](_0x936df1){const _0x8da365=_0x1dadbd,_0x4253c3=this[_0x8da365(0x25a)]['get'](_0x936df1);if(!_0x4253c3)return undefined;return this[_0x8da365(0x1f3)+'l'](_0x4253c3),_0x4253c3['value'];}[_0x1dadbd(0x265)](_0x505b84,_0x57cfc2,_0x10763a){const _0x48faab=_0x1dadbd,_0x4cad19=this['map'][_0x48faab(0x24c)](_0x505b84),_0xf962af=MemoryCache[_0x48faab(0x242)+'ze'](_0x505b84,_0x10763a);if(_0xf962af>this[_0x48faab(0x227)]){warn(_0x48faab(0x1e5)+_0x48faab(0x1f2)+_0x48faab(0x20b)+_0x48faab(0x1e3)+_0x505b84+_0x48faab(0x26d)+_0xf962af+(_0x48faab(0x216)+_0x48faab(0x212))+this[_0x48faab(0x227)]+')');if(_0x4cad19)this['delete'](_0x505b84);return;}if(_0x4cad19)this[_0x48faab(0x278)]-=_0x4cad19['size'],_0x4cad19['value']=_0x57cfc2,_0x4cad19[_0x48faab(0x210)]=_0x10763a,_0x4cad19[_0x48faab(0x1db)]=_0xf962af,this[_0x48faab(0x278)]+=_0xf962af,this[_0x48faab(0x1f3)+'l'](_0x4cad19);else{const _0x196db4={'key':_0x505b84,'value':_0x57cfc2,'serialized':_0x10763a,'size':_0xf962af,'prev':null,'next':null};this[_0x48faab(0x25a)][_0x48faab(0x265)](_0x505b84,_0x196db4),this[_0x48faab(0x1f1)](_0x196db4),this[_0x48faab(0x278)]+=_0xf962af;}while(this[_0x48faab(0x278)]>this[_0x48faab(0x227)]){const _0x59a1f7=this['head'][_0x48faab(0x26c)];if(_0x59a1f7===this[_0x48faab(0x27a)])break;this[_0x48faab(0x203)](_0x59a1f7[_0x48faab(0x219)]);}}['delete'](_0x220378){const _0x12f660=_0x1dadbd,_0x408359=this[_0x12f660(0x25a)][_0x12f660(0x24c)](_0x220378);if(!_0x408359)return;this[_0x12f660(0x23b)+'e'](_0x408359),this[_0x12f660(0x25a)]['delete'](_0x220378),this[_0x12f660(0x278)]-=_0x408359[_0x12f660(0x1db)];}}function enforceMemoryLimit(){const _0x4aefc9=_0x1dadbd;while(cache[_0x4aefc9(0x278)]+queueBytes>maxTotalBytes&&writeQueue[_0x4aefc9(0x250)]>0x1*-0x1aa7+0x1a9+0x18fe){const _0x4e8012=writeQueue[_0x4aefc9(0x21b)]();_0x4e8012[_0x4aefc9(0x1db)]&&(queueBytes-=_0x4e8012[_0x4aefc9(0x1db)]),warn(_0x4aefc9(0x200)+_0x4aefc9(0x276)+'ressure:\x20D'+'ropped\x20old'+_0x4aefc9(0x1e4)+'o\x20stay\x20wit'+'hin\x20memory'+_0x4aefc9(0x261)+_0x4aefc9(0x247)+_0x4e8012[_0x4aefc9(0x253)]+_0x4aefc9(0x268)+(_0x4e8012['key']||_0x4aefc9(0x20a)));}}export async function initializeDatabase(){const _0x586678=_0x1dadbd;info(_0x586678(0x255)+_0x586678(0x26f)+_0x586678(0x275)+'s\x20started.'+'..');try{flushTimer&&(clearInterval(flushTimer),flushTimer=null);const _0x181683=getConfig();maxTotalBytes=_0x181683[_0x586678(0x1f7)+_0x586678(0x264)],cache=new MemoryCache(maxTotalBytes);const _0x25ca4a=_0x181683[_0x586678(0x244)+'OT'],_0x31ba5b=_0x3ce179['resolve'](_0x25ca4a,_0x181683[_0x586678(0x27e)]);_0x124323[_0x586678(0x1d0)+_0x586678(0x26e)](_0x31ba5b);const _0x59326f=_0x181683[_0x586678(0x1d6)],_0x522b1c=_0x3ce179[_0x586678(0x217)](_0x31ba5b,_0x59326f);await backupDB(_0x522b1c),db=await open({'filename':_0x522b1c,'driver':_0x4134ab[_0x586678(0x25b)]}),await db[_0x586678(0x1df)](_0x586678(0x269)+_0x586678(0x277)+_0x586678(0x220)),await db[_0x586678(0x1df)](_0x586678(0x24b)+_0x586678(0x246)+_0x586678(0x21f)),await db[_0x586678(0x1df)](_0x586678(0x20f)+_0x586678(0x21e)+_0x586678(0x1fe)),await db[_0x586678(0x1df)](_0x586678(0x251)+'eign_keys\x20'+'=\x20ON;'),await applyMigrations(),await prepareStatements(),dbReady=!![],writeQueue=[],queueBytes=0xee6+0x1*-0x256b+0x481*0x5;const _0x419beb=_0x181683[_0x586678(0x1f8)+'NTERVAL'];flushTimer=setInterval(()=>flushQueue(),_0x419beb),info(_0x586678(0x1ec)+_0x586678(0x230)+'y\x20initiali'+_0x586678(0x1e0)+_0x522b1c+(_0x586678(0x215)+_0x586678(0x224)));}catch(_0x2859dc){error(_0x586678(0x258)+_0x586678(0x1f9)+(_0x2859dc?.['message']||_0x2859dc),_0x2859dc);throw _0x2859dc;}}async function prepareStatements(){const _0x339f9a=_0x1dadbd;setStmt=await db[_0x339f9a(0x266)]('INSERT\x20OR\x20'+'REPLACE\x20IN'+'TO\x20key_val'+_0x339f9a(0x263)+_0x339f9a(0x279)+_0x339f9a(0x271)+_0x339f9a(0x1ce)),deleteStmt=await db[_0x339f9a(0x266)](_0x339f9a(0x213)+_0x339f9a(0x206)+_0x339f9a(0x257)+_0x339f9a(0x1ef)+'?'),logStmt=await db[_0x339f9a(0x266)](_0x339f9a(0x21d)+_0x339f9a(0x221)+_0x339f9a(0x22a)+_0x339f9a(0x24a)+_0x339f9a(0x1da)+'ES\x20(?,\x20?,\x20'+_0x339f9a(0x1ce));}async function applyMigrations(){const _0x22aa17=_0x1dadbd;await db[_0x22aa17(0x1df)]('CREATE\x20TAB'+_0x22aa17(0x209)+_0x22aa17(0x23f)+_0x22aa17(0x1e7)+'re\x20(key\x20TE'+_0x22aa17(0x23e)+_0x22aa17(0x1e2)+_0x22aa17(0x1d7)),await db[_0x22aa17(0x1df)](_0x22aa17(0x1f4)+'LE\x20IF\x20NOT\x20'+_0x22aa17(0x280)+_0x22aa17(0x23c)+'GER\x20PRIMAR'+_0x22aa17(0x26a)+_0x22aa17(0x238)+_0x22aa17(0x245)+_0x22aa17(0x1eb)+_0x22aa17(0x1d1));}async function flushQueue(){const _0x1a0e2f=_0x1dadbd;if(!dbReady||isFlushing||writeQueue[_0x1a0e2f(0x250)]===-0x6e9+-0xe4d+0x389*0x6)return;const _0xb676b2=writeQueue[0x1e7*0x6+-0x1*0x209c+0x2*0xa99];if(_0xb676b2[_0x1a0e2f(0x27c)]>-0x97*-0x5+0xa*-0xc3+-0x4ab*-0x1&&Date[_0x1a0e2f(0x1fa)]()-_0xb676b2['timestamp']<-0x31b+-0x3*-0x7fb+0x185*-0x6)return;isFlushing=!![];const _0x47b7ad=writeQueue[_0x1a0e2f(0x232)](0x1004+0x191b+-0x291f,getConfig()['DB_BATCH_S'+_0x1a0e2f(0x22f)]),_0x51bae9=_0x47b7ad[_0x1a0e2f(0x236)]((_0x392387,_0x3bf2f2)=>_0x392387+(_0x3bf2f2[_0x1a0e2f(0x1db)]||0x11c*-0xf+0x5*0x27a+-0x2*-0x221),0x1*0x1087+0x21dd+-0xd7*0x3c);try{await db[_0x1a0e2f(0x1df)](_0x1a0e2f(0x202)+_0x1a0e2f(0x21c));for(const _0x59512d of _0x47b7ad){try{switch(_0x59512d['type']){case'set':await setStmt[_0x1a0e2f(0x22d)](_0x59512d[_0x1a0e2f(0x219)],_0x59512d[_0x1a0e2f(0x222)]);break;case _0x1a0e2f(0x203):await deleteStmt[_0x1a0e2f(0x22d)](_0x59512d['key']);break;case _0x1a0e2f(0x21a):await logStmt[_0x1a0e2f(0x22d)](_0x59512d[_0x1a0e2f(0x27d)]['ts'],_0x59512d[_0x1a0e2f(0x27d)][_0x1a0e2f(0x211)],_0x59512d[_0x1a0e2f(0x27d)]['level'],_0x59512d[_0x1a0e2f(0x27d)]['message']);break;}}catch(_0x52ae8b){error(_0x1a0e2f(0x25c)+_0x1a0e2f(0x233)+_0x1a0e2f(0x256)+_0x1a0e2f(0x235)+_0x1a0e2f(0x267)+_0x1a0e2f(0x25e)+_0x1a0e2f(0x1fd)+JSON[_0x1a0e2f(0x234)](_0x59512d),_0x52ae8b);throw _0x52ae8b;}}await db[_0x1a0e2f(0x1df)](_0x1a0e2f(0x1d4)),queueBytes-=_0x51bae9;}catch(_0x4bf9cd){error(_0x1a0e2f(0x226)+_0x1a0e2f(0x1d5)+'\x20failed,\x20r'+'olling\x20bac'+_0x1a0e2f(0x25d)+_0x1a0e2f(0x22b)+'ry.',_0x4bf9cd);try{await db[_0x1a0e2f(0x1df)]('ROLLBACK;');}catch(_0x2c3e62){error('Rollback\x20f'+_0x1a0e2f(0x274),_0x2c3e62);}const _0x4a36a6=Date[_0x1a0e2f(0x1fa)](),_0x186c82=[];for(const _0x1365d4 of _0x47b7ad){_0x1365d4[_0x1a0e2f(0x27c)]=(_0x1365d4['retries']||0x1e70+0x11a8+0x3*-0x1008)+(-0x3*0x7d1+0x34*0x1d+0x4*0x464),_0x1365d4[_0x1a0e2f(0x23a)]=_0x4a36a6,_0x1365d4['retries']<0x7*-0x2c7+0x16cd+-0x27*0x16?_0x186c82[_0x1a0e2f(0x1dc)](_0x1365d4):error(_0x1a0e2f(0x1de)+'DB\x20item\x20di'+_0x1a0e2f(0x20e)+'ter\x20multip'+_0x1a0e2f(0x27b)+'s.\x20Item:\x20'+JSON[_0x1a0e2f(0x234)](_0x1365d4));}_0x186c82[_0x1a0e2f(0x250)]>0x2c*0x49+0x51*0x11+0x1*-0x11ed&&writeQueue[_0x1a0e2f(0x1f5)](..._0x186c82);}finally{isFlushing=![];}}export async function get(_0x11b903){const _0x4defeb=_0x1dadbd;if(cache[_0x4defeb(0x241)](_0x11b903))return cache[_0x4defeb(0x24c)](_0x11b903);if(!dbReady)return warn('DB\x20not\x20rea'+_0x4defeb(0x1ed)+_0x4defeb(0x1fc)+'.'),undefined;try{const _0xe788d=await db[_0x4defeb(0x24c)](_0x4defeb(0x223)+_0x4defeb(0x27f)+_0x4defeb(0x1d8)+_0x4defeb(0x273)+'key\x20=\x20?',_0x11b903);if(_0xe788d?.[_0x4defeb(0x222)]){const _0x48d2b3=JSON[_0x4defeb(0x22e)](_0xe788d['value']);return cache[_0x4defeb(0x265)](_0x11b903,_0x48d2b3,_0xe788d[_0x4defeb(0x222)]),_0x48d2b3;}}catch(_0x590a98){error(_0x4defeb(0x25c)+'get\x20key\x20\x22'+_0x11b903+('\x22\x20from\x20DB:'+'\x20')+_0x590a98[_0x4defeb(0x208)],_0x590a98);}return undefined;}export function set(_0x16261d,_0x1e0939){const _0x176c82=_0x1dadbd;if(_0x1e0939===undefined){del(_0x16261d);return;}let _0x247104;try{_0x247104=JSON['stringify'](_0x1e0939);}catch(_0x476765){error(_0x176c82(0x243)+'key\x20\x22'+_0x16261d+('\x22\x20is\x20not\x20s'+'erializabl'+'e;\x20skippin'+_0x176c82(0x1d9)),_0x476765);return;}cache['set'](_0x16261d,_0x1e0939,_0x247104);const _0x288f34={'type':_0x176c82(0x265),'key':_0x16261d,'value':_0x247104,'retries':0x0,'timestamp':Date[_0x176c82(0x1fa)]()};_0x288f34[_0x176c82(0x1db)]=estimateQueueItemSize(_0x288f34),queueBytes+=_0x288f34[_0x176c82(0x1db)],writeQueue[_0x176c82(0x1dc)](_0x288f34),enforceMemoryLimit(),writeQueue[_0x176c82(0x250)]>=getConfig()[_0x176c82(0x225)+_0x176c82(0x22f)]&&flushQueue();}export function del(_0x2a485d){const _0x597b1a=_0x1dadbd;cache[_0x597b1a(0x203)](_0x2a485d);const _0x377f28={'type':_0x597b1a(0x203),'key':_0x2a485d,'retries':0x0,'timestamp':Date['now']()};_0x377f28[_0x597b1a(0x1db)]=estimateQueueItemSize(_0x377f28),queueBytes+=_0x377f28[_0x597b1a(0x1db)],writeQueue[_0x597b1a(0x1dc)](_0x377f28),enforceMemoryLimit(),writeQueue[_0x597b1a(0x250)]>=getConfig()[_0x597b1a(0x225)+_0x597b1a(0x22f)]&&flushQueue();}export function logToDB(module,_0x3fad65,_0x2b4d37){const _0x44316d=_0x1dadbd,_0x27be79={'ts':Date[_0x44316d(0x1fa)](),'module':module,'level':_0x3fad65,'message':String(_0x2b4d37)[_0x44316d(0x1e9)](-0x2*-0x20c+-0x1bc5+0x17ad,0x449*-0x1+-0x1d*0x61+-0x5*-0x49e)},_0x36dc80={'type':'log','data':_0x27be79,'retries':0x0,'timestamp':Date[_0x44316d(0x1fa)]()};_0x36dc80[_0x44316d(0x1db)]=estimateQueueItemSize(_0x36dc80),queueBytes+=_0x36dc80[_0x44316d(0x1db)],writeQueue[_0x44316d(0x1dc)](_0x36dc80),enforceMemoryLimit();}export async function shutdownDatabase(){const _0x7f9f31=_0x1dadbd;info(_0x7f9f31(0x1ec)+_0x7f9f31(0x22c)+_0x7f9f31(0x237)+'iated.\x20Flu'+_0x7f9f31(0x228)+_0x7f9f31(0x1e6)),dbReady=![];flushTimer&&(clearInterval(flushTimer),flushTimer=null);await flushQueue(),await flushQueue(),info(_0x7f9f31(0x249)+_0x7f9f31(0x1f0)+'d.');if(db)try{if(setStmt)await setStmt[_0x7f9f31(0x270)]();if(deleteStmt)await deleteStmt[_0x7f9f31(0x270)]();if(logStmt)await logStmt[_0x7f9f31(0x270)]();await db[_0x7f9f31(0x229)](),info(_0x7f9f31(0x240)+_0x7f9f31(0x272)+'closed\x20cle'+_0x7f9f31(0x259)),db=null;}catch(_0x524464){error('Error\x20duri'+_0x7f9f31(0x248)+_0x7f9f31(0x204)+_0x7f9f31(0x1fb),_0x524464);}info('Database\x20s'+_0x7f9f31(0x22c)+_0x7f9f31(0x1d3)+_0x7f9f31(0x239)+'essfully.');}async function backupDB(_0x17ec4f){const _0x44e401=_0x1dadbd;try{if(!await _0x124323[_0x44e401(0x254)](_0x17ec4f))return;const _0x26c335=_0x3ce179[_0x44e401(0x262)](_0x17ec4f),_0x31b466=_0x3ce179[_0x44e401(0x205)](_0x17ec4f,_0x3ce179[_0x44e401(0x1dd)](_0x17ec4f)),_0x567c71=_0x3ce179['join'](_0x26c335,_0x31b466+'.bak'),_0x271775=await _0x124323[_0x44e401(0x254)](_0x567c71)?await _0x124323[_0x44e401(0x1e8)](_0x567c71):null,_0x388f19=_0x271775?Date['now']()-_0x271775[_0x44e401(0x24f)]:Infinity;_0x388f19>(-0x1*-0x2e7+0x71f+-0x3e*0x29)*(-0x673*0x4+0x1aa1*0x1+-0x9*0x11)*(-0x112f+0x6*-0x5c2+0x33f7)*(0xd5*-0x1d+0x1c79+-0x70)&&(await _0x124323[_0x44e401(0x231)](_0x17ec4f,_0x567c71,{'overwrite':!![]}),info(_0x44e401(0x26b)+'ackup\x20crea'+'ted\x20at\x20'+_0x567c71));}catch(_0x6a068a){error('Database\x20b'+_0x44e401(0x20d)+_0x44e401(0x1cf)+_0x6a068a[_0x44e401(0x208)],_0x6a068a);}}process[_0x1dadbd(0x1ea)](_0x1dadbd(0x1cd),()=>{const _0x55a031=_0x1dadbd;shutdownDatabase()[_0x55a031(0x252)](()=>process[_0x55a031(0x201)](0x2384+-0xb7*-0x1d+-0x79*0x77));}),process['once']('SIGTERM',()=>{const _0x4f5cb5=_0x1dadbd;shutdownDatabase()[_0x4f5cb5(0x252)](()=>process[_0x4f5cb5(0x201)](0x3*0x45a+0x1afb+-0x115*0x25));});export{db};