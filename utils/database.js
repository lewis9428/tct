const _0x2e41a7=_0x8ea0;function _0x29b9(){const _0x16e820=['ropped\x20old',',\x20message\x20','value','k.\x20Prepari','size','PRAGMA\x20bus','bytes','DB\x20item\x20di','\x20operation','ailed:','ROLLBACK;','?,\x20?)','ror:\x20','2pjJKGY','e;\x20skippin','push','y\x20initiali','CREATE\x20TAB','Final\x20flus','l\x20be\x20handl',',\x20Key:\x20','780YrZPpb','10847580dvXAaC','s.\x20Item:\x20','\x20limits.\x20T','.bak','log','re\x20(key\x20TE','78lEFWmk','ransaction','.\x20System\x20i','atabase\x20cl','head','40bKBcWk','TEXT);','ue\x20FROM\x20ke','set','e_store\x20WH','352WdSIYD','unshift','IZE','key\x20=\x20?','level\x20TEXT','237681tUYwkP','run','timestamp','s\x20(ts\x20INTE','shing\x20queu','O\x20logs\x20(ts','ter\x20multip','ackup\x20fail','SACTION;','DB_BATCH_S','ERE\x20key\x20=\x20','y_value_st','DB_CACHE_M','=\x20WAL;','le\x20failure','ed\x20by\x20tran','byteLength','_removeNod','o\x20stay\x20wit','exec','REPLACE\x20IN','leted\x20succ','rnal_mode\x20','tail','\x20NORMAL;','Write\x20queu','ng\x20final\x20d','close','ion\x20proces','copy','1221WKrIml','level','versized\x20i','ype:\x20','DB\x20not\x20rea','module','M\x20key_valu','values','exit','ted\x20at\x20','once','eign_keys\x20','e\x20memory\x20p','DB_PATH','311514psuTDv','finalize','PRAGMA\x20syn','dy\x20for\x20get','message','CRITICAL:\x20','dirname','onnection\x20','delete','Database\x20i','reduce','ry.','DB\x20init\x20er','level,\x20mes','key\x20\x22','get\x20key\x20\x22','INSERT\x20INT','ES\x20(?,\x20?,\x20','shift','splice','Database\x20s','ng\x20for\x20ret','EXISTS\x20log','key,\x20value','pathExists','\x22\x20from\x20DB:','ule\x20TEXT,\x20','est\x20item\x20t','ocess\x20comp','DB_NAME','465nwyNGt','3778910SztHaQ','closed\x20cle','Database\x20b','process\x20DB','ackup\x20crea','anly.','INSERT\x20OR\x20','utf8','estimateSi','key','ressure:\x20D','Failed\x20to\x20','s\x20started.','maxBytes','next','Rollback\x20f','e...','sage)\x20VALU','nitializat','mtimeMs','SIGINT','NTERVAL','olling\x20bac','N/A','get','iated.\x20Flu','ue_store\x20(','hutdown\x20pr','hin\x20memory','Y\x20KEY,\x20mod','data','stringify','LE\x20IF\x20NOT\x20','ose:','retries','GER\x20PRIMAR','PRAGMA\x20for','map','join','DB_FLUSH_I','length','s\x20ready.','\x22\x20is\x20not\x20s','ocess\x20init','resolve','llback:\x20','prepare','COMMIT;','ore\x20WHERE\x20','ax\x20','Database\x20c','now','\x22\x20(','Value\x20for\x20','PRAGMA\x20jou','type','finally','\x20item,\x20wil','_value_sto','scarded\x20af','ensureDirS','ync','EXISTS\x20key','erializabl','Skipping\x20c','prev','491951amQcAb','TO\x20key_val','has','g\x20persist.','stat','ache\x20for\x20o','_moveToTai','DELETE\x20FRO','_addToTail'];_0x29b9=function(){return _0x16e820;};return _0x29b9();}(function(_0x1338fb,_0x2b7061){const _0x5d82da=_0x8ea0,_0x5ac50e=_0x1338fb();while(!![]){try{const _0x1cbca6=-parseInt(_0x5d82da(0x82))/(0x455*-0x9+0x889+-0x153*-0x17)*(parseInt(_0x5d82da(0x98))/(-0x52c+-0x1629+0x1b57))+-parseInt(_0x5d82da(0x100))/(-0x1*-0xcf1+0x69e+0x1*-0x138c)*(-parseInt(_0x5d82da(0xb1))/(0x1e2*-0x9+-0xd95+0x1*0x1e8b))+-parseInt(_0x5d82da(0x101))/(0xf9*-0x19+-0x2*-0x1002+0x3d7*-0x2)+-parseInt(_0x5d82da(0xa7))/(-0x29*-0xb0+-0x2391+-0x767*-0x1)*(-parseInt(_0x5d82da(0xe2))/(0x72e*0x1+0x7*0x29b+-0x1964))+-parseInt(_0x5d82da(0xac))/(-0x1a*-0x35+-0x1bf0+-0x19d*-0xe)*(-parseInt(_0x5d82da(0xb6))/(0x10ee+0x1*-0x17cd+0x6e8))+-parseInt(_0x5d82da(0xa0))/(0xe6e+-0x23f0+0x158c)*(-parseInt(_0x5d82da(0xd4))/(-0xc1*-0x27+0x887*0x2+-0x2e6a))+parseInt(_0x5d82da(0xa1))/(-0x215c+0x53c+0x3*0x964);if(_0x1cbca6===_0x2b7061)break;else _0x5ac50e['push'](_0x5ac50e['shift']());}catch(_0x2ee15d){_0x5ac50e['push'](_0x5ac50e['shift']());}}}(_0x29b9,-0x63696+0x1500d+0xad676));import _0x5df63d from'sqlite3';import{open}from'sqlite';import _0x308d6f from'fs-extra';import _0x46922b from'path';import{getConfig}from'./config.js';import{info,error,warn}from'./logger.js';let db,setStmt,deleteStmt,logStmt,dbReady=![],writeQueue=[],queueBytes=-0x1f40+0x187b+0x6c5,maxTotalBytes=0xbba+0x13*0x17f+-0x2827,isFlushing=![],flushTimer,cache;function estimateQueueItemSize(_0x1abe51){const _0x485605=_0x8ea0,_0x11fd42=0xa9*0x1d+0xd*0x230+-0x2f45;switch(_0x1abe51['type']){case _0x485605(0xaf):return Buffer[_0x485605(0xc6)](_0x1abe51['key'],_0x485605(0x108))+Buffer['byteLength'](_0x1abe51['value'],'utf8')+_0x11fd42;case _0x485605(0xea):return Buffer[_0x485605(0xc6)](_0x1abe51[_0x485605(0x10a)],_0x485605(0x108))+_0x11fd42;case _0x485605(0xa5):return Object[_0x485605(0xdb)](_0x1abe51[_0x485605(0x11f)])[_0x485605(0xec)]((_0x3ca031,_0x29d106)=>_0x3ca031+Buffer[_0x485605(0xc6)](String(_0x29d106),'utf8'),-0x6*-0x679+0xf3c+-0x9*0x602)+_0x11fd42;default:return 0x1307+0x1e06+-0x102f*0x3;}}class MemoryCache{constructor(_0xd0dd29){const _0x5eece1=_0x8ea0;this['maxBytes']=_0xd0dd29,this[_0x5eece1(0x91)]=-0xbf*-0x32+0x2190+0x2*-0x236f,this[_0x5eece1(0x126)]=new Map(),this['head']={'prev':null,'next':null},this[_0x5eece1(0xcd)]={'prev':null,'next':null},this[_0x5eece1(0xab)][_0x5eece1(0x10f)]=this[_0x5eece1(0xcd)],this[_0x5eece1(0xcd)][_0x5eece1(0x81)]=this[_0x5eece1(0xab)];}static[_0x2e41a7(0x109)+'ze'](_0x142b38,_0x530e8f){const _0x374703=_0x2e41a7,_0x235c66=Buffer[_0x374703(0xc6)](String(_0x142b38),'utf8'),_0x462b87=Buffer['byteLength'](_0x530e8f??'',_0x374703(0x108));return _0x235c66+_0x462b87+(0x7*-0x20e+0xb3a+0xda*0x4);}['_removeNod'+'e'](_0x5998e7){const _0x557e71=_0x2e41a7;_0x5998e7[_0x557e71(0x81)][_0x557e71(0x10f)]=_0x5998e7[_0x557e71(0x10f)],_0x5998e7[_0x557e71(0x10f)][_0x557e71(0x81)]=_0x5998e7[_0x557e71(0x81)];}[_0x2e41a7(0x8a)](_0x29a9e7){const _0x1470fb=_0x2e41a7;_0x29a9e7[_0x1470fb(0x81)]=this['tail'][_0x1470fb(0x81)],_0x29a9e7['next']=this[_0x1470fb(0xcd)],this[_0x1470fb(0xcd)][_0x1470fb(0x81)][_0x1470fb(0x10f)]=_0x29a9e7,this[_0x1470fb(0xcd)][_0x1470fb(0x81)]=_0x29a9e7;}[_0x2e41a7(0x88)+'l'](_0x19e9ba){const _0x312bda=_0x2e41a7;this[_0x312bda(0xc7)+'e'](_0x19e9ba),this['_addToTail'](_0x19e9ba);}[_0x2e41a7(0x84)](_0x1ec6bd){const _0x49a421=_0x2e41a7;return this[_0x49a421(0x126)][_0x49a421(0x84)](_0x1ec6bd);}[_0x2e41a7(0x119)](_0x4bafd2){const _0x57d1a3=_0x2e41a7,_0x4da668=this[_0x57d1a3(0x126)][_0x57d1a3(0x119)](_0x4bafd2);if(!_0x4da668)return undefined;return this[_0x57d1a3(0x88)+'l'](_0x4da668),_0x4da668[_0x57d1a3(0x8d)];}['set'](_0x46acba,_0x769fc,_0x41eb96){const _0x4f9541=_0x2e41a7,_0x5b1a88=this[_0x4f9541(0x126)]['get'](_0x46acba),_0x56ec75=MemoryCache[_0x4f9541(0x109)+'ze'](_0x46acba,_0x41eb96);if(_0x56ec75>this[_0x4f9541(0x10e)]){warn(_0x4f9541(0x80)+_0x4f9541(0x87)+_0x4f9541(0xd6)+'tem\x20\x22'+_0x46acba+_0x4f9541(0x74)+_0x56ec75+('\x20bytes\x20>\x20m'+_0x4f9541(0x71))+this[_0x4f9541(0x10e)]+')');if(_0x5b1a88)this['delete'](_0x46acba);return;}if(_0x5b1a88)this['bytes']-=_0x5b1a88[_0x4f9541(0x8f)],_0x5b1a88[_0x4f9541(0x8d)]=_0x769fc,_0x5b1a88['serialized']=_0x41eb96,_0x5b1a88[_0x4f9541(0x8f)]=_0x56ec75,this[_0x4f9541(0x91)]+=_0x56ec75,this['_moveToTai'+'l'](_0x5b1a88);else{const _0x163f8c={'key':_0x46acba,'value':_0x769fc,'serialized':_0x41eb96,'size':_0x56ec75,'prev':null,'next':null};this['map'][_0x4f9541(0xaf)](_0x46acba,_0x163f8c),this[_0x4f9541(0x8a)](_0x163f8c),this[_0x4f9541(0x91)]+=_0x56ec75;}while(this['bytes']>this['maxBytes']){const _0x210c4d=this[_0x4f9541(0xab)][_0x4f9541(0x10f)];if(_0x210c4d===this[_0x4f9541(0xcd)])break;this[_0x4f9541(0xea)](_0x210c4d['key']);}}[_0x2e41a7(0xea)](_0x194d01){const _0x43f752=_0x2e41a7,_0x4f5756=this['map'][_0x43f752(0x119)](_0x194d01);if(!_0x4f5756)return;this[_0x43f752(0xc7)+'e'](_0x4f5756),this[_0x43f752(0x126)]['delete'](_0x194d01),this[_0x43f752(0x91)]-=_0x4f5756[_0x43f752(0x8f)];}}function _0x8ea0(_0x36eac6,_0x50362d){const _0x3dc524=_0x29b9();return _0x8ea0=function(_0x4e03c4,_0x261b0a){_0x4e03c4=_0x4e03c4-(-0x109e+0x15d1+-0x4c5);let _0x98ca12=_0x3dc524[_0x4e03c4];return _0x98ca12;},_0x8ea0(_0x36eac6,_0x50362d);}function enforceMemoryLimit(){const _0x3afd58=_0x2e41a7;while(cache[_0x3afd58(0x91)]+queueBytes>maxTotalBytes&&writeQueue[_0x3afd58(0x129)]>0x2f5+-0x1*0x26bd+0x728*0x5){const _0x89518b=writeQueue[_0x3afd58(0xf4)]();_0x89518b[_0x3afd58(0x8f)]&&(queueBytes-=_0x89518b[_0x3afd58(0x8f)]),warn(_0x3afd58(0xcf)+_0x3afd58(0xe0)+_0x3afd58(0x10b)+_0x3afd58(0x8b)+_0x3afd58(0xfd)+_0x3afd58(0xc8)+_0x3afd58(0x11d)+_0x3afd58(0xa3)+_0x3afd58(0xd7)+_0x89518b[_0x3afd58(0x77)]+_0x3afd58(0x9f)+(_0x89518b['key']||_0x3afd58(0x118)));}}export async function initializeDatabase(){const _0xeaba8f=_0x2e41a7;info(_0xeaba8f(0xeb)+_0xeaba8f(0x113)+_0xeaba8f(0xd2)+_0xeaba8f(0x10d)+'..');try{flushTimer&&(clearInterval(flushTimer),flushTimer=null);const _0x30e8db=getConfig();maxTotalBytes=_0x30e8db[_0xeaba8f(0xc2)+'AX_BYTES'],cache=new MemoryCache(maxTotalBytes);const _0x1b375b=_0x30e8db['PROJECT_RO'+'OT'],_0x2c14a=_0x46922b[_0xeaba8f(0x12d)](_0x1b375b,_0x30e8db[_0xeaba8f(0xe1)]);_0x308d6f[_0xeaba8f(0x7c)+_0xeaba8f(0x7d)](_0x2c14a);const _0x4ccbc7=_0x30e8db[_0xeaba8f(0xff)],_0x400b5c=_0x46922b[_0xeaba8f(0x127)](_0x2c14a,_0x4ccbc7);await backupDB(_0x400b5c),db=await open({'filename':_0x400b5c,'driver':_0x5df63d['Database']}),await db[_0xeaba8f(0xc9)](_0xeaba8f(0x76)+_0xeaba8f(0xcc)+_0xeaba8f(0xc3)),await db[_0xeaba8f(0xc9)](_0xeaba8f(0xe4)+'chronous\x20='+_0xeaba8f(0xce)),await db[_0xeaba8f(0xc9)](_0xeaba8f(0x90)+'y_timeout\x20'+'=\x2010000;'),await db[_0xeaba8f(0xc9)](_0xeaba8f(0x125)+_0xeaba8f(0xdf)+'=\x20ON;'),await applyMigrations(),await prepareStatements(),dbReady=!![],writeQueue=[],queueBytes=0x1*0x1747+0x16*0x12a+-0x9c7*0x5;const _0x1a16e0=_0x30e8db[_0xeaba8f(0x128)+_0xeaba8f(0x116)];flushTimer=setInterval(()=>flushQueue(),_0x1a16e0),info(_0xeaba8f(0xf6)+'uccessfull'+_0xeaba8f(0x9b)+'zed\x20at\x20'+_0x400b5c+(_0xeaba8f(0xa9)+_0xeaba8f(0x12a)));}catch(_0x589994){error(_0xeaba8f(0xee)+_0xeaba8f(0x97)+(_0x589994?.[_0xeaba8f(0xe6)]||_0x589994),_0x589994);throw _0x589994;}}async function prepareStatements(){const _0x258ace=_0x2e41a7;setStmt=await db[_0x258ace(0x6e)](_0x258ace(0x107)+_0x258ace(0xca)+_0x258ace(0x83)+_0x258ace(0x11b)+_0x258ace(0xf9)+')\x20VALUES\x20('+_0x258ace(0x96)),deleteStmt=await db[_0x258ace(0x6e)](_0x258ace(0x89)+_0x258ace(0xda)+_0x258ace(0xb0)+_0x258ace(0xc0)+'?'),logStmt=await db[_0x258ace(0x6e)](_0x258ace(0xf2)+_0x258ace(0xbb)+',\x20module,\x20'+_0x258ace(0xef)+_0x258ace(0x112)+_0x258ace(0xf3)+_0x258ace(0x96));}async function applyMigrations(){const _0x4b72b2=_0x2e41a7;await db[_0x4b72b2(0xc9)](_0x4b72b2(0x9c)+_0x4b72b2(0x121)+_0x4b72b2(0x7e)+_0x4b72b2(0x7a)+_0x4b72b2(0xa6)+'XT\x20PRIMARY'+'\x20KEY,\x20valu'+'e\x20TEXT);'),await db[_0x4b72b2(0xc9)]('CREATE\x20TAB'+'LE\x20IF\x20NOT\x20'+_0x4b72b2(0xf8)+_0x4b72b2(0xb9)+_0x4b72b2(0x124)+_0x4b72b2(0x11e)+_0x4b72b2(0xfc)+_0x4b72b2(0xb5)+_0x4b72b2(0x8c)+_0x4b72b2(0xad));}async function flushQueue(){const _0x36ddc9=_0x2e41a7;if(!dbReady||isFlushing||writeQueue['length']===-0x34*0x11+0x19e+0xeb*0x2)return;const _0x141c9b=writeQueue[-0x9*0x3c3+0xb6f+0x1*0x166c];if(_0x141c9b[_0x36ddc9(0x123)]>-0x19*-0x53+-0x1c7a+0x1*0x145f&&Date[_0x36ddc9(0x73)]()-_0x141c9b[_0x36ddc9(0xb8)]<-0x3*0x3fa+-0xb47*0x1+0x22ed)return;isFlushing=!![];const _0xf8bb0e=writeQueue[_0x36ddc9(0xf5)](0x6*0x599+0x277+0x1*-0x240d,getConfig()['DB_BATCH_S'+_0x36ddc9(0xb3)]),_0x5a8a27=_0xf8bb0e[_0x36ddc9(0xec)]((_0xc4fa5d,_0x1ebd25)=>_0xc4fa5d+(_0x1ebd25[_0x36ddc9(0x8f)]||-0x3b*0x1+-0x1e09+-0x1e44*-0x1),-0x25*0x10b+0xafa+0x1b9d);try{await db[_0x36ddc9(0xc9)]('BEGIN\x20TRAN'+_0x36ddc9(0xbe));for(const _0x1bbef6 of _0xf8bb0e){try{switch(_0x1bbef6[_0x36ddc9(0x77)]){case'set':await setStmt[_0x36ddc9(0xb7)](_0x1bbef6[_0x36ddc9(0x10a)],_0x1bbef6[_0x36ddc9(0x8d)]);break;case _0x36ddc9(0xea):await deleteStmt[_0x36ddc9(0xb7)](_0x1bbef6[_0x36ddc9(0x10a)]);break;case'log':await logStmt[_0x36ddc9(0xb7)](_0x1bbef6[_0x36ddc9(0x11f)]['ts'],_0x1bbef6['data'][_0x36ddc9(0xd9)],_0x1bbef6[_0x36ddc9(0x11f)][_0x36ddc9(0xd5)],_0x1bbef6[_0x36ddc9(0x11f)][_0x36ddc9(0xe6)]);break;}}catch(_0x58d67f){error('Failed\x20to\x20'+_0x36ddc9(0x104)+_0x36ddc9(0x79)+_0x36ddc9(0x9e)+_0x36ddc9(0xc5)+'saction\x20ro'+_0x36ddc9(0x12e)+JSON[_0x36ddc9(0x120)](_0x1bbef6),_0x58d67f);throw _0x58d67f;}}await db['exec'](_0x36ddc9(0x6f)),queueBytes-=_0x5a8a27;}catch(_0x4a8e30){error('DB\x20flush\x20t'+_0x36ddc9(0xa8)+'\x20failed,\x20r'+_0x36ddc9(0x117)+_0x36ddc9(0x8e)+_0x36ddc9(0xf7)+_0x36ddc9(0xed),_0x4a8e30);try{await db['exec'](_0x36ddc9(0x95));}catch(_0x3ae4ac){error(_0x36ddc9(0x110)+_0x36ddc9(0x94),_0x3ae4ac);}const _0xe16c8=Date['now'](),_0x3030de=[];for(const _0x1d7331 of _0xf8bb0e){_0x1d7331[_0x36ddc9(0x123)]=(_0x1d7331[_0x36ddc9(0x123)]||-0x6f*0x25+0x6*-0x50d+0x2e59)+(0xa0e+-0x225*0x7+0x4f6),_0x1d7331[_0x36ddc9(0xb8)]=_0xe16c8,_0x1d7331['retries']<-0x1*0x1a12+0xb99*0x1+0x151*0xb?_0x3030de[_0x36ddc9(0x9a)](_0x1d7331):error(_0x36ddc9(0xe7)+_0x36ddc9(0x92)+_0x36ddc9(0x7b)+_0x36ddc9(0xbc)+_0x36ddc9(0xc4)+_0x36ddc9(0xa2)+JSON[_0x36ddc9(0x120)](_0x1d7331));}_0x3030de[_0x36ddc9(0x129)]>0x2319+0x2533+-0xe*0x52a&&writeQueue[_0x36ddc9(0xb2)](..._0x3030de);}finally{isFlushing=![];}}export async function get(_0x1a8cd3){const _0x47a73c=_0x2e41a7;if(cache[_0x47a73c(0x84)](_0x1a8cd3))return cache[_0x47a73c(0x119)](_0x1a8cd3);if(!dbReady)return warn(_0x47a73c(0xd8)+_0x47a73c(0xe5)+_0x47a73c(0x93)+'.'),undefined;try{const _0x1bda3d=await db['get']('SELECT\x20val'+_0x47a73c(0xae)+_0x47a73c(0xc1)+_0x47a73c(0x70)+_0x47a73c(0xb4),_0x1a8cd3);if(_0x1bda3d?.[_0x47a73c(0x8d)]){const _0x4a05ee=JSON['parse'](_0x1bda3d['value']);return cache[_0x47a73c(0xaf)](_0x1a8cd3,_0x4a05ee,_0x1bda3d['value']),_0x4a05ee;}}catch(_0x9cff52){error(_0x47a73c(0x10c)+_0x47a73c(0xf1)+_0x1a8cd3+(_0x47a73c(0xfb)+'\x20')+_0x9cff52[_0x47a73c(0xe6)],_0x9cff52);}return undefined;}export function set(_0xb320fe,_0xb63a52){const _0x544fef=_0x2e41a7;if(_0xb63a52===undefined){del(_0xb320fe);return;}let _0x1a0d35;try{_0x1a0d35=JSON['stringify'](_0xb63a52);}catch(_0x3404ed){error(_0x544fef(0x75)+_0x544fef(0xf0)+_0xb320fe+(_0x544fef(0x12b)+_0x544fef(0x7f)+_0x544fef(0x99)+_0x544fef(0x85)),_0x3404ed);return;}cache['set'](_0xb320fe,_0xb63a52,_0x1a0d35);const _0x102ea9={'type':_0x544fef(0xaf),'key':_0xb320fe,'value':_0x1a0d35,'retries':0x0,'timestamp':Date[_0x544fef(0x73)]()};_0x102ea9[_0x544fef(0x8f)]=estimateQueueItemSize(_0x102ea9),queueBytes+=_0x102ea9[_0x544fef(0x8f)],writeQueue[_0x544fef(0x9a)](_0x102ea9),enforceMemoryLimit(),writeQueue[_0x544fef(0x129)]>=getConfig()['DB_BATCH_S'+'IZE']&&flushQueue();}export function del(_0x5e151c){const _0x31f194=_0x2e41a7;cache[_0x31f194(0xea)](_0x5e151c);const _0x305062={'type':_0x31f194(0xea),'key':_0x5e151c,'retries':0x0,'timestamp':Date[_0x31f194(0x73)]()};_0x305062[_0x31f194(0x8f)]=estimateQueueItemSize(_0x305062),queueBytes+=_0x305062[_0x31f194(0x8f)],writeQueue[_0x31f194(0x9a)](_0x305062),enforceMemoryLimit(),writeQueue['length']>=getConfig()[_0x31f194(0xbf)+_0x31f194(0xb3)]&&flushQueue();}export function logToDB(module,_0x48394b,_0x4ec56d){const _0x3a34c1=_0x2e41a7,_0x6cd5ef={'ts':Date[_0x3a34c1(0x73)](),'module':module,'level':_0x48394b,'message':String(_0x4ec56d)['slice'](0x65*-0x4d+0x740*-0x1+0x25a1,-0x9*0x55+-0x1dd4+-0x1*-0x28a1)},_0x2dbc03={'type':'log','data':_0x6cd5ef,'retries':0x0,'timestamp':Date[_0x3a34c1(0x73)]()};_0x2dbc03[_0x3a34c1(0x8f)]=estimateQueueItemSize(_0x2dbc03),queueBytes+=_0x2dbc03['size'],writeQueue[_0x3a34c1(0x9a)](_0x2dbc03),enforceMemoryLimit();}export async function shutdownDatabase(){const _0xcb74e6=_0x2e41a7;info(_0xcb74e6(0xf6)+_0xcb74e6(0x11c)+_0xcb74e6(0x12c)+_0xcb74e6(0x11a)+_0xcb74e6(0xba)+_0xcb74e6(0x111)),dbReady=![];flushTimer&&(clearInterval(flushTimer),flushTimer=null);await flushQueue(),await flushQueue(),info(_0xcb74e6(0x9d)+'h\x20complete'+'d.');if(db)try{if(setStmt)await setStmt[_0xcb74e6(0xe3)]();if(deleteStmt)await deleteStmt[_0xcb74e6(0xe3)]();if(logStmt)await logStmt['finalize']();await db[_0xcb74e6(0xd1)](),info(_0xcb74e6(0x72)+_0xcb74e6(0xe9)+_0xcb74e6(0x102)+_0xcb74e6(0x106)),db=null;}catch(_0x5507d9){error('Error\x20duri'+_0xcb74e6(0xd0)+_0xcb74e6(0xaa)+_0xcb74e6(0x122),_0x5507d9);}info(_0xcb74e6(0xf6)+'hutdown\x20pr'+_0xcb74e6(0xfe)+_0xcb74e6(0xcb)+'essfully.');}async function backupDB(_0xaadf13){const _0x10bb83=_0x2e41a7;try{if(!await _0x308d6f[_0x10bb83(0xfa)](_0xaadf13))return;const _0x2276d5=_0x46922b[_0x10bb83(0xe8)](_0xaadf13),_0x302465=_0x46922b['basename'](_0xaadf13,_0x46922b['extname'](_0xaadf13)),_0xd3b47c=_0x46922b[_0x10bb83(0x127)](_0x2276d5,_0x302465+_0x10bb83(0xa4)),_0x4c355c=await _0x308d6f[_0x10bb83(0xfa)](_0xd3b47c)?await _0x308d6f[_0x10bb83(0x86)](_0xd3b47c):null,_0x476747=_0x4c355c?Date[_0x10bb83(0x73)]()-_0x4c355c[_0x10bb83(0x114)]:Infinity;_0x476747>(0xc30+-0x2c5*0xa+0x1*0xf9a)*(0x77*0x19+-0x1*-0xf1d+-0x1a80)*(0x31*0x49+0x27d*-0x8+-0x1*-0x62b)*(-0x11f2+0x113d+0x49d)&&(await _0x308d6f[_0x10bb83(0xd3)](_0xaadf13,_0xd3b47c,{'overwrite':!![]}),info('Database\x20b'+_0x10bb83(0x105)+_0x10bb83(0xdd)+_0xd3b47c));}catch(_0xcb15df){error(_0x10bb83(0x103)+_0x10bb83(0xbd)+'ed:\x20'+_0xcb15df['message'],_0xcb15df);}}process[_0x2e41a7(0xde)](_0x2e41a7(0x115),()=>{const _0x49058f=_0x2e41a7;shutdownDatabase()[_0x49058f(0x78)](()=>process[_0x49058f(0xdc)](0x2d*-0x5d+0x9c*-0x8+0x1*0x1539));}),process[_0x2e41a7(0xde)]('SIGTERM',()=>{const _0x22f301=_0x2e41a7;shutdownDatabase()[_0x22f301(0x78)](()=>process[_0x22f301(0xdc)](-0x4*-0x85+-0x3e5+0x1f*0xf));});export{db};