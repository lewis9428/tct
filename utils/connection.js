function _0x3554(){const _0x5db0b9=['join','\x20WHERE\x20use',';\x0a\x20\x20\x20\x20\x20\x20','\x20@\x20','RDER\x20BY\x20na','toLowerCas','e\x20FROM\x20gro','slice','\x20to\x20set\x20as','ectionReco','M\x20connecti','nGroup:\x20','tor_id\x20=\x20?','s\x20SET\x20name','p\x20failed\x20f','-scoped).\x20','issing\x20cre','ator_id\x20TE','on-existen','rGroup\x20fai','E\x20group_de','_id\x20=\x20?','up_id\x20colu','\x20(user_key','SACTION;','\x20PRIMARY\x20K','g\x20old\x20rows','n]\x20ensureS','nectionsCa','function','n]\x20connect','\x20{\x20db\x20}','\x20->\x20','map','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','to\x20persist','n]\x20setActi','upDefaults','up_id','d\x20=\x20?','SELECT\x20gro','odule\x20did\x20','n]\x20listCon','?,\x20?,\x20?,\x20?','E\x20name\x20=\x20?','LUMN\x20creat','includes','SELECT\x20nam','all','EY\x20(name,\x20',',\x20creator_','nectionsFo','\x20WHERE\x20nam','with\x20group','issing\x20gro','on]\x20normal','quired\x20for','EXT\x20NOT\x20NU','user_activ','filter','XT\x20PRIMARY','push','rUser\x20fail','_id\x20TEXT\x20N','\x20=\x20?\x20WHERE','tGroup','n]\x20created','DELETE\x20FRO','ectionName','on]\x20readin','ultsNameTo','changes','roup_id\x20TE','4FOIOOa','\x20chat_id,\x20','2105425PTtjoL','set','\x0a\x20\x20\x20\x20\x20\x20CRE','ectionScop','\x20\x20\x20\x20group_','\x22\x20@\x20group\x20','onnectionS','ized\x20group','\x0a\x20\x20\x20\x20\x20\x20\x20\x20g','\x20for\x20','nsChatIdTo','efault\x20set','NFLICT(gro','ND\x20group_i','roup','to\x20import\x20','led\x20for\x20','ons\x20WHERE\x20','60xZKpOR','s\x20failed','[INFO]','T\x20NULL\x20DEF','up_default','n]\x20deleteC','message','oup_id\x20TEX','d:\x20','\x20WHERE\x20typ','\x20DEFAULT\x20\x27','ections','n]\x20loadAct','from','6NmSjQY','\x20connectio','string','ROM\x20connec','ared\x20for\x20','nGroup\x20fai','ORDER\x20BY\x20g',')\x20failed','on]\x20insert','No\x20valid\x20c','che\x20loaded','REPLACE\x20IN','\x20loaded\x20(','e,\x20group_i','oup_id\x20=\x20?','\x20=\x20?,\x20crea','rray\x20type\x20','entries','le_info(','for\x20','nnections','hatIdsFrom','n]\x20getActi','p_id\x20PK)','id\x20for\x20\x22','\x20\x20\x20\x20\x20\x20chat','n]\x20updated','up_id,\x20nam','\x20CONFLICT(','DEFAULT\x20\x27\x27','\x20table\x20gro','ultGroup\x20f','ensured\x20an','pDefaultsC','or_id\x20TEXT','group_id,\x20','\x20setDefaul','p_id\x20TEXT\x20','\x20into\x20conn','User\x20error','O\x20connecti','n\x20complete','ailed:\x20','on\x20to\x20new\x20','\x20COLUMN\x20na','\x20to\x20update','chema\x20fail','plete','has','ET\x20chat_id','t_id','n]\x20migrati','\x20\x20\x20\x20\x20);\x0a\x20\x20','n\x20names\x20ex','INSERT\x20OR\x20','on]\x20failed',')\x20@\x20group=','5264170leYuqR','roup_id,\x20n','user_key','819036PycHFb','s\x20group','Connection','s\x20schema\x20f','\x20(deleted=','faults\x20WHE','\x20(?,\x20?)\x0a\x20\x20','nections\x20S','RY\x20KEY,\x0a\x20\x20','n][migrati','eGroupDefa','\x20\x20\x20\x20\x20\x20\x20cre','id\x20FROM\x20co','n]\x20failed\x20','BEGIN\x20TRAN','w\x20failed\x20f','=\x20?','ions\x20cache','stringify','iveGroupsC','warn','OT\x20NULL,\x0a\x20','\x20(arrays-o','\x22\x20in\x20','n]\x20loadCon','ection(','ATE\x20TABLE\x20','nly,\x20group','_id\x20=\x20?\x20OR','FAULT\x20\x27\x27;','defaults\x20(','veGroupFor','e=\x27table\x27\x20','277533KBQQcF','LL\x0a\x20\x20\x20\x20\x20\x20)','\x20group_id\x20','LUMN\x20group','delete','nnections\x20','AND\x20group_','TEXT\x20PRIMA','id,\x20group_','nnections;','oup\x20deleti','led:\x20','roup_id\x20=\x20','issing\x20cha','efault\x20cle',')\x20VALUES\x20(','tions\x20WHER','s\x20WHERE\x20na','ection\x20fai','Array\x20fail','4689960kNlgju','SELECT\x20cha','STS\x20','ache\x20faile','DROP\x20TABLE','e_groups','\x20table\x20','\x20\x20\x20\x20\x20ON\x20CO','UPDATE\x20SET','IF\x20NOT\x20EXI','error','NOT\x20NULL\x0a\x20','or\x20','\x20\x20\x20\x20\x20\x20);\x0a\x20','n]\x20addGrou','on]\x20migrat','aultGroup','creator_id','d\x20migratio','n]\x20getConn','onnections','NULL,\x0a\x20\x20\x20\x20','length','\x20now\x20->\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)','\x20AND\x20group','Caches\x20loa','ed:\x20','\x20group_def','up_id)\x20DO\x20','STS\x20connec','ame','_defaults\x20','\x20active\x20gr','Cache\x20fail','faults\x20ADD','names\x20prov','group_id\x20=','[WARN]','isArray','faults\x20(gr','d,\x20chat_id',',\x20group_id','\x20COLUMN\x20gr','connection','\x20=\x20?\x20AND\x20g','E\x20IF\x20NOT\x20E','ultForGrou','trim','XT\x20NOT\x20NUL','n]\x20addConn','30jhCZId','ByCreatorI','e,\x20chat_id','group_id','UPDATE\x20gro','AULT\x20\x27[]\x27;','\x20FROM\x20conn','r_key,\x20gro','name','INSERT\x20INT','\x20user_key\x20','SET\x20group_','or_id)\x20VAL','ALTER\x20TABL','\x20all','L,\x0a\x20\x20\x20\x20\x20\x20\x20','w\x20(\x0a\x20\x20\x20\x20\x20\x20','k\x20failed\x20f','Scoped:\x20re','olumns\x20fai','aults\x20for\x20','ultGroup:\x20','None\x20of\x20th','name\x20=\x20?\x20A','\x20IF\x20EXISTS','ded.group_','\x20NOT\x20NULL\x20','n]\x20removeC','AULT\x20\x27\x27,\x0a\x20','he\x20loaded\x20','n]\x20added\x20m','n]\x20getDefa','me\x20TEXT\x20NO','values','ons\x20(name,','Unsupporte','LL,\x0a\x20\x20\x20\x20\x20\x20','n]\x20active\x20','NAME\x20TO\x20co','lumn','O\x20group_de','[connectio','\x20\x20\x20\x20\x20\x20name','oup_id,\x20na','T\x20NOT\x20NULL','ed(','entries\x20fo','nections\x20(','name,\x20grou','No\x20connect','r_key\x20=\x20?','\x20name\x20=\x20?\x20','WHERE\x20grou','\x20group_id,','WHERE\x20crea','ons\x20ADD\x20CO','\x20group_id)','p_id\x20=\x20?\x20O','for\x20setDef','hat_id\x20TEX','to\x20add\x20cha','moved\x20all\x20','ions\x20found','ailed\x20for\x20','ections_ne','XISTS\x20conn','E\x20connecti','\x20=\x20?\x20LIMIT','OT\x20NULL\x20DE','t_id\x20FROM\x20','Caches\x20com','ns;','654418OdZPGT','\x20loaded\x20(0','etDefaultG','1998227gdxAZw','ults','group_defa','group_id)\x0a','\x20\x20\x20\x20\x20\x20grou','up_id\x20FROM','ist\x20in\x20thi','Scoped\x20fai','ite_master','SELECT\x20use','?,\x20?)\x20\x0a\x20\x20\x20','chat_id','e\x20FROM\x20sql','run','ult\x20failed','\x20\x20PRIMARY\x20','groups\x20cac','get','rdScoped(','s\x20WHERE\x20gr','to\x20add\x20gro','n]\x20schema\x20','on\x20\x22','exec','database.j','groupId\x20re','ided\x20for\x20s','parse','ator_id','\x20(creator=','\x20\x20\x20\x20\x20\x20\x20\x20\x20c','\x20KEY,\x0a\x20\x20\x20\x20','\x20rows)','onnection\x20','\x20table\x20con','coped:\x20','id\x20=\x20?','COMMIT;','n]\x20group\x20d','me\x20=\x20?\x20AND','skipping\x20n','efaults\x20ca','UPDATE\x20con','undefined','some','\x20(0\x20rows)','user_key)\x20','ted','clear','split','id\x20TEXT\x20NO'];_0x3554=function(){return _0x5db0b9;};return _0x3554();}const _0x2dc5d3=_0x2e64;(function(_0x3fd5b5,_0x1cd76c){const _0x1901ff=_0x2e64,_0x3b4d71=_0x3fd5b5();while(!![]){try{const _0x70ac34=parseInt(_0x1901ff(0xac))/(0x2*0x8db+-0x39*0x57+0x1aa)*(parseInt(_0x1901ff(0x12b))/(0x143+0x10c6+0x163*-0xd))+-parseInt(_0x1901ff(0x1aa))/(0x4aa+-0xb*-0x17e+0x1511*-0x1)*(-parseInt(_0x1901ff(0x13f))/(-0xd18+-0x1d67+0x2a83))+-parseInt(_0x1901ff(0x186))/(0x3e0+0x1d*0xa0+-0x15fb)*(parseInt(_0x1901ff(0x14d))/(-0xf90+-0x74e*-0x1+-0xa*-0xd4))+-parseInt(_0x1901ff(0x12d))/(0x1*0x1636+-0x15c*0x1+-0x1*0x14d3)+-parseInt(_0x1901ff(0x1be))/(0x362+-0x4*0x4a0+-0x7*-0x22a)+parseInt(_0x1901ff(0x189))/(0x7f3+-0xf*0x296+0x1ee0)*(parseInt(_0x1901ff(0x1f1))/(0x19*0x17+-0x564+-0x1*-0x32f))+-parseInt(_0x1901ff(0xaf))/(0xec8+0xe1+-0xf9e);if(_0x70ac34===_0x1cd76c)break;else _0x3b4d71['push'](_0x3b4d71['shift']());}catch(_0x1c530c){_0x3b4d71['push'](_0x3b4d71['shift']());}}}(_0x3554,0x28083*-0x6+0x10be81+0x42b9*0x2b));import{info as _0x1cbdd4,warn as _0x280a23,error as _0x244afc}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map(),connectionsCache=new Map(),groupDefaultsCache=new Map(),ACTIVE_TABLE=_0x2dc5d3(0x11c)+_0x2dc5d3(0x1c3);function info(..._0x97bbd1){const _0x29fedc=_0x2dc5d3;try{_0x1cbdd4(..._0x97bbd1);}catch(_0x52394c){console['log'](_0x29fedc(0x141),..._0x97bbd1);}}function warn(..._0x11e3a7){const _0x5172f7=_0x2dc5d3;try{_0x280a23(..._0x11e3a7);}catch(_0xdb056a){console[_0x5172f7(0x19d)](_0x5172f7(0x1e4),..._0x11e3a7);}}function error(..._0x3f24d4){const _0x5a4ccb=_0x2dc5d3;try{_0x244afc(..._0x3f24d4);}catch(_0x56b2aa){console[_0x5a4ccb(0x1c8)]('[ERROR]',..._0x3f24d4);}}async function getDb(){const _0xef0870=_0x2dc5d3;if(db&&typeof db['exec']===_0xef0870(0xff))return db;try{const _0x53a1c0=await import('./database.js');if(_0x53a1c0&&_0x53a1c0['db'])return db=_0x53a1c0['db'],db;throw new Error('database\x20m'+_0xef0870(0x10b)+'not\x20export'+_0xef0870(0x101));}catch(_0x1982fc){error(_0x1982fc,_0xef0870(0x8d)+_0xef0870(0x196)+_0xef0870(0x13c)+_0xef0870(0xc7)+'s');throw _0x1982fc;}}function safeParseJSON(_0x4a1069){const _0x5ba0c6=_0x2dc5d3;try{return JSON[_0x5ba0c6(0xca)](_0x4a1069);}catch(_0x567f3a){return null;}}function asArrayStrict(_0x5ed782){const _0x52c672=_0x2dc5d3;if(_0x5ed782===null||_0x5ed782===undefined)return[];if(typeof _0x5ed782===_0x52c672(0x14f)){const _0x270fc3=safeParseJSON(_0x5ed782);if(Array[_0x52c672(0x1e5)](_0x270fc3))return _0x270fc3[_0x52c672(0x103)](String);return[_0x5ed782];}if(Array[_0x52c672(0x1e5)](_0x5ed782))return _0x5ed782['map'](String);return[String(_0x5ed782)];}function toJSONString(_0x264c5c){const _0x244f3c=_0x2dc5d3;return JSON[_0x244f3c(0x19b)](Array[_0x244f3c(0x1e5)](_0x264c5c)?_0x264c5c[_0x244f3c(0x103)](String):[]);}async function tableExists(_0x447175){const _0x4f268a=_0x2dc5d3,_0xcb5575=await getDb(),_0x4b7cf0=await _0xcb5575[_0x4f268a(0xc0)](_0x4f268a(0x111)+_0x4f268a(0xbb)+_0x4f268a(0xb7)+_0x4f268a(0x148)+_0x4f268a(0x1a9)+'AND\x20name\x20='+'\x20?',[String(_0x447175)]);return!!_0x4b7cf0;}async function columnExists(_0x4d12fc,_0x1dd457){const _0x27fbd4=_0x2dc5d3;try{const _0x55089b=await getDb(),_0x55e44a=await _0x55089b[_0x27fbd4(0x112)]('PRAGMA\x20tab'+_0x27fbd4(0x15f)+_0x4d12fc+')');if(!Array[_0x27fbd4(0x1e5)](_0x55e44a))return![];return _0x55e44a[_0x27fbd4(0xdb)](_0x51e64f=>String(_0x51e64f[_0x27fbd4(0x1f9)])[_0x27fbd4(0xe7)+'e']()===String(_0x1dd457)[_0x27fbd4(0xe7)+'e']());}catch(_0x499a03){return warn('[connectio'+'n]\x20columnE'+'xists\x20chec'+_0x27fbd4(0x75)+_0x27fbd4(0x1ca)+_0x4d12fc+'.'+_0x1dd457+':\x20'+(_0x499a03?.[_0x27fbd4(0x145)]||_0x499a03)),![];}}async function ensureConnectionsTable(){const _0x2ba014=_0x2dc5d3,_0x56fbca=await getDb(),_0x307e34=await tableExists(_0x2ba014(0x1ea)+'s');if(!_0x307e34){await _0x56fbca[_0x2ba014(0xc6)](_0x2ba014(0x12f)+_0x2ba014(0x1a3)+_0x2ba014(0x1c7)+_0x2ba014(0x1dc)+'tions\x20(\x0a\x20\x20'+_0x2ba014(0x8e)+'\x20TEXT\x20NOT\x20'+_0x2ba014(0x1d3)+_0x2ba014(0x131)+_0x2ba014(0xe1)+'T\x20NULL,\x0a\x20\x20'+_0x2ba014(0x166)+_0x2ba014(0x121)+_0x2ba014(0x19e)+_0x2ba014(0x194)+_0x2ba014(0xf3)+_0x2ba014(0x1ef)+_0x2ba014(0x73)+_0x2ba014(0xfb)+_0x2ba014(0x113)+_0x2ba014(0xb2)+_0x2ba014(0x1cb)+'\x20\x20\x20'),info(_0x2ba014(0x8d)+_0x2ba014(0x124)+_0x2ba014(0xd1)+_0x2ba014(0x93)+'name,\x20grou'+_0x2ba014(0x164));return;}const _0x2465ff=await columnExists(_0x2ba014(0x1ea)+'s',_0x2ba014(0x1f4)),_0x42694b=await columnExists(_0x2ba014(0x1ea)+'s',_0x2ba014(0xba)),_0x3268f2=await columnExists(_0x2ba014(0x1ea)+'s',_0x2ba014(0x1cf));if(!_0x42694b||!_0x3268f2||!_0x2465ff)try{await _0x56fbca['exec']('\x0a\x20\x20\x20\x20\x20\x20\x20\x20C'+'REATE\x20TABL'+_0x2ba014(0x1ec)+_0x2ba014(0xa5)+_0x2ba014(0xa4)+_0x2ba014(0x74)+'\x20\x20\x20\x20name\x20T'+_0x2ba014(0x11b)+_0x2ba014(0x88)+'\x20\x20\x20\x20group_'+_0x2ba014(0xe1)+'T\x20NULL\x20DEF'+_0x2ba014(0x80)+_0x2ba014(0xcd)+_0x2ba014(0x9f)+_0x2ba014(0x90)+_0x2ba014(0x149)+'[]\x27,\x0a\x20\x20\x20\x20\x20'+'\x20\x20\x20\x20\x20creat'+_0x2ba014(0x16f)+_0x2ba014(0x7e)+_0x2ba014(0x16a)+',\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+_0x2ba014(0xbe)+'KEY\x20(name,'+_0x2ba014(0x9c)+_0x2ba014(0x1d6)+_0x2ba014(0xe4));try{const _0x4897bd=await _0x56fbca['all'](_0x2ba014(0x111)+_0x2ba014(0x1f3)+_0x2ba014(0x114)+'id\x20FROM\x20co'+'nnections');if(Array[_0x2ba014(0x1e5)](_0x4897bd)&&_0x4897bd['length'])for(const _0x562f81 of _0x4897bd){const _0x22efa3=_0x562f81[_0x2ba014(0x1f9)],_0x2b9b91=typeof _0x562f81[_0x2ba014(0xba)]===_0x2ba014(0xda)||_0x562f81[_0x2ba014(0xba)]===null?'[]':_0x562f81[_0x2ba014(0xba)],_0x4a9925=typeof _0x562f81[_0x2ba014(0x1cf)]==='undefined'||_0x562f81[_0x2ba014(0x1cf)]===null?'':_0x562f81[_0x2ba014(0x1cf)];try{await _0x56fbca[_0x2ba014(0xbc)](_0x2ba014(0x183)+_0x2ba014(0x158)+'TO\x20connect'+'ions_new\x20('+_0x2ba014(0x94)+'p_id,\x20chat'+'_id,\x20creat'+_0x2ba014(0x70)+'UES\x20(?,\x20?,'+'\x20?,\x20?)',[_0x22efa3,'',_0x2b9b91,_0x4a9925]);}catch(_0x1ac8a3){warn('[connectio'+_0x2ba014(0x192)+_0x2ba014(0x155)+_0x2ba014(0x173)+_0x2ba014(0xa4)+_0x2ba014(0x198)+_0x2ba014(0x1ca)+_0x22efa3+':\x20'+(_0x1ac8a3?.[_0x2ba014(0x145)]||_0x1ac8a3));}}}catch(_0x76350){warn(_0x2ba014(0x8d)+'n][migrati'+_0x2ba014(0x127)+_0x2ba014(0xfc)+'\x20failed:\x20'+(_0x76350?.[_0x2ba014(0x145)]||_0x76350));}try{await _0x56fbca[_0x2ba014(0xc6)](_0x2ba014(0x1c2)+_0x2ba014(0x7c)+_0x2ba014(0x14e)+_0x2ba014(0xab));}catch(_0x1e41d6){}await _0x56fbca[_0x2ba014(0xc6)](_0x2ba014(0x71)+_0x2ba014(0xa6)+'ons_new\x20RE'+_0x2ba014(0x8a)+_0x2ba014(0x1b3)),info(_0x2ba014(0x8d)+'n]\x20migrate'+'d\x20connecti'+'ons\x20->\x20con'+'nections\x20('+_0x2ba014(0x117)+'_id)');}catch(_0x4e4ee4){warn(_0x2ba014(0x8d)+_0x2ba014(0x180)+_0x2ba014(0x178)+_0x2ba014(0x1ea)+_0x2ba014(0x18c)+_0x2ba014(0x177)+(_0x4e4ee4?.['message']||_0x4e4ee4));if(!_0x42694b)try{await _0x56fbca[_0x2ba014(0xc6)](_0x2ba014(0x71)+_0x2ba014(0xa6)+_0x2ba014(0x9b)+'LUMN\x20chat_'+_0x2ba014(0xe1)+_0x2ba014(0x142)+_0x2ba014(0x1f6)),info(_0x2ba014(0x8d)+_0x2ba014(0x82)+_0x2ba014(0x1b7)+'t_id\x20colum'+'n');}catch(_0x50d779){warn(_0x50d779,_0x2ba014(0x8d)+'n]\x20failed\x20'+_0x2ba014(0xa0)+_0x2ba014(0x17f));}if(!_0x3268f2)try{await _0x56fbca[_0x2ba014(0xc6)](_0x2ba014(0x71)+_0x2ba014(0xa6)+_0x2ba014(0x9b)+_0x2ba014(0x10f)+'or_id\x20TEXT'+_0x2ba014(0x7e)+_0x2ba014(0x16a)+';'),info(_0x2ba014(0x8d)+'n]\x20added\x20m'+_0x2ba014(0xf2)+'ator_id\x20co'+_0x2ba014(0x8b));}catch(_0x14584e){warn(_0x14584e,_0x2ba014(0x8d)+_0x2ba014(0x196)+'to\x20add\x20cre'+_0x2ba014(0xcb));}if(!_0x2465ff)try{await _0x56fbca[_0x2ba014(0xc6)](_0x2ba014(0x71)+'E\x20connecti'+_0x2ba014(0x9b)+_0x2ba014(0x1ad)+_0x2ba014(0x121)+_0x2ba014(0xa8)+_0x2ba014(0x1a6)),info('[connectio'+_0x2ba014(0x82)+_0x2ba014(0x118)+_0x2ba014(0xf8)+'mn');}catch(_0x3f5dce){warn(_0x3f5dce,_0x2ba014(0x8d)+'n]\x20failed\x20'+_0x2ba014(0xc3)+_0x2ba014(0x108));}}}async function ensureGroupDefaultsTable(){const _0x8c073d=_0x2dc5d3,_0x5ca031=await getDb(),_0x27f67f=await tableExists(_0x8c073d(0xb1)+'ults');if(!_0x27f67f){await _0x5ca031[_0x8c073d(0xc6)](_0x8c073d(0x12f)+_0x8c073d(0x1a3)+_0x8c073d(0x1c7)+'STS\x20group_'+_0x8c073d(0x1a7)+_0x8c073d(0x135)+_0x8c073d(0x12a)+_0x8c073d(0x11e)+_0x8c073d(0xce)+'\x20\x20\x20\x20name\x20T'+_0x8c073d(0x11b)+_0x8c073d(0x1ab)+';\x0a\x20\x20\x20\x20'),info(_0x8c073d(0x8d)+_0x8c073d(0x124)+_0x8c073d(0x16b)+_0x8c073d(0x143)+'s');return;}!await columnExists('group_defa'+_0x8c073d(0xb0),_0x8c073d(0x1f4))&&await addGroupDefaultsColumns();}function _0x2e64(_0xba31fe,_0x4cb930){const _0xb65ac8=_0x3554();return _0x2e64=function(_0x310558,_0x5e53b9){_0x310558=_0x310558-(-0x521+-0x110+0x69f);let _0x51c3cd=_0xb65ac8[_0x310558];return _0x51c3cd;},_0x2e64(_0xba31fe,_0x4cb930);}async function addGroupDefaultsColumns(){const _0x3da8f2=_0x2dc5d3,_0x255084=await getDb();try{await _0x255084[_0x3da8f2(0xc6)](_0x3da8f2(0x71)+'E\x20group_de'+_0x3da8f2(0x1e1)+_0x3da8f2(0x1e9)+_0x3da8f2(0x146)+'T\x20NOT\x20NULL'+'\x20DEFAULT\x20\x27'+'\x27;'),await _0x255084[_0x3da8f2(0xc6)](_0x3da8f2(0x71)+_0x3da8f2(0xf6)+_0x3da8f2(0x1e1)+_0x3da8f2(0x179)+_0x3da8f2(0x84)+_0x3da8f2(0x142)+'AULT\x20\x27[]\x27;');}catch(_0x3f3f06){warn(_0x3da8f2(0x8d)+_0x3da8f2(0x1cc)+_0x3da8f2(0x16e)+_0x3da8f2(0x77)+_0x3da8f2(0x1b5)+(_0x3f3f06?.[_0x3da8f2(0x145)]||_0x3f3f06));}}async function ensureActiveGroupsTable(){const _0x38651b=_0x2dc5d3,_0x370889=await getDb(),_0x2c2406=await tableExists(ACTIVE_TABLE);!_0x2c2406&&(await _0x370889[_0x38651b(0xc6)](_0x38651b(0x12f)+'ATE\x20TABLE\x20'+_0x38651b(0x1c7)+_0x38651b(0x1c0)+ACTIVE_TABLE+('\x20(\x0a\x20\x20\x20\x20\x20\x20\x20'+_0x38651b(0x6e)+_0x38651b(0x1b1)+_0x38651b(0x191)+_0x38651b(0xb3)+_0x38651b(0x172)+_0x38651b(0x1c9)+_0x38651b(0x181)+'\x20\x20')),info(_0x38651b(0x8d)+_0x38651b(0x124)+_0x38651b(0x1c4)+ACTIVE_TABLE));}async function migrateConnectionsChatIdToArray(){const _0x579d93=_0x2dc5d3;try{const _0x4132e6=await getDb(),_0x2ecc34=await _0x4132e6[_0x579d93(0x112)](_0x579d93(0x111)+'e,\x20group_i'+'d,\x20chat_id'+'\x20FROM\x20conn'+'ections');if(!_0x2ecc34||_0x2ecc34[_0x579d93(0x1d4)]===-0x3fd*-0x7+0x1bf1+-0x514*0xb)return;const _0x3e09c8=[];for(const _0x29b1e9 of _0x2ecc34){const _0x5f5cb5=_0x29b1e9[_0x579d93(0xba)],_0x322380=safeParseJSON(_0x5f5cb5);if(Array[_0x579d93(0x1e5)](_0x322380)){const _0xdde07c=_0x322380[_0x579d93(0x103)](String),_0x1c9581=toJSONString(_0xdde07c);if(_0x1c9581!==_0x5f5cb5)_0x3e09c8[_0x579d93(0x11f)]({'name':_0x29b1e9['name'],'group_id':_0x29b1e9[_0x579d93(0x1f4)]||'','chat_id':_0x1c9581});continue;}else{let _0x12c189=[];_0x5f5cb5===null||_0x5f5cb5===undefined||String(_0x5f5cb5)[_0x579d93(0x1ee)]()===''?_0x12c189=[]:_0x12c189=[String(_0x5f5cb5)];const _0x563c70=toJSONString(_0x12c189);_0x3e09c8[_0x579d93(0x11f)]({'name':_0x29b1e9[_0x579d93(0x1f9)],'group_id':_0x29b1e9[_0x579d93(0x1f4)]||'','chat_id':_0x563c70});}}if(_0x3e09c8['length']>-0x2007+-0x9*-0x1fc+-0x75*-0x1f){try{await _0x4132e6[_0x579d93(0xc6)](_0x579d93(0x197)+_0x579d93(0xfa));}catch(_0x23c1b4){}for(const _0x172dd4 of _0x3e09c8){try{await _0x4132e6[_0x579d93(0xbc)](_0x579d93(0xd9)+'nections\x20S'+_0x579d93(0x17e)+'\x20=\x20?\x20WHERE'+_0x579d93(0x97)+_0x579d93(0x1b0)+'id\x20=\x20?',[_0x172dd4[_0x579d93(0xba)],_0x172dd4[_0x579d93(0x1f9)],_0x172dd4[_0x579d93(0x1f4)]]),info(_0x579d93(0x8d)+_0x579d93(0x192)+_0x579d93(0x119)+'ized\x20chat_'+_0x579d93(0x165)+_0x172dd4[_0x579d93(0x1f9)]+(_0x579d93(0x132)+'\x22')+_0x172dd4[_0x579d93(0x1f4)]+'\x22');}catch(_0x43a397){warn(_0x579d93(0x8d)+'n][migrati'+_0x579d93(0x184)+_0x579d93(0x17a)+'\x20chat_id\x20f'+_0x579d93(0x1ca)+_0x172dd4[_0x579d93(0x1f9)]+'@'+_0x172dd4[_0x579d93(0x1f4)]+':\x20'+(_0x43a397?.[_0x579d93(0x145)]||_0x43a397));}}try{await _0x4132e6[_0x579d93(0xc6)](_0x579d93(0xd4));}catch(_0x5196eb){}}}catch(_0x332874){warn('[connectio'+_0x579d93(0x192)+_0x579d93(0x1cd)+'eConnectio'+_0x579d93(0x137)+_0x579d93(0x1bd)+_0x579d93(0x1d9)+(_0x332874?.[_0x579d93(0x145)]||_0x332874));}}async function migrateGroupDefaultsNameToArray(){const _0x413648=_0x2dc5d3;try{const _0x1ddcc4=await getDb(),_0x2485cb=await _0x1ddcc4[_0x413648(0x112)]('SELECT\x20gro'+_0x413648(0x168)+_0x413648(0xe8)+_0x413648(0x143)+'s');if(!_0x2485cb||_0x2485cb['length']===0x20b5+0x2d*-0xf+0x1*-0x1e12)return;const _0x324b26=[];for(const _0x3aaccd of _0x2485cb){const _0x4bd02f=_0x3aaccd[_0x413648(0x1f9)],_0x435cb7=safeParseJSON(_0x4bd02f);if(Array[_0x413648(0x1e5)](_0x435cb7)){const _0x583d04=toJSONString(_0x435cb7);if(_0x583d04!==_0x4bd02f)_0x324b26[_0x413648(0x11f)]({'group_id':_0x3aaccd['group_id'],'name':_0x583d04});continue;}else{const _0x244030=_0x4bd02f===null||_0x4bd02f===undefined||String(_0x4bd02f)[_0x413648(0x1ee)]()===''?[]:[String(_0x4bd02f)],_0x4cb227=toJSONString(_0x244030);_0x324b26[_0x413648(0x11f)]({'group_id':_0x3aaccd[_0x413648(0x1f4)],'name':_0x4cb227});}}if(_0x324b26[_0x413648(0x1d4)]>0xbb*0xc+0x7da+-0x109e){try{await _0x1ddcc4[_0x413648(0xc6)](_0x413648(0x197)+_0x413648(0xfa));}catch(_0x16fd26){}for(const _0x52b5cd of _0x324b26){try{await _0x1ddcc4['run'](_0x413648(0x1f5)+_0x413648(0x143)+_0x413648(0xef)+_0x413648(0x122)+_0x413648(0x1ac)+_0x413648(0x199),[_0x52b5cd['name'],_0x52b5cd[_0x413648(0x1f4)]]),info(_0x413648(0x8d)+'n][migrati'+_0x413648(0x119)+_0x413648(0x134)+_0x413648(0x1de)+_0x413648(0x160)+_0x52b5cd[_0x413648(0x1f4)]);}catch(_0x112009){warn(_0x413648(0x8d)+'n][migrati'+'on]\x20failed'+_0x413648(0x17a)+_0x413648(0x1da)+_0x413648(0x78)+_0x52b5cd[_0x413648(0x1f4)]+':\x20'+(_0x112009?.['message']||_0x112009));}}try{await _0x1ddcc4['exec'](_0x413648(0xd4));}catch(_0x125009){}}}catch(_0x5b08b9){warn('[connectio'+'n][migrati'+_0x413648(0x1cd)+_0x413648(0x193)+_0x413648(0x128)+_0x413648(0x1bd)+_0x413648(0x1d9)+(_0x5b08b9?.[_0x413648(0x145)]||_0x5b08b9));}}function parseArrayStrict(_0x48c562){const _0x400d8c=_0x2dc5d3;if(_0x48c562===null||_0x48c562===undefined)return[];if(typeof _0x48c562===_0x400d8c(0x14f)){const _0x29e288=safeParseJSON(_0x48c562);if(Array[_0x400d8c(0x1e5)](_0x29e288))return _0x29e288[_0x400d8c(0x103)](String);return[];}if(Array['isArray'](_0x48c562))return _0x48c562[_0x400d8c(0x103)](String);return[String(_0x48c562)];}function stringifyArray(_0x1d8a4b){const _0x63e4d6=_0x2dc5d3;return JSON[_0x63e4d6(0x19b)](Array[_0x63e4d6(0x1e5)](_0x1d8a4b)?_0x1d8a4b[_0x63e4d6(0x103)](String):[]);}async function loadConnectionsCache(){const _0x493448=_0x2dc5d3;try{const _0x2e6ccc=await getDb(),_0x124f89=await _0x2e6ccc[_0x493448(0x112)](_0x493448(0x111)+_0x493448(0x15a)+_0x493448(0x1e7)+_0x493448(0x114)+_0x493448(0x195)+_0x493448(0x161));connectionsCache['clear']();if(!_0x124f89||!_0x124f89[_0x493448(0x1d4)]){info('[connectio'+_0x493448(0x100)+_0x493448(0x19a)+_0x493448(0xad)+_0x493448(0xcf));return;}for(const _0x47d466 of _0x124f89){const _0x8706fd=String(_0x47d466[_0x493448(0x1f4)]||'');if(!connectionsCache[_0x493448(0x17d)](_0x8706fd))connectionsCache[_0x493448(0x12e)](_0x8706fd,new Map());const _0x26612d=connectionsCache[_0x493448(0xc0)](_0x8706fd);_0x26612d['set'](String(_0x47d466[_0x493448(0x1f9)]),{'name':_0x47d466[_0x493448(0x1f9)],'chat_id':parseArrayStrict(_0x47d466[_0x493448(0xba)]),'creator_id':_0x47d466['creator_id']});}info('[connectio'+_0x493448(0x100)+_0x493448(0x19a)+_0x493448(0x159)+_0x124f89[_0x493448(0x1d4)]+'\x20rows)');}catch(_0x5ae812){warn(_0x493448(0x8d)+_0x493448(0x1a1)+_0x493448(0xfe)+'che\x20failed'+':\x20'+(_0x5ae812?.[_0x493448(0x145)]||_0x5ae812));}}async function loadGroupDefaultsCache(){const _0x57d4d9=_0x2dc5d3;try{const _0x566789=await getDb(),_0x431267=await _0x566789[_0x57d4d9(0x112)](_0x57d4d9(0x10a)+_0x57d4d9(0x168)+_0x57d4d9(0xe8)+'up_default'+'s');groupDefaultsCache['clear']();if(!_0x431267||!_0x431267['length']){info(_0x57d4d9(0x8d)+_0x57d4d9(0xd5)+_0x57d4d9(0xd8)+_0x57d4d9(0x157)+_0x57d4d9(0xdc));return;}for(const _0x19736d of _0x431267){try{const _0x784654=String(_0x19736d[_0x57d4d9(0x1f4)]),_0x21b99d=safeParseJSON(_0x19736d['name']),_0x4aa918=Array[_0x57d4d9(0x1e5)](_0x21b99d)?_0x21b99d[_0x57d4d9(0x103)](String):[];groupDefaultsCache['set'](_0x784654,_0x4aa918);}catch(_0x296993){}}info(_0x57d4d9(0x8d)+_0x57d4d9(0xd5)+'efaults\x20ca'+_0x57d4d9(0x157)+'\x20('+_0x431267['length']+_0x57d4d9(0xcf));}catch(_0x240c56){warn(_0x57d4d9(0x8d)+'n]\x20loadGro'+_0x57d4d9(0x107)+_0x57d4d9(0x1e0)+_0x57d4d9(0x1d9)+(_0x240c56?.[_0x57d4d9(0x145)]||_0x240c56));}}async function loadActiveGroupsCache(){const _0x495dea=_0x2dc5d3;try{const _0x468e06=await getDb(),_0x3a76a0=await _0x468e06['all'](_0x495dea(0xb8)+_0x495dea(0x1f8)+_0x495dea(0xb4)+'\x20'+ACTIVE_TABLE);activeGroupByUser[_0x495dea(0xdf)]();if(!_0x3a76a0||!_0x3a76a0[_0x495dea(0x1d4)]){info(_0x495dea(0x8d)+_0x495dea(0x89)+_0x495dea(0xbf)+_0x495dea(0x81)+'(0\x20rows)');return;}for(const _0x127e7a of _0x3a76a0){try{activeGroupByUser[_0x495dea(0x12e)](String(_0x127e7a[_0x495dea(0x188)]),String(_0x127e7a[_0x495dea(0x1f4)]));}catch(_0x5864ef){}}info('[connectio'+_0x495dea(0x89)+_0x495dea(0xbf)+'he\x20loaded\x20'+'('+_0x3a76a0[_0x495dea(0x1d4)]+_0x495dea(0xcf));}catch(_0x289208){warn(_0x495dea(0x8d)+_0x495dea(0x14b)+_0x495dea(0x19c)+_0x495dea(0x1c1)+_0x495dea(0x147)+(_0x289208?.['message']||_0x289208));}}export async function refreshCaches(){const _0x470e8a=_0x2dc5d3;await ensureSchema(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache(),info(_0x470e8a(0x8d)+'n]\x20refresh'+_0x470e8a(0xaa)+_0x470e8a(0x17c));}async function ensureActiveGroupsTableAndLoadCaches(){await ensureActiveGroupsTable(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache();}function normalizeUserKeyForStorage(_0x549cee){const _0x44b34a=_0x2dc5d3;if(!_0x549cee)return null;const _0x347d30=String(_0x549cee)[_0x44b34a(0x1ee)]();if(!_0x347d30)return null;return _0x347d30[_0x44b34a(0x110)]('@')?_0x347d30[_0x44b34a(0xe0)]('@')[-0x3b+-0xbb1*-0x3+0xdf*-0x28]:_0x347d30;}export async function ensureSchema(){const _0x13ea80=_0x2dc5d3;if(schemaEnsured)return;try{await getDb(),await ensureConnectionsTable(),await ensureGroupDefaultsTable(),await ensureActiveGroupsTable(),await migrateConnectionsChatIdToArray(),await migrateGroupDefaultsNameToArray(),await ensureActiveGroupsTableAndLoadCaches(),schemaEnsured=!![],info(_0x13ea80(0x8d)+_0x13ea80(0xc4)+_0x13ea80(0x16d)+_0x13ea80(0x1d0)+_0x13ea80(0x176)+_0x13ea80(0x19f)+_0x13ea80(0x1a4)+_0x13ea80(0xf1)+_0x13ea80(0x1d8)+'ded.');}catch(_0x32df0c){error(_0x32df0c,'[connectio'+_0x13ea80(0xfd)+_0x13ea80(0x17b)+_0x13ea80(0x1d9)+(_0x32df0c?.[_0x13ea80(0x145)]||_0x32df0c));throw _0x32df0c;}}export async function initialize(){await ensureSchema();}export async function setActiveGroupForUser(_0x55bfe3,_0x59292a){const _0x4d70dc=_0x2dc5d3;try{if(!_0x55bfe3)return;const _0x54c73b=normalizeUserKeyForStorage(_0x55bfe3);if(!_0x54c73b)return;if(!_0x59292a){activeGroupByUser[_0x4d70dc(0x1ae)](_0x54c73b);try{const _0x534e5c=await getDb();await _0x534e5c[_0x4d70dc(0xbc)](_0x4d70dc(0x125)+'M\x20'+ACTIVE_TABLE+(_0x4d70dc(0xe3)+_0x4d70dc(0x96)),[_0x54c73b]);}catch(_0x3e02ef){warn(_0x4d70dc(0x8d)+_0x4d70dc(0x196)+_0x4d70dc(0x105)+'\x20active\x20gr'+_0x4d70dc(0x1b4)+'on:\x20'+(_0x3e02ef?.[_0x4d70dc(0x145)]||_0x3e02ef));}return;}const _0x376ac6=String(_0x59292a);activeGroupByUser[_0x4d70dc(0x12e)](_0x54c73b,_0x376ac6);try{const _0x162e0b=await getDb();await _0x162e0b[_0x4d70dc(0xbc)](_0x4d70dc(0x1fa)+'O\x20'+ACTIVE_TABLE+(_0x4d70dc(0xf9)+_0x4d70dc(0x1e8)+_0x4d70dc(0x1b9)+_0x4d70dc(0xb9)+_0x4d70dc(0x104)+'\x20\x20\x20\x20\x20\x20\x20\x20ON'+_0x4d70dc(0x169)+_0x4d70dc(0xdd)+'DO\x20UPDATE\x20'+_0x4d70dc(0x6f)+'id\x20=\x20exclu'+_0x4d70dc(0x7d)+'id'),[_0x54c73b,_0x376ac6]);}catch(_0x229cf0){warn(_0x4d70dc(0x8d)+_0x4d70dc(0x196)+_0x4d70dc(0x105)+_0x4d70dc(0x1df)+'oup:\x20'+(_0x229cf0?.[_0x4d70dc(0x145)]||_0x229cf0));}}catch(_0x150a23){warn(_0x4d70dc(0x8d)+_0x4d70dc(0x106)+_0x4d70dc(0x1a8)+'User\x20error'+':\x20'+(_0x150a23?.[_0x4d70dc(0x145)]||_0x150a23));}}export function getActiveGroupForUser(_0xed9f19){const _0x46c8af=_0x2dc5d3;try{if(!_0xed9f19)return null;const _0x1694ef=normalizeUserKeyForStorage(_0xed9f19);if(!_0x1694ef)return null;return activeGroupByUser['get'](_0x1694ef)||null;}catch(_0x4c3586){return warn(_0x46c8af(0x8d)+_0x46c8af(0x163)+_0x46c8af(0x1a8)+_0x46c8af(0x174)+':\x20'+(_0x4c3586?.[_0x46c8af(0x145)]||_0x4c3586)),null;}}export async function addConnection(_0x1c2800,_0x1dd06d,_0x4c2b2a='',_0x1909db=''){const _0x5a1ac3=_0x2dc5d3;try{await ensureSchema();const _0x2599ef=await getDb(),_0x192f17=String(_0x1909db||''),_0x2f5348=await _0x2599ef[_0x5a1ac3(0xc0)](_0x5a1ac3(0x1bf)+'t_id\x20FROM\x20'+_0x5a1ac3(0x1ea)+_0x5a1ac3(0x1bb)+_0x5a1ac3(0xd6)+_0x5a1ac3(0x1ac)+_0x5a1ac3(0x199),[String(_0x1c2800),_0x192f17]);if(!_0x2f5348){const _0x15cf60=[String(_0x1dd06d)];await _0x2599ef['run'](_0x5a1ac3(0x1fa)+_0x5a1ac3(0x175)+_0x5a1ac3(0x86)+_0x5a1ac3(0x99)+_0x5a1ac3(0x12c)+_0x5a1ac3(0x1cf)+')\x20VALUES\x20('+_0x5a1ac3(0x10d)+')',[String(_0x1c2800),_0x192f17,stringifyArray(_0x15cf60),String(_0x4c2b2a||'')]),info(_0x5a1ac3(0x8d)+'n]\x20created'+':\x20'+_0x1c2800+'\x20->\x20'+_0x1dd06d+_0x5a1ac3(0xcc)+_0x4c2b2a+_0x5a1ac3(0x185)+_0x192f17);if(!connectionsCache['has'](_0x192f17))connectionsCache[_0x5a1ac3(0x12e)](_0x192f17,new Map());const _0x317454=connectionsCache['get'](_0x192f17);return _0x317454['set'](String(_0x1c2800),{'name':String(_0x1c2800),'chat_id':_0x15cf60[_0x5a1ac3(0x103)](String),'creator_id':String(_0x4c2b2a||'')}),!![];}else{const _0x3245c0=parseArrayStrict(_0x2f5348[_0x5a1ac3(0xba)]);if(!_0x3245c0[_0x5a1ac3(0x110)](String(_0x1dd06d)))_0x3245c0[_0x5a1ac3(0x11f)](String(_0x1dd06d));await _0x2599ef['run'](_0x5a1ac3(0xd9)+_0x5a1ac3(0x190)+_0x5a1ac3(0x17e)+_0x5a1ac3(0x15c)+_0x5a1ac3(0xee)+_0x5a1ac3(0x116)+'e\x20=\x20?\x20AND\x20'+_0x5a1ac3(0x1e3)+'\x20?',[stringifyArray(_0x3245c0),String(_0x4c2b2a||''),String(_0x1c2800),_0x192f17]),info(_0x5a1ac3(0x8d)+_0x5a1ac3(0x167)+':\x20'+_0x1c2800+_0x5a1ac3(0x102)+_0x3245c0[_0x5a1ac3(0xe2)](',')+'\x20@\x20group='+_0x192f17);if(!connectionsCache[_0x5a1ac3(0x17d)](_0x192f17))connectionsCache['set'](_0x192f17,new Map());const _0xbab6e5=connectionsCache[_0x5a1ac3(0xc0)](_0x192f17);return _0xbab6e5['set'](String(_0x1c2800),{'name':String(_0x1c2800),'chat_id':_0x3245c0[_0x5a1ac3(0x103)](String),'creator_id':String(_0x4c2b2a||'')}),!![];}}catch(_0x518083){return error(_0x518083,'[connectio'+_0x5a1ac3(0x1f0)+_0x5a1ac3(0x1bc)+_0x5a1ac3(0x13d)+_0x1c2800+_0x5a1ac3(0xe5)+_0x1909db),![];}}export async function deleteConnectionScoped(_0xb8d668,_0x3506c3=''){const _0xc591f1=_0x2dc5d3;try{await ensureSchema();const _0x64d79e=await getDb(),_0x5169db=await _0x64d79e['run']('DELETE\x20FRO'+_0xc591f1(0xec)+_0xc591f1(0x13e)+_0xc591f1(0x7b)+_0xc591f1(0x13a)+_0xc591f1(0x109),[String(_0xb8d668),String(_0x3506c3||'')]),_0x3e8a47=_0x5169db&&(_0x5169db[_0xc591f1(0x129)]===undefined?!![]:!!_0x5169db['changes']);info(_0xc591f1(0x8d)+'n]\x20deleteC'+'onnectionS'+_0xc591f1(0xd2)+_0xb8d668+'\x20@\x20'+_0x3506c3+_0xc591f1(0x18d)+_0x3e8a47+')');try{const _0x4a9c1e=String(_0x3506c3||'');if(connectionsCache[_0xc591f1(0x17d)](_0x4a9c1e)){const _0x2af1ac=connectionsCache[_0xc591f1(0xc0)](_0x4a9c1e);if(_0x2af1ac)_0x2af1ac[_0xc591f1(0x1ae)](String(_0xb8d668));}}catch(_0x31ad3d){}return _0x3e8a47;}catch(_0x5b2325){return error(_0x5b2325,_0xc591f1(0x8d)+_0xc591f1(0x144)+_0xc591f1(0x133)+'coped\x20fail'+_0xc591f1(0x1d9)+_0xb8d668+'\x20@\x20'+_0x3506c3),![];}}export async function deleteConnectionsByCreatorInGroup(_0x1fd70e,_0x1f38d6=''){const _0x1a161d=_0x2dc5d3;try{await ensureSchema();const _0x43eb15=await getDb(),_0x1c5d96=await _0x43eb15[_0x1a161d(0xbc)](_0x1a161d(0x125)+_0x1a161d(0xec)+_0x1a161d(0x13e)+_0x1a161d(0x1cf)+'\x20=\x20?\x20AND\x20g'+_0x1a161d(0x1b6)+'?',[String(_0x1fd70e),String(_0x1f38d6||'')]),_0x2501e4=_0x1c5d96&&(_0x1c5d96[_0x1a161d(0x129)]===undefined?!![]:_0x1c5d96[_0x1a161d(0x129)])||-0x1*-0x8a1+0xb5d+-0x3*0x6aa;info(_0x1a161d(0x8d)+_0x1a161d(0x144)+_0x1a161d(0x1d2)+_0x1a161d(0x1f2)+_0x1a161d(0xed)+_0x1fd70e+_0x1a161d(0xe5)+_0x1f38d6+_0x1a161d(0x18d)+_0x2501e4+')');try{const _0x2a3f66=String(_0x1f38d6||'');if(connectionsCache[_0x1a161d(0x17d)](_0x2a3f66)){const _0xf511f2=connectionsCache[_0x1a161d(0xc0)](_0x2a3f66);for(const [_0x5d0134,_0x350890]of Array[_0x1a161d(0x14c)](_0xf511f2[_0x1a161d(0x15e)]())){if(String(_0x350890[_0x1a161d(0x1cf)])===String(_0x1fd70e))_0xf511f2[_0x1a161d(0x1ae)](_0x5d0134);}}}catch(_0x283aa6){}return _0x2501e4;}catch(_0x1a7139){return error(_0x1a7139,_0x1a161d(0x8d)+_0x1a161d(0x144)+_0x1a161d(0x1d2)+_0x1a161d(0x1f2)+_0x1a161d(0x152)+'led:\x20'+(_0x1a7139?.[_0x1a161d(0x145)]||_0x1a7139)),-0x22*-0x9e+-0x33*0x3+-0x1463;}}export async function removeChatIdsFromConnectionScoped(_0x108011,_0x22186d,_0x313171=''){const _0x43c17e=_0x2dc5d3;try{if(!_0x108011)return![];await ensureSchema();const _0x5b77f7=await getDb(),_0x2e0dcd=await _0x5b77f7['get'](_0x43c17e(0x1bf)+_0x43c17e(0xa9)+'connection'+_0x43c17e(0x1bb)+_0x43c17e(0xd6)+_0x43c17e(0x1ac)+'=\x20?',[String(_0x108011),String(_0x313171||'')]);if(!_0x2e0dcd)return![];const _0x3935e8=parseArrayStrict(_0x2e0dcd[_0x43c17e(0xba)]),_0x8d4b88=Array[_0x43c17e(0x1e5)](_0x22186d)?_0x22186d[_0x43c17e(0x103)](String):[String(_0x22186d)],_0x365cfa=_0x3935e8[_0x43c17e(0x11d)](_0xf24f55=>!_0x8d4b88[_0x43c17e(0x110)](_0xf24f55));if(_0x365cfa[_0x43c17e(0x1d4)]===0x1*-0x1514+-0x16d7*0x1+0x2beb){await _0x5b77f7[_0x43c17e(0xbc)]('DELETE\x20FRO'+_0x43c17e(0xec)+_0x43c17e(0x13e)+_0x43c17e(0x7b)+'ND\x20group_i'+_0x43c17e(0x109),[String(_0x108011),String(_0x313171||'')]),info(_0x43c17e(0x8d)+'n]\x20removeC'+_0x43c17e(0x162)+_0x43c17e(0x18b)+_0x43c17e(0x76)+_0x43c17e(0xa1)+_0x43c17e(0x92)+'r\x20'+_0x108011+_0x43c17e(0xe5)+_0x313171+(',\x20row\x20dele'+_0x43c17e(0xde)));try{const _0x2efac1=String(_0x313171||'');if(connectionsCache[_0x43c17e(0x17d)](_0x2efac1))connectionsCache[_0x43c17e(0xc0)](_0x2efac1)['delete'](String(_0x108011));}catch(_0x36b5ac){}return!![];}else{await _0x5b77f7[_0x43c17e(0xbc)](_0x43c17e(0xd9)+_0x43c17e(0x190)+'ET\x20chat_id'+_0x43c17e(0x122)+'\x20name\x20=\x20?\x20'+_0x43c17e(0x1b0)+_0x43c17e(0xd3),[stringifyArray(_0x365cfa),String(_0x108011),String(_0x313171||'')]),info('[connectio'+'n]\x20removeC'+_0x43c17e(0x162)+_0x43c17e(0x18b)+'Scoped:\x20'+_0x108011+'@'+_0x313171+_0x43c17e(0x1d5)+_0x365cfa[_0x43c17e(0xe2)](','));try{const _0x32e719=String(_0x313171||'');if(!connectionsCache['has'](_0x32e719))connectionsCache[_0x43c17e(0x12e)](_0x32e719,new Map());connectionsCache['get'](_0x32e719)[_0x43c17e(0x12e)](String(_0x108011),{'name':String(_0x108011),'chat_id':_0x365cfa[_0x43c17e(0x103)](String),'creator_id':connectionsCache[_0x43c17e(0xc0)](_0x32e719)[_0x43c17e(0xc0)](String(_0x108011))?.[_0x43c17e(0x1cf)]||''});}catch(_0x5b0cf4){}return!![];}}catch(_0x86dbcc){return error(_0x86dbcc,'[connectio'+_0x43c17e(0x7f)+_0x43c17e(0x162)+'Connection'+_0x43c17e(0xb6)+_0x43c17e(0x1b5)+(_0x86dbcc?.['message']||_0x86dbcc)),![];}}export async function listConnectionsForGroup(_0x453e48){const _0x13c64b=_0x2dc5d3;try{await ensureSchema();const _0x2d9928=String(_0x453e48||'');if(connectionsCache['has'](_0x2d9928)){const _0x5af13b=connectionsCache['get'](_0x2d9928);return Array['from'](_0x5af13b[_0x13c64b(0x85)]())['map'](_0xd2580d=>({'name':_0xd2580d[_0x13c64b(0x1f9)],'chat_id':Array[_0x13c64b(0x1e5)](_0xd2580d[_0x13c64b(0xba)])?_0xd2580d[_0x13c64b(0xba)][_0x13c64b(0x103)](String):[],'creator_id':_0xd2580d[_0x13c64b(0x1cf)]}));}const _0x5bc528=await getDb(),_0x58d4c2=await _0x5bc528[_0x13c64b(0x112)](_0x13c64b(0x111)+_0x13c64b(0x1f3)+_0x13c64b(0x114)+_0x13c64b(0x195)+'nnections\x20'+_0x13c64b(0x98)+_0x13c64b(0x9d)+_0x13c64b(0xe6)+'me',[_0x2d9928]);return(_0x58d4c2||[])[_0x13c64b(0x103)](_0x38b9ae=>({'name':_0x38b9ae[_0x13c64b(0x1f9)],'chat_id':parseArrayStrict(_0x38b9ae[_0x13c64b(0xba)]),'creator_id':_0x38b9ae[_0x13c64b(0x1cf)]}));}catch(_0x2dd0de){return error(_0x2dd0de,_0x13c64b(0x8d)+_0x13c64b(0x10c)+_0x13c64b(0x115)+_0x13c64b(0xf5)+_0x13c64b(0x1b5)+(_0x2dd0de?.[_0x13c64b(0x145)]||_0x2dd0de)),[];}}export async function listConnectionsForUser(_0xb2dbbb,_0x3485ac=null){const _0x153401=_0x2dc5d3;try{await ensureSchema();const _0x560844=await getDb();if(_0x3485ac){const _0x111e11=await _0x560844[_0x153401(0x112)]('SELECT\x20nam'+_0x153401(0x1f3)+_0x153401(0x114)+_0x153401(0x195)+_0x153401(0x1af)+'WHERE\x20crea'+'tor_id\x20=\x20?'+_0x153401(0x1d7)+_0x153401(0x1a5)+'DER\x20BY\x20nam'+'e',[String(_0xb2dbbb),String(_0x3485ac)]);return(_0x111e11||[])[_0x153401(0x103)](_0x5dd66a=>({'name':_0x5dd66a[_0x153401(0x1f9)],'chat_id':parseArrayStrict(_0x5dd66a['chat_id']),'creator_id':_0x5dd66a[_0x153401(0x1cf)]}));}else{const _0x3bb62a=await _0x560844[_0x153401(0x112)]('SELECT\x20nam'+_0x153401(0x1f3)+',\x20creator_'+_0x153401(0x1b2)+'id\x20FROM\x20co'+_0x153401(0x1af)+_0x153401(0x9a)+_0x153401(0xee)+'\x20ORDER\x20BY\x20'+_0x153401(0x170)+_0x153401(0x1f9),[String(_0xb2dbbb)]);return(_0x3bb62a||[])[_0x153401(0x103)](_0x5c163e=>({'name':_0x5c163e['name'],'chat_id':parseArrayStrict(_0x5c163e[_0x153401(0xba)]),'creator_id':_0x5c163e['creator_id'],'group_id':_0x5c163e[_0x153401(0x1f4)]}));}}catch(_0x1c2b0c){return error(_0x1c2b0c,'[connectio'+_0x153401(0x10c)+'nectionsFo'+_0x153401(0x120)+'ed'),[];}}export async function listAllConnections(){const _0x4c7d4e=_0x2dc5d3;try{await ensureSchema();const _0x4eae65=await getDb(),_0x13a4f4=await _0x4eae65[_0x4c7d4e(0x112)](_0x4c7d4e(0x111)+_0x4c7d4e(0x1f3)+_0x4c7d4e(0x114)+_0x4c7d4e(0x1b2)+'id\x20FROM\x20co'+_0x4c7d4e(0x1af)+_0x4c7d4e(0x153)+_0x4c7d4e(0x187)+_0x4c7d4e(0x1dd));return(_0x13a4f4||[])[_0x4c7d4e(0x103)](_0xd5d316=>({'name':_0xd5d316[_0x4c7d4e(0x1f9)],'chat_id':parseArrayStrict(_0xd5d316[_0x4c7d4e(0xba)]),'creator_id':_0xd5d316[_0x4c7d4e(0x1cf)],'group_id':_0xd5d316[_0x4c7d4e(0x1f4)]}));}catch(_0x3bb116){return error(_0x3bb116,'[connectio'+'n]\x20listAll'+'Connection'+_0x4c7d4e(0x140)),[];}}export async function getConnectionScoped(_0x40c2bb,_0x1bf0e0=''){const _0x549bb6=_0x2dc5d3;try{await ensureSchema();const _0x249f37=String(_0x1bf0e0||'');if(connectionsCache[_0x549bb6(0x17d)](_0x249f37)&&connectionsCache['get'](_0x249f37)[_0x549bb6(0x17d)](String(_0x40c2bb)))return connectionsCache[_0x549bb6(0xc0)](_0x249f37)[_0x549bb6(0xc0)](String(_0x40c2bb))[_0x549bb6(0xba)]['slice']();const _0x11d2b1=await getDb(),_0x5665c3=await _0x11d2b1[_0x549bb6(0xc0)](_0x549bb6(0x1bf)+_0x549bb6(0xa9)+'connection'+_0x549bb6(0x1bb)+_0x549bb6(0xd6)+_0x549bb6(0x1ac)+_0x549bb6(0x199),[String(_0x40c2bb),_0x249f37]);if(!_0x5665c3)return null;return parseArrayStrict(_0x5665c3['chat_id']);}catch(_0x525326){return error(_0x525326,'[connectio'+'n]\x20getConn'+_0x549bb6(0x130)+_0x549bb6(0x91)+_0x40c2bb+_0x549bb6(0xe5)+_0x1bf0e0+')\x20failed'),null;}}export async function getConnectionRecordScoped(_0x46d00d,_0x575fd9=''){const _0x1e0a77=_0x2dc5d3;try{await ensureSchema();const _0x1eec4f=String(_0x575fd9||'');if(connectionsCache[_0x1e0a77(0x17d)](_0x1eec4f)&&connectionsCache['get'](_0x1eec4f)[_0x1e0a77(0x17d)](String(_0x46d00d))){const _0x4abfba=connectionsCache[_0x1e0a77(0xc0)](_0x1eec4f)[_0x1e0a77(0xc0)](String(_0x46d00d));return{'name':_0x4abfba[_0x1e0a77(0x1f9)],'chat_id':_0x4abfba[_0x1e0a77(0xba)]['slice'](),'creator_id':_0x4abfba['creator_id']};}const _0x29597b=await getDb(),_0x5b8c46=await _0x29597b[_0x1e0a77(0xc0)](_0x1e0a77(0x111)+_0x1e0a77(0x1f3)+_0x1e0a77(0x114)+_0x1e0a77(0x195)+_0x1e0a77(0x1af)+'WHERE\x20name'+_0x1e0a77(0x1eb)+_0x1e0a77(0x1b6)+'?',[String(_0x46d00d),_0x1eec4f]);if(!_0x5b8c46)return null;return{'name':_0x5b8c46[_0x1e0a77(0x1f9)],'chat_id':parseArrayStrict(_0x5b8c46[_0x1e0a77(0xba)]),'creator_id':_0x5b8c46[_0x1e0a77(0x1cf)]};}catch(_0x50d248){return error(_0x50d248,_0x1e0a77(0x8d)+'n]\x20getConn'+_0x1e0a77(0xeb)+_0x1e0a77(0xc1)+_0x46d00d+'\x20@\x20'+_0x575fd9+')\x20failed'),null;}}export async function getConnectionName(_0x39d316){const _0x236915=_0x2dc5d3;try{await ensureSchema();for(const [_0x37e71f,_0x443d5c]of connectionsCache[_0x236915(0x15e)]()){for(const [_0x5768ca,_0x2edd98]of _0x443d5c[_0x236915(0x15e)]()){if(Array[_0x236915(0x1e5)](_0x2edd98[_0x236915(0xba)])&&_0x2edd98['chat_id'][_0x236915(0x110)](String(_0x39d316)))return _0x5768ca;}}const _0x31c967=await getDb(),_0x51f717=await _0x31c967[_0x236915(0x112)](_0x236915(0x111)+'e,\x20chat_id'+_0x236915(0x1f7)+_0x236915(0x14a));for(const _0x179c27 of _0x51f717||[]){const _0x18de90=parseArrayStrict(_0x179c27['chat_id']);if(_0x18de90['includes'](String(_0x39d316)))return _0x179c27[_0x236915(0x1f9)];}return null;}catch(_0x4af94a){return error(_0x4af94a,_0x236915(0x8d)+_0x236915(0x1d1)+_0x236915(0x126)+'('+_0x39d316+_0x236915(0x154)),null;}}export async function setDefaultGroup(_0x20278a,_0x2b9067){const _0x8c8be0=_0x2dc5d3;try{await ensureSchema();const _0x1ee68c=await getDb();if(!_0x2b9067)throw new Error(_0x8c8be0(0xc8)+_0x8c8be0(0x11a)+_0x8c8be0(0x171)+_0x8c8be0(0x123));if(!_0x20278a||Array[_0x8c8be0(0x1e5)](_0x20278a)&&_0x20278a[_0x8c8be0(0x1d4)]===0x1f25+0x13*0x1b4+0x3f81*-0x1)return await _0x1ee68c['run'](_0x8c8be0(0x125)+'M\x20group_de'+_0x8c8be0(0x18e)+'RE\x20group_i'+_0x8c8be0(0x109),[String(_0x2b9067)]),groupDefaultsCache['delete'](String(_0x2b9067)),info(_0x8c8be0(0x8d)+_0x8c8be0(0xd5)+_0x8c8be0(0x1b8)+_0x8c8be0(0x151)+_0x2b9067),!![];let _0x54017f=[];if(typeof _0x20278a===_0x8c8be0(0x14f)&&_0x20278a['toLowerCas'+'e']()===_0x8c8be0(0x112)){const _0x4be50e=await listConnectionsForGroup(String(_0x2b9067));_0x54017f=(_0x4be50e||[])[_0x8c8be0(0x103)](_0x2ca198=>_0x2ca198[_0x8c8be0(0x1f9)])['filter'](Boolean);if(!_0x54017f['length'])throw new Error(_0x8c8be0(0x95)+_0x8c8be0(0xa2)+_0x8c8be0(0xea)+_0x8c8be0(0x72));}else{if(Array[_0x8c8be0(0x1e5)](_0x20278a))_0x54017f=_0x20278a['map'](String)['filter'](Boolean);else{if(typeof _0x20278a===_0x8c8be0(0x14f)){if(_0x20278a[_0x8c8be0(0x110)](','))_0x54017f=_0x20278a['split'](',')[_0x8c8be0(0x103)](_0x21c112=>_0x21c112[_0x8c8be0(0x1ee)]())['filter'](Boolean);else _0x54017f=[_0x20278a];}else throw new Error(_0x8c8be0(0x87)+'d\x20namesOrA'+_0x8c8be0(0x15d)+_0x8c8be0(0x9e)+_0x8c8be0(0x1ce));}}if(!_0x54017f[_0x8c8be0(0x1d4)])throw new Error(_0x8c8be0(0x156)+_0x8c8be0(0xd0)+_0x8c8be0(0x1e2)+_0x8c8be0(0xc9)+_0x8c8be0(0xae)+_0x8c8be0(0x13b));const _0x56011e=[];for(const _0x441916 of _0x54017f){const _0x32a1e9=await _0x1ee68c[_0x8c8be0(0xc0)]('SELECT\x201\x20F'+_0x8c8be0(0x150)+_0x8c8be0(0x1ba)+_0x8c8be0(0x10e)+_0x8c8be0(0x1d7)+_0x8c8be0(0xf7),[String(_0x441916),String(_0x2b9067)]);if(_0x32a1e9)_0x56011e[_0x8c8be0(0x11f)](_0x441916);else warn(_0x8c8be0(0x8d)+'n]\x20setDefa'+_0x8c8be0(0x79)+_0x8c8be0(0xd7)+_0x8c8be0(0xf4)+'t\x20connecti'+_0x8c8be0(0xc5)+_0x441916+_0x8c8be0(0x1a0)+_0x2b9067);}if(!_0x56011e[_0x8c8be0(0x1d4)])throw new Error(_0x8c8be0(0x7a)+'e\x20provided'+_0x8c8be0(0x14e)+_0x8c8be0(0x182)+_0x8c8be0(0xb5)+_0x8c8be0(0x18a));return await _0x1ee68c[_0x8c8be0(0xbc)](_0x8c8be0(0x1fa)+_0x8c8be0(0x8c)+_0x8c8be0(0x1e6)+_0x8c8be0(0x8f)+'me)\x20VALUES'+_0x8c8be0(0x18f)+_0x8c8be0(0x1c5)+_0x8c8be0(0x139)+_0x8c8be0(0x1db)+_0x8c8be0(0x1c6)+'\x20name\x20=\x20ex'+'cluded.nam'+'e;',[String(_0x2b9067),JSON['stringify'](_0x56011e)]),groupDefaultsCache[_0x8c8be0(0x12e)](String(_0x2b9067),_0x56011e[_0x8c8be0(0xe9)]()),info('[connectio'+_0x8c8be0(0xd5)+_0x8c8be0(0x138)+_0x8c8be0(0x136)+_0x2b9067+_0x8c8be0(0x102)+JSON[_0x8c8be0(0x19b)](_0x56011e)),!![];}catch(_0x587bd4){return error(_0x587bd4,_0x8c8be0(0x8d)+'n]\x20setDefa'+_0x8c8be0(0x16c)+_0x8c8be0(0xa3)+_0x2b9067+':\x20'+(_0x587bd4?.[_0x8c8be0(0x145)]||_0x587bd4)),![];}}export async function getDefaultForGroup(_0x4fcab){const _0x56ed63=_0x2dc5d3;try{await ensureSchema();if(!_0x4fcab)return null;const _0x3b5cf=String(_0x4fcab);if(groupDefaultsCache['has'](_0x3b5cf)){const _0x1d9a62=groupDefaultsCache['get'](_0x3b5cf);return Array[_0x56ed63(0x1e5)](_0x1d9a62)?_0x1d9a62[_0x56ed63(0x103)](String):null;}const _0x153c0d=await getDb(),_0x305762=await _0x153c0d[_0x56ed63(0xc0)]('SELECT\x20nam'+'e\x20FROM\x20gro'+_0x56ed63(0x143)+_0x56ed63(0xc2)+_0x56ed63(0x15b),[_0x3b5cf]);if(!_0x305762||!_0x305762[_0x56ed63(0x1f9)])return null;try{const _0x1abeb9=JSON['parse'](_0x305762[_0x56ed63(0x1f9)]);if(Array[_0x56ed63(0x1e5)](_0x1abeb9))return groupDefaultsCache['set'](_0x3b5cf,_0x1abeb9['map'](String)),_0x1abeb9[_0x56ed63(0x103)](String);}catch(_0xef9559){}return null;}catch(_0x3e82e){return error(_0x3e82e,_0x56ed63(0x8d)+_0x56ed63(0x83)+_0x56ed63(0x1ed)+_0x56ed63(0xf0)+_0x56ed63(0x1ca)+_0x4fcab),null;}}export async function getDefault(_0x9ed415){const _0x1549e4=_0x2dc5d3;try{await ensureSchema();const _0x313fca=getActiveGroupForUser(String(_0x9ed415));if(!_0x313fca)return null;return await getDefaultForGroup(_0x313fca);}catch(_0x5837c6){return error(_0x5837c6,_0x1549e4(0x8d)+_0x1549e4(0x83)+_0x1549e4(0xbd)+'\x20for\x20'+_0x9ed415),null;}}export async function getConnection(_0x3f885f){const _0x336ffe=_0x2dc5d3;try{await ensureSchema();const _0x3a316d=await getDb(),_0xfc3eb6=await _0x3a316d[_0x336ffe(0x112)]('SELECT\x20cha'+'t_id\x20FROM\x20'+_0x336ffe(0x1ea)+_0x336ffe(0x1bb)+'me\x20=\x20?',[String(_0x3f885f)]);if(!_0xfc3eb6||!_0xfc3eb6[_0x336ffe(0x1d4)])return null;const _0xf8eef=[];for(const _0x28b704 of _0xfc3eb6){const _0x5d5d52=parseArrayStrict(_0x28b704[_0x336ffe(0xba)]);for(const _0x4a078d of _0x5d5d52)if(!_0xf8eef[_0x336ffe(0x110)](_0x4a078d))_0xf8eef[_0x336ffe(0x11f)](_0x4a078d);}return _0xf8eef;}catch(_0x51cfe1){return error(_0x51cfe1,_0x336ffe(0x8d)+_0x336ffe(0x1d1)+_0x336ffe(0x1a2)+_0x3f885f+')\x20failed'),null;}}export async function getConnectionRecord(_0x2eb9ce){const _0x4e08c3=_0x2dc5d3;try{await ensureSchema();const _0x8f326d=await getDb(),_0x12e231=await _0x8f326d[_0x4e08c3(0xc0)](_0x4e08c3(0x111)+'e,\x20chat_id'+_0x4e08c3(0x114)+_0x4e08c3(0x1b2)+'id\x20FROM\x20co'+_0x4e08c3(0x1af)+'WHERE\x20name'+_0x4e08c3(0xa7)+'\x201',[String(_0x2eb9ce)]);if(!_0x12e231)return null;return{'name':_0x12e231['name'],'chat_id':parseArrayStrict(_0x12e231['chat_id']),'creator_id':_0x12e231[_0x4e08c3(0x1cf)],'group_id':_0x12e231['group_id']};}catch(_0x203a6b){return error(_0x203a6b,_0x4e08c3(0x8d)+_0x4e08c3(0x1d1)+_0x4e08c3(0xeb)+'rd('+_0x2eb9ce+_0x4e08c3(0x154)),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnectionScoped':deleteConnectionScoped,'deleteConnectionsByCreatorInGroup':deleteConnectionsByCreatorInGroup,'removeChatIdsFromConnectionScoped':removeChatIdsFromConnectionScoped,'listConnectionsForUser':listConnectionsForUser,'listConnectionsForGroup':listConnectionsForGroup,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'getConnectionRecord':getConnectionRecord,'getConnectionRecordScoped':getConnectionRecordScoped,'getConnectionScoped':getConnectionScoped,'setDefaultGroup':setDefaultGroup,'getDefaultForGroup':getDefaultForGroup,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser,'refreshCaches':refreshCaches,'_internalCaches':{'connectionsCache':connectionsCache,'groupDefaultsCache':groupDefaultsCache,'activeGroupByUser':activeGroupByUser}};