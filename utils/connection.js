const _0x412c2d=_0x4208;(function(_0x356903,_0xdc45b8){const _0x25e8f1=_0x4208,_0x42d1e4=_0x356903();while(!![]){try{const _0x4f5f9d=-parseInt(_0x25e8f1(0x310))/(0x2c4*-0x3+0x1*0x986+-0x139)+parseInt(_0x25e8f1(0x21e))/(-0xf2*-0x25+0xdb5*-0x2+-0x78e*0x1)*(-parseInt(_0x25e8f1(0x1ae))/(0x810+-0x486*-0x4+-0x3*0x8b7))+-parseInt(_0x25e8f1(0x2f1))/(-0x677*-0x6+-0x3af+-0x2317)+-parseInt(_0x25e8f1(0x1dd))/(0x4b*-0x4b+-0x1c2a+0x18*0x217)*(-parseInt(_0x25e8f1(0x26e))/(-0x6*-0x4b5+-0xd0e*0x1+0x6*-0x287))+-parseInt(_0x25e8f1(0x2d1))/(-0x128d+-0x179+0x140d)*(-parseInt(_0x25e8f1(0x222))/(0x5*0x213+0x2519*0x1+0x84*-0x5c))+-parseInt(_0x25e8f1(0x2e8))/(0x1e74*0x1+0x454*-0x2+0x741*-0x3)+parseInt(_0x25e8f1(0x1e0))/(0x1f3f*0x1+0x1093*0x1+-0x1*0x2fc8);if(_0x4f5f9d===_0xdc45b8)break;else _0x42d1e4['push'](_0x42d1e4['shift']());}catch(_0x12fd49){_0x42d1e4['push'](_0x42d1e4['shift']());}}}(_0x6c7e,-0x4a38+0x5b81+0x4355*0x7));import{info as _0x500d04,warn as _0x19397c,error as _0x1880f8}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map(),connectionsCache=new Map(),groupDefaultsCache=new Map(),ACTIVE_TABLE=_0x412c2d(0x308)+_0x412c2d(0x21a);function info(..._0x2fa668){const _0x135eb9=_0x412c2d;try{_0x500d04(..._0x2fa668);}catch(_0x32e5c5){console[_0x135eb9(0x1b3)](_0x135eb9(0x223),..._0x2fa668);}}function warn(..._0x5b9f6b){try{_0x19397c(..._0x5b9f6b);}catch(_0x14e7b1){console['warn']('[WARN]',..._0x5b9f6b);}}function error(..._0x33756d){const _0x58fb57=_0x412c2d;try{_0x1880f8(..._0x33756d);}catch(_0x371636){console[_0x58fb57(0x1e4)]('[ERROR]',..._0x33756d);}}async function getDb(){const _0x52d51b=_0x412c2d;if(db&&typeof db[_0x52d51b(0x232)]===_0x52d51b(0x289))return db;try{const _0x4f9307=await import('./database.js');if(_0x4f9307&&_0x4f9307['db'])return db=_0x4f9307['db'],db;throw new Error('database\x20m'+_0x52d51b(0x1c7)+_0x52d51b(0x216)+_0x52d51b(0x2e6));}catch(_0x588c05){error(_0x588c05,'[connectio'+_0x52d51b(0x1f2)+_0x52d51b(0x1a4)+_0x52d51b(0x1bc)+'s');throw _0x588c05;}}function safeParseJSON(_0x5d8359){const _0xa178fe=_0x412c2d;try{return JSON[_0xa178fe(0x249)](_0x5d8359);}catch(_0x1ade8f){return null;}}function asArrayStrict(_0xe9c251){const _0xf5d6cd=_0x412c2d;if(_0xe9c251===null||_0xe9c251===undefined)return[];if(typeof _0xe9c251==='string'){const _0x35c2ec=safeParseJSON(_0xe9c251);if(Array[_0xf5d6cd(0x25a)](_0x35c2ec))return _0x35c2ec['map'](String);return[_0xe9c251];}if(Array[_0xf5d6cd(0x25a)](_0xe9c251))return _0xe9c251['map'](String);return[String(_0xe9c251)];}function toJSONString(_0x216c14){const _0x43667f=_0x412c2d;return JSON[_0x43667f(0x2d2)](Array[_0x43667f(0x25a)](_0x216c14)?_0x216c14[_0x43667f(0x21f)](String):[]);}async function tableExists(_0x104175){const _0x5af940=_0x412c2d,_0x5f42e9=await getDb(),_0x22253f=await _0x5f42e9[_0x5af940(0x20b)](_0x5af940(0x1d4)+_0x5af940(0x1b6)+'ite_master'+_0x5af940(0x1c6)+'e=\x27table\x27\x20'+'AND\x20name\x20='+'\x20?',[String(_0x104175)]);return!!_0x22253f;}async function columnExists(_0x2cbe0e,_0x388813){const _0x377814=_0x412c2d;try{const _0x5e9b23=await getDb(),_0x2f55c5=await _0x5e9b23[_0x377814(0x1cb)](_0x377814(0x30e)+_0x377814(0x1ca)+_0x2cbe0e+')');if(!Array[_0x377814(0x25a)](_0x2f55c5))return![];return _0x2f55c5[_0x377814(0x28c)](_0x5cfc13=>String(_0x5cfc13[_0x377814(0x244)])[_0x377814(0x296)+'e']()===String(_0x388813)[_0x377814(0x296)+'e']());}catch(_0x51fb82){return warn(_0x377814(0x1f4)+'n]\x20columnE'+'xists\x20chec'+_0x377814(0x284)+_0x377814(0x1c9)+_0x2cbe0e+'.'+_0x388813+':\x20'+(_0x51fb82?.['message']||_0x51fb82)),![];}}async function ensureConnectionsTable(){const _0x2b656a=_0x412c2d,_0xfab5e8=await getDb(),_0x3edf75=await tableExists(_0x2b656a(0x1f9)+'s');if(!_0x3edf75){await _0xfab5e8[_0x2b656a(0x232)]('\x0a\x20\x20\x20\x20\x20\x20CRE'+'ATE\x20TABLE\x20'+'IF\x20NOT\x20EXI'+'STS\x20connec'+_0x2b656a(0x1bf)+_0x2b656a(0x1c3)+_0x2b656a(0x282)+_0x2b656a(0x1d9)+'\x20\x20\x20\x20group_'+'id\x20TEXT\x20NO'+_0x2b656a(0x262)+_0x2b656a(0x2bb)+_0x2b656a(0x2e3)+_0x2b656a(0x28e)+_0x2b656a(0x237)+'ator_id\x20TE'+_0x2b656a(0x1ef)+'L,\x0a\x20\x20\x20\x20\x20\x20\x20'+_0x2b656a(0x2b7)+_0x2b656a(0x304)+_0x2b656a(0x233)+_0x2b656a(0x2be)+_0x2b656a(0x22a)),info('[connectio'+_0x2b656a(0x206)+_0x2b656a(0x29b)+'nections\x20('+_0x2b656a(0x1e7)+_0x2b656a(0x302));return;}const _0x411477=await columnExists('connection'+'s',_0x2b656a(0x1c4)),_0x9b7458=await columnExists(_0x2b656a(0x1f9)+'s','chat_id'),_0x1b93c9=await columnExists(_0x2b656a(0x1f9)+'s',_0x2b656a(0x209));if(!_0x9b7458||!_0x1b93c9||!_0x411477)try{await _0xfab5e8[_0x2b656a(0x232)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20C'+'REATE\x20TABL'+_0x2b656a(0x1ec)+_0x2b656a(0x1e8)+_0x2b656a(0x2da)+_0x2b656a(0x272)+_0x2b656a(0x315)+_0x2b656a(0x2a5)+'LL,\x0a\x20\x20\x20\x20\x20\x20'+_0x2b656a(0x247)+_0x2b656a(0x2d8)+_0x2b656a(0x2eb)+_0x2b656a(0x218)+_0x2b656a(0x219)+'hat_id\x20TEX'+_0x2b656a(0x1c5)+_0x2b656a(0x29c)+_0x2b656a(0x297)+_0x2b656a(0x288)+_0x2b656a(0x25e)+_0x2b656a(0x2fb)+_0x2b656a(0x1be)+',\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+'\x20\x20PRIMARY\x20'+'KEY\x20(name,'+_0x2b656a(0x316)+_0x2b656a(0x291)+_0x2b656a(0x253));try{const _0x5d1b18=await _0xfab5e8['all']('SELECT\x20nam'+_0x2b656a(0x312)+',\x20creator_'+_0x2b656a(0x26b)+_0x2b656a(0x2db));if(Array[_0x2b656a(0x25a)](_0x5d1b18)&&_0x5d1b18[_0x2b656a(0x25d)])for(const _0x441853 of _0x5d1b18){const _0x2badf3=_0x441853[_0x2b656a(0x244)],_0x491c9d=typeof _0x441853[_0x2b656a(0x211)]===_0x2b656a(0x227)||_0x441853['chat_id']===null?'[]':_0x441853[_0x2b656a(0x211)],_0x7fd116=typeof _0x441853[_0x2b656a(0x209)]==='undefined'||_0x441853[_0x2b656a(0x209)]===null?'':_0x441853[_0x2b656a(0x209)];try{await _0xfab5e8[_0x2b656a(0x1c1)](_0x2b656a(0x1c2)+_0x2b656a(0x1f7)+_0x2b656a(0x24e)+_0x2b656a(0x23b)+_0x2b656a(0x1e7)+_0x2b656a(0x2b4)+'_id,\x20creat'+'or_id)\x20VAL'+_0x2b656a(0x221)+'\x20?,\x20?)',[_0x2badf3,'',_0x491c9d,_0x7fd116]);}catch(_0x533aaa){warn(_0x2b656a(0x1f4)+_0x2b656a(0x285)+_0x2b656a(0x1a9)+'\x20into\x20conn'+_0x2b656a(0x2da)+_0x2b656a(0x2ed)+_0x2b656a(0x1c9)+_0x2badf3+':\x20'+(_0x533aaa?.['message']||_0x533aaa));}}}catch(_0x562a04){warn('[connectio'+'n][migrati'+_0x2b656a(0x26f)+_0x2b656a(0x246)+_0x2b656a(0x2dd)+(_0x562a04?.[_0x2b656a(0x2bd)]||_0x562a04));}try{await _0xfab5e8[_0x2b656a(0x232)](_0x2b656a(0x274)+_0x2b656a(0x2cd)+_0x2b656a(0x319)+_0x2b656a(0x2d7));}catch(_0x18c916){}await _0xfab5e8[_0x2b656a(0x232)](_0x2b656a(0x314)+'E\x20connecti'+_0x2b656a(0x2e7)+_0x2b656a(0x238)+_0x2b656a(0x2a7)),info(_0x2b656a(0x1f4)+'n]\x20migrate'+_0x2b656a(0x228)+'ons\x20->\x20con'+_0x2b656a(0x30f)+_0x2b656a(0x2e2)+_0x2b656a(0x2d4));}catch(_0x3d1444){warn(_0x2b656a(0x1f4)+_0x2b656a(0x2a2)+_0x2b656a(0x300)+_0x2b656a(0x1f9)+_0x2b656a(0x239)+_0x2b656a(0x1cf)+(_0x3d1444?.[_0x2b656a(0x2bd)]||_0x3d1444));if(!_0x9b7458)try{await _0xfab5e8[_0x2b656a(0x232)](_0x2b656a(0x314)+_0x2b656a(0x2cb)+_0x2b656a(0x203)+'LUMN\x20chat_'+_0x2b656a(0x2d8)+_0x2b656a(0x2eb)+'AULT\x20\x27[]\x27;'),info(_0x2b656a(0x1f4)+_0x2b656a(0x2a1)+_0x2b656a(0x2bf)+_0x2b656a(0x275)+'n');}catch(_0x3b9a0e){warn(_0x3b9a0e,_0x2b656a(0x1f4)+_0x2b656a(0x1f2)+_0x2b656a(0x317)+_0x2b656a(0x201));}if(!_0x1b93c9)try{await _0xfab5e8[_0x2b656a(0x232)](_0x2b656a(0x314)+_0x2b656a(0x2cb)+'ons\x20ADD\x20CO'+'LUMN\x20creat'+_0x2b656a(0x25e)+_0x2b656a(0x2fb)+_0x2b656a(0x1be)+';'),info(_0x2b656a(0x1f4)+'n]\x20added\x20m'+_0x2b656a(0x21b)+_0x2b656a(0x2ca)+_0x2b656a(0x1ee));}catch(_0x51c849){warn(_0x51c849,_0x2b656a(0x1f4)+_0x2b656a(0x1f2)+_0x2b656a(0x1e9)+_0x2b656a(0x307));}if(!_0x411477)try{await _0xfab5e8[_0x2b656a(0x232)](_0x2b656a(0x314)+_0x2b656a(0x2cb)+'ons\x20ADD\x20CO'+_0x2b656a(0x266)+_0x2b656a(0x2e3)+_0x2b656a(0x294)+_0x2b656a(0x270)),info(_0x2b656a(0x1f4)+_0x2b656a(0x2a1)+_0x2b656a(0x1f5)+_0x2b656a(0x231)+'mn');}catch(_0x50ab1c){warn(_0x50ab1c,'[connectio'+_0x2b656a(0x1f2)+_0x2b656a(0x259)+'up_id');}}}async function ensureGroupDefaultsTable(){const _0x1bacce=_0x412c2d,_0x323918=await getDb(),_0x65fb73=await tableExists(_0x1bacce(0x268)+_0x1bacce(0x2a9));if(!_0x65fb73){await _0x323918[_0x1bacce(0x232)](_0x1bacce(0x1d1)+'ATE\x20TABLE\x20'+'IF\x20NOT\x20EXI'+_0x1bacce(0x2d9)+'defaults\x20('+_0x1bacce(0x1d5)+_0x1bacce(0x217)+_0x1bacce(0x2b8)+_0x1bacce(0x2ac)+_0x1bacce(0x315)+_0x1bacce(0x2a5)+'LL\x0a\x20\x20\x20\x20\x20\x20)'+';\x0a\x20\x20\x20\x20'),info(_0x1bacce(0x1f4)+_0x1bacce(0x206)+_0x1bacce(0x207)+_0x1bacce(0x27c)+'s');return;}!await columnExists('group_defa'+'ults','group_id')&&await addGroupDefaultsColumns();}async function addGroupDefaultsColumns(){const _0x89b996=_0x412c2d,_0x302069=await getDb();try{await _0x302069['exec'](_0x89b996(0x314)+_0x89b996(0x2f4)+_0x89b996(0x286)+_0x89b996(0x1ad)+_0x89b996(0x2bc)+'T\x20NOT\x20NULL'+_0x89b996(0x29c)+'\x27;'),await _0x302069[_0x89b996(0x232)]('ALTER\x20TABL'+_0x89b996(0x2f4)+_0x89b996(0x286)+'\x20COLUMN\x20na'+_0x89b996(0x24c)+_0x89b996(0x2eb)+'AULT\x20\x27[]\x27;');}catch(_0xba66){warn(_0x89b996(0x1f4)+_0x89b996(0x27a)+'pDefaultsC'+_0x89b996(0x2d0)+_0x89b996(0x22b)+(_0xba66?.[_0x89b996(0x2bd)]||_0xba66));}}function _0x4208(_0x37cbb6,_0x3835f9){const _0x2cbc7f=_0x6c7e();return _0x4208=function(_0x33b76d,_0xc5832b){_0x33b76d=_0x33b76d-(0x25d3+-0x114b*0x1+-0x12e8);let _0x325f56=_0x2cbc7f[_0x33b76d];return _0x325f56;},_0x4208(_0x37cbb6,_0x3835f9);}async function ensureActiveGroupsTable(){const _0x231637=_0x412c2d,_0x1fe541=await getDb(),_0x214336=await tableExists(ACTIVE_TABLE);!_0x214336&&(await _0x1fe541[_0x231637(0x232)](_0x231637(0x1d1)+'ATE\x20TABLE\x20'+_0x231637(0x2ce)+'STS\x20'+ACTIVE_TABLE+(_0x231637(0x22f)+'\x20user_key\x20'+_0x231637(0x2c2)+'RY\x20KEY,\x0a\x20\x20'+_0x231637(0x293)+_0x231637(0x2c1)+_0x231637(0x1cc)+_0x231637(0x1da)+'\x20\x20')),info(_0x231637(0x1f4)+_0x231637(0x206)+_0x231637(0x2e4)+ACTIVE_TABLE));}async function migrateConnectionsChatIdToArray(){const _0x18c86a=_0x412c2d;try{const _0x120ee4=await getDb(),_0x11f70c=await _0x120ee4[_0x18c86a(0x1cb)]('SELECT\x20nam'+'e,\x20group_i'+_0x18c86a(0x2d6)+'\x20FROM\x20conn'+'ections');if(!_0x11f70c||_0x11f70c[_0x18c86a(0x25d)]===-0x1cf5+0x233+0x89*0x32)return;const _0x26188e=[];for(const _0x49835c of _0x11f70c){const _0x63a2cd=_0x49835c[_0x18c86a(0x211)],_0x54c9a4=safeParseJSON(_0x63a2cd);if(Array['isArray'](_0x54c9a4)){const _0x5f1439=_0x54c9a4['map'](String),_0x627abd=toJSONString(_0x5f1439);if(_0x627abd!==_0x63a2cd)_0x26188e['push']({'name':_0x49835c[_0x18c86a(0x244)],'group_id':_0x49835c[_0x18c86a(0x1c4)]||'','chat_id':_0x627abd});continue;}else{let _0x4d6b7d=[];_0x63a2cd===null||_0x63a2cd===undefined||String(_0x63a2cd)[_0x18c86a(0x230)]()===''?_0x4d6b7d=[]:_0x4d6b7d=[String(_0x63a2cd)];const _0x4f9968=toJSONString(_0x4d6b7d);_0x26188e[_0x18c86a(0x290)]({'name':_0x49835c[_0x18c86a(0x244)],'group_id':_0x49835c[_0x18c86a(0x1c4)]||'','chat_id':_0x4f9968});}}if(_0x26188e[_0x18c86a(0x25d)]>0x1*-0x496+0x629+-0x193){try{await _0x120ee4[_0x18c86a(0x232)](_0x18c86a(0x1ab)+_0x18c86a(0x241));}catch(_0x32e7e6){}for(const _0x3d0af3 of _0x26188e){try{await _0x120ee4[_0x18c86a(0x1c1)](_0x18c86a(0x2f5)+_0x18c86a(0x267)+'ET\x20chat_id'+_0x18c86a(0x31a)+_0x18c86a(0x27b)+'AND\x20group_'+'id\x20=\x20?',[_0x3d0af3[_0x18c86a(0x211)],_0x3d0af3[_0x18c86a(0x244)],_0x3d0af3[_0x18c86a(0x1c4)]]),info('[connectio'+_0x18c86a(0x285)+_0x18c86a(0x2f2)+_0x18c86a(0x245)+_0x18c86a(0x24b)+_0x3d0af3[_0x18c86a(0x244)]+(_0x18c86a(0x1d7)+'\x22')+_0x3d0af3[_0x18c86a(0x1c4)]+'\x22');}catch(_0x21bdfd){warn('[connectio'+'n][migrati'+'on]\x20failed'+_0x18c86a(0x2f9)+_0x18c86a(0x204)+_0x18c86a(0x1c9)+_0x3d0af3['name']+'@'+_0x3d0af3['group_id']+':\x20'+(_0x21bdfd?.[_0x18c86a(0x2bd)]||_0x21bdfd));}}try{await _0x120ee4[_0x18c86a(0x232)](_0x18c86a(0x234));}catch(_0xc3d83e){}}}catch(_0x19d1fb){warn(_0x18c86a(0x1f4)+_0x18c86a(0x285)+_0x18c86a(0x2cc)+_0x18c86a(0x210)+_0x18c86a(0x214)+'Array\x20fail'+_0x18c86a(0x28b)+(_0x19d1fb?.['message']||_0x19d1fb));}}async function migrateGroupDefaultsNameToArray(){const _0x2f5ae7=_0x412c2d;try{const _0x52fbce=await getDb(),_0x4d1f80=await _0x52fbce['all']('SELECT\x20gro'+_0x2f5ae7(0x1f8)+_0x2f5ae7(0x295)+_0x2f5ae7(0x27c)+'s');if(!_0x4d1f80||_0x4d1f80[_0x2f5ae7(0x25d)]===0x2*0x259+-0x1*-0x92+-0x4*0x151)return;const _0x271085=[];for(const _0x49bd26 of _0x4d1f80){const _0x23f945=_0x49bd26[_0x2f5ae7(0x244)],_0x4342bd=safeParseJSON(_0x23f945);if(Array[_0x2f5ae7(0x25a)](_0x4342bd)){const _0x4777d2=toJSONString(_0x4342bd);if(_0x4777d2!==_0x23f945)_0x271085[_0x2f5ae7(0x290)]({'group_id':_0x49bd26[_0x2f5ae7(0x1c4)],'name':_0x4777d2});continue;}else{const _0x428235=_0x23f945===null||_0x23f945===undefined||String(_0x23f945)[_0x2f5ae7(0x230)]()===''?[]:[String(_0x23f945)],_0x48b83b=toJSONString(_0x428235);_0x271085[_0x2f5ae7(0x290)]({'group_id':_0x49bd26['group_id'],'name':_0x48b83b});}}if(_0x271085[_0x2f5ae7(0x25d)]>-0x1af2+0x5*-0x6c1+0x3cb7){try{await _0x52fbce[_0x2f5ae7(0x232)](_0x2f5ae7(0x1ab)+'SACTION;');}catch(_0x233b1a){}for(const _0x5a7e1c of _0x271085){try{await _0x52fbce[_0x2f5ae7(0x1c1)]('UPDATE\x20gro'+_0x2f5ae7(0x27c)+'s\x20SET\x20name'+_0x2f5ae7(0x31a)+_0x2f5ae7(0x2fe)+_0x2f5ae7(0x280),[_0x5a7e1c[_0x2f5ae7(0x244)],_0x5a7e1c[_0x2f5ae7(0x1c4)]]),info(_0x2f5ae7(0x1f4)+_0x2f5ae7(0x285)+'on]\x20normal'+_0x2f5ae7(0x1fe)+_0x2f5ae7(0x2b3)+'for\x20'+_0x5a7e1c[_0x2f5ae7(0x1c4)]);}catch(_0x496db1){warn(_0x2f5ae7(0x1f4)+_0x2f5ae7(0x285)+_0x2f5ae7(0x21c)+_0x2f5ae7(0x2f9)+'\x20group_def'+'aults\x20for\x20'+_0x5a7e1c[_0x2f5ae7(0x1c4)]+':\x20'+(_0x496db1?.[_0x2f5ae7(0x2bd)]||_0x496db1));}}try{await _0x52fbce[_0x2f5ae7(0x232)]('COMMIT;');}catch(_0x35b0f3){}}}catch(_0x4930bb){warn(_0x2f5ae7(0x1f4)+'n][migrati'+_0x2f5ae7(0x2cc)+'eGroupDefa'+_0x2f5ae7(0x2ef)+_0x2f5ae7(0x1dc)+_0x2f5ae7(0x28b)+(_0x4930bb?.['message']||_0x4930bb));}}function parseArrayStrict(_0x3f9bdb){const _0x4c4022=_0x412c2d;if(_0x3f9bdb===null||_0x3f9bdb===undefined)return[];if(typeof _0x3f9bdb===_0x4c4022(0x1f6)){const _0x246443=safeParseJSON(_0x3f9bdb);if(Array[_0x4c4022(0x25a)](_0x246443))return _0x246443[_0x4c4022(0x21f)](String);return[];}if(Array['isArray'](_0x3f9bdb))return _0x3f9bdb[_0x4c4022(0x21f)](String);return[String(_0x3f9bdb)];}function stringifyArray(_0x53c59c){const _0x5bfb9a=_0x412c2d;return JSON[_0x5bfb9a(0x2d2)](Array[_0x5bfb9a(0x25a)](_0x53c59c)?_0x53c59c[_0x5bfb9a(0x21f)](String):[]);}async function loadConnectionsCache(){const _0x463926=_0x412c2d;try{const _0x17ca0e=await getDb(),_0x3bcc09=await _0x17ca0e['all'](_0x463926(0x1d4)+'e,\x20group_i'+_0x463926(0x2d6)+',\x20creator_'+_0x463926(0x26b)+'nnections');connectionsCache[_0x463926(0x261)]();if(!_0x3bcc09||!_0x3bcc09[_0x463926(0x25d)]){info('[connectio'+_0x463926(0x281)+'ions\x20cache'+'\x20loaded\x20(0'+_0x463926(0x1fd));return;}for(const _0x3289a7 of _0x3bcc09){const _0x34c0ee=String(_0x3289a7[_0x463926(0x1c4)]||'');if(!connectionsCache[_0x463926(0x1ff)](_0x34c0ee))connectionsCache[_0x463926(0x28a)](_0x34c0ee,new Map());const _0x1d0d21=connectionsCache['get'](_0x34c0ee);_0x1d0d21['set'](String(_0x3289a7[_0x463926(0x244)]),{'name':_0x3289a7[_0x463926(0x244)],'chat_id':parseArrayStrict(_0x3289a7[_0x463926(0x211)]),'creator_id':_0x3289a7[_0x463926(0x209)]});}info(_0x463926(0x1f4)+_0x463926(0x281)+_0x463926(0x202)+_0x463926(0x224)+_0x3bcc09['length']+'\x20rows)');}catch(_0x1c5c55){warn(_0x463926(0x1f4)+'n]\x20loadCon'+_0x463926(0x1d8)+'che\x20failed'+':\x20'+(_0x1c5c55?.['message']||_0x1c5c55));}}async function loadGroupDefaultsCache(){const _0x678c27=_0x412c2d;try{const _0x3aac6c=await getDb(),_0x25f8ce=await _0x3aac6c['all'](_0x678c27(0x256)+_0x678c27(0x1f8)+_0x678c27(0x295)+_0x678c27(0x27c)+'s');groupDefaultsCache[_0x678c27(0x261)]();if(!_0x25f8ce||!_0x25f8ce['length']){info(_0x678c27(0x1f4)+_0x678c27(0x2b0)+'efaults\x20ca'+_0x678c27(0x260)+_0x678c27(0x1b4));return;}for(const _0x4c87be of _0x25f8ce){try{const _0x50c08a=String(_0x4c87be[_0x678c27(0x1c4)]),_0x5abde0=safeParseJSON(_0x4c87be['name']),_0x2f2bf1=Array[_0x678c27(0x25a)](_0x5abde0)?_0x5abde0['map'](String):[];groupDefaultsCache['set'](_0x50c08a,_0x2f2bf1);}catch(_0x3db68a){}}info('[connectio'+_0x678c27(0x2b0)+'efaults\x20ca'+_0x678c27(0x260)+'\x20('+_0x25f8ce[_0x678c27(0x25d)]+_0x678c27(0x1fd));}catch(_0x49a8f6){warn('[connectio'+_0x678c27(0x236)+_0x678c27(0x1a6)+_0x678c27(0x2f0)+_0x678c27(0x28b)+(_0x49a8f6?.[_0x678c27(0x2bd)]||_0x49a8f6));}}async function loadActiveGroupsCache(){const _0x363431=_0x412c2d;try{const _0x57217a=await getDb(),_0x20b1e5=await _0x57217a['all'](_0x363431(0x248)+_0x363431(0x2ee)+_0x363431(0x21d)+'\x20'+ACTIVE_TABLE);activeGroupByUser['clear']();if(!_0x20b1e5||!_0x20b1e5[_0x363431(0x25d)]){info(_0x363431(0x1f4)+'n]\x20active\x20'+_0x363431(0x309)+_0x363431(0x2a3)+_0x363431(0x30d));return;}for(const _0x204d97 of _0x20b1e5){try{activeGroupByUser['set'](String(_0x204d97[_0x363431(0x2c0)]),String(_0x204d97[_0x363431(0x1c4)]));}catch(_0x4e3fa2){}}info(_0x363431(0x1f4)+_0x363431(0x24f)+'groups\x20cac'+_0x363431(0x2a3)+'('+_0x20b1e5[_0x363431(0x25d)]+_0x363431(0x1fd));}catch(_0x5dabd2){warn('[connectio'+_0x363431(0x27e)+_0x363431(0x1a7)+'ache\x20faile'+_0x363431(0x1a2)+(_0x5dabd2?.['message']||_0x5dabd2));}}export async function refreshCaches(){const _0x621187=_0x412c2d;await ensureSchema(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache(),info(_0x621187(0x1f4)+_0x621187(0x27f)+_0x621187(0x1e2)+_0x621187(0x2b6));}async function ensureActiveGroupsTableAndLoadCaches(){await ensureActiveGroupsTable(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache();}function normalizeUserKeyForStorage(_0x194352){const _0x22cd78=_0x412c2d;if(!_0x194352)return null;const _0x591d4a=String(_0x194352)['trim']();if(!_0x591d4a)return null;return _0x591d4a[_0x22cd78(0x2a8)]('@')?_0x591d4a[_0x22cd78(0x1c8)]('@')[-0x1b21+-0x3b0+0x1ed1]:_0x591d4a;}export async function ensureSchema(){const _0x107483=_0x412c2d;if(schemaEnsured)return;try{await getDb(),await ensureConnectionsTable(),await ensureGroupDefaultsTable(),await ensureActiveGroupsTable(),await migrateConnectionsChatIdToArray(),await migrateGroupDefaultsNameToArray(),await ensureActiveGroupsTableAndLoadCaches(),schemaEnsured=!![],info(_0x107483(0x1f4)+_0x107483(0x2e0)+'ensured\x20an'+_0x107483(0x318)+_0x107483(0x1db)+_0x107483(0x1fb)+_0x107483(0x2b5)+_0x107483(0x299)+_0x107483(0x26a)+'ded.');}catch(_0x276a92){error(_0x276a92,_0x107483(0x1f4)+_0x107483(0x2b9)+_0x107483(0x273)+_0x107483(0x28b)+(_0x276a92?.['message']||_0x276a92));throw _0x276a92;}}export async function initialize(){await ensureSchema();}export async function setActiveGroupForUser(_0x18b9b9,_0x14c0f5){const _0x2d6a93=_0x412c2d;try{if(!_0x18b9b9)return;const _0x4c677b=normalizeUserKeyForStorage(_0x18b9b9);if(!_0x4c677b)return;if(!_0x14c0f5){activeGroupByUser['delete'](_0x4c677b);try{const _0x4801fb=await getDb();await _0x4801fb[_0x2d6a93(0x1c1)](_0x2d6a93(0x2c4)+'M\x20'+ACTIVE_TABLE+(_0x2d6a93(0x1cd)+_0x2d6a93(0x311)),[_0x4c677b]);}catch(_0xdba8e7){warn('[connectio'+_0x2d6a93(0x1f2)+'to\x20persist'+_0x2d6a93(0x1e6)+_0x2d6a93(0x283)+_0x2d6a93(0x23f)+(_0xdba8e7?.[_0x2d6a93(0x2bd)]||_0xdba8e7));}return;}const _0x590953=String(_0x14c0f5);activeGroupByUser[_0x2d6a93(0x28a)](_0x4c677b,_0x590953);try{const _0x4667d3=await getDb();await _0x4667d3[_0x2d6a93(0x1c1)](_0x2d6a93(0x2f3)+'O\x20'+ACTIVE_TABLE+(_0x2d6a93(0x2aa)+_0x2d6a93(0x2cf)+_0x2d6a93(0x2a6)+'?,\x20?)\x20\x0a\x20\x20\x20'+_0x2d6a93(0x2b2)+_0x2d6a93(0x29f)+_0x2d6a93(0x2dc)+_0x2d6a93(0x279)+_0x2d6a93(0x1ba)+_0x2d6a93(0x1a0)+_0x2d6a93(0x1b9)+_0x2d6a93(0x2f6)+'id'),[_0x4c677b,_0x590953]);}catch(_0x5bc0b5){warn('[connectio'+_0x2d6a93(0x1f2)+_0x2d6a93(0x263)+_0x2d6a93(0x1e6)+_0x2d6a93(0x2ff)+(_0x5bc0b5?.[_0x2d6a93(0x2bd)]||_0x5bc0b5));}}catch(_0x3c612d){warn(_0x2d6a93(0x1f4)+_0x2d6a93(0x1d3)+_0x2d6a93(0x276)+_0x2d6a93(0x1af)+':\x20'+(_0x3c612d?.[_0x2d6a93(0x2bd)]||_0x3c612d));}}export function getActiveGroupForUser(_0x14930e){const _0x5c32f6=_0x412c2d;try{if(!_0x14930e)return null;const _0x2a9612=normalizeUserKeyForStorage(_0x14930e);if(!_0x2a9612)return null;return activeGroupByUser[_0x5c32f6(0x20b)](_0x2a9612)||null;}catch(_0x2cfb26){return warn(_0x5c32f6(0x1f4)+_0x5c32f6(0x22e)+_0x5c32f6(0x276)+'User\x20error'+':\x20'+(_0x2cfb26?.['message']||_0x2cfb26)),null;}}export async function addConnection(_0x568491,_0xc77d71,_0x49985a='',_0x3cb700=''){const _0x2ad95c=_0x412c2d;try{await ensureSchema();const _0x41b60e=await getDb(),_0x1b26cc=String(_0x3cb700||''),_0x155f15=await _0x41b60e[_0x2ad95c(0x20b)](_0x2ad95c(0x25f)+'t_id\x20FROM\x20'+_0x2ad95c(0x1f9)+_0x2ad95c(0x2f8)+_0x2ad95c(0x1c0)+_0x2ad95c(0x2fe)+'=\x20?',[String(_0x568491),_0x1b26cc]);if(!_0x155f15){const _0x233de4=[String(_0xc77d71)];await _0x41b60e[_0x2ad95c(0x1c1)](_0x2ad95c(0x2f3)+_0x2ad95c(0x30b)+_0x2ad95c(0x1de)+'\x20group_id,'+'\x20chat_id,\x20'+_0x2ad95c(0x209)+')\x20VALUES\x20('+_0x2ad95c(0x1e3)+')',[String(_0x568491),_0x1b26cc,stringifyArray(_0x233de4),String(_0x49985a||'')]),info(_0x2ad95c(0x1f4)+'n]\x20created'+':\x20'+_0x568491+_0x2ad95c(0x26d)+_0xc77d71+'\x20(creator='+_0x49985a+_0x2ad95c(0x2e9)+_0x1b26cc);if(!connectionsCache['has'](_0x1b26cc))connectionsCache[_0x2ad95c(0x28a)](_0x1b26cc,new Map());const _0x21ac3e=connectionsCache[_0x2ad95c(0x20b)](_0x1b26cc);return _0x21ac3e['set'](String(_0x568491),{'name':String(_0x568491),'chat_id':_0x233de4['map'](String),'creator_id':String(_0x49985a||'')}),!![];}else{const _0x79676e=parseArrayStrict(_0x155f15['chat_id']);if(!_0x79676e[_0x2ad95c(0x2a8)](String(_0xc77d71)))_0x79676e[_0x2ad95c(0x290)](String(_0xc77d71));await _0x41b60e[_0x2ad95c(0x1c1)](_0x2ad95c(0x2f5)+_0x2ad95c(0x267)+'ET\x20chat_id'+_0x2ad95c(0x265)+_0x2ad95c(0x1aa)+'\x20WHERE\x20nam'+_0x2ad95c(0x2f7)+_0x2ad95c(0x313)+'\x20?',[stringifyArray(_0x79676e),String(_0x49985a||''),String(_0x568491),_0x1b26cc]),info(_0x2ad95c(0x1f4)+_0x2ad95c(0x26c)+':\x20'+_0x568491+_0x2ad95c(0x26d)+_0x79676e[_0x2ad95c(0x2ad)](',')+_0x2ad95c(0x2af)+_0x1b26cc);if(!connectionsCache['has'](_0x1b26cc))connectionsCache[_0x2ad95c(0x28a)](_0x1b26cc,new Map());const _0x2d59ec=connectionsCache[_0x2ad95c(0x20b)](_0x1b26cc);return _0x2d59ec[_0x2ad95c(0x28a)](String(_0x568491),{'name':String(_0x568491),'chat_id':_0x79676e[_0x2ad95c(0x21f)](String),'creator_id':String(_0x49985a||'')}),!![];}}catch(_0xaa889){return error(_0xaa889,'[connectio'+_0x2ad95c(0x2fc)+'ection\x20fai'+'led\x20for\x20'+_0x568491+_0x2ad95c(0x1e1)+_0x3cb700),![];}}export async function deleteConnectionScoped(_0x444301,_0x17b701=''){const _0x24003a=_0x412c2d;try{await ensureSchema();const _0x13c210=await getDb(),_0x6d6515=await _0x13c210[_0x24003a(0x1c1)](_0x24003a(0x2c4)+_0x24003a(0x22c)+_0x24003a(0x2c8)+_0x24003a(0x1e5)+'ND\x20group_i'+_0x24003a(0x2df),[String(_0x444301),String(_0x17b701||'')]),_0x2f9325=_0x6d6515&&(_0x6d6515['changes']===undefined?!![]:!!_0x6d6515[_0x24003a(0x28d)]);info(_0x24003a(0x1f4)+_0x24003a(0x2ea)+_0x24003a(0x2d5)+'coped:\x20'+_0x444301+_0x24003a(0x1e1)+_0x17b701+'\x20(deleted='+_0x2f9325+')');try{const _0x376cd7=String(_0x17b701||'');if(connectionsCache[_0x24003a(0x1ff)](_0x376cd7)){const _0xb2d86f=connectionsCache[_0x24003a(0x20b)](_0x376cd7);if(_0xb2d86f)_0xb2d86f[_0x24003a(0x1a3)](String(_0x444301));}}catch(_0x6e602e){}return _0x2f9325;}catch(_0x2d2caf){return error(_0x2d2caf,_0x24003a(0x1f4)+_0x24003a(0x2ea)+_0x24003a(0x2d5)+_0x24003a(0x200)+'ed:\x20'+_0x444301+_0x24003a(0x1e1)+_0x17b701),![];}}export async function deleteConnectionsByCreatorInGroup(_0x19c82b,_0x44da16=''){const _0x335f61=_0x412c2d;try{await ensureSchema();const _0x52a47f=await getDb(),_0x5415fc=await _0x52a47f[_0x335f61(0x1c1)](_0x335f61(0x2c4)+'M\x20connecti'+'ons\x20WHERE\x20'+_0x335f61(0x209)+_0x335f61(0x292)+'roup_id\x20=\x20'+'?',[String(_0x19c82b),String(_0x44da16||'')]),_0x3ef5f8=_0x5415fc&&(_0x5415fc['changes']===undefined?!![]:_0x5415fc[_0x335f61(0x28d)])||-0x1385+0x10*-0xf7+-0x9d*-0x39;info('[connectio'+'n]\x20deleteC'+'onnections'+'ByCreatorI'+_0x335f61(0x212)+_0x19c82b+'\x20@\x20'+_0x44da16+_0x335f61(0x27d)+_0x3ef5f8+')');try{const _0x1c0fee=String(_0x44da16||'');if(connectionsCache[_0x335f61(0x1ff)](_0x1c0fee)){const _0x36fa3a=connectionsCache[_0x335f61(0x20b)](_0x1c0fee);for(const [_0x42cd6a,_0x158737]of Array['from'](_0x36fa3a[_0x335f61(0x23a)]())){if(String(_0x158737[_0x335f61(0x209)])===String(_0x19c82b))_0x36fa3a[_0x335f61(0x1a3)](_0x42cd6a);}}}catch(_0x40a6a2){}return _0x3ef5f8;}catch(_0x1ff09d){return error(_0x1ff09d,_0x335f61(0x1f4)+'n]\x20deleteC'+'onnections'+_0x335f61(0x1f0)+_0x335f61(0x2ba)+'led:\x20'+(_0x1ff09d?.[_0x335f61(0x2bd)]||_0x1ff09d)),0x186+-0x29d+0x117;}}export async function removeChatIdsFromConnectionScoped(_0x37aae8,_0x1a821f,_0x4de8b7=''){const _0x37c795=_0x412c2d;try{if(!_0x37aae8)return![];await ensureSchema();const _0x1ca137=await getDb(),_0x58dcd0=await _0x1ca137['get'](_0x37c795(0x25f)+_0x37c795(0x1b1)+_0x37c795(0x1f9)+_0x37c795(0x2f8)+_0x37c795(0x1c0)+_0x37c795(0x2fe)+'=\x20?',[String(_0x37aae8),String(_0x4de8b7||'')]);if(!_0x58dcd0)return![];const _0xa3e9e9=parseArrayStrict(_0x58dcd0['chat_id']),_0x1f861d=Array[_0x37c795(0x25a)](_0x1a821f)?_0x1a821f[_0x37c795(0x21f)](String):[String(_0x1a821f)],_0x23342a=_0xa3e9e9[_0x37c795(0x1bb)](_0x5b7400=>!_0x1f861d['includes'](_0x5b7400));if(_0x23342a['length']===-0xb21+-0x56*0x6+0xd25){await _0x1ca137[_0x37c795(0x1c1)]('DELETE\x20FRO'+'M\x20connecti'+_0x37c795(0x2c8)+'name\x20=\x20?\x20A'+_0x37c795(0x2e5)+_0x37c795(0x2df),[String(_0x37aae8),String(_0x4de8b7||'')]),info(_0x37c795(0x1f4)+_0x37c795(0x24a)+_0x37c795(0x264)+_0x37c795(0x306)+_0x37c795(0x2c5)+_0x37c795(0x2ab)+'entries\x20fo'+'r\x20'+_0x37aae8+'\x20@\x20'+_0x4de8b7+(_0x37c795(0x20d)+_0x37c795(0x2b1)));try{const _0x3e5b15=String(_0x4de8b7||'');if(connectionsCache[_0x37c795(0x1ff)](_0x3e5b15))connectionsCache[_0x37c795(0x20b)](_0x3e5b15)[_0x37c795(0x1a3)](String(_0x37aae8));}catch(_0x54fa7e){}return!![];}else{await _0x1ca137['run'](_0x37c795(0x2f5)+_0x37c795(0x267)+_0x37c795(0x2a4)+_0x37c795(0x31a)+_0x37c795(0x27b)+_0x37c795(0x1b8)+'id\x20=\x20?',[stringifyArray(_0x23342a),String(_0x37aae8),String(_0x4de8b7||'')]),info(_0x37c795(0x1f4)+_0x37c795(0x24a)+_0x37c795(0x264)+_0x37c795(0x306)+_0x37c795(0x1ce)+_0x37aae8+'@'+_0x4de8b7+'\x20now\x20->\x20'+_0x23342a[_0x37c795(0x2ad)](','));try{const _0x2f8c85=String(_0x4de8b7||'');if(!connectionsCache['has'](_0x2f8c85))connectionsCache['set'](_0x2f8c85,new Map());connectionsCache[_0x37c795(0x20b)](_0x2f8c85)[_0x37c795(0x28a)](String(_0x37aae8),{'name':String(_0x37aae8),'chat_id':_0x23342a[_0x37c795(0x21f)](String),'creator_id':connectionsCache['get'](_0x2f8c85)['get'](String(_0x37aae8))?.[_0x37c795(0x209)]||''});}catch(_0x368e4b){}return!![];}}catch(_0x250949){return error(_0x250949,_0x37c795(0x1f4)+_0x37c795(0x24a)+_0x37c795(0x264)+_0x37c795(0x306)+'Scoped\x20fai'+_0x37c795(0x22b)+(_0x250949?.[_0x37c795(0x2bd)]||_0x250949)),![];}}export async function listConnectionsForGroup(_0x22a6ee){const _0x6cf281=_0x412c2d;try{await ensureSchema();const _0xf70097=String(_0x22a6ee||'');if(connectionsCache[_0x6cf281(0x1ff)](_0xf70097)){const _0x1c0969=connectionsCache['get'](_0xf70097);return Array[_0x6cf281(0x23c)](_0x1c0969[_0x6cf281(0x1df)]())[_0x6cf281(0x21f)](_0x74d7=>({'name':_0x74d7[_0x6cf281(0x244)],'chat_id':Array[_0x6cf281(0x25a)](_0x74d7[_0x6cf281(0x211)])?_0x74d7[_0x6cf281(0x211)][_0x6cf281(0x21f)](String):[],'creator_id':_0x74d7[_0x6cf281(0x209)]}));}const _0x242db1=await getDb(),_0x2a21e2=await _0x242db1[_0x6cf281(0x1cb)](_0x6cf281(0x1d4)+_0x6cf281(0x312)+_0x6cf281(0x303)+_0x6cf281(0x26b)+_0x6cf281(0x242)+_0x6cf281(0x1b5)+_0x6cf281(0x226)+_0x6cf281(0x1a8)+'me',[_0xf70097]);return(_0x2a21e2||[])[_0x6cf281(0x21f)](_0x284d22=>({'name':_0x284d22[_0x6cf281(0x244)],'chat_id':parseArrayStrict(_0x284d22['chat_id']),'creator_id':_0x284d22[_0x6cf281(0x209)]}));}catch(_0x664702){return error(_0x664702,_0x6cf281(0x1f4)+'n]\x20listCon'+'nectionsFo'+'rGroup\x20fai'+'led:\x20'+(_0x664702?.[_0x6cf281(0x2bd)]||_0x664702)),[];}}export async function listConnectionsForUser(_0x4f3c71,_0x2c5fac=null){const _0x34cf56=_0x412c2d;try{await ensureSchema();const _0x376672=await getDb();if(_0x2c5fac){const _0x4eda66=await _0x376672['all'](_0x34cf56(0x1d4)+'e,\x20chat_id'+_0x34cf56(0x303)+_0x34cf56(0x26b)+_0x34cf56(0x242)+_0x34cf56(0x251)+'tor_id\x20=\x20?'+_0x34cf56(0x20a)+_0x34cf56(0x1ea)+_0x34cf56(0x301)+'e',[String(_0x4f3c71),String(_0x2c5fac)]);return(_0x4eda66||[])[_0x34cf56(0x21f)](_0x150575=>({'name':_0x150575[_0x34cf56(0x244)],'chat_id':parseArrayStrict(_0x150575['chat_id']),'creator_id':_0x150575[_0x34cf56(0x209)]}));}else{const _0x8b0e42=await _0x376672[_0x34cf56(0x1cb)](_0x34cf56(0x1d4)+'e,\x20chat_id'+_0x34cf56(0x303)+_0x34cf56(0x277)+_0x34cf56(0x26b)+'nnections\x20'+_0x34cf56(0x251)+_0x34cf56(0x1aa)+_0x34cf56(0x2c9)+_0x34cf56(0x1d0)+'name',[String(_0x4f3c71)]);return(_0x8b0e42||[])['map'](_0x1d43cc=>({'name':_0x1d43cc[_0x34cf56(0x244)],'chat_id':parseArrayStrict(_0x1d43cc[_0x34cf56(0x211)]),'creator_id':_0x1d43cc['creator_id'],'group_id':_0x1d43cc[_0x34cf56(0x1c4)]}));}}catch(_0x4e488d){return error(_0x4e488d,_0x34cf56(0x1f4)+_0x34cf56(0x229)+_0x34cf56(0x1ac)+'rUser\x20fail'+'ed'),[];}}export async function listAllConnections(){const _0x585621=_0x412c2d;try{await ensureSchema();const _0x9a0b44=await getDb(),_0x123817=await _0x9a0b44[_0x585621(0x1cb)](_0x585621(0x1d4)+_0x585621(0x312)+_0x585621(0x303)+_0x585621(0x277)+'id\x20FROM\x20co'+_0x585621(0x242)+'ORDER\x20BY\x20g'+'roup_id,\x20n'+'ame');return(_0x123817||[])[_0x585621(0x21f)](_0x2242a4=>({'name':_0x2242a4[_0x585621(0x244)],'chat_id':parseArrayStrict(_0x2242a4['chat_id']),'creator_id':_0x2242a4['creator_id'],'group_id':_0x2242a4[_0x585621(0x1c4)]}));}catch(_0x1d953b){return error(_0x1d953b,'[connectio'+_0x585621(0x29e)+'Connection'+'s\x20failed'),[];}}export async function getConnectionScoped(_0x4bcca0,_0x4a9c28=''){const _0x11e89c=_0x412c2d;try{await ensureSchema();const _0x18af97=String(_0x4a9c28||'');if(connectionsCache[_0x11e89c(0x1ff)](_0x18af97)&&connectionsCache[_0x11e89c(0x20b)](_0x18af97)[_0x11e89c(0x1ff)](String(_0x4bcca0)))return connectionsCache['get'](_0x18af97)[_0x11e89c(0x20b)](String(_0x4bcca0))[_0x11e89c(0x211)][_0x11e89c(0x25c)]();const _0x39fa01=await getDb(),_0x48da2d=await _0x39fa01[_0x11e89c(0x20b)](_0x11e89c(0x25f)+'t_id\x20FROM\x20'+_0x11e89c(0x1f9)+'s\x20WHERE\x20na'+_0x11e89c(0x1c0)+_0x11e89c(0x2fe)+'=\x20?',[String(_0x4bcca0),_0x18af97]);if(!_0x48da2d)return null;return parseArrayStrict(_0x48da2d[_0x11e89c(0x211)]);}catch(_0x2bd99f){return error(_0x2bd99f,_0x11e89c(0x1f4)+'n]\x20getConn'+_0x11e89c(0x2a0)+'ed('+_0x4bcca0+_0x11e89c(0x1e1)+_0x4a9c28+_0x11e89c(0x29d)),null;}}export async function getConnectionRecordScoped(_0x3b2c98,_0x19778e=''){const _0x3bfb69=_0x412c2d;try{await ensureSchema();const _0x422624=String(_0x19778e||'');if(connectionsCache[_0x3bfb69(0x1ff)](_0x422624)&&connectionsCache['get'](_0x422624)[_0x3bfb69(0x1ff)](String(_0x3b2c98))){const _0x203a23=connectionsCache[_0x3bfb69(0x20b)](_0x422624)['get'](String(_0x3b2c98));return{'name':_0x203a23['name'],'chat_id':_0x203a23['chat_id'][_0x3bfb69(0x25c)](),'creator_id':_0x203a23[_0x3bfb69(0x209)]};}const _0x524970=await getDb(),_0x36aeaa=await _0x524970[_0x3bfb69(0x20b)](_0x3bfb69(0x1d4)+_0x3bfb69(0x312)+_0x3bfb69(0x303)+_0x3bfb69(0x26b)+_0x3bfb69(0x242)+_0x3bfb69(0x20f)+_0x3bfb69(0x292)+_0x3bfb69(0x1ed)+'?',[String(_0x3b2c98),_0x422624]);if(!_0x36aeaa)return null;return{'name':_0x36aeaa[_0x3bfb69(0x244)],'chat_id':parseArrayStrict(_0x36aeaa[_0x3bfb69(0x211)]),'creator_id':_0x36aeaa[_0x3bfb69(0x209)]};}catch(_0x15c2e3){return error(_0x15c2e3,'[connectio'+'n]\x20getConn'+_0x3bfb69(0x243)+_0x3bfb69(0x2ae)+_0x3b2c98+'\x20@\x20'+_0x19778e+')\x20failed'),null;}}export async function getConnectionName(_0x26b5b2){const _0x2f531a=_0x412c2d;try{await ensureSchema();for(const [_0x258382,_0x28fab6]of connectionsCache['entries']()){for(const [_0x5807c9,_0x4a48d8]of _0x28fab6[_0x2f531a(0x23a)]()){if(Array[_0x2f531a(0x25a)](_0x4a48d8[_0x2f531a(0x211)])&&_0x4a48d8['chat_id']['includes'](String(_0x26b5b2)))return _0x5807c9;}}const _0x4d6a7c=await getDb(),_0x4204c3=await _0x4d6a7c[_0x2f531a(0x1cb)](_0x2f531a(0x1d4)+_0x2f531a(0x312)+_0x2f531a(0x1b0)+_0x2f531a(0x1fc));for(const _0x37c507 of _0x4204c3||[]){const _0x4a9221=parseArrayStrict(_0x37c507[_0x2f531a(0x211)]);if(_0x4a9221[_0x2f531a(0x2a8)](String(_0x26b5b2)))return _0x37c507[_0x2f531a(0x244)];}return null;}catch(_0x59c1ee){return error(_0x59c1ee,'[connectio'+_0x2f531a(0x1d2)+'ectionName'+'('+_0x26b5b2+_0x2f531a(0x29d)),null;}}export async function setDefaultGroup(_0x3803a3,_0x5a5767){const _0x80cabd=_0x412c2d;try{await ensureSchema();const _0x821549=await getDb();if(!_0x5a5767)throw new Error(_0x80cabd(0x213)+'quired\x20for'+_0x80cabd(0x254)+_0x80cabd(0x2ec));if(!_0x3803a3||Array[_0x80cabd(0x25a)](_0x3803a3)&&_0x3803a3[_0x80cabd(0x25d)]===-0x6*-0x1bf+-0x3d*0x4+-0x6a*0x17)return await _0x821549[_0x80cabd(0x1c1)](_0x80cabd(0x2c4)+_0x80cabd(0x1f3)+_0x80cabd(0x30a)+'RE\x20group_i'+_0x80cabd(0x2df),[String(_0x5a5767)]),groupDefaultsCache[_0x80cabd(0x1a3)](String(_0x5a5767)),info(_0x80cabd(0x1f4)+'n]\x20group\x20d'+'efault\x20cle'+'ared\x20for\x20'+_0x5a5767),!![];let _0x314762=[];if(typeof _0x3803a3===_0x80cabd(0x1f6)&&_0x3803a3[_0x80cabd(0x296)+'e']()===_0x80cabd(0x1cb)){const _0xba8152=await listConnectionsForGroup(String(_0x5a5767));_0x314762=(_0xba8152||[])[_0x80cabd(0x21f)](_0x2dfa73=>_0x2dfa73[_0x80cabd(0x244)])[_0x80cabd(0x1bb)](Boolean);if(!_0x314762[_0x80cabd(0x25d)])throw new Error('No\x20connect'+'ions\x20found'+'\x20to\x20set\x20as'+_0x80cabd(0x1d6));}else{if(Array[_0x80cabd(0x25a)](_0x3803a3))_0x314762=_0x3803a3[_0x80cabd(0x21f)](String)[_0x80cabd(0x1bb)](Boolean);else{if(typeof _0x3803a3===_0x80cabd(0x1f6)){if(_0x3803a3[_0x80cabd(0x2a8)](','))_0x314762=_0x3803a3[_0x80cabd(0x1c8)](',')[_0x80cabd(0x21f)](_0x37338a=>_0x37338a[_0x80cabd(0x230)]())['filter'](Boolean);else _0x314762=[_0x3803a3];}else throw new Error(_0x80cabd(0x20e)+_0x80cabd(0x208)+_0x80cabd(0x1b7)+_0x80cabd(0x22d)+_0x80cabd(0x24d));}}if(!_0x314762[_0x80cabd(0x25d)])throw new Error(_0x80cabd(0x2fa)+_0x80cabd(0x2fd)+_0x80cabd(0x2e1)+'ided\x20for\x20s'+_0x80cabd(0x28f)+_0x80cabd(0x25b));const _0x37977b=[];for(const _0x487627 of _0x314762){const _0x567ae4=await _0x821549['get'](_0x80cabd(0x252)+_0x80cabd(0x1b2)+_0x80cabd(0x271)+_0x80cabd(0x255)+'\x20AND\x20group'+'_id\x20=\x20?',[String(_0x487627),String(_0x5a5767)]);if(_0x567ae4)_0x37977b[_0x80cabd(0x290)](_0x487627);else warn(_0x80cabd(0x1f4)+'n]\x20setDefa'+_0x80cabd(0x215)+_0x80cabd(0x205)+_0x80cabd(0x258)+_0x80cabd(0x1fa)+_0x80cabd(0x29a)+_0x487627+_0x80cabd(0x298)+_0x5a5767);}if(!_0x37977b[_0x80cabd(0x25d)])throw new Error(_0x80cabd(0x225)+_0x80cabd(0x240)+_0x80cabd(0x319)+_0x80cabd(0x2de)+_0x80cabd(0x2d3)+_0x80cabd(0x20c));return await _0x821549['run'](_0x80cabd(0x2f3)+'O\x20group_de'+_0x80cabd(0x2c7)+_0x80cabd(0x30c)+_0x80cabd(0x1a5)+_0x80cabd(0x23e)+_0x80cabd(0x23d)+'NFLICT(gro'+_0x80cabd(0x1bd)+_0x80cabd(0x2c3)+_0x80cabd(0x269)+_0x80cabd(0x235)+'e;',[String(_0x5a5767),JSON[_0x80cabd(0x2d2)](_0x37977b)]),groupDefaultsCache['set'](String(_0x5a5767),_0x37977b['slice']()),info(_0x80cabd(0x1f4)+_0x80cabd(0x2b0)+_0x80cabd(0x1a1)+_0x80cabd(0x278)+_0x5a5767+'\x20->\x20'+JSON[_0x80cabd(0x2d2)](_0x37977b)),!![];}catch(_0x545eda){return error(_0x545eda,'[connectio'+'n]\x20setDefa'+'ultGroup\x20f'+_0x80cabd(0x2c6)+_0x5a5767+':\x20'+(_0x545eda?.['message']||_0x545eda)),![];}}function _0x6c7e(){const _0x1d220f=['rdScoped(','\x20@\x20group=','n]\x20group\x20d','ted','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','_defaults\x20','p_id,\x20chat','nly,\x20group','plete','\x20PRIMARY\x20K','XT\x20PRIMARY','n]\x20ensureS','nGroup\x20fai','\x20\x20\x20\x20\x20\x20chat','oup_id\x20TEX','message','\x20\x20\x20\x20\x20\x20);\x0a\x20','issing\x20cha','user_key','p_id\x20TEXT\x20','TEXT\x20PRIMA','UPDATE\x20SET','DELETE\x20FRO','Scoped:\x20re','ailed\x20for\x20','faults\x20(gr','ons\x20WHERE\x20','\x20ORDER\x20BY\x20','ator_id\x20co','E\x20connecti','on]\x20migrat','\x20IF\x20EXISTS','IF\x20NOT\x20EXI',',\x20group_id','olumns\x20fai','2051tFsuym','stringify','ist\x20in\x20thi','_id)','onnectionS','d,\x20chat_id','ns;','id\x20TEXT\x20NO','STS\x20group_','ections_ne','nnections','\x20CONFLICT(','\x20failed:\x20','n\x20names\x20ex','d\x20=\x20?','n]\x20schema\x20','names\x20prov','with\x20group','_id\x20TEXT\x20N','\x20table\x20','ND\x20group_i','\x20{\x20db\x20}','ons_new\x20RE','484146wBfKuD',')\x20@\x20group=','n]\x20deleteC','T\x20NULL\x20DEF','tGroup','w\x20failed\x20f','r_key,\x20gro','ultsNameTo','Cache\x20fail','665532OXmiBP','on]\x20normal','INSERT\x20INT','E\x20group_de','UPDATE\x20con','ded.group_','e\x20=\x20?\x20AND\x20','s\x20WHERE\x20na','\x20to\x20update','No\x20valid\x20c','\x20NOT\x20NULL\x20','n]\x20addConn','onnection\x20','\x20group_id\x20','oup:\x20','on\x20to\x20new\x20','DER\x20BY\x20nam','p_id\x20PK)',',\x20creator_','EY\x20(name,\x20','ult\x20failed','Connection','ator_id','user_activ','groups\x20cac','faults\x20WHE','O\x20connecti','oup_id,\x20na','(0\x20rows)','PRAGMA\x20tab','nections\x20(','222073NAcwcP','r_key\x20=\x20?','e,\x20chat_id','group_id\x20=','ALTER\x20TABL','\x20\x20\x20\x20name\x20T','\x20group_id)','to\x20add\x20cha','d\x20migratio','\x20connectio','\x20=\x20?\x20WHERE','SET\x20group_','efault\x20set','d:\x20','delete','to\x20import\x20','me)\x20VALUES','upDefaults','iveGroupsC','RDER\x20BY\x20na','on]\x20insert','tor_id\x20=\x20?','BEGIN\x20TRAN','nectionsFo','\x20COLUMN\x20gr','1896JKyuZU','User\x20error','\x20FROM\x20conn','t_id\x20FROM\x20','ROM\x20connec','log','\x20(0\x20rows)','WHERE\x20grou','e\x20FROM\x20sql','rray\x20type\x20','AND\x20group_','id\x20=\x20exclu','DO\x20UPDATE\x20','filter','database.j','up_id)\x20DO\x20','DEFAULT\x20\x27\x27','tions\x20(\x0a\x20\x20','me\x20=\x20?\x20AND','run','INSERT\x20OR\x20','\x20\x20\x20\x20\x20\x20name','group_id','T\x20NOT\x20NULL','\x20WHERE\x20typ','odule\x20did\x20','split','or\x20','le_info(','all','NOT\x20NULL\x0a\x20','\x20WHERE\x20use','Scoped:\x20','ailed:\x20','group_id,\x20','\x0a\x20\x20\x20\x20\x20\x20CRE','n]\x20getConn','n]\x20setActi','SELECT\x20nam','\x0a\x20\x20\x20\x20\x20\x20\x20\x20g','\x20all','\x22\x20@\x20group\x20','nectionsCa','NULL,\x0a\x20\x20\x20\x20','\x20\x20\x20\x20\x20);\x0a\x20\x20','n\x20complete','Array\x20fail','21260HYifzM','ons\x20(name,','values','3338590XhDCVt','\x20@\x20','Caches\x20com','?,\x20?,\x20?,\x20?','error','name\x20=\x20?\x20A','\x20active\x20gr','name,\x20grou','XISTS\x20conn','to\x20add\x20cre','_id\x20=\x20?\x20OR','n]\x20getDefa','E\x20IF\x20NOT\x20E','roup_id\x20=\x20','lumn','XT\x20NOT\x20NUL','ByCreatorI','ection(','n]\x20failed\x20','M\x20group_de','[connectio','issing\x20gro','string','REPLACE\x20IN','up_id,\x20nam','connection','t\x20connecti','\x20(arrays-o','ections','\x20rows)','ized\x20group','has','coped\x20fail','t_id','ions\x20cache','ons\x20ADD\x20CO','\x20chat_id\x20f','skipping\x20n','n]\x20created','\x20table\x20gro','d\x20namesOrA','creator_id','\x20AND\x20group','get','s\x20group',',\x20row\x20dele','Unsupporte','WHERE\x20name','eConnectio','chat_id','nGroup:\x20','groupId\x20re','nsChatIdTo','ultGroup:\x20','not\x20export','roup_id\x20TE','AULT\x20\x27\x27,\x0a\x20','\x20\x20\x20\x20\x20\x20\x20\x20\x20c','e_groups','issing\x20cre','on]\x20failed','up_id\x20FROM','504nJkRYC','map','\x20=\x20?\x20LIMIT','UES\x20(?,\x20?,','6776OKhBSE','[INFO]','\x20loaded\x20(','None\x20of\x20th','p_id\x20=\x20?\x20O','undefined','d\x20connecti','n]\x20listCon','\x20\x20\x20','led:\x20','M\x20connecti','for\x20setDef','n]\x20getActi','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20','trim','up_id\x20colu','exec','group_id)\x0a','COMMIT;','cluded.nam','n]\x20loadGro','\x20\x20\x20\x20\x20\x20\x20cre','NAME\x20TO\x20co','s\x20schema\x20f','entries','ions_new\x20(','from','\x20\x20\x20\x20\x20ON\x20CO','\x20(?,\x20?)\x0a\x20\x20','on:\x20','e\x20provided','SACTION;','nnections\x20','ectionReco','name','ized\x20chat_','g\x20old\x20rows','\x20\x20\x20\x20group_','SELECT\x20use','parse','n]\x20removeC','id\x20for\x20\x22','me\x20TEXT\x20NO','aultGroup','TO\x20connect','n]\x20active\x20','rd(','WHERE\x20crea','SELECT\x201\x20F',';\x0a\x20\x20\x20\x20\x20\x20','\x20setDefaul','E\x20name\x20=\x20?','SELECT\x20gro','ultForGrou','on-existen','to\x20add\x20gro','isArray','roup','slice','length','or_id\x20TEXT','SELECT\x20cha','che\x20loaded','clear','T\x20NULL,\x0a\x20\x20','to\x20persist','hatIdsFrom','\x20=\x20?,\x20crea','LUMN\x20group','nections\x20S','group_defa','\x20name\x20=\x20ex','Caches\x20loa','id\x20FROM\x20co','n]\x20updated','\x20->\x20','204sZBIIk','on]\x20readin','FAULT\x20\x27\x27;','tions\x20WHER','w\x20(\x0a\x20\x20\x20\x20\x20\x20','chema\x20fail','DROP\x20TABLE','t_id\x20colum','veGroupFor','id,\x20group_','\x20for\x20','user_key)\x20','n]\x20addGrou','\x20name\x20=\x20?\x20','up_default','\x20(deleted=','n]\x20loadAct','n]\x20refresh','=\x20?','n]\x20connect','\x20TEXT\x20NOT\x20','oup\x20deleti','k\x20failed\x20f','n][migrati','faults\x20ADD','me\x20=\x20?','\x20\x20\x20\x20\x20creat','function','set','ed:\x20','some','changes','OT\x20NULL,\x0a\x20','etDefaultG','push','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)','\x20=\x20?\x20AND\x20g','\x20\x20\x20\x20\x20\x20grou','OT\x20NULL\x20DE','e\x20FROM\x20gro','toLowerCas','[]\x27,\x0a\x20\x20\x20\x20\x20','\x22\x20in\x20','-scoped).\x20','on\x20\x22','\x20table\x20con','\x20DEFAULT\x20\x27',')\x20failed','n]\x20listAll','\x20\x20\x20\x20\x20\x20\x20\x20ON','ectionScop','n]\x20added\x20m','n]\x20migrati','he\x20loaded\x20','ET\x20chat_id','EXT\x20NOT\x20NU',')\x20VALUES\x20(','nnections;','includes','ults','\x20(user_key','moved\x20all\x20','\x20KEY,\x0a\x20\x20\x20\x20','join'];_0x6c7e=function(){return _0x1d220f;};return _0x6c7e();}export async function getDefaultForGroup(_0x2704b3){const _0x2e5d74=_0x412c2d;try{await ensureSchema();if(!_0x2704b3)return null;const _0x431e2e=String(_0x2704b3);if(groupDefaultsCache[_0x2e5d74(0x1ff)](_0x431e2e)){const _0x141b12=groupDefaultsCache[_0x2e5d74(0x20b)](_0x431e2e);return Array[_0x2e5d74(0x25a)](_0x141b12)?_0x141b12[_0x2e5d74(0x21f)](String):null;}const _0x39c4b6=await getDb(),_0x56f063=await _0x39c4b6[_0x2e5d74(0x20b)](_0x2e5d74(0x1d4)+_0x2e5d74(0x295)+'up_default'+'s\x20WHERE\x20gr'+'oup_id\x20=\x20?',[_0x431e2e]);if(!_0x56f063||!_0x56f063[_0x2e5d74(0x244)])return null;try{const _0x4daca8=JSON[_0x2e5d74(0x249)](_0x56f063[_0x2e5d74(0x244)]);if(Array[_0x2e5d74(0x25a)](_0x4daca8))return groupDefaultsCache[_0x2e5d74(0x28a)](_0x431e2e,_0x4daca8[_0x2e5d74(0x21f)](String)),_0x4daca8[_0x2e5d74(0x21f)](String);}catch(_0x1ae61c){}return null;}catch(_0x46dc68){return error(_0x46dc68,_0x2e5d74(0x1f4)+_0x2e5d74(0x1eb)+_0x2e5d74(0x257)+'p\x20failed\x20f'+'or\x20'+_0x2704b3),null;}}export async function getDefault(_0x410561){const _0x4410d4=_0x412c2d;try{await ensureSchema();const _0x149a4a=getActiveGroupForUser(String(_0x410561));if(!_0x149a4a)return null;return await getDefaultForGroup(_0x149a4a);}catch(_0x23d9da){return error(_0x23d9da,'[connectio'+_0x4410d4(0x1eb)+_0x4410d4(0x305)+_0x4410d4(0x278)+_0x410561),null;}}export async function getConnection(_0x41a29a){const _0x1165a0=_0x412c2d;try{await ensureSchema();const _0x17d90d=await getDb(),_0x28d8f9=await _0x17d90d[_0x1165a0(0x1cb)](_0x1165a0(0x25f)+_0x1165a0(0x1b1)+'connection'+_0x1165a0(0x2f8)+_0x1165a0(0x287),[String(_0x41a29a)]);if(!_0x28d8f9||!_0x28d8f9[_0x1165a0(0x25d)])return null;const _0x5df503=[];for(const _0x25aed3 of _0x28d8f9){const _0x5d9fb4=parseArrayStrict(_0x25aed3[_0x1165a0(0x211)]);for(const _0x23bafc of _0x5d9fb4)if(!_0x5df503['includes'](_0x23bafc))_0x5df503[_0x1165a0(0x290)](_0x23bafc);}return _0x5df503;}catch(_0x24c437){return error(_0x24c437,_0x1165a0(0x1f4)+_0x1165a0(0x1d2)+_0x1165a0(0x1f1)+_0x41a29a+_0x1165a0(0x29d)),null;}}export async function getConnectionRecord(_0x3bdf3b){const _0x3038a5=_0x412c2d;try{await ensureSchema();const _0x45bbc8=await getDb(),_0x3d8d95=await _0x45bbc8[_0x3038a5(0x20b)](_0x3038a5(0x1d4)+_0x3038a5(0x312)+_0x3038a5(0x303)+_0x3038a5(0x277)+_0x3038a5(0x26b)+_0x3038a5(0x242)+_0x3038a5(0x20f)+_0x3038a5(0x220)+'\x201',[String(_0x3bdf3b)]);if(!_0x3d8d95)return null;return{'name':_0x3d8d95[_0x3038a5(0x244)],'chat_id':parseArrayStrict(_0x3d8d95[_0x3038a5(0x211)]),'creator_id':_0x3d8d95[_0x3038a5(0x209)],'group_id':_0x3d8d95[_0x3038a5(0x1c4)]};}catch(_0x375a76){return error(_0x375a76,_0x3038a5(0x1f4)+_0x3038a5(0x1d2)+'ectionReco'+_0x3038a5(0x250)+_0x3bdf3b+_0x3038a5(0x29d)),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnectionScoped':deleteConnectionScoped,'deleteConnectionsByCreatorInGroup':deleteConnectionsByCreatorInGroup,'removeChatIdsFromConnectionScoped':removeChatIdsFromConnectionScoped,'listConnectionsForUser':listConnectionsForUser,'listConnectionsForGroup':listConnectionsForGroup,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'getConnectionRecord':getConnectionRecord,'getConnectionRecordScoped':getConnectionRecordScoped,'getConnectionScoped':getConnectionScoped,'setDefaultGroup':setDefaultGroup,'getDefaultForGroup':getDefaultForGroup,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser,'refreshCaches':refreshCaches,'_internalCaches':{'connectionsCache':connectionsCache,'groupDefaultsCache':groupDefaultsCache,'activeGroupByUser':activeGroupByUser}};