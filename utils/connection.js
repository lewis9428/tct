const _0x5c0553=_0x22cf;(function(_0xaaa835,_0x2cad36){const _0x2865a0=_0x22cf,_0x44ce9f=_0xaaa835();while(!![]){try{const _0x186589=parseInt(_0x2865a0(0xd7))/(0x12e8+0x3*0x213+0x1*-0x1920)*(parseInt(_0x2865a0(0xcb))/(-0x23cf*-0x1+0x1a13+-0x58*0xb4))+-parseInt(_0x2865a0(0x20c))/(-0x1*0x1833+0x1690+-0x2*-0xd3)+parseInt(_0x2865a0(0x1ac))/(0x8da+0x4d7+-0x1*0xdad)+parseInt(_0x2865a0(0x18f))/(0x3*-0xbcf+-0xe5*-0x5+0x1ef9)+-parseInt(_0x2865a0(0x1be))/(-0x3c5+-0x67*-0x2d+-0xe50)*(parseInt(_0x2865a0(0x20f))/(0x2*-0x76c+0xac4*0x3+-0x116d))+-parseInt(_0x2865a0(0x174))/(-0x26ea+-0x209*0x8+0x373a)*(parseInt(_0x2865a0(0x1d1))/(-0x8*0xf8+-0x1366+-0x1b2f*-0x1))+parseInt(_0x2865a0(0x1e0))/(0x4*-0x5d1+-0x1f6f+0x36bd);if(_0x186589===_0x2cad36)break;else _0x44ce9f['push'](_0x44ce9f['shift']());}catch(_0x2592ec){_0x44ce9f['push'](_0x44ce9f['shift']());}}}(_0xfa46,0x154f5+0xc5*-0x667+0x813f9));import{info as _0x3aafa2,warn as _0x566c07,error as _0x198868}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map(),connectionsCache=new Map(),groupDefaultsCache=new Map(),ACTIVE_TABLE=_0x5c0553(0x10e)+_0x5c0553(0x1d0);function info(..._0x5f24bc){const _0x192609=_0x5c0553;try{_0x3aafa2(..._0x5f24bc);}catch(_0x378936){console['log'](_0x192609(0x1d2),..._0x5f24bc);}}function warn(..._0x173c3f){const _0xa46ffd=_0x5c0553;try{_0x566c07(..._0x173c3f);}catch(_0x31b63b){console[_0xa46ffd(0x141)](_0xa46ffd(0x1fe),..._0x173c3f);}}function error(..._0x99cb6a){const _0x2269d1=_0x5c0553;try{_0x198868(..._0x99cb6a);}catch(_0x27d3b6){console['error'](_0x2269d1(0x21b),..._0x99cb6a);}}async function getDb(){const _0x15e9b5=_0x5c0553;if(db&&typeof db[_0x15e9b5(0x218)]==='function')return db;try{const _0x5a4b38=await import('./database.js');if(_0x5a4b38&&_0x5a4b38['db'])return db=_0x5a4b38['db'],db;throw new Error(_0x15e9b5(0x11f)+_0x15e9b5(0x240)+_0x15e9b5(0x107)+_0x15e9b5(0x184));}catch(_0x54ea0f){error(_0x54ea0f,'[connectio'+_0x15e9b5(0x1da)+_0x15e9b5(0x14b)+_0x15e9b5(0x1c1)+'s');throw _0x54ea0f;}}function safeParseJSON(_0x33e9e5){const _0x3a41d2=_0x5c0553;try{return JSON[_0x3a41d2(0x17f)](_0x33e9e5);}catch(_0x342ab0){return null;}}function asArrayStrict(_0x32fba7){const _0x324517=_0x5c0553;if(_0x32fba7===null||_0x32fba7===undefined)return[];if(typeof _0x32fba7===_0x324517(0x102)){const _0x1961c8=safeParseJSON(_0x32fba7);if(Array['isArray'](_0x1961c8))return _0x1961c8['map'](String);return[_0x32fba7];}if(Array[_0x324517(0x17a)](_0x32fba7))return _0x32fba7[_0x324517(0x1e7)](String);return[String(_0x32fba7)];}function toJSONString(_0x448497){const _0x366ede=_0x5c0553;return JSON[_0x366ede(0x11c)](Array[_0x366ede(0x17a)](_0x448497)?_0x448497['map'](String):[]);}async function tableExists(_0x757c51){const _0x5f53ec=_0x5c0553,_0x1da5a1=await getDb(),_0x451412=await _0x1da5a1['get'](_0x5f53ec(0x1f4)+_0x5f53ec(0x237)+'ite_master'+_0x5f53ec(0x219)+'e=\x27table\x27\x20'+_0x5f53ec(0x19f)+'\x20?',[String(_0x757c51)]);return!!_0x451412;}async function columnExists(_0x25aabb,_0x2de1a7){const _0xdd21a3=_0x5c0553;try{const _0x3e50c3=await getDb(),_0x230a94=await _0x3e50c3[_0xdd21a3(0x1ce)]('PRAGMA\x20tab'+_0xdd21a3(0xd0)+_0x25aabb+')');if(!Array[_0xdd21a3(0x17a)](_0x230a94))return![];return _0x230a94[_0xdd21a3(0x214)](_0x361778=>String(_0x361778[_0xdd21a3(0x221)])[_0xdd21a3(0x18a)+'e']()===String(_0x2de1a7)[_0xdd21a3(0x18a)+'e']());}catch(_0x250221){return warn(_0xdd21a3(0x114)+_0xdd21a3(0x248)+_0xdd21a3(0x1c7)+_0xdd21a3(0x1ff)+_0xdd21a3(0x1fd)+_0x25aabb+'.'+_0x2de1a7+':\x20'+(_0x250221?.[_0xdd21a3(0x23e)]||_0x250221)),![];}}async function ensureConnectionsTable(){const _0x75defb=_0x5c0553,_0x4c7952=await getDb(),_0x53997f=await tableExists(_0x75defb(0x15c)+'s');if(!_0x53997f){await _0x4c7952[_0x75defb(0x218)](_0x75defb(0x1b8)+_0x75defb(0x169)+'IF\x20NOT\x20EXI'+'STS\x20connec'+_0x75defb(0x243)+_0x75defb(0x138)+_0x75defb(0x143)+'NULL,\x0a\x20\x20\x20\x20'+'\x20\x20\x20\x20group_'+'id\x20TEXT\x20NO'+_0x75defb(0x121)+_0x75defb(0x22b)+_0x75defb(0x1e1)+_0x75defb(0x158)+_0x75defb(0x162)+_0x75defb(0x132)+_0x75defb(0xe8)+_0x75defb(0x1e4)+_0x75defb(0x17b)+_0x75defb(0x170)+_0x75defb(0x1f0)+_0x75defb(0xcc)+'\x20\x20\x20'),info(_0x75defb(0x114)+_0x75defb(0x15d)+_0x75defb(0x14d)+_0x75defb(0x13f)+'name,\x20grou'+_0x75defb(0x19a));return;}const _0x10ac36=await columnExists(_0x75defb(0x15c)+'s',_0x75defb(0xf7)),_0x4db284=await columnExists(_0x75defb(0x15c)+'s',_0x75defb(0x1ee)),_0x4e3b4f=await columnExists(_0x75defb(0x15c)+'s',_0x75defb(0x15a));if(!_0x4db284||!_0x4e3b4f||!_0x10ac36)try{await _0x4c7952[_0x75defb(0x218)]('\x0a\x20\x20\x20\x20\x20\x20\x20\x20C'+'REATE\x20TABL'+_0x75defb(0x117)+'XISTS\x20conn'+'ections_ne'+'w\x20(\x0a\x20\x20\x20\x20\x20\x20'+_0x75defb(0x159)+'EXT\x20NOT\x20NU'+'LL,\x0a\x20\x20\x20\x20\x20\x20'+_0x75defb(0x150)+_0x75defb(0x242)+'T\x20NULL\x20DEF'+_0x75defb(0x1b4)+'\x20\x20\x20\x20\x20\x20\x20\x20\x20c'+_0x75defb(0xc8)+_0x75defb(0xc6)+_0x75defb(0x216)+_0x75defb(0x112)+_0x75defb(0x15b)+_0x75defb(0x1c9)+'\x20NOT\x20NULL\x20'+_0x75defb(0x1e5)+_0x75defb(0x1f7)+_0x75defb(0x164)+_0x75defb(0xf5)+_0x75defb(0x18e)+_0x75defb(0x131)+_0x75defb(0x145));try{const _0x297a2a=await _0x4c7952[_0x75defb(0x1ce)](_0x75defb(0x1f4)+_0x75defb(0x13a)+',\x20creator_'+_0x75defb(0x1ef)+_0x75defb(0x1a0));if(Array[_0x75defb(0x17a)](_0x297a2a)&&_0x297a2a[_0x75defb(0x182)])for(const _0x2592c0 of _0x297a2a){const _0x193428=_0x2592c0[_0x75defb(0x221)],_0x564355=typeof _0x2592c0[_0x75defb(0x1ee)]===_0x75defb(0x10d)||_0x2592c0[_0x75defb(0x1ee)]===null?'[]':_0x2592c0[_0x75defb(0x1ee)],_0x384880=typeof _0x2592c0[_0x75defb(0x15a)]===_0x75defb(0x10d)||_0x2592c0[_0x75defb(0x15a)]===null?'':_0x2592c0[_0x75defb(0x15a)];try{await _0x4c7952[_0x75defb(0x188)](_0x75defb(0xe2)+_0x75defb(0x1ae)+_0x75defb(0x198)+_0x75defb(0xef)+'name,\x20grou'+_0x75defb(0x126)+_0x75defb(0x13e)+'or_id)\x20VAL'+_0x75defb(0x167)+_0x75defb(0x18c),[_0x193428,'',_0x564355,_0x384880]);}catch(_0x4eed9e){warn(_0x75defb(0x114)+_0x75defb(0x111)+_0x75defb(0x1f6)+_0x75defb(0x185)+'ections_ne'+'w\x20failed\x20f'+_0x75defb(0x1fd)+_0x193428+':\x20'+(_0x4eed9e?.[_0x75defb(0x23e)]||_0x4eed9e));}}}catch(_0x37e0fc){warn(_0x75defb(0x114)+_0x75defb(0x111)+_0x75defb(0xd3)+_0x75defb(0xe9)+_0x75defb(0xe6)+(_0x37e0fc?.[_0x75defb(0x23e)]||_0x37e0fc));}try{await _0x4c7952[_0x75defb(0x218)](_0x75defb(0xdb)+_0x75defb(0x232)+_0x75defb(0x1b3)+_0x75defb(0x16e));}catch(_0x4bdb04){}await _0x4c7952[_0x75defb(0x218)](_0x75defb(0xd5)+_0x75defb(0x173)+'ons_new\x20RE'+_0x75defb(0x186)+_0x75defb(0x20d)),info(_0x75defb(0x114)+'n]\x20migrate'+_0x75defb(0xda)+_0x75defb(0x17d)+_0x75defb(0x13f)+_0x75defb(0x227)+_0x75defb(0x229));}catch(_0x30636b){warn(_0x75defb(0x114)+'n]\x20migrati'+_0x75defb(0xea)+_0x75defb(0x15c)+_0x75defb(0x16a)+_0x75defb(0xf6)+(_0x30636b?.['message']||_0x30636b));if(!_0x4db284)try{await _0x4c7952['exec']('ALTER\x20TABL'+'E\x20connecti'+_0x75defb(0x157)+_0x75defb(0x1a7)+_0x75defb(0x242)+_0x75defb(0x1d5)+_0x75defb(0x136)),info(_0x75defb(0x114)+'n]\x20added\x20m'+_0x75defb(0x1f5)+_0x75defb(0x245)+'n');}catch(_0x244033){warn(_0x244033,_0x75defb(0x114)+'n]\x20failed\x20'+_0x75defb(0x12f)+_0x75defb(0x1c0));}if(!_0x4e3b4f)try{await _0x4c7952[_0x75defb(0x218)](_0x75defb(0xd5)+_0x75defb(0x173)+_0x75defb(0x157)+_0x75defb(0x24b)+_0x75defb(0x1c9)+'\x20NOT\x20NULL\x20'+_0x75defb(0x1e5)+';'),info(_0x75defb(0x114)+_0x75defb(0x1b7)+_0x75defb(0x228)+_0x75defb(0x21d)+_0x75defb(0xe1));}catch(_0x52114f){warn(_0x52114f,_0x75defb(0x114)+_0x75defb(0x1da)+_0x75defb(0xd1)+_0x75defb(0x1d7));}if(!_0x10ac36)try{await _0x4c7952[_0x75defb(0x218)](_0x75defb(0xd5)+_0x75defb(0x173)+_0x75defb(0x157)+'LUMN\x20group'+_0x75defb(0x1e1)+_0x75defb(0x1a1)+_0x75defb(0xc5)),info(_0x75defb(0x114)+_0x75defb(0x1b7)+_0x75defb(0x203)+_0x75defb(0x128)+'mn');}catch(_0x3d435a){warn(_0x3d435a,_0x75defb(0x114)+_0x75defb(0x1da)+_0x75defb(0x1c6)+_0x75defb(0x20a));}}}async function ensureGroupDefaultsTable(){const _0x4b44a8=_0x5c0553,_0x55b7c8=await getDb(),_0x13887d=await tableExists(_0x4b44a8(0xee)+_0x4b44a8(0x1dc));if(!_0x13887d){await _0x55b7c8[_0x4b44a8(0x218)](_0x4b44a8(0x1b8)+'ATE\x20TABLE\x20'+'IF\x20NOT\x20EXI'+'STS\x20group_'+_0x4b44a8(0x140)+_0x4b44a8(0x108)+'roup_id\x20TE'+_0x4b44a8(0x1eb)+_0x4b44a8(0xe0)+'\x20\x20\x20\x20name\x20T'+'EXT\x20NOT\x20NU'+_0x4b44a8(0x1f1)+_0x4b44a8(0x201)),info('[connectio'+_0x4b44a8(0x15d)+_0x4b44a8(0x1de)+_0x4b44a8(0x18b)+'s');return;}!await columnExists(_0x4b44a8(0xee)+_0x4b44a8(0x1dc),_0x4b44a8(0xf7))&&await addGroupDefaultsColumns();}async function addGroupDefaultsColumns(){const _0x31ba89=_0x5c0553,_0x198c59=await getDb();try{await _0x198c59[_0x31ba89(0x218)]('ALTER\x20TABL'+_0x31ba89(0x15f)+_0x31ba89(0x1f3)+_0x31ba89(0x16d)+_0x31ba89(0x1e9)+_0x31ba89(0xc6)+_0x31ba89(0x216)+'\x27;'),await _0x198c59[_0x31ba89(0x218)](_0x31ba89(0xd5)+'E\x20group_de'+_0x31ba89(0x1f3)+_0x31ba89(0x13d)+_0x31ba89(0x151)+'T\x20NULL\x20DEF'+'AULT\x20\x27[]\x27;');}catch(_0x4d7cbd){warn('[connectio'+_0x31ba89(0x230)+_0x31ba89(0x11e)+_0x31ba89(0x120)+'led:\x20'+(_0x4d7cbd?.[_0x31ba89(0x23e)]||_0x4d7cbd));}}async function ensureActiveGroupsTable(){const _0x12d98e=_0x5c0553,_0x3b0d75=await getDb(),_0x176d49=await tableExists(ACTIVE_TABLE);!_0x176d49&&(await _0x3b0d75[_0x12d98e(0x218)](_0x12d98e(0x1b8)+'ATE\x20TABLE\x20'+_0x12d98e(0x24a)+_0x12d98e(0x23f)+ACTIVE_TABLE+(_0x12d98e(0xf9)+_0x12d98e(0xce)+_0x12d98e(0x1a2)+_0x12d98e(0x16b)+_0x12d98e(0x137)+'p_id\x20TEXT\x20'+_0x12d98e(0x105)+_0x12d98e(0x1f2)+'\x20\x20')),info(_0x12d98e(0x114)+_0x12d98e(0x15d)+_0x12d98e(0x1fc)+ACTIVE_TABLE));}async function migrateConnectionsChatIdToArray(){const _0x4a127c=_0x5c0553;try{const _0x4c0d97=await getDb(),_0x254fda=await _0x4c0d97[_0x4a127c(0x1ce)](_0x4a127c(0x1f4)+_0x4a127c(0x189)+_0x4a127c(0x10c)+_0x4a127c(0x212)+'ections');if(!_0x254fda||_0x254fda['length']===-0x1*0x1dc3+0xe07*0x2+0x1b5)return;const _0x5393d0=[];for(const _0x5ccf20 of _0x254fda){const _0x343aef=_0x5ccf20[_0x4a127c(0x1ee)],_0x151649=safeParseJSON(_0x343aef);if(Array[_0x4a127c(0x17a)](_0x151649)){const _0x55d901=_0x151649[_0x4a127c(0x1e7)](String),_0x481b87=toJSONString(_0x55d901);if(_0x481b87!==_0x343aef)_0x5393d0[_0x4a127c(0x1cc)]({'name':_0x5ccf20[_0x4a127c(0x221)],'group_id':_0x5ccf20[_0x4a127c(0xf7)]||'','chat_id':_0x481b87});continue;}else{let _0x265d6b=[];_0x343aef===null||_0x343aef===undefined||String(_0x343aef)[_0x4a127c(0x124)]()===''?_0x265d6b=[]:_0x265d6b=[String(_0x343aef)];const _0x4728d9=toJSONString(_0x265d6b);_0x5393d0[_0x4a127c(0x1cc)]({'name':_0x5ccf20[_0x4a127c(0x221)],'group_id':_0x5ccf20['group_id']||'','chat_id':_0x4728d9});}}if(_0x5393d0[_0x4a127c(0x182)]>-0x4b2+-0x5*-0xb5+0x129){try{await _0x4c0d97[_0x4a127c(0x218)](_0x4a127c(0x1d6)+_0x4a127c(0x14a));}catch(_0x4fd2e5){}for(const _0x49bb1c of _0x5393d0){try{await _0x4c0d97[_0x4a127c(0x188)](_0x4a127c(0xd8)+'nections\x20S'+'ET\x20chat_id'+_0x4a127c(0x11a)+_0x4a127c(0x127)+'AND\x20group_'+_0x4a127c(0x1fb),[_0x49bb1c[_0x4a127c(0x1ee)],_0x49bb1c[_0x4a127c(0x221)],_0x49bb1c[_0x4a127c(0xf7)]]),info(_0x4a127c(0x114)+_0x4a127c(0x111)+_0x4a127c(0x12b)+_0x4a127c(0x134)+_0x4a127c(0x223)+_0x49bb1c['name']+('\x22\x20@\x20group\x20'+'\x22')+_0x49bb1c[_0x4a127c(0xf7)]+'\x22');}catch(_0x528c67){warn(_0x4a127c(0x114)+_0x4a127c(0x111)+_0x4a127c(0xfd)+_0x4a127c(0x200)+_0x4a127c(0x210)+_0x4a127c(0x1fd)+_0x49bb1c[_0x4a127c(0x221)]+'@'+_0x49bb1c[_0x4a127c(0xf7)]+':\x20'+(_0x528c67?.['message']||_0x528c67));}}try{await _0x4c0d97[_0x4a127c(0x218)](_0x4a127c(0xcf));}catch(_0x8d3816){}}}catch(_0x128270){warn(_0x4a127c(0x114)+'n][migrati'+'on]\x20migrat'+_0x4a127c(0x17e)+_0x4a127c(0x1af)+'Array\x20fail'+_0x4a127c(0x1c3)+(_0x128270?.[_0x4a127c(0x23e)]||_0x128270));}}async function migrateGroupDefaultsNameToArray(){const _0x59ed48=_0x5c0553;try{const _0x4848e8=await getDb(),_0x444015=await _0x4848e8['all'](_0x59ed48(0x1d4)+'up_id,\x20nam'+_0x59ed48(0x133)+_0x59ed48(0x18b)+'s');if(!_0x444015||_0x444015[_0x59ed48(0x182)]===-0x19c*0xe+0x16+0x1672*0x1)return;const _0x546f2f=[];for(const _0x543c6e of _0x444015){const _0x2fe06a=_0x543c6e['name'],_0xb3df80=safeParseJSON(_0x2fe06a);if(Array['isArray'](_0xb3df80)){const _0xbf68ed=toJSONString(_0xb3df80);if(_0xbf68ed!==_0x2fe06a)_0x546f2f['push']({'group_id':_0x543c6e[_0x59ed48(0xf7)],'name':_0xbf68ed});continue;}else{const _0x1475dc=_0x2fe06a===null||_0x2fe06a===undefined||String(_0x2fe06a)[_0x59ed48(0x124)]()===''?[]:[String(_0x2fe06a)],_0x294a2f=toJSONString(_0x1475dc);_0x546f2f[_0x59ed48(0x1cc)]({'group_id':_0x543c6e[_0x59ed48(0xf7)],'name':_0x294a2f});}}if(_0x546f2f[_0x59ed48(0x182)]>0x20b3+-0x1fd*0x11+0x11a){try{await _0x4848e8[_0x59ed48(0x218)]('BEGIN\x20TRAN'+_0x59ed48(0x14a));}catch(_0x31da99){}for(const _0x20b141 of _0x546f2f){try{await _0x4848e8[_0x59ed48(0x188)](_0x59ed48(0xf3)+'up_default'+_0x59ed48(0x235)+'\x20=\x20?\x20WHERE'+_0x59ed48(0x110)+_0x59ed48(0x215),[_0x20b141['name'],_0x20b141['group_id']]),info(_0x59ed48(0x114)+_0x59ed48(0x111)+_0x59ed48(0x12b)+_0x59ed48(0x236)+_0x59ed48(0xf1)+_0x59ed48(0x179)+_0x20b141[_0x59ed48(0xf7)]);}catch(_0x378420){warn(_0x59ed48(0x114)+'n][migrati'+_0x59ed48(0xfd)+'\x20to\x20update'+'\x20group_def'+'aults\x20for\x20'+_0x20b141[_0x59ed48(0xf7)]+':\x20'+(_0x378420?.[_0x59ed48(0x23e)]||_0x378420));}}try{await _0x4848e8['exec'](_0x59ed48(0xcf));}catch(_0x11e555){}}}catch(_0x2b8d8d){warn(_0x59ed48(0x114)+_0x59ed48(0x111)+_0x59ed48(0x1d3)+_0x59ed48(0x23d)+'ultsNameTo'+_0x59ed48(0xfe)+_0x59ed48(0x1c3)+(_0x2b8d8d?.[_0x59ed48(0x23e)]||_0x2b8d8d));}}function parseArrayStrict(_0xc9f689){const _0x101f6a=_0x5c0553;if(_0xc9f689===null||_0xc9f689===undefined)return[];if(typeof _0xc9f689===_0x101f6a(0x102)){const _0x583409=safeParseJSON(_0xc9f689);if(Array[_0x101f6a(0x17a)](_0x583409))return _0x583409[_0x101f6a(0x1e7)](String);return[];}if(Array[_0x101f6a(0x17a)](_0xc9f689))return _0xc9f689[_0x101f6a(0x1e7)](String);return[String(_0xc9f689)];}function stringifyArray(_0x2c5f5b){const _0x50a42e=_0x5c0553;return JSON['stringify'](Array[_0x50a42e(0x17a)](_0x2c5f5b)?_0x2c5f5b[_0x50a42e(0x1e7)](String):[]);}async function loadConnectionsCache(){const _0x56a31f=_0x5c0553;try{const _0x3f2e44=await getDb(),_0x5b3b18=await _0x3f2e44[_0x56a31f(0x1ce)](_0x56a31f(0x1f4)+_0x56a31f(0x189)+_0x56a31f(0x10c)+_0x56a31f(0x206)+'id\x20FROM\x20co'+_0x56a31f(0x1a0));connectionsCache[_0x56a31f(0x101)]();if(!_0x5b3b18||!_0x5b3b18[_0x56a31f(0x182)]){info(_0x56a31f(0x114)+_0x56a31f(0x1c2)+_0x56a31f(0x241)+_0x56a31f(0x22c)+'\x20rows)');return;}for(const _0x237394 of _0x5b3b18){const _0xe13f1=String(_0x237394['group_id']||'');if(!connectionsCache['has'](_0xe13f1))connectionsCache[_0x56a31f(0x153)](_0xe13f1,new Map());const _0x3ac7f1=connectionsCache[_0x56a31f(0x148)](_0xe13f1);_0x3ac7f1[_0x56a31f(0x153)](String(_0x237394[_0x56a31f(0x221)]),{'name':_0x237394[_0x56a31f(0x221)],'chat_id':parseArrayStrict(_0x237394['chat_id']),'creator_id':_0x237394[_0x56a31f(0x15a)]});}info('[connectio'+'n]\x20connect'+_0x56a31f(0x241)+_0x56a31f(0xe5)+_0x5b3b18[_0x56a31f(0x182)]+_0x56a31f(0x23c));}catch(_0x4e092f){warn('[connectio'+_0x56a31f(0x1dd)+_0x56a31f(0x249)+_0x56a31f(0x225)+':\x20'+(_0x4e092f?.[_0x56a31f(0x23e)]||_0x4e092f));}}async function loadGroupDefaultsCache(){const _0x2da2fd=_0x5c0553;try{const _0x4f20f2=await getDb(),_0x549ca0=await _0x4f20f2[_0x2da2fd(0x1ce)](_0x2da2fd(0x1d4)+_0x2da2fd(0x113)+_0x2da2fd(0x133)+_0x2da2fd(0x18b)+'s');groupDefaultsCache[_0x2da2fd(0x101)]();if(!_0x549ca0||!_0x549ca0[_0x2da2fd(0x182)]){info(_0x2da2fd(0x114)+_0x2da2fd(0x233)+'efaults\x20ca'+_0x2da2fd(0x163)+_0x2da2fd(0x205));return;}for(const _0x363563 of _0x549ca0){try{const _0x30f222=String(_0x363563['group_id']),_0x44006c=safeParseJSON(_0x363563[_0x2da2fd(0x221)]),_0x3c2314=Array[_0x2da2fd(0x17a)](_0x44006c)?_0x44006c[_0x2da2fd(0x1e7)](String):[];groupDefaultsCache['set'](_0x30f222,_0x3c2314);}catch(_0x2a42d3){}}info(_0x2da2fd(0x114)+_0x2da2fd(0x233)+'efaults\x20ca'+_0x2da2fd(0x163)+'\x20('+_0x549ca0['length']+'\x20rows)');}catch(_0x1e3487){warn(_0x2da2fd(0x114)+_0x2da2fd(0x11d)+_0x2da2fd(0x1fa)+_0x2da2fd(0x166)+_0x2da2fd(0x1c3)+(_0x1e3487?.[_0x2da2fd(0x23e)]||_0x1e3487));}}async function loadActiveGroupsCache(){const _0x198925=_0x5c0553;try{const _0x30df76=await getDb(),_0xd1b9fc=await _0x30df76[_0x198925(0x1ce)]('SELECT\x20use'+_0x198925(0x1c8)+_0x198925(0x175)+'\x20'+ACTIVE_TABLE);activeGroupByUser[_0x198925(0x101)]();if(!_0xd1b9fc||!_0xd1b9fc[_0x198925(0x182)]){info(_0x198925(0x114)+_0x198925(0x1bd)+'groups\x20cac'+_0x198925(0xd6)+'(0\x20rows)');return;}for(const _0x38742b of _0xd1b9fc){try{activeGroupByUser[_0x198925(0x153)](String(_0x38742b[_0x198925(0x147)]),String(_0x38742b[_0x198925(0xf7)]));}catch(_0x35770a){}}info(_0x198925(0x114)+_0x198925(0x1bd)+_0x198925(0x1a5)+_0x198925(0xd6)+'('+_0xd1b9fc['length']+_0x198925(0x23c));}catch(_0x138add){warn('[connectio'+_0x198925(0x239)+'iveGroupsC'+_0x198925(0x19e)+'d:\x20'+(_0x138add?.[_0x198925(0x23e)]||_0x138add));}}export async function refreshCaches(){const _0x4995d8=_0x5c0553;await ensureSchema(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache(),info(_0x4995d8(0x114)+_0x4995d8(0x14f)+_0x4995d8(0x204)+_0x4995d8(0xcd));}async function ensureActiveGroupsTableAndLoadCaches(){await ensureActiveGroupsTable(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache();}function normalizeUserKeyForStorage(_0x1787a9){const _0x565bff=_0x5c0553;if(!_0x1787a9)return null;const _0x4094fe=String(_0x1787a9)[_0x565bff(0x124)]();if(!_0x4094fe)return null;return _0x4094fe['includes']('@')?_0x4094fe[_0x565bff(0x187)]('@')[-0x291*0xb+-0x697+0x22d2]:_0x4094fe;}export async function ensureSchema(){const _0x1e13fc=_0x5c0553;if(schemaEnsured)return;try{await getDb(),await ensureConnectionsTable(),await ensureGroupDefaultsTable(),await ensureActiveGroupsTable(),await migrateConnectionsChatIdToArray(),await migrateGroupDefaultsNameToArray(),await ensureActiveGroupsTableAndLoadCaches(),schemaEnsured=!![],info('[connectio'+_0x1e13fc(0x1e8)+_0x1e13fc(0x1ec)+_0x1e13fc(0x1b5)+_0x1e13fc(0x100)+_0x1e13fc(0x208)+'nly,\x20group'+_0x1e13fc(0xc9)+_0x1e13fc(0x168)+_0x1e13fc(0x209));}catch(_0x11ae7a){error(_0x11ae7a,_0x1e13fc(0x114)+_0x1e13fc(0x244)+_0x1e13fc(0x23b)+_0x1e13fc(0x1c3)+(_0x11ae7a?.[_0x1e13fc(0x23e)]||_0x11ae7a));throw _0x11ae7a;}}function _0x22cf(_0x18caf0,_0x49605f){const _0x57cf0b=_0xfa46();return _0x22cf=function(_0x42bd88,_0x1e7a69){_0x42bd88=_0x42bd88-(-0x1cd7+0x220f+-0x473);let _0xb5d095=_0x57cf0b[_0x42bd88];return _0xb5d095;},_0x22cf(_0x18caf0,_0x49605f);}export async function initialize(){await ensureSchema();}export async function setActiveGroupForUser(_0x7c903f,_0x16e6a4){const _0x4a836f=_0x5c0553;try{if(!_0x7c903f)return;const _0x28ebb9=normalizeUserKeyForStorage(_0x7c903f);if(!_0x28ebb9)return;if(!_0x16e6a4){activeGroupByUser[_0x4a836f(0x190)](_0x28ebb9);try{const _0x246090=await getDb();await _0x246090[_0x4a836f(0x188)](_0x4a836f(0x125)+'M\x20'+ACTIVE_TABLE+(_0x4a836f(0x18d)+_0x4a836f(0xd4)),[_0x28ebb9]);}catch(_0x5b928f){warn(_0x4a836f(0x114)+_0x4a836f(0x1da)+_0x4a836f(0x115)+_0x4a836f(0x196)+'oup\x20deleti'+'on:\x20'+(_0x5b928f?.[_0x4a836f(0x23e)]||_0x5b928f));}return;}const _0x357a80=String(_0x16e6a4);activeGroupByUser[_0x4a836f(0x153)](_0x28ebb9,_0x357a80);try{const _0xec1e98=await getDb();await _0xec1e98['run'](_0x4a836f(0x146)+'O\x20'+ACTIVE_TABLE+('\x20(user_key'+',\x20group_id'+_0x4a836f(0x135)+'?,\x20?)\x20\x0a\x20\x20\x20'+_0x4a836f(0x160)+_0x4a836f(0xf0)+_0x4a836f(0x1ba)+_0x4a836f(0x1cd)+'DO\x20UPDATE\x20'+_0x4a836f(0xdf)+_0x4a836f(0x123)+_0x4a836f(0xca)+'id'),[_0x28ebb9,_0x357a80]);}catch(_0x341d50){warn('[connectio'+_0x4a836f(0x1da)+_0x4a836f(0x115)+_0x4a836f(0x196)+_0x4a836f(0x1db)+(_0x341d50?.[_0x4a836f(0x23e)]||_0x341d50));}}catch(_0x5f3d1e){warn(_0x4a836f(0x114)+_0x4a836f(0xfb)+_0x4a836f(0x155)+_0x4a836f(0xde)+':\x20'+(_0x5f3d1e?.[_0x4a836f(0x23e)]||_0x5f3d1e));}}export function getActiveGroupForUser(_0x408cb8){const _0x4ac3e0=_0x5c0553;try{if(!_0x408cb8)return null;const _0x3ac445=normalizeUserKeyForStorage(_0x408cb8);if(!_0x3ac445)return null;return activeGroupByUser[_0x4ac3e0(0x148)](_0x3ac445)||null;}catch(_0x5d1fc7){return warn(_0x4ac3e0(0x114)+_0x4ac3e0(0x23a)+_0x4ac3e0(0x155)+_0x4ac3e0(0xde)+':\x20'+(_0x5d1fc7?.[_0x4ac3e0(0x23e)]||_0x5d1fc7)),null;}}export async function addConnection(_0x5c5dcb,_0x5af51a,_0x6388='',_0x5b9fca=''){const _0x328dee=_0x5c0553;try{await ensureSchema();const _0x18fe16=await getDb(),_0x1bc947=String(_0x5b9fca||''),_0x260e67=await _0x18fe16[_0x328dee(0x148)](_0x328dee(0xc7)+'t_id\x20FROM\x20'+_0x328dee(0x15c)+_0x328dee(0x17c)+'me\x20=\x20?\x20AND'+_0x328dee(0x110)+_0x328dee(0x215),[String(_0x5c5dcb),_0x1bc947]);if(!_0x260e67){const _0x2ffde3=[String(_0x5af51a)];await _0x18fe16[_0x328dee(0x188)](_0x328dee(0x146)+_0x328dee(0x165)+_0x328dee(0x20b)+_0x328dee(0x1a9)+_0x328dee(0x171)+_0x328dee(0x15a)+')\x20VALUES\x20('+'?,\x20?,\x20?,\x20?'+')',[String(_0x5c5dcb),_0x1bc947,stringifyArray(_0x2ffde3),String(_0x6388||'')]),info(_0x328dee(0x114)+_0x328dee(0x15d)+':\x20'+_0x5c5dcb+_0x328dee(0x193)+_0x5af51a+_0x328dee(0x139)+_0x6388+_0x328dee(0x22a)+_0x1bc947);if(!connectionsCache[_0x328dee(0x109)](_0x1bc947))connectionsCache[_0x328dee(0x153)](_0x1bc947,new Map());const _0x3f86d0=connectionsCache[_0x328dee(0x148)](_0x1bc947);return _0x3f86d0['set'](String(_0x5c5dcb),{'name':String(_0x5c5dcb),'chat_id':_0x2ffde3['map'](String),'creator_id':String(_0x6388||'')}),!![];}else{const _0x3bc6bb=parseArrayStrict(_0x260e67['chat_id']);if(!_0x3bc6bb[_0x328dee(0x1a6)](String(_0x5af51a)))_0x3bc6bb['push'](String(_0x5af51a));await _0x18fe16[_0x328dee(0x188)](_0x328dee(0xd8)+'nections\x20S'+'ET\x20chat_id'+_0x328dee(0xf4)+_0x328dee(0x12e)+_0x328dee(0x1b1)+_0x328dee(0x180)+'group_id\x20='+'\x20?',[stringifyArray(_0x3bc6bb),String(_0x6388||''),String(_0x5c5dcb),_0x1bc947]),info('[connectio'+_0x328dee(0x21a)+':\x20'+_0x5c5dcb+_0x328dee(0x193)+_0x3bc6bb[_0x328dee(0x12d)](',')+_0x328dee(0x199)+_0x1bc947);if(!connectionsCache[_0x328dee(0x109)](_0x1bc947))connectionsCache['set'](_0x1bc947,new Map());const _0x586b9e=connectionsCache['get'](_0x1bc947);return _0x586b9e['set'](String(_0x5c5dcb),{'name':String(_0x5c5dcb),'chat_id':_0x3bc6bb[_0x328dee(0x1e7)](String),'creator_id':String(_0x6388||'')}),!![];}}catch(_0x23462a){return error(_0x23462a,_0x328dee(0x114)+'n]\x20addConn'+_0x328dee(0x16f)+_0x328dee(0x176)+_0x5c5dcb+_0x328dee(0x1ea)+_0x5b9fca),![];}}export async function deleteConnectionScoped(_0x5aef9b,_0x2e0ee5=''){const _0x534d4e=_0x5c0553;try{await ensureSchema();const _0x252369=await getDb(),_0x575647=await _0x252369[_0x534d4e(0x188)](_0x534d4e(0x125)+_0x534d4e(0x1ca)+_0x534d4e(0x195)+_0x534d4e(0x10a)+'ND\x20group_i'+_0x534d4e(0x103),[String(_0x5aef9b),String(_0x2e0ee5||'')]),_0x29f43f=_0x575647&&(_0x575647[_0x534d4e(0x1bc)]===undefined?!![]:!!_0x575647['changes']);info(_0x534d4e(0x114)+'n]\x20deleteC'+_0x534d4e(0x22f)+'coped:\x20'+_0x5aef9b+_0x534d4e(0x1ea)+_0x2e0ee5+_0x534d4e(0x116)+_0x29f43f+')');try{const _0x4875ee=String(_0x2e0ee5||'');if(connectionsCache[_0x534d4e(0x109)](_0x4875ee)){const _0x1f46b2=connectionsCache[_0x534d4e(0x148)](_0x4875ee);if(_0x1f46b2)_0x1f46b2[_0x534d4e(0x190)](String(_0x5aef9b));}}catch(_0x5a4836){}return _0x29f43f;}catch(_0x59083b){return error(_0x59083b,_0x534d4e(0x114)+_0x534d4e(0xf2)+'onnectionS'+_0x534d4e(0x1b0)+_0x534d4e(0x1c3)+_0x5aef9b+_0x534d4e(0x1ea)+_0x2e0ee5),![];}}function _0xfa46(){const _0x15b4e1=['\x20group_id,','t\x20connecti','No\x20valid\x20c','2088960BPyksl','\x20for\x20','REPLACE\x20IN','nsChatIdTo','coped\x20fail','\x20WHERE\x20nam','filter','\x20connectio','AULT\x20\x27\x27,\x0a\x20','d\x20migratio','s\x20failed','n]\x20added\x20m','\x0a\x20\x20\x20\x20\x20\x20CRE','\x20=\x20?\x20LIMIT','\x20CONFLICT(','names\x20prov','changes','n]\x20active\x20','4710YGoPoa','ed(','t_id','database.j','n]\x20connect','ed:\x20','No\x20connect','ections','to\x20add\x20gro','xists\x20chec','r_key,\x20gro','or_id\x20TEXT','M\x20connecti','\x20(?,\x20?)\x0a\x20\x20','push','user_key)\x20','all','roup','e_groups','81wdCKLW','[INFO]','on]\x20migrat','SELECT\x20gro','T\x20NULL\x20DEF','BEGIN\x20TRAN','ator_id','slice','ORDER\x20BY\x20g','n]\x20failed\x20','oup:\x20','ults','n]\x20loadCon','\x20table\x20gro','n]\x20getConn','5609400CtwpEO','_id\x20TEXT\x20N','id,\x20group_','\x20AND\x20group','L,\x0a\x20\x20\x20\x20\x20\x20\x20','DEFAULT\x20\x27\x27','\x20ORDER\x20BY\x20','map','n]\x20schema\x20','oup_id\x20TEX','\x20@\x20','XT\x20PRIMARY','ensured\x20an','Scoped:\x20','chat_id','id\x20FROM\x20co','group_id)\x0a','LL\x0a\x20\x20\x20\x20\x20\x20)','\x20\x20\x20\x20\x20);\x0a\x20\x20','faults\x20ADD','SELECT\x20nam','issing\x20cha','on]\x20insert',',\x0a\x20\x20\x20\x20\x20\x20\x20\x20','rUser\x20fail','n]\x20setDefa','upDefaults','id\x20=\x20?','\x20table\x20','or\x20','[WARN]','k\x20failed\x20f','\x20to\x20update',';\x0a\x20\x20\x20\x20','entries','issing\x20gro','Caches\x20com','\x20(0\x20rows)',',\x20creator_','DER\x20BY\x20nam','\x20(arrays-o','ded.','up_id','ons\x20(name,','1542288GsbLXa','nnections;','n]\x20getDefa','3605fYDPJR','\x20chat_id\x20f','ultGroup\x20f','\x20FROM\x20conn','Unsupporte','some','=\x20?','\x20DEFAULT\x20\x27','O\x20group_de','exec','\x20WHERE\x20typ','n]\x20updated','[ERROR]','ectionReco','ator_id\x20co','ided\x20for\x20s','n]\x20listAll','UPDATE\x20SET','name','from','id\x20for\x20\x22','E\x20name\x20=\x20?','che\x20failed','faults\x20(gr','with\x20group','issing\x20cre','_id)',')\x20@\x20group=','\x20\x20\x20\x20\x20\x20chat','\x20loaded\x20(0','ROM\x20connec','e\x20provided','onnectionS','n]\x20addGrou','rd(','\x20IF\x20EXISTS','n]\x20group\x20d',')\x20failed','s\x20SET\x20name','ized\x20group','e\x20FROM\x20sql','p_id\x20=\x20?\x20O','n]\x20loadAct','n]\x20getActi','chema\x20fail','\x20rows)','eGroupDefa','message','STS\x20','odule\x20did\x20','ions\x20cache','id\x20TEXT\x20NO','tions\x20(\x0a\x20\x20','n]\x20ensureS','t_id\x20colum','n]\x20removeC','AND\x20group_','n]\x20columnE','nectionsCa','IF\x20NOT\x20EXI','LUMN\x20creat','FAULT\x20\x27\x27;','T\x20NOT\x20NULL','SELECT\x20cha','hat_id\x20TEX','-scoped).\x20','ded.group_','2HOMpuu','\x20\x20\x20\x20\x20\x20);\x0a\x20','plete','\x20user_key\x20','COMMIT;','le_info(','to\x20add\x20cre','t_id\x20FROM\x20','on]\x20readin','r_key\x20=\x20?','ALTER\x20TABL','he\x20loaded\x20','89937QmpSGV','UPDATE\x20con','ByCreatorI','d\x20connecti','DROP\x20TABLE','nGroup:\x20','nectionsFo','User\x20error','SET\x20group_','\x20KEY,\x0a\x20\x20\x20\x20','lumn','INSERT\x20OR\x20','me)\x20VALUES','d\x20namesOrA','\x20loaded\x20(','\x20failed:\x20','ist\x20in\x20thi','XT\x20NOT\x20NUL','g\x20old\x20rows','on\x20to\x20new\x20','\x20all','onnection\x20','me\x20=\x20?\x20AND','group_defa','ions_new\x20(','\x20\x20\x20\x20\x20\x20\x20\x20ON','_defaults\x20','n]\x20deleteC','UPDATE\x20gro','\x20=\x20?,\x20crea','KEY\x20(name,','ailed:\x20','group_id','_id\x20=\x20?','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20','\x20name\x20=\x20ex','n]\x20setActi','ectionScop','on]\x20failed','Array\x20fail','aultGroup','n\x20complete','clear','string','d\x20=\x20?','_id\x20=\x20?\x20OR','NOT\x20NULL\x0a\x20','nections\x20S','not\x20export','\x0a\x20\x20\x20\x20\x20\x20\x20\x20g','has','name\x20=\x20?\x20A','SELECT\x201\x20F','d,\x20chat_id','undefined','user_activ','hatIdsFrom','\x20group_id\x20','n][migrati','[]\x27,\x0a\x20\x20\x20\x20\x20','up_id,\x20nam','[connectio','to\x20persist','\x20(deleted=','E\x20IF\x20NOT\x20E','RE\x20group_i','s\x20group','\x20=\x20?\x20WHERE','quired\x20for','stringify','n]\x20loadGro','pDefaultsC','database\x20m','olumns\x20fai','T\x20NULL,\x0a\x20\x20','roup_id\x20=\x20','id\x20=\x20exclu','trim','DELETE\x20FRO','p_id,\x20chat','\x20name\x20=\x20?\x20','up_id\x20colu','ions\x20found','ailed\x20for\x20','on]\x20normal','ectionName','join','tor_id\x20=\x20?','to\x20add\x20cha','\x20to\x20set\x20as','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)','ator_id\x20TE','e\x20FROM\x20gro','ized\x20chat_',')\x20VALUES\x20(','AULT\x20\x27[]\x27;','\x20\x20\x20\x20\x20\x20grou','\x20\x20\x20\x20\x20\x20name','\x20(creator=','e,\x20chat_id','None\x20of\x20th','WHERE\x20crea','\x20COLUMN\x20na','_id,\x20creat','nections\x20(','defaults\x20(','warn','s\x20WHERE\x20gr','\x20TEXT\x20NOT\x20','Scoped\x20fai',';\x0a\x20\x20\x20\x20\x20\x20','INSERT\x20INT','user_key','get','ared\x20for\x20','SACTION;','to\x20import\x20','\x22\x20in\x20','\x20table\x20con','\x20\x20\x20\x20\x20ON\x20CO','n]\x20refresh','\x20\x20\x20\x20group_','me\x20TEXT\x20NO','Connection','set','for\x20setDef','veGroupFor','entries\x20fo','ons\x20ADD\x20CO','OT\x20NULL,\x0a\x20','\x20\x20\x20\x20name\x20T','creator_id','\x20\x20\x20\x20\x20creat','connection','n]\x20created','tions\x20WHER','E\x20group_de','\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20','WHERE\x20name','\x20\x20\x20\x20\x20\x20\x20cre','che\x20loaded','\x20\x20PRIMARY\x20','O\x20connecti','Cache\x20fail','UES\x20(?,\x20?,','Caches\x20loa','ATE\x20TABLE\x20','s\x20schema\x20f','RY\x20KEY,\x0a\x20\x20','ult\x20failed','\x20COLUMN\x20gr','ns;','ection\x20fai','EY\x20(name,\x20','\x20chat_id,\x20','ET\x20chat_id','E\x20connecti','236840fhlXHA','up_id\x20FROM','led\x20for\x20','ted','ame','for\x20','isArray','\x20PRIMARY\x20K','s\x20WHERE\x20na','ons\x20->\x20con','eConnectio','parse','e\x20=\x20?\x20AND\x20',',\x20row\x20dele','length','tGroup','\x20{\x20db\x20}','\x20into\x20conn','NAME\x20TO\x20co','split','run','e,\x20group_i','toLowerCas','up_default','\x20?,\x20?)','\x20WHERE\x20use','\x20group_id)','1527510byGmrx','delete','rray\x20type\x20','NFLICT(gro','\x20->\x20','group_id,\x20','ons\x20WHERE\x20','\x20active\x20gr','onnections','TO\x20connect','\x20@\x20group=','p_id\x20PK)','ection(','Scoped:\x20re','ultForGrou','ache\x20faile','AND\x20name\x20=','nnections','OT\x20NULL\x20DE','TEXT\x20PRIMA','nnections\x20','ND\x20group_i','groups\x20cac','includes','LUMN\x20chat_','\x20setDefaul'];_0xfa46=function(){return _0x15b4e1;};return _0xfa46();}export async function deleteConnectionsByCreatorInGroup(_0x39328e,_0x112389=''){const _0x2a0042=_0x5c0553;try{await ensureSchema();const _0x2fd195=await getDb(),_0x17a597=await _0x2fd195[_0x2a0042(0x188)](_0x2a0042(0x125)+_0x2a0042(0x1ca)+_0x2a0042(0x195)+_0x2a0042(0x15a)+'\x20=\x20?\x20AND\x20g'+_0x2a0042(0x122)+'?',[String(_0x39328e),String(_0x112389||'')]),_0x1dcaa0=_0x17a597&&(_0x17a597[_0x2a0042(0x1bc)]===undefined?!![]:_0x17a597[_0x2a0042(0x1bc)])||0x89+0x13cd+-0x2*0xa2b;info('[connectio'+_0x2a0042(0xf2)+'onnections'+_0x2a0042(0xd9)+_0x2a0042(0xdc)+_0x39328e+_0x2a0042(0x1ea)+_0x112389+'\x20(deleted='+_0x1dcaa0+')');try{const _0x42ccad=String(_0x112389||'');if(connectionsCache[_0x2a0042(0x109)](_0x42ccad)){const _0x56d95e=connectionsCache[_0x2a0042(0x148)](_0x42ccad);for(const [_0x4641b6,_0x4187ac]of Array[_0x2a0042(0x222)](_0x56d95e[_0x2a0042(0x202)]())){if(String(_0x4187ac['creator_id'])===String(_0x39328e))_0x56d95e['delete'](_0x4641b6);}}}catch(_0x23c98b){}return _0x1dcaa0;}catch(_0x578501){return error(_0x578501,'[connectio'+_0x2a0042(0xf2)+_0x2a0042(0x197)+'ByCreatorI'+'nGroup\x20fai'+'led:\x20'+(_0x578501?.[_0x2a0042(0x23e)]||_0x578501)),-0x1*-0x1929+0xf2c*0x2+-0x3781;}}export async function removeChatIdsFromConnectionScoped(_0x2905ec,_0x45602d,_0x205bd3=''){const _0x5e01b0=_0x5c0553;try{if(!_0x2905ec)return![];await ensureSchema();const _0x2dcac7=await getDb(),_0x558c59=await _0x2dcac7[_0x5e01b0(0x148)](_0x5e01b0(0xc7)+'t_id\x20FROM\x20'+_0x5e01b0(0x15c)+_0x5e01b0(0x17c)+_0x5e01b0(0xed)+_0x5e01b0(0x110)+'=\x20?',[String(_0x2905ec),String(_0x205bd3||'')]);if(!_0x558c59)return![];const _0x27436d=parseArrayStrict(_0x558c59[_0x5e01b0(0x1ee)]),_0x208164=Array[_0x5e01b0(0x17a)](_0x45602d)?_0x45602d[_0x5e01b0(0x1e7)](String):[String(_0x45602d)],_0x1738dd=_0x27436d[_0x5e01b0(0x1b2)](_0x2ef7cd=>!_0x208164[_0x5e01b0(0x1a6)](_0x2ef7cd));if(_0x1738dd[_0x5e01b0(0x182)]===-0x1bdb+-0x7b*-0x29+0x828){await _0x2dcac7[_0x5e01b0(0x188)]('DELETE\x20FRO'+'M\x20connecti'+'ons\x20WHERE\x20'+'name\x20=\x20?\x20A'+_0x5e01b0(0x1a4)+_0x5e01b0(0x103),[String(_0x2905ec),String(_0x205bd3||'')]),info(_0x5e01b0(0x114)+_0x5e01b0(0x246)+_0x5e01b0(0x10f)+_0x5e01b0(0x152)+_0x5e01b0(0x19c)+'moved\x20all\x20'+_0x5e01b0(0x156)+'r\x20'+_0x2905ec+_0x5e01b0(0x1ea)+_0x205bd3+(_0x5e01b0(0x181)+_0x5e01b0(0x177)));try{const _0x5aabca=String(_0x205bd3||'');if(connectionsCache[_0x5e01b0(0x109)](_0x5aabca))connectionsCache[_0x5e01b0(0x148)](_0x5aabca)[_0x5e01b0(0x190)](String(_0x2905ec));}catch(_0x2491cd){}return!![];}else{await _0x2dcac7[_0x5e01b0(0x188)]('UPDATE\x20con'+_0x5e01b0(0x106)+_0x5e01b0(0x172)+_0x5e01b0(0x11a)+_0x5e01b0(0x127)+_0x5e01b0(0x247)+'id\x20=\x20?',[stringifyArray(_0x1738dd),String(_0x2905ec),String(_0x205bd3||'')]),info(_0x5e01b0(0x114)+_0x5e01b0(0x246)+_0x5e01b0(0x10f)+_0x5e01b0(0x152)+_0x5e01b0(0x1ed)+_0x2905ec+'@'+_0x205bd3+'\x20now\x20->\x20'+_0x1738dd['join'](','));try{const _0x15275f=String(_0x205bd3||'');if(!connectionsCache[_0x5e01b0(0x109)](_0x15275f))connectionsCache['set'](_0x15275f,new Map());connectionsCache[_0x5e01b0(0x148)](_0x15275f)[_0x5e01b0(0x153)](String(_0x2905ec),{'name':String(_0x2905ec),'chat_id':_0x1738dd[_0x5e01b0(0x1e7)](String),'creator_id':connectionsCache[_0x5e01b0(0x148)](_0x15275f)[_0x5e01b0(0x148)](String(_0x2905ec))?.['creator_id']||''});}catch(_0x4b67f3){}return!![];}}catch(_0x5a0c13){return error(_0x5a0c13,'[connectio'+'n]\x20removeC'+_0x5e01b0(0x10f)+_0x5e01b0(0x152)+_0x5e01b0(0x144)+'led:\x20'+(_0x5a0c13?.[_0x5e01b0(0x23e)]||_0x5a0c13)),![];}}export async function listConnectionsForGroup(_0x12fd93){const _0x40b8fa=_0x5c0553;try{await ensureSchema();const _0x1b41d4=String(_0x12fd93||'');if(connectionsCache[_0x40b8fa(0x109)](_0x1b41d4)){const _0x2d8f91=connectionsCache['get'](_0x1b41d4);return Array[_0x40b8fa(0x222)](_0x2d8f91['values']())[_0x40b8fa(0x1e7)](_0x2d34db=>({'name':_0x2d34db[_0x40b8fa(0x221)],'chat_id':Array[_0x40b8fa(0x17a)](_0x2d34db[_0x40b8fa(0x1ee)])?_0x2d34db[_0x40b8fa(0x1ee)][_0x40b8fa(0x1e7)](String):[],'creator_id':_0x2d34db['creator_id']}));}const _0x567d3f=await getDb(),_0x1e9dd1=await _0x567d3f[_0x40b8fa(0x1ce)](_0x40b8fa(0x1f4)+_0x40b8fa(0x13a)+_0x40b8fa(0x206)+_0x40b8fa(0x1ef)+_0x40b8fa(0x1a3)+'WHERE\x20grou'+_0x40b8fa(0x238)+'RDER\x20BY\x20na'+'me',[_0x1b41d4]);return(_0x1e9dd1||[])[_0x40b8fa(0x1e7)](_0x47b5c3=>({'name':_0x47b5c3[_0x40b8fa(0x221)],'chat_id':parseArrayStrict(_0x47b5c3['chat_id']),'creator_id':_0x47b5c3[_0x40b8fa(0x15a)]}));}catch(_0x2648ed){return error(_0x2648ed,'[connectio'+'n]\x20listCon'+'nectionsFo'+'rGroup\x20fai'+'led:\x20'+(_0x2648ed?.[_0x40b8fa(0x23e)]||_0x2648ed)),[];}}export async function listConnectionsForUser(_0x5aa217,_0x753767=null){const _0x228c81=_0x5c0553;try{await ensureSchema();const _0x1ba68d=await getDb();if(_0x753767){const _0x2a47e7=await _0x1ba68d[_0x228c81(0x1ce)](_0x228c81(0x1f4)+_0x228c81(0x13a)+',\x20creator_'+_0x228c81(0x1ef)+'nnections\x20'+_0x228c81(0x13c)+_0x228c81(0x12e)+_0x228c81(0x1e3)+_0x228c81(0x104)+_0x228c81(0x207)+'e',[String(_0x5aa217),String(_0x753767)]);return(_0x2a47e7||[])['map'](_0x17e5f2=>({'name':_0x17e5f2[_0x228c81(0x221)],'chat_id':parseArrayStrict(_0x17e5f2[_0x228c81(0x1ee)]),'creator_id':_0x17e5f2['creator_id']}));}else{const _0x34009c=await _0x1ba68d[_0x228c81(0x1ce)](_0x228c81(0x1f4)+_0x228c81(0x13a)+_0x228c81(0x206)+'id,\x20group_'+'id\x20FROM\x20co'+_0x228c81(0x1a3)+'WHERE\x20crea'+_0x228c81(0x12e)+_0x228c81(0x1e6)+_0x228c81(0x194)+_0x228c81(0x221),[String(_0x5aa217)]);return(_0x34009c||[])['map'](_0x59eaa7=>({'name':_0x59eaa7[_0x228c81(0x221)],'chat_id':parseArrayStrict(_0x59eaa7['chat_id']),'creator_id':_0x59eaa7[_0x228c81(0x15a)],'group_id':_0x59eaa7[_0x228c81(0xf7)]}));}}catch(_0x580b5c){return error(_0x580b5c,'[connectio'+'n]\x20listCon'+_0x228c81(0xdd)+_0x228c81(0x1f8)+'ed'),[];}}export async function listAllConnections(){const _0x2103b0=_0x5c0553;try{await ensureSchema();const _0x1c888c=await getDb(),_0x101fc8=await _0x1c888c['all'](_0x2103b0(0x1f4)+_0x2103b0(0x13a)+_0x2103b0(0x206)+_0x2103b0(0x1e2)+_0x2103b0(0x1ef)+_0x2103b0(0x1a3)+_0x2103b0(0x1d9)+'roup_id,\x20n'+_0x2103b0(0x178));return(_0x101fc8||[])['map'](_0x2054ef=>({'name':_0x2054ef[_0x2103b0(0x221)],'chat_id':parseArrayStrict(_0x2054ef[_0x2103b0(0x1ee)]),'creator_id':_0x2054ef[_0x2103b0(0x15a)],'group_id':_0x2054ef[_0x2103b0(0xf7)]}));}catch(_0x1f20b3){return error(_0x1f20b3,_0x2103b0(0x114)+_0x2103b0(0x21f)+_0x2103b0(0x152)+_0x2103b0(0x1b6)),[];}}export async function getConnectionScoped(_0x1ad6d0,_0x4777e8=''){const _0xacde7f=_0x5c0553;try{await ensureSchema();const _0x413ee2=String(_0x4777e8||'');if(connectionsCache['has'](_0x413ee2)&&connectionsCache[_0xacde7f(0x148)](_0x413ee2)[_0xacde7f(0x109)](String(_0x1ad6d0)))return connectionsCache[_0xacde7f(0x148)](_0x413ee2)['get'](String(_0x1ad6d0))['chat_id']['slice']();const _0x25ced5=await getDb(),_0xd27117=await _0x25ced5[_0xacde7f(0x148)](_0xacde7f(0xc7)+_0xacde7f(0xd2)+_0xacde7f(0x15c)+_0xacde7f(0x17c)+_0xacde7f(0xed)+_0xacde7f(0x110)+_0xacde7f(0x215),[String(_0x1ad6d0),_0x413ee2]);if(!_0xd27117)return null;return parseArrayStrict(_0xd27117[_0xacde7f(0x1ee)]);}catch(_0x214d16){return error(_0x214d16,'[connectio'+'n]\x20getConn'+_0xacde7f(0xfc)+_0xacde7f(0x1bf)+_0x1ad6d0+_0xacde7f(0x1ea)+_0x4777e8+_0xacde7f(0x234)),null;}}export async function getConnectionRecordScoped(_0x43e4a3,_0x2b51c4=''){const _0x1b7ce0=_0x5c0553;try{await ensureSchema();const _0x390c0c=String(_0x2b51c4||'');if(connectionsCache['has'](_0x390c0c)&&connectionsCache['get'](_0x390c0c)[_0x1b7ce0(0x109)](String(_0x43e4a3))){const _0x1227c4=connectionsCache[_0x1b7ce0(0x148)](_0x390c0c)[_0x1b7ce0(0x148)](String(_0x43e4a3));return{'name':_0x1227c4[_0x1b7ce0(0x221)],'chat_id':_0x1227c4[_0x1b7ce0(0x1ee)][_0x1b7ce0(0x1d8)](),'creator_id':_0x1227c4[_0x1b7ce0(0x15a)]};}const _0x103f08=await getDb(),_0xd64d18=await _0x103f08[_0x1b7ce0(0x148)](_0x1b7ce0(0x1f4)+_0x1b7ce0(0x13a)+_0x1b7ce0(0x206)+'id\x20FROM\x20co'+'nnections\x20'+'WHERE\x20name'+'\x20=\x20?\x20AND\x20g'+_0x1b7ce0(0x122)+'?',[String(_0x43e4a3),_0x390c0c]);if(!_0xd64d18)return null;return{'name':_0xd64d18[_0x1b7ce0(0x221)],'chat_id':parseArrayStrict(_0xd64d18[_0x1b7ce0(0x1ee)]),'creator_id':_0xd64d18[_0x1b7ce0(0x15a)]};}catch(_0x1509f5){return error(_0x1509f5,'[connectio'+_0x1b7ce0(0x1df)+_0x1b7ce0(0x21c)+'rdScoped('+_0x43e4a3+_0x1b7ce0(0x1ea)+_0x2b51c4+_0x1b7ce0(0x234)),null;}}export async function getConnectionName(_0x54d376){const _0x53b8d1=_0x5c0553;try{await ensureSchema();for(const [_0x5256a8,_0x546206]of connectionsCache[_0x53b8d1(0x202)]()){for(const [_0x2d6776,_0x182b1a]of _0x546206['entries']()){if(Array[_0x53b8d1(0x17a)](_0x182b1a[_0x53b8d1(0x1ee)])&&_0x182b1a[_0x53b8d1(0x1ee)][_0x53b8d1(0x1a6)](String(_0x54d376)))return _0x2d6776;}}const _0x4e335f=await getDb(),_0x35ec6b=await _0x4e335f[_0x53b8d1(0x1ce)](_0x53b8d1(0x1f4)+'e,\x20chat_id'+'\x20FROM\x20conn'+_0x53b8d1(0x1c5));for(const _0x2b592d of _0x35ec6b||[]){const _0xd11d06=parseArrayStrict(_0x2b592d[_0x53b8d1(0x1ee)]);if(_0xd11d06['includes'](String(_0x54d376)))return _0x2b592d[_0x53b8d1(0x221)];}return null;}catch(_0xead020){return error(_0xead020,_0x53b8d1(0x114)+_0x53b8d1(0x1df)+_0x53b8d1(0x12c)+'('+_0x54d376+')\x20failed'),null;}}export async function setDefaultGroup(_0x90bbbf,_0x51cad0){const _0x193706=_0x5c0553;try{await ensureSchema();const _0x23292e=await getDb();if(!_0x51cad0)throw new Error('groupId\x20re'+_0x193706(0x11b)+_0x193706(0x1a8)+_0x193706(0x183));if(!_0x90bbbf||Array[_0x193706(0x17a)](_0x90bbbf)&&_0x90bbbf[_0x193706(0x182)]===-0x5ce*0x2+0x1515+-0x1*0x979)return await _0x23292e['run'](_0x193706(0x125)+'M\x20group_de'+'faults\x20WHE'+_0x193706(0x118)+'d\x20=\x20?',[String(_0x51cad0)]),groupDefaultsCache[_0x193706(0x190)](String(_0x51cad0)),info('[connectio'+_0x193706(0x233)+'efault\x20cle'+_0x193706(0x149)+_0x51cad0),!![];let _0x42da1f=[];if(typeof _0x90bbbf==='string'&&_0x90bbbf[_0x193706(0x18a)+'e']()===_0x193706(0x1ce)){const _0x1f44e1=await listConnectionsForGroup(String(_0x51cad0));_0x42da1f=(_0x1f44e1||[])[_0x193706(0x1e7)](_0x22463a=>_0x22463a[_0x193706(0x221)])[_0x193706(0x1b2)](Boolean);if(!_0x42da1f['length'])throw new Error(_0x193706(0x1c4)+_0x193706(0x129)+_0x193706(0x130)+_0x193706(0xeb));}else{if(Array[_0x193706(0x17a)](_0x90bbbf))_0x42da1f=_0x90bbbf[_0x193706(0x1e7)](String)[_0x193706(0x1b2)](Boolean);else{if(typeof _0x90bbbf==='string'){if(_0x90bbbf[_0x193706(0x1a6)](','))_0x42da1f=_0x90bbbf[_0x193706(0x187)](',')[_0x193706(0x1e7)](_0x275170=>_0x275170[_0x193706(0x124)]())[_0x193706(0x1b2)](Boolean);else _0x42da1f=[_0x90bbbf];}else throw new Error(_0x193706(0x213)+_0x193706(0xe4)+_0x193706(0x191)+_0x193706(0x154)+_0x193706(0xff));}}if(!_0x42da1f['length'])throw new Error(_0x193706(0x1ab)+_0x193706(0xec)+_0x193706(0x1bb)+_0x193706(0x21e)+'etDefaultG'+_0x193706(0x1cf));const _0x3c3182=[];for(const _0x29e254 of _0x42da1f){const _0x1245a6=await _0x23292e[_0x193706(0x148)](_0x193706(0x10b)+_0x193706(0x22d)+_0x193706(0x15e)+_0x193706(0x224)+'\x20AND\x20group'+_0x193706(0xf8),[String(_0x29e254),String(_0x51cad0)]);if(_0x1245a6)_0x3c3182[_0x193706(0x1cc)](_0x29e254);else warn(_0x193706(0x114)+_0x193706(0x1f9)+'ultGroup:\x20'+'skipping\x20n'+'on-existen'+_0x193706(0x1aa)+'on\x20\x22'+_0x29e254+_0x193706(0x14c)+_0x51cad0);}if(!_0x3c3182['length'])throw new Error(_0x193706(0x13b)+_0x193706(0x22e)+_0x193706(0x1b3)+'n\x20names\x20ex'+_0x193706(0xe7)+_0x193706(0x119));return await _0x23292e['run'](_0x193706(0x146)+_0x193706(0x217)+_0x193706(0x226)+'oup_id,\x20na'+_0x193706(0xe3)+_0x193706(0x1cb)+_0x193706(0x14e)+_0x193706(0x192)+'up_id)\x20DO\x20'+_0x193706(0x220)+_0x193706(0xfa)+'cluded.nam'+'e;',[String(_0x51cad0),JSON[_0x193706(0x11c)](_0x3c3182)]),groupDefaultsCache[_0x193706(0x153)](String(_0x51cad0),_0x3c3182[_0x193706(0x1d8)]()),info('[connectio'+_0x193706(0x233)+'efault\x20set'+_0x193706(0x1ad)+_0x51cad0+_0x193706(0x193)+JSON['stringify'](_0x3c3182)),!![];}catch(_0x138098){return error(_0x138098,_0x193706(0x114)+'n]\x20setDefa'+_0x193706(0x211)+_0x193706(0x12a)+_0x51cad0+':\x20'+(_0x138098?.[_0x193706(0x23e)]||_0x138098)),![];}}export async function getDefaultForGroup(_0x93df27){const _0x256448=_0x5c0553;try{await ensureSchema();if(!_0x93df27)return null;const _0x3fd319=String(_0x93df27);if(groupDefaultsCache[_0x256448(0x109)](_0x3fd319)){const _0xfdea85=groupDefaultsCache[_0x256448(0x148)](_0x3fd319);return Array[_0x256448(0x17a)](_0xfdea85)?_0xfdea85[_0x256448(0x1e7)](String):null;}const _0x4368cb=await getDb(),_0x53fe51=await _0x4368cb[_0x256448(0x148)](_0x256448(0x1f4)+'e\x20FROM\x20gro'+_0x256448(0x18b)+_0x256448(0x142)+'oup_id\x20=\x20?',[_0x3fd319]);if(!_0x53fe51||!_0x53fe51['name'])return null;try{const _0x9fe295=JSON[_0x256448(0x17f)](_0x53fe51[_0x256448(0x221)]);if(Array[_0x256448(0x17a)](_0x9fe295))return groupDefaultsCache['set'](_0x3fd319,_0x9fe295[_0x256448(0x1e7)](String)),_0x9fe295[_0x256448(0x1e7)](String);}catch(_0x50b39e){}return null;}catch(_0x262d52){return error(_0x262d52,_0x256448(0x114)+_0x256448(0x20e)+_0x256448(0x19d)+'p\x20failed\x20f'+_0x256448(0x1fd)+_0x93df27),null;}}export async function getDefault(_0x19a94e){const _0x4de4eb=_0x5c0553;try{await ensureSchema();const _0x500df7=getActiveGroupForUser(String(_0x19a94e));if(!_0x500df7)return null;return await getDefaultForGroup(_0x500df7);}catch(_0x5ba6f0){return error(_0x5ba6f0,_0x4de4eb(0x114)+_0x4de4eb(0x20e)+_0x4de4eb(0x16c)+_0x4de4eb(0x1ad)+_0x19a94e),null;}}export async function getConnection(_0x27cd4b){const _0x17c937=_0x5c0553;try{await ensureSchema();const _0xf0f00f=await getDb(),_0x1fab05=await _0xf0f00f[_0x17c937(0x1ce)](_0x17c937(0xc7)+'t_id\x20FROM\x20'+'connection'+_0x17c937(0x17c)+'me\x20=\x20?',[String(_0x27cd4b)]);if(!_0x1fab05||!_0x1fab05[_0x17c937(0x182)])return null;const _0x185458=[];for(const _0x14e901 of _0x1fab05){const _0x4c6295=parseArrayStrict(_0x14e901[_0x17c937(0x1ee)]);for(const _0x11b9b1 of _0x4c6295)if(!_0x185458['includes'](_0x11b9b1))_0x185458[_0x17c937(0x1cc)](_0x11b9b1);}return _0x185458;}catch(_0x580103){return error(_0x580103,'[connectio'+_0x17c937(0x1df)+_0x17c937(0x19b)+_0x27cd4b+_0x17c937(0x234)),null;}}export async function getConnectionRecord(_0x51f3e7){const _0x3dbd23=_0x5c0553;try{await ensureSchema();const _0x466117=await getDb(),_0xf9cb2b=await _0x466117[_0x3dbd23(0x148)]('SELECT\x20nam'+_0x3dbd23(0x13a)+_0x3dbd23(0x206)+_0x3dbd23(0x1e2)+_0x3dbd23(0x1ef)+_0x3dbd23(0x1a3)+_0x3dbd23(0x161)+_0x3dbd23(0x1b9)+'\x201',[String(_0x51f3e7)]);if(!_0xf9cb2b)return null;return{'name':_0xf9cb2b[_0x3dbd23(0x221)],'chat_id':parseArrayStrict(_0xf9cb2b[_0x3dbd23(0x1ee)]),'creator_id':_0xf9cb2b['creator_id'],'group_id':_0xf9cb2b[_0x3dbd23(0xf7)]};}catch(_0x16be9a){return error(_0x16be9a,'[connectio'+_0x3dbd23(0x1df)+_0x3dbd23(0x21c)+_0x3dbd23(0x231)+_0x51f3e7+_0x3dbd23(0x234)),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnectionScoped':deleteConnectionScoped,'deleteConnectionsByCreatorInGroup':deleteConnectionsByCreatorInGroup,'removeChatIdsFromConnectionScoped':removeChatIdsFromConnectionScoped,'listConnectionsForUser':listConnectionsForUser,'listConnectionsForGroup':listConnectionsForGroup,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'getConnectionRecord':getConnectionRecord,'getConnectionRecordScoped':getConnectionRecordScoped,'getConnectionScoped':getConnectionScoped,'setDefaultGroup':setDefaultGroup,'getDefaultForGroup':getDefaultForGroup,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser,'refreshCaches':refreshCaches,'_internalCaches':{'connectionsCache':connectionsCache,'groupDefaultsCache':groupDefaultsCache,'activeGroupByUser':activeGroupByUser}};