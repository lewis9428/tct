function _0x5aea(){const _0x1a2b1a=['changes','ded.group_','or\x20','p_id\x20TEXT\x20','on]\x20readin','\x20user_key\x20','delete','\x20WHERE\x20typ','\x20\x20\x20\x20\x20creat','No\x20valid\x20c','on]\x20insert','n]\x20loadGro','oup:\x20',',\x20creator_','\x20connectio','SELECT\x20gro','quired\x20for','ache\x20faile','k\x20failed\x20f','nGroup\x20fai','\x20IF\x20EXISTS','ded.','oup_id,\x20na','n]\x20getDefa','e,\x20group_i','upDefaults','\x20=\x20?\x20AND\x20g','Connection','=\x20?','E\x20group_de','O\x20connecti','some','n]\x20active\x20','includes','eGroupDefa','_defaults\x20','Caches\x20com','id\x20=\x20?','join','to\x20add\x20cha','NOT\x20NULL\x0a\x20','SELECT\x20nam','n]\x20deleteC','from','ections_ne','OT\x20NULL\x20DE','\x0a\x20\x20\x20\x20\x20\x20\x20\x20C','[WARN]','FAULT\x20\x27\x27;','tions\x20(\x0a\x20\x20','parse','id\x20FROM\x20co','r_key\x20=\x20?','DELETE\x20FRO','ND\x20group_i','n]\x20created','\x20->\x20','issing\x20cha','n]\x20addConn','\x20name\x20=\x20?\x20','225269rIMVLb','9cMdUmr','ame','REATE\x20TABL','ultGroup\x20f','n]\x20updated','\x20to\x20update','coped\x20fail','led\x20for\x20','[ERROR]','n]\x20columnE','me\x20=\x20?','STS\x20','roup','UPDATE\x20con','not\x20export','function','ite_master','L,\x0a\x20\x20\x20\x20\x20\x20\x20','\x20AND\x20group','ailed\x20for\x20','rUser\x20fail','oup_id\x20TEX','ons\x20ADD\x20CO','\x20\x20\x20\x20\x20\x20chat','E\x20IF\x20NOT\x20E','\x20rows)','[]\x27,\x0a\x20\x20\x20\x20\x20','n]\x20group\x20d','AULT\x20\x27\x27,\x0a\x20','id,\x20group_','nections\x20S','E\x20connecti','LUMN\x20chat_','ized\x20group','26139LueAEW','n][migrati','all','id\x20for\x20\x22','slice','oup_id\x20=\x20?','\x20=\x20?\x20WHERE','n]\x20migrate','ed:\x20','\x20WHERE\x20use','\x20PRIMARY\x20K','values','e=\x27table\x27\x20','ided\x20for\x20s','xists\x20chec','with\x20group','name','SELECT\x201\x20F','s\x20WHERE\x20na','[connectio','\x20\x20\x20\x20\x20);\x0a\x20\x20','t_id\x20FROM\x20','or_id\x20TEXT','r_key,\x20gro','Scoped\x20fai','n]\x20failed\x20','Scoped:\x20re','ultForGrou','\x20COLUMN\x20gr','\x20loaded\x20(','XT\x20NOT\x20NUL','to\x20add\x20gro','UES\x20(?,\x20?,','isArray','Cache\x20fail','\x22\x20@\x20group\x20','\x20\x20\x20\x20\x20ON\x20CO','ectionName','INSERT\x20INT','nectionsCa','ons\x20->\x20con','\x20active\x20gr','to\x20persist','up_id\x20FROM','cluded.nam','\x20COLUMN\x20na','\x20\x20PRIMARY\x20','ensured\x20an','ections','\x20for\x20','STS\x20connec','\x0a\x20\x20\x20\x20\x20\x20\x20\x20g','85743SjpIPO','WHERE\x20grou','moved\x20all\x20','tions\x20WHER','rGroup\x20fai','hat_id\x20TEX','AND\x20name\x20=','id\x20TEXT\x20NO','faults\x20(gr','n]\x20loadAct','\x20chat_id\x20f','roup_id\x20=\x20','PRAGMA\x20tab',';\x0a\x20\x20\x20\x20\x20\x20','odule\x20did\x20','group_id,\x20','e\x20FROM\x20gro','s\x20SET\x20name','\x20group_id,','Scoped:\x20','g\x20old\x20rows','SACTION;','\x20(\x0a\x20\x20\x20\x20\x20\x20\x20','exec','\x0a\x20\x20\x20\x20\x20\x20\x20\x20)','user_key)\x20','toLowerCas',')\x20VALUES\x20(','n]\x20connect','set','\x20chat_id,\x20','\x20setDefaul','nGroup:\x20','names\x20prov','WHERE\x20name','\x20\x20\x20\x20group_','tGroup','map','AND\x20group_','REPLACE\x20IN','undefined','user_activ','d\x20=\x20?','d,\x20chat_id','rd(','rray\x20type\x20','?,\x20?)\x20\x0a\x20\x20\x20','id\x20=\x20exclu','he\x20loaded\x20','up_id','on-existen','T\x20NULL,\x0a\x20\x20','ions\x20cache','\x20\x20\x20\x20\x20\x20grou','me\x20=\x20?\x20AND','\x20@\x20group=','entries','ult\x20failed','Caches\x20loa','split','ectionScop','nnections;','roup_id\x20TE','stringify','s\x20failed','COMMIT;','NFLICT(gro','up_id)\x20DO\x20','\x20to\x20set\x20as','w\x20(\x0a\x20\x20\x20\x20\x20\x20','get','message','ATE\x20TABLE\x20','e,\x20chat_id','ns;','name\x20=\x20?\x20A','aults\x20for\x20','on]\x20migrat','O\x20group_de','User\x20error','?,\x20?,\x20?,\x20?','onnections','length','n]\x20ensureS','n]\x20added\x20m','e_groups','(0\x20rows)','\x20KEY,\x0a\x20\x20\x20\x20','p_id\x20PK)','ator_id\x20TE',',\x0a\x20\x20\x20\x20\x20\x20\x20\x20','up_default','nectionsFo','EY\x20(name,\x20','n]\x20setDefa','\x20(creator=','e\x20FROM\x20sql','\x20\x20\x20\x20name\x20T','\x20failed:\x20','n]\x20addGrou','p\x20failed\x20f','T\x20NOT\x20NULL','559600VaYlRv','\x20@\x20','EXT\x20NOT\x20NU','chema\x20fail','group_id','\x20FROM\x20conn','faults\x20WHE','olumns\x20fai','connection','le_info(','coped:\x20','\x20table\x20','nly,\x20group','\x22\x20in\x20','SET\x20group_','ist\x20in\x20thi','lumn','s\x20WHERE\x20gr','n]\x20getConn','on:\x20','p_id\x20=\x20?\x20O','push',',\x20row\x20dele','n]\x20listCon','d\x20namesOrA','chat_id','up_id\x20colu','groupId\x20re','w\x20failed\x20f','BEGIN\x20TRAN','s\x20group','ized\x20chat_','n]\x20migrati','plete','LUMN\x20creat','trim','\x20?,\x20?)','ectionReco','up_id,\x20nam','M\x20connecti','\x20TEXT\x20NOT\x20','1722702MoOBST','nections\x20(','LUMN\x20group','led:\x20','_id)','T\x20NULL\x20DEF','entries\x20fo','NULL,\x0a\x20\x20\x20\x20','LL\x0a\x20\x20\x20\x20\x20\x20)','me)\x20VALUES','LL,\x0a\x20\x20\x20\x20\x20\x20','SELECT\x20use','nnections\x20','[INFO]','pDefaultsC','ALTER\x20TABL','defaults\x20(','ultGroup:\x20','\x20(deleted=','DEFAULT\x20\x27\x27','t\x20connecti','ByCreatorI','ection(','\x20\x20\x20\x20\x20\x20\x20cre','filter','SELECT\x20cha',')\x20failed','ults','\x20DEFAULT\x20\x27','41195gGmDqM','ator_id','run','efaults\x20ca','che\x20failed','eConnectio','_id\x20TEXT\x20N','ET\x20chat_id','ions_new\x20(','\x20ORDER\x20BY\x20','\x20table\x20gro','onnectionS','to\x20import\x20','veGroupFor','INSERT\x20OR\x20','WHERE\x20crea','etDefaultG','\x20\x20\x20\x20\x20\x20);\x0a\x20','\x20\x20\x20','groups\x20cac','\x20(user_key','string','M\x20group_de','Unsupporte','\x20table\x20con','n]\x20loadCon','288712JKDIwA','for\x20setDef','on\x20to\x20new\x20','Array\x20fail','d\x20connecti','AULT\x20\x27[]\x27;','creator_id',';\x0a\x20\x20\x20\x20','iveGroupsC','ailed:\x20','\x20=\x20?\x20LIMIT','warn','\x20group_id\x20','name,\x20grou','skipping\x20n','100UAxzLh','ORDER\x20BY\x20g','group_id)\x0a','n]\x20removeC','on]\x20normal','TEXT\x20PRIMA','IF\x20NOT\x20EXI','ons\x20WHERE\x20','hatIdsFrom','s\x20schema\x20f','ator_id\x20co','ared\x20for\x20','oup\x20deleti','t_id\x20colum','ted','has','\x0a\x20\x20\x20\x20\x20\x20CRE','for\x20','STS\x20group_','n]\x20refresh','on]\x20failed',')\x20@\x20group='];_0x5aea=function(){return _0x1a2b1a;};return _0x5aea();}const _0x1e4243=_0x15e4;(function(_0x149668,_0x596ba0){const _0x231cde=_0x15e4,_0x32a30a=_0x149668();while(!![]){try{const _0x371fe2=-parseInt(_0x231cde(0xe0))/(0x1f*0x9b+0x2*-0xfb4+0xca4)+parseInt(_0x231cde(0x19d))/(0xb5*0x21+-0x11ca+-0x589)+parseInt(_0x231cde(0x103))/(-0x3d8+-0x1be6+0x2e3*0xb)*(-parseInt(_0x231cde(0x20c))/(-0x1f69+-0x21fd+0x416a))+parseInt(_0x231cde(0x1e3))/(0x971*0x1+-0xda+-0x892*0x1)+parseInt(_0x231cde(0x1c6))/(0x571+0x2437+-0x29a2)+-parseInt(_0x231cde(0x137))/(-0x5*-0x54f+-0x133d+-0x747)+parseInt(_0x231cde(0x1fd))/(0x175c+-0xc9f+0x1*-0xab5)*(parseInt(_0x231cde(0xe1))/(0x10*0x25+0x6*0x5c6+0x2d7*-0xd));if(_0x371fe2===_0x596ba0)break;else _0x32a30a['push'](_0x32a30a['shift']());}catch(_0x1c2205){_0x32a30a['push'](_0x32a30a['shift']());}}}(_0x5aea,-0x128b6+0x211eb*0x1+0xbd*0x1fd));import{info as _0x688fd0,warn as _0x4bd8bd,error as _0x5a1fe2}from'./logger.js';let db=null,schemaEnsured=![];const activeGroupByUser=new Map(),connectionsCache=new Map(),groupDefaultsCache=new Map(),ACTIVE_TABLE=_0x1e4243(0x160)+_0x1e4243(0x18c);function info(..._0x33d223){const _0x3cbad3=_0x1e4243;try{_0x688fd0(..._0x33d223);}catch(_0x46274a){console['log'](_0x3cbad3(0x1d3),..._0x33d223);}}function warn(..._0x39b5bd){const _0x28eb44=_0x1e4243;try{_0x4bd8bd(..._0x39b5bd);}catch(_0x4bed5e){console[_0x28eb44(0x208)](_0x28eb44(0xd3),..._0x39b5bd);}}function error(..._0x5d8dc7){const _0x503278=_0x1e4243;try{_0x5a1fe2(..._0x5d8dc7);}catch(_0x32fe1c){console['error'](_0x503278(0xe9),..._0x5d8dc7);}}async function getDb(){const _0x47c174=_0x1e4243;if(db&&typeof db[_0x47c174(0x14e)]===_0x47c174(0xf0))return db;try{const _0xc90bfc=await import('./database.js');if(_0xc90bfc&&_0xc90bfc['db'])return db=_0xc90bfc['db'],db;throw new Error('database\x20m'+_0x47c174(0x145)+_0x47c174(0xef)+'\x20{\x20db\x20}');}catch(_0x6192d3){error(_0x6192d3,_0x47c174(0x116)+_0x47c174(0x11c)+_0x47c174(0x1ef)+'database.j'+'s');throw _0x6192d3;}}function safeParseJSON(_0x5b8c86){const _0x17317d=_0x1e4243;try{return JSON[_0x17317d(0xd6)](_0x5b8c86);}catch(_0x557bfe){return null;}}function asArrayStrict(_0x44b83e){const _0x4952b8=_0x1e4243;if(_0x44b83e===null||_0x44b83e===undefined)return[];if(typeof _0x44b83e===_0x4952b8(0x1f8)){const _0x4a1996=safeParseJSON(_0x44b83e);if(Array[_0x4952b8(0x124)](_0x4a1996))return _0x4a1996['map'](String);return[_0x44b83e];}if(Array[_0x4952b8(0x124)](_0x44b83e))return _0x44b83e[_0x4952b8(0x15c)](String);return[String(_0x44b83e)];}function toJSONString(_0x4ae731){const _0x3baf21=_0x1e4243;return JSON['stringify'](Array[_0x3baf21(0x124)](_0x4ae731)?_0x4ae731[_0x3baf21(0x15c)](String):[]);}async function tableExists(_0x5399aa){const _0x4b42d7=_0x1e4243,_0x585a22=await getDb(),_0x2682c2=await _0x585a22['get']('SELECT\x20nam'+_0x4b42d7(0x197)+_0x4b42d7(0xf1)+_0x4b42d7(0xab)+_0x4b42d7(0x10f)+_0x4b42d7(0x13d)+'\x20?',[String(_0x5399aa)]);return!!_0x2682c2;}async function columnExists(_0x8ef567,_0x4af46b){const _0x41f8e0=_0x1e4243;try{const _0x44a220=await getDb(),_0x2f43e0=await _0x44a220['all'](_0x41f8e0(0x143)+_0x41f8e0(0x1a6)+_0x8ef567+')');if(!Array[_0x41f8e0(0x124)](_0x2f43e0))return![];return _0x2f43e0[_0x41f8e0(0xc3)](_0x5e4d71=>String(_0x5e4d71[_0x41f8e0(0x113)])['toLowerCas'+'e']()===String(_0x4af46b)[_0x41f8e0(0x151)+'e']());}catch(_0x1a6329){return warn('[connectio'+_0x41f8e0(0xea)+_0x41f8e0(0x111)+_0x41f8e0(0xb6)+_0x41f8e0(0x224)+_0x8ef567+'.'+_0x4af46b+':\x20'+(_0x1a6329?.['message']||_0x1a6329)),![];}}async function ensureConnectionsTable(){const _0x13188a=_0x1e4243,_0x13d9c6=await getDb(),_0x27f651=await tableExists(_0x13188a(0x1a5)+'s');if(!_0x27f651){await _0x13d9c6[_0x13188a(0x14e)](_0x13188a(0x21c)+_0x13188a(0x17f)+_0x13188a(0x212)+_0x13188a(0x135)+_0x13188a(0xd5)+'\x20\x20\x20\x20\x20\x20name'+_0x13188a(0x1c5)+_0x13188a(0x1cd)+_0x13188a(0x15a)+'id\x20TEXT\x20NO'+_0x13188a(0x16a)+_0x13188a(0xf8)+'_id\x20TEXT\x20N'+'OT\x20NULL,\x0a\x20'+_0x13188a(0x1dd)+_0x13188a(0x190)+_0x13188a(0x121)+_0x13188a(0xf2)+_0x13188a(0x10d)+_0x13188a(0x194)+_0x13188a(0x20e)+_0x13188a(0x1f4)+_0x13188a(0x1f5)),info(_0x13188a(0x116)+_0x13188a(0xdb)+_0x13188a(0x1fb)+_0x13188a(0x1c7)+_0x13188a(0x20a)+_0x13188a(0x18f));return;}const _0x261a3e=await columnExists(_0x13188a(0x1a5)+'s',_0x13188a(0x1a1)),_0x21abbc=await columnExists(_0x13188a(0x1a5)+'s',_0x13188a(0x1b6)),_0x1ca486=await columnExists(_0x13188a(0x1a5)+'s',_0x13188a(0x203));if(!_0x21abbc||!_0x1ca486||!_0x261a3e)try{await _0x13d9c6['exec'](_0x13188a(0xd2)+_0x13188a(0xe3)+_0x13188a(0xf9)+'XISTS\x20conn'+_0x13188a(0xd0)+_0x13188a(0x17c)+_0x13188a(0x198)+_0x13188a(0x19f)+_0x13188a(0x1d0)+_0x13188a(0x15a)+'id\x20TEXT\x20NO'+_0x13188a(0x1cb)+_0x13188a(0xfd)+'\x20\x20\x20\x20\x20\x20\x20\x20\x20c'+_0x13188a(0x13c)+_0x13188a(0x19c)+_0x13188a(0x1e2)+_0x13188a(0xfb)+_0x13188a(0xac)+'or_id\x20TEXT'+'\x20NOT\x20NULL\x20'+_0x13188a(0x1d9)+_0x13188a(0x191)+_0x13188a(0x131)+'KEY\x20(name,'+'\x20group_id)'+_0x13188a(0x14f)+_0x13188a(0x144));try{const _0x89de8=await _0x13d9c6['all'](_0x13188a(0xcd)+_0x13188a(0x180)+_0x13188a(0xb1)+'id\x20FROM\x20co'+'nnections');if(Array[_0x13188a(0x124)](_0x89de8)&&_0x89de8[_0x13188a(0x189)])for(const _0x29540e of _0x89de8){const _0x4d80d9=_0x29540e[_0x13188a(0x113)],_0x5dc490=typeof _0x29540e[_0x13188a(0x1b6)]==='undefined'||_0x29540e[_0x13188a(0x1b6)]===null?'[]':_0x29540e[_0x13188a(0x1b6)],_0xec7f0b=typeof _0x29540e[_0x13188a(0x203)]===_0x13188a(0x15f)||_0x29540e[_0x13188a(0x203)]===null?'':_0x29540e['creator_id'];try{await _0x13d9c6['run'](_0x13188a(0x1f1)+_0x13188a(0x15e)+'TO\x20connect'+_0x13188a(0x1eb)+_0x13188a(0x20a)+'p_id,\x20chat'+'_id,\x20creat'+'or_id)\x20VAL'+_0x13188a(0x123)+_0x13188a(0x1c1),[_0x4d80d9,'',_0x5dc490,_0xec7f0b]);}catch(_0x191e74){warn('[connectio'+_0x13188a(0x104)+_0x13188a(0xae)+'\x20into\x20conn'+_0x13188a(0xd0)+_0x13188a(0x1b9)+'or\x20'+_0x4d80d9+':\x20'+(_0x191e74?.[_0x13188a(0x17e)]||_0x191e74));}}}catch(_0x273d6b){warn(_0x13188a(0x116)+_0x13188a(0x104)+_0x13188a(0x226)+_0x13188a(0x14b)+_0x13188a(0x199)+(_0x273d6b?.[_0x13188a(0x17e)]||_0x273d6b));}try{await _0x13d9c6[_0x13188a(0x14e)]('DROP\x20TABLE'+_0x13188a(0xb8)+_0x13188a(0xb2)+_0x13188a(0x181));}catch(_0x3b1841){}await _0x13d9c6[_0x13188a(0x14e)]('ALTER\x20TABL'+_0x13188a(0x100)+'ons_new\x20RE'+'NAME\x20TO\x20co'+_0x13188a(0x174)),info('[connectio'+_0x13188a(0x10a)+_0x13188a(0x201)+_0x13188a(0x12b)+_0x13188a(0x1c7)+_0x13188a(0x112)+_0x13188a(0x1ca));}catch(_0x43a67f){warn(_0x13188a(0x116)+_0x13188a(0x1bd)+_0x13188a(0x1ff)+_0x13188a(0x1a5)+_0x13188a(0x215)+_0x13188a(0x206)+(_0x43a67f?.['message']||_0x43a67f));if(!_0x21abbc)try{await _0x13d9c6[_0x13188a(0x14e)](_0x13188a(0x1d5)+'E\x20connecti'+_0x13188a(0xf7)+_0x13188a(0x101)+_0x13188a(0x13e)+_0x13188a(0x1cb)+'AULT\x20\x27[]\x27;'),info('[connectio'+'n]\x20added\x20m'+_0x13188a(0xdd)+_0x13188a(0x219)+'n');}catch(_0x2c7f6a){warn(_0x2c7f6a,'[connectio'+_0x13188a(0x11c)+_0x13188a(0xcb)+'t_id');}if(!_0x1ca486)try{await _0x13d9c6[_0x13188a(0x14e)](_0x13188a(0x1d5)+_0x13188a(0x100)+_0x13188a(0xf7)+_0x13188a(0x1bf)+_0x13188a(0x119)+'\x20NOT\x20NULL\x20'+_0x13188a(0x1d9)+';'),info(_0x13188a(0x116)+_0x13188a(0x18b)+'issing\x20cre'+_0x13188a(0x216)+_0x13188a(0x1ad));}catch(_0x4737e0){warn(_0x4737e0,_0x13188a(0x116)+'n]\x20failed\x20'+'to\x20add\x20cre'+_0x13188a(0x1e4));}if(!_0x261a3e)try{await _0x13d9c6[_0x13188a(0x14e)]('ALTER\x20TABL'+_0x13188a(0x100)+_0x13188a(0xf7)+_0x13188a(0x1c8)+_0x13188a(0x1e9)+_0x13188a(0xd1)+_0x13188a(0xd4)),info(_0x13188a(0x116)+_0x13188a(0x18b)+'issing\x20gro'+_0x13188a(0x1b7)+'mn');}catch(_0x3ba76f){warn(_0x3ba76f,_0x13188a(0x116)+_0x13188a(0x11c)+_0x13188a(0x122)+_0x13188a(0x168));}}}async function ensureGroupDefaultsTable(){const _0x3bee61=_0x1e4243,_0x2628d7=await getDb(),_0x2c3e93=await tableExists('group_defa'+_0x3bee61(0x1e1));if(!_0x2c3e93){await _0x2628d7[_0x3bee61(0x14e)](_0x3bee61(0x21c)+_0x3bee61(0x17f)+'IF\x20NOT\x20EXI'+_0x3bee61(0x21e)+_0x3bee61(0x1d6)+_0x3bee61(0x136)+_0x3bee61(0x175)+'XT\x20PRIMARY'+_0x3bee61(0x18e)+'\x20\x20\x20\x20name\x20T'+'EXT\x20NOT\x20NU'+_0x3bee61(0x1ce)+_0x3bee61(0x204)),info(_0x3bee61(0x116)+'n]\x20created'+_0x3bee61(0x1ed)+_0x3bee61(0x192)+'s');return;}!await columnExists('group_defa'+_0x3bee61(0x1e1),_0x3bee61(0x1a1))&&await addGroupDefaultsColumns();}async function addGroupDefaultsColumns(){const _0x1c9882=_0x1e4243,_0x463489=await getDb();try{await _0x463489['exec'](_0x1c9882(0x1d5)+_0x1c9882(0xc1)+'faults\x20ADD'+_0x1c9882(0x11f)+_0x1c9882(0xf6)+_0x1c9882(0x19c)+_0x1c9882(0x1e2)+'\x27;'),await _0x463489[_0x1c9882(0x14e)](_0x1c9882(0x1d5)+_0x1c9882(0xc1)+'faults\x20ADD'+_0x1c9882(0x130)+'me\x20TEXT\x20NO'+_0x1c9882(0x1cb)+_0x1c9882(0x202));}catch(_0x1bce04){warn(_0x1c9882(0x116)+_0x1c9882(0x19a)+_0x1c9882(0x1d4)+_0x1c9882(0x1a4)+_0x1c9882(0x1c9)+(_0x1bce04?.[_0x1c9882(0x17e)]||_0x1bce04));}}async function ensureActiveGroupsTable(){const _0x157f7d=_0x1e4243,_0x1951e2=await getDb(),_0x22948d=await tableExists(ACTIVE_TABLE);!_0x22948d&&(await _0x1951e2['exec'](_0x157f7d(0x21c)+_0x157f7d(0x17f)+'IF\x20NOT\x20EXI'+_0x157f7d(0xec)+ACTIVE_TABLE+(_0x157f7d(0x14d)+_0x157f7d(0x227)+_0x157f7d(0x211)+'RY\x20KEY,\x0a\x20\x20'+_0x157f7d(0x16c)+_0x157f7d(0x225)+_0x157f7d(0xcc)+_0x157f7d(0x117)+'\x20\x20')),info('[connectio'+_0x157f7d(0xdb)+_0x157f7d(0x1a8)+ACTIVE_TABLE));}async function migrateConnectionsChatIdToArray(){const _0x4066d3=_0x1e4243;try{const _0x35f284=await getDb(),_0xe3b794=await _0x35f284['all'](_0x4066d3(0xcd)+_0x4066d3(0xbc)+_0x4066d3(0x162)+_0x4066d3(0x1a2)+'ections');if(!_0xe3b794||_0xe3b794[_0x4066d3(0x189)]===-0xde4+0x2*0xcf5+-0x201*0x6)return;const _0x333e5a=[];for(const _0x394f7d of _0xe3b794){const _0x94009d=_0x394f7d['chat_id'],_0x4722ef=safeParseJSON(_0x94009d);if(Array[_0x4066d3(0x124)](_0x4722ef)){const _0x4d7dec=_0x4722ef[_0x4066d3(0x15c)](String),_0xf76dca=toJSONString(_0x4d7dec);if(_0xf76dca!==_0x94009d)_0x333e5a['push']({'name':_0x394f7d[_0x4066d3(0x113)],'group_id':_0x394f7d[_0x4066d3(0x1a1)]||'','chat_id':_0xf76dca});continue;}else{let _0xc232c0=[];_0x94009d===null||_0x94009d===undefined||String(_0x94009d)[_0x4066d3(0x1c0)]()===''?_0xc232c0=[]:_0xc232c0=[String(_0x94009d)];const _0x1fb731=toJSONString(_0xc232c0);_0x333e5a['push']({'name':_0x394f7d[_0x4066d3(0x113)],'group_id':_0x394f7d[_0x4066d3(0x1a1)]||'','chat_id':_0x1fb731});}}if(_0x333e5a['length']>0x577*0x7+-0xe97+-0x17aa){try{await _0x35f284[_0x4066d3(0x14e)](_0x4066d3(0x1ba)+_0x4066d3(0x14c));}catch(_0xa49ed3){}for(const _0x45ff56 of _0x333e5a){try{await _0x35f284[_0x4066d3(0x1e5)](_0x4066d3(0xee)+_0x4066d3(0xff)+'ET\x20chat_id'+_0x4066d3(0x109)+_0x4066d3(0xdf)+'AND\x20group_'+_0x4066d3(0xc9),[_0x45ff56['chat_id'],_0x45ff56[_0x4066d3(0x113)],_0x45ff56[_0x4066d3(0x1a1)]]),info('[connectio'+_0x4066d3(0x104)+_0x4066d3(0x210)+_0x4066d3(0x1bc)+_0x4066d3(0x106)+_0x45ff56[_0x4066d3(0x113)]+(_0x4066d3(0x126)+'\x22')+_0x45ff56['group_id']+'\x22');}catch(_0x17d40d){warn(_0x4066d3(0x116)+'n][migrati'+_0x4066d3(0x220)+_0x4066d3(0xe6)+_0x4066d3(0x141)+_0x4066d3(0x224)+_0x45ff56[_0x4066d3(0x113)]+'@'+_0x45ff56['group_id']+':\x20'+(_0x17d40d?.[_0x4066d3(0x17e)]||_0x17d40d));}}try{await _0x35f284[_0x4066d3(0x14e)]('COMMIT;');}catch(_0xa4eb7c){}}}catch(_0x2d7688){warn(_0x4066d3(0x116)+_0x4066d3(0x104)+_0x4066d3(0x184)+_0x4066d3(0x1e8)+'nsChatIdTo'+_0x4066d3(0x200)+_0x4066d3(0x10b)+(_0x2d7688?.[_0x4066d3(0x17e)]||_0x2d7688));}}async function migrateGroupDefaultsNameToArray(){const _0x5661c9=_0x1e4243;try{const _0x2ad0b7=await getDb(),_0x34b884=await _0x2ad0b7[_0x5661c9(0x105)](_0x5661c9(0xb3)+_0x5661c9(0x1c3)+'e\x20FROM\x20gro'+_0x5661c9(0x192)+'s');if(!_0x34b884||_0x34b884[_0x5661c9(0x189)]===-0x10*0x185+0x535+0x131b)return;const _0x4a1276=[];for(const _0x3caec6 of _0x34b884){const _0x39afa9=_0x3caec6[_0x5661c9(0x113)],_0x39c572=safeParseJSON(_0x39afa9);if(Array['isArray'](_0x39c572)){const _0x2149f2=toJSONString(_0x39c572);if(_0x2149f2!==_0x39afa9)_0x4a1276[_0x5661c9(0x1b2)]({'group_id':_0x3caec6[_0x5661c9(0x1a1)],'name':_0x2149f2});continue;}else{const _0x37cfd9=_0x39afa9===null||_0x39afa9===undefined||String(_0x39afa9)[_0x5661c9(0x1c0)]()===''?[]:[String(_0x39afa9)],_0x5bafd5=toJSONString(_0x37cfd9);_0x4a1276['push']({'group_id':_0x3caec6[_0x5661c9(0x1a1)],'name':_0x5bafd5});}}if(_0x4a1276[_0x5661c9(0x189)]>0x74*0x20+-0x1e98+0x28*0x67){try{await _0x2ad0b7[_0x5661c9(0x14e)](_0x5661c9(0x1ba)+_0x5661c9(0x14c));}catch(_0x1cc308){}for(const _0x2ce6e0 of _0x4a1276){try{await _0x2ad0b7[_0x5661c9(0x1e5)]('UPDATE\x20gro'+'up_default'+_0x5661c9(0x148)+_0x5661c9(0x109)+_0x5661c9(0x209)+'=\x20?',[_0x2ce6e0[_0x5661c9(0x113)],_0x2ce6e0['group_id']]),info(_0x5661c9(0x116)+_0x5661c9(0x104)+_0x5661c9(0x210)+_0x5661c9(0x102)+_0x5661c9(0xc7)+_0x5661c9(0x21d)+_0x2ce6e0['group_id']);}catch(_0x5af1ca){warn(_0x5661c9(0x116)+_0x5661c9(0x104)+'on]\x20failed'+_0x5661c9(0xe6)+'\x20group_def'+_0x5661c9(0x183)+_0x2ce6e0['group_id']+':\x20'+(_0x5af1ca?.['message']||_0x5af1ca));}}try{await _0x2ad0b7[_0x5661c9(0x14e)](_0x5661c9(0x178));}catch(_0x181e30){}}}catch(_0x1d7a5f){warn(_0x5661c9(0x116)+_0x5661c9(0x104)+_0x5661c9(0x184)+_0x5661c9(0xc6)+'ultsNameTo'+_0x5661c9(0x200)+_0x5661c9(0x10b)+(_0x1d7a5f?.['message']||_0x1d7a5f));}}function parseArrayStrict(_0x260287){const _0x3ca5e2=_0x1e4243;if(_0x260287===null||_0x260287===undefined)return[];if(typeof _0x260287===_0x3ca5e2(0x1f8)){const _0x41bafd=safeParseJSON(_0x260287);if(Array[_0x3ca5e2(0x124)](_0x41bafd))return _0x41bafd[_0x3ca5e2(0x15c)](String);return[];}if(Array[_0x3ca5e2(0x124)](_0x260287))return _0x260287[_0x3ca5e2(0x15c)](String);return[String(_0x260287)];}function stringifyArray(_0x5f43ec){const _0x3ce996=_0x1e4243;return JSON[_0x3ce996(0x176)](Array[_0x3ce996(0x124)](_0x5f43ec)?_0x5f43ec['map'](String):[]);}async function loadConnectionsCache(){const _0x5685f3=_0x1e4243;try{const _0x375997=await getDb(),_0x3fa3a9=await _0x375997['all'](_0x5685f3(0xcd)+_0x5685f3(0xbc)+'d,\x20chat_id'+',\x20creator_'+_0x5685f3(0xd7)+'nnections');connectionsCache['clear']();if(!_0x3fa3a9||!_0x3fa3a9[_0x5685f3(0x189)]){info(_0x5685f3(0x116)+_0x5685f3(0x153)+_0x5685f3(0x16b)+'\x20loaded\x20(0'+_0x5685f3(0xfa));return;}for(const _0x1d7829 of _0x3fa3a9){const _0x445a3b=String(_0x1d7829[_0x5685f3(0x1a1)]||'');if(!connectionsCache[_0x5685f3(0x21b)](_0x445a3b))connectionsCache[_0x5685f3(0x154)](_0x445a3b,new Map());const _0x535ff4=connectionsCache['get'](_0x445a3b);_0x535ff4['set'](String(_0x1d7829['name']),{'name':_0x1d7829[_0x5685f3(0x113)],'chat_id':parseArrayStrict(_0x1d7829[_0x5685f3(0x1b6)]),'creator_id':_0x1d7829[_0x5685f3(0x203)]});}info(_0x5685f3(0x116)+'n]\x20connect'+_0x5685f3(0x16b)+_0x5685f3(0x120)+_0x3fa3a9[_0x5685f3(0x189)]+_0x5685f3(0xfa));}catch(_0x506e5d){warn(_0x5685f3(0x116)+_0x5685f3(0x1fc)+_0x5685f3(0x12a)+_0x5685f3(0x1e7)+':\x20'+(_0x506e5d?.['message']||_0x506e5d));}}async function loadGroupDefaultsCache(){const _0x17092a=_0x1e4243;try{const _0x33ffb1=await getDb(),_0x3a969b=await _0x33ffb1[_0x17092a(0x105)]('SELECT\x20gro'+_0x17092a(0x1c3)+_0x17092a(0x147)+_0x17092a(0x192)+'s');groupDefaultsCache['clear']();if(!_0x3a969b||!_0x3a969b[_0x17092a(0x189)]){info(_0x17092a(0x116)+'n]\x20group\x20d'+_0x17092a(0x1e6)+'che\x20loaded'+'\x20(0\x20rows)');return;}for(const _0x182577 of _0x3a969b){try{const _0x3c7f8c=String(_0x182577[_0x17092a(0x1a1)]),_0xd42cfe=safeParseJSON(_0x182577[_0x17092a(0x113)]),_0x39d8a6=Array[_0x17092a(0x124)](_0xd42cfe)?_0xd42cfe[_0x17092a(0x15c)](String):[];groupDefaultsCache['set'](_0x3c7f8c,_0x39d8a6);}catch(_0x176b79){}}info(_0x17092a(0x116)+_0x17092a(0xfc)+'efaults\x20ca'+'che\x20loaded'+'\x20('+_0x3a969b[_0x17092a(0x189)]+'\x20rows)');}catch(_0x566ad2){warn(_0x17092a(0x116)+_0x17092a(0xaf)+_0x17092a(0xbd)+_0x17092a(0x125)+_0x17092a(0x10b)+(_0x566ad2?.['message']||_0x566ad2));}}async function loadActiveGroupsCache(){const _0x4dd108=_0x1e4243;try{const _0x29fd74=await getDb(),_0x19b5a4=await _0x29fd74[_0x4dd108(0x105)](_0x4dd108(0x1d1)+_0x4dd108(0x11a)+_0x4dd108(0x12e)+'\x20'+ACTIVE_TABLE);activeGroupByUser['clear']();if(!_0x19b5a4||!_0x19b5a4[_0x4dd108(0x189)]){info(_0x4dd108(0x116)+'n]\x20active\x20'+_0x4dd108(0x1f6)+_0x4dd108(0x167)+_0x4dd108(0x18d));return;}for(const _0x59bfaa of _0x19b5a4){try{activeGroupByUser[_0x4dd108(0x154)](String(_0x59bfaa['user_key']),String(_0x59bfaa[_0x4dd108(0x1a1)]));}catch(_0x292d6a){}}info(_0x4dd108(0x116)+_0x4dd108(0xc4)+'groups\x20cac'+'he\x20loaded\x20'+'('+_0x19b5a4[_0x4dd108(0x189)]+_0x4dd108(0xfa));}catch(_0x4b0c75){warn(_0x4dd108(0x116)+_0x4dd108(0x140)+_0x4dd108(0x205)+_0x4dd108(0xb5)+'d:\x20'+(_0x4b0c75?.[_0x4dd108(0x17e)]||_0x4b0c75));}}export async function refreshCaches(){const _0x2ff72d=_0x1e4243;await ensureSchema(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache(),info('[connectio'+_0x2ff72d(0x21f)+_0x2ff72d(0xc8)+_0x2ff72d(0x1be));}async function ensureActiveGroupsTableAndLoadCaches(){await ensureActiveGroupsTable(),await loadConnectionsCache(),await loadGroupDefaultsCache(),await loadActiveGroupsCache();}function normalizeUserKeyForStorage(_0x40cce9){const _0x39dbe3=_0x1e4243;if(!_0x40cce9)return null;const _0x2386be=String(_0x40cce9)[_0x39dbe3(0x1c0)]();if(!_0x2386be)return null;return _0x2386be[_0x39dbe3(0xc5)]('@')?_0x2386be[_0x39dbe3(0x172)]('@')[0x1f93+0xc36+-0x2bc9]:_0x2386be;}export async function ensureSchema(){const _0x30cf33=_0x1e4243;if(schemaEnsured)return;try{await getDb(),await ensureConnectionsTable(),await ensureGroupDefaultsTable(),await ensureActiveGroupsTable(),await migrateConnectionsChatIdToArray(),await migrateGroupDefaultsNameToArray(),await ensureActiveGroupsTableAndLoadCaches(),schemaEnsured=!![],info('[connectio'+'n]\x20schema\x20'+_0x30cf33(0x132)+'d\x20migratio'+'n\x20complete'+'\x20(arrays-o'+_0x30cf33(0x1a9)+'-scoped).\x20'+_0x30cf33(0x171)+_0x30cf33(0xb9));}catch(_0x3ee540){error(_0x3ee540,_0x30cf33(0x116)+_0x30cf33(0x18a)+_0x30cf33(0x1a0)+_0x30cf33(0x10b)+(_0x3ee540?.[_0x30cf33(0x17e)]||_0x3ee540));throw _0x3ee540;}}export async function initialize(){await ensureSchema();}export async function setActiveGroupForUser(_0x31ba45,_0x3a8308){const _0x37c9c6=_0x1e4243;try{if(!_0x31ba45)return;const _0x261a95=normalizeUserKeyForStorage(_0x31ba45);if(!_0x261a95)return;if(!_0x3a8308){activeGroupByUser[_0x37c9c6(0x228)](_0x261a95);try{const _0x18c36b=await getDb();await _0x18c36b[_0x37c9c6(0x1e5)](_0x37c9c6(0xd9)+'M\x20'+ACTIVE_TABLE+(_0x37c9c6(0x10c)+_0x37c9c6(0xd8)),[_0x261a95]);}catch(_0xae7768){warn(_0x37c9c6(0x116)+_0x37c9c6(0x11c)+_0x37c9c6(0x12d)+_0x37c9c6(0x12c)+_0x37c9c6(0x218)+_0x37c9c6(0x1b0)+(_0xae7768?.[_0x37c9c6(0x17e)]||_0xae7768));}return;}const _0x5c0850=String(_0x3a8308);activeGroupByUser[_0x37c9c6(0x154)](_0x261a95,_0x5c0850);try{const _0x24ce6f=await getDb();await _0x24ce6f[_0x37c9c6(0x1e5)](_0x37c9c6(0x129)+'O\x20'+ACTIVE_TABLE+(_0x37c9c6(0x1f7)+',\x20group_id'+_0x37c9c6(0x152)+_0x37c9c6(0x165)+'\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+'\x20\x20\x20\x20\x20\x20\x20\x20ON'+'\x20CONFLICT('+_0x37c9c6(0x150)+'DO\x20UPDATE\x20'+_0x37c9c6(0x1ab)+_0x37c9c6(0x166)+_0x37c9c6(0x223)+'id'),[_0x261a95,_0x5c0850]);}catch(_0x59207b){warn('[connectio'+_0x37c9c6(0x11c)+_0x37c9c6(0x12d)+'\x20active\x20gr'+_0x37c9c6(0xb0)+(_0x59207b?.[_0x37c9c6(0x17e)]||_0x59207b));}}catch(_0x3131fb){warn(_0x37c9c6(0x116)+'n]\x20setActi'+'veGroupFor'+_0x37c9c6(0x186)+':\x20'+(_0x3131fb?.['message']||_0x3131fb));}}export function getActiveGroupForUser(_0x48424b){const _0x2d2453=_0x1e4243;try{if(!_0x48424b)return null;const _0x3b40df=normalizeUserKeyForStorage(_0x48424b);if(!_0x3b40df)return null;return activeGroupByUser[_0x2d2453(0x17d)](_0x3b40df)||null;}catch(_0x3af1e8){return warn('[connectio'+'n]\x20getActi'+_0x2d2453(0x1f0)+_0x2d2453(0x186)+':\x20'+(_0x3af1e8?.[_0x2d2453(0x17e)]||_0x3af1e8)),null;}}export async function addConnection(_0x41e651,_0x3e31f1,_0x4340f7='',_0x351c53=''){const _0x574091=_0x1e4243;try{await ensureSchema();const _0x20a367=await getDb(),_0xd5a100=String(_0x351c53||''),_0x2a301c=await _0x20a367['get'](_0x574091(0x1df)+'t_id\x20FROM\x20'+'connection'+_0x574091(0x115)+_0x574091(0x16d)+'\x20group_id\x20'+_0x574091(0xc0),[String(_0x41e651),_0xd5a100]);if(!_0x2a301c){const _0x19421e=[String(_0x3e31f1)];await _0x20a367[_0x574091(0x1e5)](_0x574091(0x129)+_0x574091(0xc2)+'ons\x20(name,'+_0x574091(0x149)+_0x574091(0x155)+_0x574091(0x203)+_0x574091(0x152)+_0x574091(0x187)+')',[String(_0x41e651),_0xd5a100,stringifyArray(_0x19421e),String(_0x4340f7||'')]),info(_0x574091(0x116)+_0x574091(0xdb)+':\x20'+_0x41e651+'\x20->\x20'+_0x3e31f1+_0x574091(0x196)+_0x4340f7+_0x574091(0x221)+_0xd5a100);if(!connectionsCache[_0x574091(0x21b)](_0xd5a100))connectionsCache[_0x574091(0x154)](_0xd5a100,new Map());const _0x2aee9e=connectionsCache[_0x574091(0x17d)](_0xd5a100);return _0x2aee9e[_0x574091(0x154)](String(_0x41e651),{'name':String(_0x41e651),'chat_id':_0x19421e[_0x574091(0x15c)](String),'creator_id':String(_0x4340f7||'')}),!![];}else{const _0x148655=parseArrayStrict(_0x2a301c['chat_id']);if(!_0x148655[_0x574091(0xc5)](String(_0x3e31f1)))_0x148655[_0x574091(0x1b2)](String(_0x3e31f1));await _0x20a367[_0x574091(0x1e5)](_0x574091(0xee)+_0x574091(0xff)+_0x574091(0x1ea)+'\x20=\x20?,\x20crea'+'tor_id\x20=\x20?'+'\x20WHERE\x20nam'+'e\x20=\x20?\x20AND\x20'+'group_id\x20='+'\x20?',[stringifyArray(_0x148655),String(_0x4340f7||''),String(_0x41e651),_0xd5a100]),info(_0x574091(0x116)+_0x574091(0xe5)+':\x20'+_0x41e651+_0x574091(0xdc)+_0x148655[_0x574091(0xca)](',')+_0x574091(0x16e)+_0xd5a100);if(!connectionsCache[_0x574091(0x21b)](_0xd5a100))connectionsCache[_0x574091(0x154)](_0xd5a100,new Map());const _0x1513fd=connectionsCache[_0x574091(0x17d)](_0xd5a100);return _0x1513fd[_0x574091(0x154)](String(_0x41e651),{'name':String(_0x41e651),'chat_id':_0x148655[_0x574091(0x15c)](String),'creator_id':String(_0x4340f7||'')}),!![];}}catch(_0x5d2bd7){return error(_0x5d2bd7,_0x574091(0x116)+_0x574091(0xde)+'ection\x20fai'+_0x574091(0xe8)+_0x41e651+'\x20@\x20'+_0x351c53),![];}}export async function deleteConnectionScoped(_0x4845da,_0x422f4e=''){const _0x336488=_0x1e4243;try{await ensureSchema();const _0x383c43=await getDb(),_0x587c1b=await _0x383c43[_0x336488(0x1e5)](_0x336488(0xd9)+_0x336488(0x1c4)+_0x336488(0x213)+_0x336488(0x182)+_0x336488(0xda)+'d\x20=\x20?',[String(_0x4845da),String(_0x422f4e||'')]),_0x1350f5=_0x587c1b&&(_0x587c1b[_0x336488(0x222)]===undefined?!![]:!!_0x587c1b[_0x336488(0x222)]);info('[connectio'+'n]\x20deleteC'+_0x336488(0x1ee)+_0x336488(0x1a7)+_0x4845da+_0x336488(0x19e)+_0x422f4e+_0x336488(0x1d8)+_0x1350f5+')');try{const _0x5508fa=String(_0x422f4e||'');if(connectionsCache[_0x336488(0x21b)](_0x5508fa)){const _0x44cc36=connectionsCache['get'](_0x5508fa);if(_0x44cc36)_0x44cc36[_0x336488(0x228)](String(_0x4845da));}}catch(_0x888e12){}return _0x1350f5;}catch(_0x277ec6){return error(_0x277ec6,'[connectio'+_0x336488(0xce)+'onnectionS'+_0x336488(0xe7)+_0x336488(0x10b)+_0x4845da+_0x336488(0x19e)+_0x422f4e),![];}}function _0x15e4(_0x5b13a2,_0x1ca4e9){const _0x1ebc2c=_0x5aea();return _0x15e4=function(_0x4f50c3,_0x2c948b){_0x4f50c3=_0x4f50c3-(-0x32*-0x23+-0x1*0x1fb6+-0x198b*-0x1);let _0x51fdd6=_0x1ebc2c[_0x4f50c3];return _0x51fdd6;},_0x15e4(_0x5b13a2,_0x1ca4e9);}export async function deleteConnectionsByCreatorInGroup(_0x26cbf7,_0x2d07f7=''){const _0x8de406=_0x1e4243;try{await ensureSchema();const _0x23d148=await getDb(),_0x5743c3=await _0x23d148[_0x8de406(0x1e5)]('DELETE\x20FRO'+_0x8de406(0x1c4)+_0x8de406(0x213)+_0x8de406(0x203)+_0x8de406(0xbe)+_0x8de406(0x142)+'?',[String(_0x26cbf7),String(_0x2d07f7||'')]),_0x4d1126=_0x5743c3&&(_0x5743c3[_0x8de406(0x222)]===undefined?!![]:_0x5743c3['changes'])||-0x123e+-0x6b*-0x2f+-0x167;info(_0x8de406(0x116)+'n]\x20deleteC'+_0x8de406(0x188)+_0x8de406(0x1db)+_0x8de406(0x157)+_0x26cbf7+_0x8de406(0x19e)+_0x2d07f7+_0x8de406(0x1d8)+_0x4d1126+')');try{const _0x423065=String(_0x2d07f7||'');if(connectionsCache[_0x8de406(0x21b)](_0x423065)){const _0x504cb3=connectionsCache[_0x8de406(0x17d)](_0x423065);for(const [_0x46feff,_0x23e4fe]of Array[_0x8de406(0xcf)](_0x504cb3['entries']())){if(String(_0x23e4fe[_0x8de406(0x203)])===String(_0x26cbf7))_0x504cb3[_0x8de406(0x228)](_0x46feff);}}}catch(_0x4a69cb){}return _0x4d1126;}catch(_0x9cfcdf){return error(_0x9cfcdf,_0x8de406(0x116)+_0x8de406(0xce)+_0x8de406(0x188)+'ByCreatorI'+_0x8de406(0xb7)+_0x8de406(0x1c9)+(_0x9cfcdf?.['message']||_0x9cfcdf)),-0xcc0+0x4b+0xc75*0x1;}}export async function removeChatIdsFromConnectionScoped(_0x15b31c,_0xd01575,_0x768211=''){const _0x493941=_0x1e4243;try{if(!_0x15b31c)return![];await ensureSchema();const _0x512533=await getDb(),_0x1c1c53=await _0x512533['get']('SELECT\x20cha'+'t_id\x20FROM\x20'+_0x493941(0x1a5)+_0x493941(0x115)+_0x493941(0x16d)+'\x20group_id\x20'+_0x493941(0xc0),[String(_0x15b31c),String(_0x768211||'')]);if(!_0x1c1c53)return![];const _0x30f16c=parseArrayStrict(_0x1c1c53[_0x493941(0x1b6)]),_0x34b4e0=Array[_0x493941(0x124)](_0xd01575)?_0xd01575[_0x493941(0x15c)](String):[String(_0xd01575)],_0x495f68=_0x30f16c[_0x493941(0x1de)](_0xd4f13e=>!_0x34b4e0[_0x493941(0xc5)](_0xd4f13e));if(_0x495f68['length']===-0x2*0x327+0xe09+-0x7bb){await _0x512533['run']('DELETE\x20FRO'+'M\x20connecti'+'ons\x20WHERE\x20'+'name\x20=\x20?\x20A'+_0x493941(0xda)+_0x493941(0x161),[String(_0x15b31c),String(_0x768211||'')]),info(_0x493941(0x116)+_0x493941(0x20f)+_0x493941(0x214)+_0x493941(0xbf)+_0x493941(0x11d)+_0x493941(0x139)+_0x493941(0x1cc)+'r\x20'+_0x15b31c+'\x20@\x20'+_0x768211+(_0x493941(0x1b3)+_0x493941(0x21a)));try{const _0x22e395=String(_0x768211||'');if(connectionsCache['has'](_0x22e395))connectionsCache[_0x493941(0x17d)](_0x22e395)[_0x493941(0x228)](String(_0x15b31c));}catch(_0x4009aa){}return!![];}else{await _0x512533['run'](_0x493941(0xee)+'nections\x20S'+_0x493941(0x1ea)+'\x20=\x20?\x20WHERE'+_0x493941(0xdf)+_0x493941(0x15d)+_0x493941(0xc9),[stringifyArray(_0x495f68),String(_0x15b31c),String(_0x768211||'')]),info(_0x493941(0x116)+_0x493941(0x20f)+_0x493941(0x214)+_0x493941(0xbf)+_0x493941(0x14a)+_0x15b31c+'@'+_0x768211+'\x20now\x20->\x20'+_0x495f68[_0x493941(0xca)](','));try{const _0x16e8ed=String(_0x768211||'');if(!connectionsCache[_0x493941(0x21b)](_0x16e8ed))connectionsCache[_0x493941(0x154)](_0x16e8ed,new Map());connectionsCache['get'](_0x16e8ed)[_0x493941(0x154)](String(_0x15b31c),{'name':String(_0x15b31c),'chat_id':_0x495f68['map'](String),'creator_id':connectionsCache[_0x493941(0x17d)](_0x16e8ed)[_0x493941(0x17d)](String(_0x15b31c))?.[_0x493941(0x203)]||''});}catch(_0x2d51e2){}return!![];}}catch(_0x3e8c05){return error(_0x3e8c05,'[connectio'+_0x493941(0x20f)+'hatIdsFrom'+'Connection'+_0x493941(0x11b)+'led:\x20'+(_0x3e8c05?.[_0x493941(0x17e)]||_0x3e8c05)),![];}}export async function listConnectionsForGroup(_0x366c5f){const _0x293088=_0x1e4243;try{await ensureSchema();const _0x200b8f=String(_0x366c5f||'');if(connectionsCache['has'](_0x200b8f)){const _0x43d096=connectionsCache[_0x293088(0x17d)](_0x200b8f);return Array[_0x293088(0xcf)](_0x43d096[_0x293088(0x10e)]())[_0x293088(0x15c)](_0x2b95b6=>({'name':_0x2b95b6[_0x293088(0x113)],'chat_id':Array[_0x293088(0x124)](_0x2b95b6[_0x293088(0x1b6)])?_0x2b95b6[_0x293088(0x1b6)][_0x293088(0x15c)](String):[],'creator_id':_0x2b95b6[_0x293088(0x203)]}));}const _0x3c186c=await getDb(),_0x3a3d90=await _0x3c186c[_0x293088(0x105)](_0x293088(0xcd)+'e,\x20chat_id'+_0x293088(0xb1)+_0x293088(0xd7)+'nnections\x20'+_0x293088(0x138)+_0x293088(0x1b1)+'RDER\x20BY\x20na'+'me',[_0x200b8f]);return(_0x3a3d90||[])['map'](_0x177202=>({'name':_0x177202['name'],'chat_id':parseArrayStrict(_0x177202[_0x293088(0x1b6)]),'creator_id':_0x177202[_0x293088(0x203)]}));}catch(_0x1d449d){return error(_0x1d449d,'[connectio'+_0x293088(0x1b4)+_0x293088(0x193)+_0x293088(0x13b)+_0x293088(0x1c9)+(_0x1d449d?.[_0x293088(0x17e)]||_0x1d449d)),[];}}export async function listConnectionsForUser(_0x457794,_0x1ed582=null){const _0x3903af=_0x1e4243;try{await ensureSchema();const _0x4a03a3=await getDb();if(_0x1ed582){const _0x596cd5=await _0x4a03a3[_0x3903af(0x105)](_0x3903af(0xcd)+'e,\x20chat_id'+_0x3903af(0xb1)+_0x3903af(0xd7)+_0x3903af(0x1d2)+'WHERE\x20crea'+'tor_id\x20=\x20?'+_0x3903af(0xf3)+'_id\x20=\x20?\x20OR'+'DER\x20BY\x20nam'+'e',[String(_0x457794),String(_0x1ed582)]);return(_0x596cd5||[])[_0x3903af(0x15c)](_0x1808c7=>({'name':_0x1808c7[_0x3903af(0x113)],'chat_id':parseArrayStrict(_0x1808c7['chat_id']),'creator_id':_0x1808c7[_0x3903af(0x203)]}));}else{const _0x1c53cb=await _0x4a03a3[_0x3903af(0x105)](_0x3903af(0xcd)+_0x3903af(0x180)+_0x3903af(0xb1)+_0x3903af(0xfe)+_0x3903af(0xd7)+_0x3903af(0x1d2)+_0x3903af(0x1f2)+'tor_id\x20=\x20?'+_0x3903af(0x1ec)+_0x3903af(0x146)+_0x3903af(0x113),[String(_0x457794)]);return(_0x1c53cb||[])[_0x3903af(0x15c)](_0x58038e=>({'name':_0x58038e['name'],'chat_id':parseArrayStrict(_0x58038e[_0x3903af(0x1b6)]),'creator_id':_0x58038e[_0x3903af(0x203)],'group_id':_0x58038e[_0x3903af(0x1a1)]}));}}catch(_0x54144b){return error(_0x54144b,_0x3903af(0x116)+'n]\x20listCon'+_0x3903af(0x193)+_0x3903af(0xf5)+'ed'),[];}}export async function listAllConnections(){const _0x342a41=_0x1e4243;try{await ensureSchema();const _0x52040f=await getDb(),_0x245fa2=await _0x52040f[_0x342a41(0x105)](_0x342a41(0xcd)+'e,\x20chat_id'+_0x342a41(0xb1)+_0x342a41(0xfe)+'id\x20FROM\x20co'+_0x342a41(0x1d2)+_0x342a41(0x20d)+'roup_id,\x20n'+_0x342a41(0xe2));return(_0x245fa2||[])[_0x342a41(0x15c)](_0x18a20c=>({'name':_0x18a20c[_0x342a41(0x113)],'chat_id':parseArrayStrict(_0x18a20c[_0x342a41(0x1b6)]),'creator_id':_0x18a20c['creator_id'],'group_id':_0x18a20c['group_id']}));}catch(_0x9514ec){return error(_0x9514ec,'[connectio'+'n]\x20listAll'+_0x342a41(0xbf)+_0x342a41(0x177)),[];}}export async function getConnectionScoped(_0x452014,_0x329c8d=''){const _0x169518=_0x1e4243;try{await ensureSchema();const _0x5990ce=String(_0x329c8d||'');if(connectionsCache[_0x169518(0x21b)](_0x5990ce)&&connectionsCache[_0x169518(0x17d)](_0x5990ce)[_0x169518(0x21b)](String(_0x452014)))return connectionsCache[_0x169518(0x17d)](_0x5990ce)[_0x169518(0x17d)](String(_0x452014))['chat_id']['slice']();const _0x12855b=await getDb(),_0x52cd4b=await _0x12855b[_0x169518(0x17d)](_0x169518(0x1df)+_0x169518(0x118)+_0x169518(0x1a5)+'s\x20WHERE\x20na'+_0x169518(0x16d)+_0x169518(0x209)+_0x169518(0xc0),[String(_0x452014),_0x5990ce]);if(!_0x52cd4b)return null;return parseArrayStrict(_0x52cd4b[_0x169518(0x1b6)]);}catch(_0x241ab5){return error(_0x241ab5,_0x169518(0x116)+_0x169518(0x1af)+_0x169518(0x173)+'ed('+_0x452014+_0x169518(0x19e)+_0x329c8d+')\x20failed'),null;}}export async function getConnectionRecordScoped(_0x38f609,_0xe0ea16=''){const _0x28ce2f=_0x1e4243;try{await ensureSchema();const _0x1258c7=String(_0xe0ea16||'');if(connectionsCache[_0x28ce2f(0x21b)](_0x1258c7)&&connectionsCache['get'](_0x1258c7)[_0x28ce2f(0x21b)](String(_0x38f609))){const _0x1911da=connectionsCache['get'](_0x1258c7)[_0x28ce2f(0x17d)](String(_0x38f609));return{'name':_0x1911da['name'],'chat_id':_0x1911da[_0x28ce2f(0x1b6)][_0x28ce2f(0x107)](),'creator_id':_0x1911da['creator_id']};}const _0x389b54=await getDb(),_0x4f2d3d=await _0x389b54[_0x28ce2f(0x17d)](_0x28ce2f(0xcd)+_0x28ce2f(0x180)+_0x28ce2f(0xb1)+_0x28ce2f(0xd7)+_0x28ce2f(0x1d2)+_0x28ce2f(0x159)+_0x28ce2f(0xbe)+_0x28ce2f(0x142)+'?',[String(_0x38f609),_0x1258c7]);if(!_0x4f2d3d)return null;return{'name':_0x4f2d3d[_0x28ce2f(0x113)],'chat_id':parseArrayStrict(_0x4f2d3d[_0x28ce2f(0x1b6)]),'creator_id':_0x4f2d3d['creator_id']};}catch(_0x1d9fcb){return error(_0x1d9fcb,_0x28ce2f(0x116)+_0x28ce2f(0x1af)+'ectionReco'+'rdScoped('+_0x38f609+_0x28ce2f(0x19e)+_0xe0ea16+')\x20failed'),null;}}export async function getConnectionName(_0x400f8f){const _0x8bc240=_0x1e4243;try{await ensureSchema();for(const [_0x1c5bcb,_0x242cdf]of connectionsCache[_0x8bc240(0x16f)]()){for(const [_0x1beabe,_0x400364]of _0x242cdf['entries']()){if(Array[_0x8bc240(0x124)](_0x400364[_0x8bc240(0x1b6)])&&_0x400364[_0x8bc240(0x1b6)][_0x8bc240(0xc5)](String(_0x400f8f)))return _0x1beabe;}}const _0x3c159=await getDb(),_0x520015=await _0x3c159[_0x8bc240(0x105)]('SELECT\x20nam'+_0x8bc240(0x180)+_0x8bc240(0x1a2)+_0x8bc240(0x133));for(const _0x3f7aac of _0x520015||[]){const _0x1574f3=parseArrayStrict(_0x3f7aac[_0x8bc240(0x1b6)]);if(_0x1574f3['includes'](String(_0x400f8f)))return _0x3f7aac[_0x8bc240(0x113)];}return null;}catch(_0x452e08){return error(_0x452e08,'[connectio'+_0x8bc240(0x1af)+_0x8bc240(0x128)+'('+_0x400f8f+')\x20failed'),null;}}export async function setDefaultGroup(_0x1c4cde,_0x656d4){const _0x1e582b=_0x1e4243;try{await ensureSchema();const _0x265cc4=await getDb();if(!_0x656d4)throw new Error(_0x1e582b(0x1b8)+_0x1e582b(0xb4)+_0x1e582b(0x156)+_0x1e582b(0x15b));if(!_0x1c4cde||Array['isArray'](_0x1c4cde)&&_0x1c4cde['length']===0x1866+-0xdb*-0x15+-0x2a5d)return await _0x265cc4['run']('DELETE\x20FRO'+_0x1e582b(0x1f9)+_0x1e582b(0x1a3)+'RE\x20group_i'+_0x1e582b(0x161),[String(_0x656d4)]),groupDefaultsCache[_0x1e582b(0x228)](String(_0x656d4)),info(_0x1e582b(0x116)+_0x1e582b(0xfc)+'efault\x20cle'+_0x1e582b(0x217)+_0x656d4),!![];let _0x20fb73=[];if(typeof _0x1c4cde===_0x1e582b(0x1f8)&&_0x1c4cde[_0x1e582b(0x151)+'e']()===_0x1e582b(0x105)){const _0x4d1aad=await listConnectionsForGroup(String(_0x656d4));_0x20fb73=(_0x4d1aad||[])['map'](_0x56458b=>_0x56458b[_0x1e582b(0x113)])[_0x1e582b(0x1de)](Boolean);if(!_0x20fb73['length'])throw new Error('No\x20connect'+'ions\x20found'+_0x1e582b(0x17b)+'\x20all');}else{if(Array[_0x1e582b(0x124)](_0x1c4cde))_0x20fb73=_0x1c4cde[_0x1e582b(0x15c)](String)['filter'](Boolean);else{if(typeof _0x1c4cde===_0x1e582b(0x1f8)){if(_0x1c4cde[_0x1e582b(0xc5)](','))_0x20fb73=_0x1c4cde[_0x1e582b(0x172)](',')['map'](_0x293ada=>_0x293ada[_0x1e582b(0x1c0)]())[_0x1e582b(0x1de)](Boolean);else _0x20fb73=[_0x1c4cde];}else throw new Error(_0x1e582b(0x1fa)+_0x1e582b(0x1b5)+_0x1e582b(0x164)+_0x1e582b(0x1fe)+'aultGroup');}}if(!_0x20fb73[_0x1e582b(0x189)])throw new Error(_0x1e582b(0xad)+'onnection\x20'+_0x1e582b(0x158)+_0x1e582b(0x110)+_0x1e582b(0x1f3)+_0x1e582b(0xed));const _0x547176=[];for(const _0x1356cf of _0x20fb73){const _0x22a8a0=await _0x265cc4['get'](_0x1e582b(0x114)+'ROM\x20connec'+_0x1e582b(0x13a)+'E\x20name\x20=\x20?'+'\x20AND\x20group'+'_id\x20=\x20?',[String(_0x1356cf),String(_0x656d4)]);if(_0x22a8a0)_0x547176[_0x1e582b(0x1b2)](_0x1356cf);else warn('[connectio'+_0x1e582b(0x195)+_0x1e582b(0x1d7)+_0x1e582b(0x20b)+_0x1e582b(0x169)+_0x1e582b(0x1da)+'on\x20\x22'+_0x1356cf+_0x1e582b(0x1aa)+_0x656d4);}if(!_0x547176[_0x1e582b(0x189)])throw new Error('None\x20of\x20th'+'e\x20provided'+_0x1e582b(0xb2)+'n\x20names\x20ex'+_0x1e582b(0x1ac)+_0x1e582b(0x1bb));return await _0x265cc4[_0x1e582b(0x1e5)](_0x1e582b(0x129)+_0x1e582b(0x185)+_0x1e582b(0x13f)+_0x1e582b(0xba)+_0x1e582b(0x1cf)+'\x20(?,\x20?)\x0a\x20\x20'+_0x1e582b(0x127)+_0x1e582b(0x179)+_0x1e582b(0x17a)+'UPDATE\x20SET'+'\x20name\x20=\x20ex'+_0x1e582b(0x12f)+'e;',[String(_0x656d4),JSON[_0x1e582b(0x176)](_0x547176)]),groupDefaultsCache['set'](String(_0x656d4),_0x547176[_0x1e582b(0x107)]()),info(_0x1e582b(0x116)+_0x1e582b(0xfc)+'efault\x20set'+_0x1e582b(0x134)+_0x656d4+_0x1e582b(0xdc)+JSON[_0x1e582b(0x176)](_0x547176)),!![];}catch(_0x4a248b){return error(_0x4a248b,_0x1e582b(0x116)+'n]\x20setDefa'+_0x1e582b(0xe4)+_0x1e582b(0xf4)+_0x656d4+':\x20'+(_0x4a248b?.[_0x1e582b(0x17e)]||_0x4a248b)),![];}}export async function getDefaultForGroup(_0x5828e8){const _0x2946be=_0x1e4243;try{await ensureSchema();if(!_0x5828e8)return null;const _0x212d6f=String(_0x5828e8);if(groupDefaultsCache['has'](_0x212d6f)){const _0x5aa080=groupDefaultsCache[_0x2946be(0x17d)](_0x212d6f);return Array['isArray'](_0x5aa080)?_0x5aa080[_0x2946be(0x15c)](String):null;}const _0x4af142=await getDb(),_0x431233=await _0x4af142[_0x2946be(0x17d)](_0x2946be(0xcd)+'e\x20FROM\x20gro'+_0x2946be(0x192)+_0x2946be(0x1ae)+_0x2946be(0x108),[_0x212d6f]);if(!_0x431233||!_0x431233['name'])return null;try{const _0x23ae7a=JSON[_0x2946be(0xd6)](_0x431233[_0x2946be(0x113)]);if(Array[_0x2946be(0x124)](_0x23ae7a))return groupDefaultsCache[_0x2946be(0x154)](_0x212d6f,_0x23ae7a[_0x2946be(0x15c)](String)),_0x23ae7a[_0x2946be(0x15c)](String);}catch(_0x16da0f){}return null;}catch(_0x55f3c8){return error(_0x55f3c8,_0x2946be(0x116)+'n]\x20getDefa'+_0x2946be(0x11e)+_0x2946be(0x19b)+_0x2946be(0x224)+_0x5828e8),null;}}export async function getDefault(_0x316c45){const _0x4bd757=_0x1e4243;try{await ensureSchema();const _0x207eb3=getActiveGroupForUser(String(_0x316c45));if(!_0x207eb3)return null;return await getDefaultForGroup(_0x207eb3);}catch(_0x11089c){return error(_0x11089c,_0x4bd757(0x116)+_0x4bd757(0xbb)+_0x4bd757(0x170)+_0x4bd757(0x134)+_0x316c45),null;}}export async function getConnection(_0x56863c){const _0x4a8a45=_0x1e4243;try{await ensureSchema();const _0x607e26=await getDb(),_0x8e60fb=await _0x607e26[_0x4a8a45(0x105)](_0x4a8a45(0x1df)+_0x4a8a45(0x118)+_0x4a8a45(0x1a5)+_0x4a8a45(0x115)+_0x4a8a45(0xeb),[String(_0x56863c)]);if(!_0x8e60fb||!_0x8e60fb[_0x4a8a45(0x189)])return null;const _0x1d1a45=[];for(const _0x202d1e of _0x8e60fb){const _0x54d6c9=parseArrayStrict(_0x202d1e[_0x4a8a45(0x1b6)]);for(const _0x4a8434 of _0x54d6c9)if(!_0x1d1a45['includes'](_0x4a8434))_0x1d1a45['push'](_0x4a8434);}return _0x1d1a45;}catch(_0x1bd92a){return error(_0x1bd92a,'[connectio'+_0x4a8a45(0x1af)+_0x4a8a45(0x1dc)+_0x56863c+_0x4a8a45(0x1e0)),null;}}export async function getConnectionRecord(_0x401f88){const _0x219cbe=_0x1e4243;try{await ensureSchema();const _0x5c8e3e=await getDb(),_0x45667d=await _0x5c8e3e[_0x219cbe(0x17d)](_0x219cbe(0xcd)+_0x219cbe(0x180)+_0x219cbe(0xb1)+_0x219cbe(0xfe)+_0x219cbe(0xd7)+_0x219cbe(0x1d2)+_0x219cbe(0x159)+_0x219cbe(0x207)+'\x201',[String(_0x401f88)]);if(!_0x45667d)return null;return{'name':_0x45667d['name'],'chat_id':parseArrayStrict(_0x45667d[_0x219cbe(0x1b6)]),'creator_id':_0x45667d[_0x219cbe(0x203)],'group_id':_0x45667d[_0x219cbe(0x1a1)]};}catch(_0x550dee){return error(_0x550dee,_0x219cbe(0x116)+_0x219cbe(0x1af)+_0x219cbe(0x1c2)+_0x219cbe(0x163)+_0x401f88+_0x219cbe(0x1e0)),null;}}export default{'ensureSchema':ensureSchema,'initialize':initialize,'addConnection':addConnection,'deleteConnectionScoped':deleteConnectionScoped,'deleteConnectionsByCreatorInGroup':deleteConnectionsByCreatorInGroup,'removeChatIdsFromConnectionScoped':removeChatIdsFromConnectionScoped,'listConnectionsForUser':listConnectionsForUser,'listConnectionsForGroup':listConnectionsForGroup,'listAllConnections':listAllConnections,'getConnection':getConnection,'getConnectionName':getConnectionName,'getConnectionRecord':getConnectionRecord,'getConnectionRecordScoped':getConnectionRecordScoped,'getConnectionScoped':getConnectionScoped,'setDefaultGroup':setDefaultGroup,'getDefaultForGroup':getDefaultForGroup,'getDefault':getDefault,'setActiveGroupForUser':setActiveGroupForUser,'getActiveGroupForUser':getActiveGroupForUser,'refreshCaches':refreshCaches,'_internalCaches':{'connectionsCache':connectionsCache,'groupDefaultsCache':groupDefaultsCache,'activeGroupByUser':activeGroupByUser}};