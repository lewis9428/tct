const _0x4e7c03=_0x4193;(function(_0x56ca22,_0x2148ed){const _0x47d14c=_0x4193,_0x3f9aa6=_0x56ca22();while(!![]){try{const _0x38831b=parseInt(_0x47d14c(0x1dd))/(0x1f5e+0x49+-0x1fa6*0x1)+parseInt(_0x47d14c(0x176))/(-0x1465+0x1*0x207b+-0x2*0x60a)+parseInt(_0x47d14c(0x19d))/(-0xbb7*-0x3+-0x26d6+0x3b4)*(-parseInt(_0x47d14c(0x1f5))/(0x1d78+-0x1*0x136b+-0x16f*0x7))+parseInt(_0x47d14c(0x243))/(0x2338+-0x545+-0x1dee)*(-parseInt(_0x47d14c(0x1e5))/(-0x1*0x1dd6+0x1*-0x2323+0x7*0x949))+-parseInt(_0x47d14c(0x195))/(0xe5e+0x1*-0x2479+-0xb11*-0x2)+-parseInt(_0x47d14c(0x229))/(-0x1*0x23f3+-0x6d*-0xb+0x1f4c)*(-parseInt(_0x47d14c(0x1c9))/(-0xa31+-0xd*0x1c3+0x2121))+-parseInt(_0x47d14c(0x1c2))/(-0x1b*0xa5+-0xf73*0x1+0x20e4)*(-parseInt(_0x47d14c(0x1c7))/(-0xa5d+0x1c68+-0x1200));if(_0x38831b===_0x2148ed)break;else _0x3f9aa6['push'](_0x3f9aa6['shift']());}catch(_0x1c8df3){_0x3f9aa6['push'](_0x3f9aa6['shift']());}}}(_0x2dfb,0x17912+-0x1*-0x1ff01+0xed57*-0x1));import _0x118cf2 from'fs';import _0x3c1cb2 from'path';import{downloadContentFromMessage}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,findConfigFile,PROJECT_ROOT}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';import{userJidFromCtx,listSudo,normalizeToJid}from'../utils/sudo.js';import{shutdownDatabase,initializeDatabase}from'../utils/database.js';export const name=_0x4e7c03(0x220);export const version=_0x4e7c03(0x1b9);function _0x2dfb(){const _0x268c34=['❌\x20Accepted','n\x20path.','DB_PATH','text','extendedTe','DB\x20from\x20ba','o\x20send\x20con','jid','kup\x20after\x20','\x20could\x20not','config.yml','xtMessage','b\x20at\x20','error','te\x20DB\x20(hea','d\x20config\x20f','clear','after\x20getd','1685222KvalXn','\x20from\x20','der\x20mismat','\x27\x20authoriz','\x20database\x20','\x20not\x20appea','resolve','\x20setconfig','3TtXiYj','fromMe','trim','ompleted\x20f','bot.db','e-check\x20an','wnload','DB_NAME','❌\x20Invalid\x20','@g.us','concat','nsions:\x20.y','image','ssage','client','o\x20restore\x20','uploaded\x20D','\x20found:\x20','\x20and\x20DB\x20re','length','\x20failed','❌\x20Failed\x20t','lidation\x20f','o\x20error\x20du','destinatio','\x20media\x20has','includes','existsSync','2.5.0','shutdown\x20c','d\x20step)','sage','ync','✅\x20Config\x20r','[dbbackup]','getdb','\x20may\x20be\x20re','120JWhVhH','\x20expired\x20o','message','config.jso','\x20quick\x20cop','412819lcjLkn','\x20DB\x20reinit','3708MDGBMC','document','y\x20failed:\x20','\x0aNote:\x20A\x20b','the\x20file\x20a','.yaml','join','o\x20save\x20con','mediaMsg','ialized\x20af','❌\x20Could\x20no','file:\x20','DB\x20backed\x20','copyFileSy','ascii','\x20create\x20DB','eply\x20to\x20a\x20','\x20to\x20','\x20remove\x20ol','valid\x20SQLi','21452MCNbOk','❌\x20Uploaded','\x20cleanup\x20e','ill\x20be\x20val','sendMessag','was\x20made.','en\x20DB\x20file','etdb','424962NvoAgZ','ailable.','ck\x20up\x20new\x20','failed','function','runtime-co','nce\x20not\x20av','\x0aAn\x20attemp','extname','er:\x20\x22SQLit','documentMe','text/x-yam','\x20send\x20fail','rror:\x20','fileName','r:\x20','613684rmenbm','dbbackup.i','eplaced\x20wi','ttach\x20or\x20r','tore\x20faile','config\x20fil','unlinkSync','\x20setdb\x20res','.json','d\x20for\x20','\x20command\x20\x27','startsWith','applicatio','n/octet-st','\x20failed\x20to','ailure','./data/db','eDatabase\x20','ailed','file\x20heade','is\x20is\x20inde','\x20access\x20de','initialize','Message','❌\x20Please\x20a','failed\x20aft','readFileSy','omCtx\x20erro','pe\x20or\x20no\x20m','t\x20validate','\x20and\x20re-in','requires\x20b','\x20initializ','ed\x20recover','key','DB\x20(any\x20ex','replace','ream','delete','has','endsWith','\x20header\x20va','ile:\x20','dbbackup','er\x20attempt','ices\x20to\x20pi','set','B\x20from\x20bac','push','\x20download\x20','nied.','\x20cleaned\x20u','5144sGphBi','\x20file\x20exte','imageMessa','\x20removed\x20o','relative','audioMessa','th:\x20','isCommand','ot\x20instanc','remoteJid','age','⚠️\x20Warning:','ed\x20a\x20DB,\x20r','Expected\x20S','.db','\x20sent\x20DB\x20f','videoMessa','y\x20attempt\x20','map','stickerMes','utf8','n\x20WhatsApp','getconfig','\x20getconfig','isArray','string','20cjIWTm','equals','sock','re-upload\x20','e\x20format\x203','.bak_for_s','d\x20re-uploa','e\x20complete','\x20error:\x20','ld\x20config\x20','toLowerCas','contextInf','video','inalDestFr','er\x20getdb\x20f','slice','from','ml,\x20.yaml,','setdb','d\x20media\x20ty','\x20file\x20does','to\x20downloa','or\x20getdb\x20o','sticker','up\x20to\x20','.yml','mat\x203\x00','n/json','o\x20download','t\x20to\x20recov','file\x20to\x20re',']\x20resolveF','edia\x20to\x20do','\x20onMessage','\x5c0\x22.\x20If\x20th','peration.','DB:\x20','\x20DB:\x20','fig\x20file:\x20','ter\x20getdb\x20','\x0aA\x20recover','✅\x20Active\x20D','214694tPNyyT','\x20uploaded\x20','quotedMess','\x20safeSend\x20','\x20backup:\x20','\x20operation','split','QLite\x20head','\x20at\x20','ed\x20for\x20','mkdirSync','basename','Unsupporte'];_0x2dfb=function(){return _0x268c34;};return _0x2dfb();}export const priority=-0x112e*0x2+-0xb*-0x1ef+0xd85;export const commands=[_0x4e7c03(0x1c0),_0x4e7c03(0x255),_0x4e7c03(0x23f),'setconfig'];let botRef=null,sendApi=null;const DEDUPE_TTL_MS=(0x22be+-0x1576+-0xd3e)*(0x1a3f+0x191*0x3+-0x1b0a),processedMessageKeys=new Map();function markProcessed(_0x357fd5){const _0x27fbc7=_0x4e7c03;if(!_0x357fd5)return;if(processedMessageKeys[_0x27fbc7(0x21c)](_0x357fd5))try{clearTimeout(processedMessageKeys['get'](_0x357fd5));}catch(_0x6a42e){}const _0x5cdbde=setTimeout(()=>processedMessageKeys[_0x27fbc7(0x21b)](_0x357fd5),DEDUPE_TTL_MS);processedMessageKeys[_0x27fbc7(0x223)](_0x357fd5,_0x5cdbde);}function isProcessed(_0x5cf2a6){const _0x5e7a21=_0x4e7c03;return _0x5cf2a6&&processedMessageKeys[_0x5e7a21(0x21c)](_0x5cf2a6);}async function resolveFinalDestFromCtx(_0x45743c){const _0x5e39cb=_0x4e7c03;try{if(!_0x45743c||!_0x45743c[_0x5e39cb(0x217)])return null;const _0x1ceacd=getBotJid(),_0x24368f=Boolean(_0x45743c[_0x5e39cb(0x217)][_0x5e39cb(0x19e)]);if(_0x24368f)return _0x1ceacd||null;const _0x216396=String(_0x45743c['key'][_0x5e39cb(0x232)]||'');if(!_0x216396||_0x216396[_0x5e39cb(0x21d)](_0x5e39cb(0x1a6)))return null;const {findings:_0x3aa2ec}=userJidFromCtx(_0x45743c);if(!Array[_0x5e39cb(0x241)](_0x3aa2ec)||_0x3aa2ec[_0x5e39cb(0x1b0)]===0xd25*0x2+0x4*0x31b+-0x26b6)return null;const _0x3e5159=await listSudo();if(!Array[_0x5e39cb(0x241)](_0x3e5159)||_0x3e5159[_0x5e39cb(0x1b0)]===0x6f6*-0x3+0x86*0x49+0x1154*-0x1)return null;const _0x44c261=new Set(_0x3e5159[_0x5e39cb(0x23b)](_0x61c01a=>String(_0x61c01a)));for(const _0x1387eb of _0x3aa2ec){if(!_0x1387eb?.[_0x5e39cb(0x18a)]||typeof _0x1387eb[_0x5e39cb(0x18a)]!==_0x5e39cb(0x242))continue;let _0xaea77c=null;try{_0xaea77c=normalizeToJid(_0x1387eb[_0x5e39cb(0x18a)]);}catch(_0x4ae276){_0xaea77c=null;}if(_0xaea77c&&_0x44c261['has'](_0xaea77c))return _0xaea77c;const _0x3dc901=(String(_0x1387eb['jid'])['split']('@')[-0x17d9+0x1dfc+0x1*-0x623]||'')[_0x5e39cb(0x17c)](':')[0xf2a+-0x8ce+0x2c*-0x25]||null;if(_0x3dc901)for(const _0x6a8e29 of _0x44c261){const _0x56a761=String(_0x6a8e29)[_0x5e39cb(0x17c)]('@')[0x137b*-0x1+-0x16f0+-0x1*-0x2a6b]||null;if(_0x56a761&&_0x3dc901===_0x56a761)return _0x6a8e29;}if(_0x44c261[_0x5e39cb(0x21c)](_0x1387eb[_0x5e39cb(0x18a)]))return _0x1387eb[_0x5e39cb(0x18a)];}return null;}catch(_0x10c553){return warn('['+name+(_0x5e39cb(0x262)+_0x5e39cb(0x250)+_0x5e39cb(0x210)+_0x5e39cb(0x1f4))+(_0x10c553?.[_0x5e39cb(0x1c4)]||_0x10c553)),null;}}function setupSendApi(_0x3e1315){const _0x375ff6=_0x4e7c03;if(!_0x3e1315)return;if(typeof _0x3e1315[_0x375ff6(0x1e1)+'e']===_0x375ff6(0x1e9))sendApi=async(_0x5d0625,_0x7bfd09)=>await _0x3e1315[_0x375ff6(0x1e1)+'e'](_0x5d0625,_0x7bfd09);else _0x3e1315[_0x375ff6(0x245)]&&typeof _0x3e1315[_0x375ff6(0x245)][_0x375ff6(0x1e1)+'e']===_0x375ff6(0x1e9)?sendApi=async(_0x3305da,_0x25551a)=>await _0x3e1315[_0x375ff6(0x245)][_0x375ff6(0x1e1)+'e'](_0x3305da,_0x25551a):sendApi=null;}async function safeSend(_0x147e12,_0x387acb){const _0x219cf2=_0x4e7c03;try{if(!_0x147e12||!_0x387acb)return;if(sendApi)return await sendApi(_0x147e12,_0x387acb);warn(_0x219cf2(0x1bf)+'\x20no\x20send\x20s'+'urface\x20ava'+'ilable');}catch(_0x5655e5){error(_0x5655e5,_0x219cf2(0x1bf)+_0x219cf2(0x179)+_0x219cf2(0x1e8)),warn('[dbbackup]'+_0x219cf2(0x179)+'failed:\x20'+(_0x5655e5?.['message']||_0x5655e5));}}function resolveDbDir(){const _0x46e4df=_0x4e7c03,_0x541e15=getConfig(),_0x1dbc11=_0x541e15&&_0x541e15[_0x46e4df(0x185)]?_0x541e15['DB_PATH']:_0x46e4df(0x205),_0x46e45d=_0x3c1cb2['isAbsolute'](_0x1dbc11)?_0x3c1cb2[_0x46e4df(0x19b)](_0x1dbc11):_0x3c1cb2[_0x46e4df(0x19b)](PROJECT_ROOT,_0x1dbc11);return _0x46e45d;}function ensureInside(_0x1da4de,_0x4b14ac){const _0x4144c9=_0x4e7c03,_0x4f79b8=_0x3c1cb2['resolve'](_0x1da4de)+_0x3c1cb2['sep'],_0x8f69b4=_0x3c1cb2[_0x4144c9(0x19b)](_0x4b14ac);return _0x8f69b4[_0x4144c9(0x200)](_0x4f79b8);}function getMediaFromMessage(_0x3bfe91){const _0x3f3d3e=_0x4e7c03;if(!_0x3bfe91)return null;if(_0x3bfe91[_0x3f3d3e(0x1ef)+_0x3f3d3e(0x1aa)]){const _0x57f5a6=_0x3bfe91[_0x3f3d3e(0x1ef)+_0x3f3d3e(0x1aa)];return{'type':_0x3f3d3e(0x1ca),'mediaMsg':_0x3bfe91,'fileName':_0x57f5a6[_0x3f3d3e(0x1f3)]||null,'caption':_0x57f5a6['caption']||null};}if(_0x3bfe91[_0x3f3d3e(0x22b)+'ge']||_0x3bfe91[_0x3f3d3e(0x239)+'ge']||_0x3bfe91[_0x3f3d3e(0x22e)+'ge']||_0x3bfe91[_0x3f3d3e(0x23c)+_0x3f3d3e(0x1bc)]){const _0x55316c=[_0x3f3d3e(0x22b)+'ge',_0x3f3d3e(0x239)+'ge','audioMessa'+'ge',_0x3f3d3e(0x23c)+_0x3f3d3e(0x1bc)];for(const _0xf9ca73 of _0x55316c){if(_0x3bfe91[_0xf9ca73])return{'type':_0xf9ca73[_0x3f3d3e(0x219)](_0x3f3d3e(0x20c),''),'mediaMsg':_0x3bfe91,'fileName':null,'caption':null};}}return null;}function getQuotedMedia(_0x5c1e90){const _0xc3a5ed=_0x4e7c03,_0x580189=_0x5c1e90['message']&&_0x5c1e90['message']['extendedTe'+_0xc3a5ed(0x18e)];if(!_0x580189||!_0x580189[_0xc3a5ed(0x24e)+'o']||!_0x580189['contextInf'+'o'][_0xc3a5ed(0x178)+_0xc3a5ed(0x233)])return null;const _0x2bcb46=_0x580189[_0xc3a5ed(0x24e)+'o'][_0xc3a5ed(0x178)+_0xc3a5ed(0x233)];return getMediaFromMessage(_0x2bcb46);}function _0x4193(_0xeb30d9,_0x50a3a2){const _0x4e9a72=_0x2dfb();return _0x4193=function(_0x5c0224,_0x49a66f){_0x5c0224=_0x5c0224-(0x20fe+-0x1*-0x120a+0x1089*-0x3);let _0x39f27a=_0x4e9a72[_0x5c0224];return _0x39f27a;},_0x4193(_0xeb30d9,_0x50a3a2);}async function downloadMessageToBuffer(_0x500005){const _0x4c251b=_0x4e7c03;if(!_0x500005||!_0x500005[_0x4c251b(0x1c4)]){const _0x282af0=_0x500005,_0x2595ed=getMediaFromMessage(_0x282af0);if(!_0x2595ed)throw new Error('No\x20media\x20n'+'ode\x20found\x20'+_0x4c251b(0x258)+'d');_0x500005={'message':_0x282af0};}const _0x31276c=_0x500005['message']||{},_0x4698e3=[_0x4c251b(0x1ca),_0x4c251b(0x1a9),_0x4c251b(0x24f),'ptv','audio',_0x4c251b(0x25a)];for(const _0xa04aba of _0x4698e3){const _0x3cae68=_0x31276c[_0xa04aba+_0x4c251b(0x20c)];if(!_0x3cae68)continue;const _0x14220e=await downloadContentFromMessage(_0x3cae68,_0xa04aba),_0x179c1a=[];for await(const _0x16a9fd of _0x14220e)_0x179c1a[_0x4c251b(0x225)](_0x16a9fd);return Buffer[_0x4c251b(0x1a7)](_0x179c1a);}throw new Error(_0x4c251b(0x182)+_0x4c251b(0x256)+_0x4c251b(0x211)+_0x4c251b(0x263)+_0x4c251b(0x1a3));}export async function initialize(_0x4b5277){const _0x4e2d11=_0x4e7c03;if(!_0x4b5277)throw new Error(_0x4e2d11(0x1f6)+'nitialize\x20'+_0x4e2d11(0x214)+_0x4e2d11(0x231)+'e');botRef=_0x4b5277,setupSendApi(botRef),info(_0x4e2d11(0x1bf)+_0x4e2d11(0x215)+'ed');}export async function onMessage(_0x52cabe){const _0x591370=_0x4e7c03;try{if(!_0x52cabe||!_0x52cabe[_0x591370(0x217)]||!_0x52cabe[_0x591370(0x1c4)])return;const _0x332bbd=String(_0x52cabe[_0x591370(0x217)]['remoteJid']||'');if(_0x332bbd['endsWith']('@g.us'))return;const _0x59f5a6=_0x332bbd+'::'+String(_0x52cabe[_0x591370(0x217)]['id']||'');if(isProcessed(_0x59f5a6))return;if(!_0x52cabe[_0x591370(0x230)])return;const _0x557124=_0x52cabe[_0x591370(0x186)]&&typeof _0x52cabe[_0x591370(0x186)]===_0x591370(0x242)?_0x52cabe[_0x591370(0x186)]['trim']():'';if(!_0x557124)return;const _0x351811=_0x557124[_0x591370(0x17c)](/\r?\n/)[-0x14*0x15a+-0x3*0x26d+0x224f][_0x591370(0x19f)]()[_0x591370(0x17c)](/\s+/),_0x4787eb=(_0x351811[-0x1*-0x1fd+0x52*0x6b+-0x2443]||'')[_0x591370(0x24d)+'e']();if(!commands[_0x591370(0x1b7)](_0x4787eb))return;if(!botRef)botRef=_0x52cabe['bot']||_0x52cabe[_0x591370(0x1ab)]||null;if(!sendApi)setupSendApi(botRef);if(!botRef){warn('[dbbackup]'+'\x20bot\x20insta'+_0x591370(0x1eb)+_0x591370(0x1e6));return;}const _0xe9c2a7=await resolveFinalDestFromCtx(_0x52cabe);if(!_0xe9c2a7)return;markProcessed(_0x59f5a6),info(_0x591370(0x1bf)+_0x591370(0x1ff)+_0x4787eb+(_0x591370(0x198)+_0x591370(0x17f))+_0xe9c2a7);if(_0x4787eb==='getdb'){const _0x24d14d=getConfig(),_0x15dd9f=resolveDbDir(),_0x40cf30=_0x24d14d&&_0x24d14d[_0x591370(0x1a4)]?String(_0x24d14d[_0x591370(0x1a4)]):_0x591370(0x1a1),_0x1af81e=_0x351811['length']>=-0xea9+0x1c03+0x6ac*-0x2?_0x351811[_0x591370(0x252)](0x128d+0xd75+-0x2001)[_0x591370(0x1cf)]('\x20')['trim']():_0x40cf30,_0x2e2c09=_0x3c1cb2[_0x591370(0x19b)](_0x15dd9f,_0x1af81e);if(!ensureInside(_0x15dd9f,_0x2e2c09)){await safeSend(_0xe9c2a7,{'text':_0x591370(0x1a5)+'filename\x20/'+_0x591370(0x20a)+_0x591370(0x227)});return;}if(!_0x118cf2[_0x591370(0x1b8)](_0x2e2c09)){await safeSend(_0xe9c2a7,{'text':'❌\x20File\x20not'+_0x591370(0x1ae)+_0x1af81e});return;}const _0x18fa34=_0x3c1cb2['join'](_0x15dd9f,_0x3c1cb2[_0x591370(0x181)](_0x2e2c09)+('.bak_for_g'+_0x591370(0x1e4)));let _0x3b3c82=![];try{await shutdownDatabase(),_0x3b3c82=!![],info(_0x591370(0x1bf)+_0x591370(0x199)+_0x591370(0x1ba)+'ompleted\x20f'+_0x591370(0x259)+_0x591370(0x16f));try{_0x118cf2['copyFileSy'+'nc'](_0x2e2c09,_0x18fa34),info(_0x591370(0x1bf)+_0x591370(0x1c6)+'y\x20for\x20getd'+_0x591370(0x18f)+_0x18fa34);}catch(_0x4f9f32){warn(_0x591370(0x1bf)+'\x20quick\x20cop'+_0x591370(0x1cb)+(_0x4f9f32?.[_0x591370(0x1c4)]||_0x4f9f32));}const _0x3eab70=_0x118cf2['readFileSy'+'nc'](_0x2e2c09);await safeSend(_0xe9c2a7,{'document':_0x3eab70,'fileName':_0x3c1cb2[_0x591370(0x181)](_0x2e2c09),'mimetype':_0x591370(0x201)+_0x591370(0x202)+_0x591370(0x21a)}),info(_0x591370(0x1bf)+_0x591370(0x238)+'ile\x20'+_0x2e2c09+_0x591370(0x1da)+_0xe9c2a7),await initializeDatabase(),info('[dbbackup]'+_0x591370(0x1c8)+_0x591370(0x1d2)+_0x591370(0x173)+'operation.');}catch(_0x296f94){error(_0x296f94,_0x591370(0x1bf)+'\x20getdb\x20fai'+'led');try{_0x3b3c82&&(await initializeDatabase(),info('[dbbackup]'+'\x20initializ'+_0x591370(0x206)+'attempted\x20'+_0x591370(0x194)+'b\x20failure.'));}catch(_0x59ebbc){error(_0x59ebbc,_0x591370(0x1bf)+_0x591370(0x215)+_0x591370(0x206)+_0x591370(0x20e)+_0x591370(0x251)+_0x591370(0x204));}await safeSend(_0xe9c2a7,{'text':_0x591370(0x1b2)+'o\x20retrieve'+_0x591370(0x171)+(_0x296f94?.[_0x591370(0x1c4)]||_0x296f94)+(_0x591370(0x174)+_0x591370(0x23a)+_0x591370(0x1e2))});}finally{try{if(_0x118cf2[_0x591370(0x1b8)](_0x18fa34))_0x118cf2[_0x591370(0x1fb)](_0x18fa34);}catch(_0x514dca){}}return;}if(_0x4787eb===_0x591370(0x255)){let _0x129b61=getMediaFromMessage(_0x52cabe['message'])||getQuotedMedia(_0x52cabe),_0x3c4bca=!getMediaFromMessage(_0x52cabe[_0x591370(0x1c4)])&&!!getQuotedMedia(_0x52cabe);if(!_0x129b61||!_0x129b61[_0x591370(0x1d1)]){await safeSend(_0xe9c2a7,{'text':_0x591370(0x20d)+_0x591370(0x1f8)+_0x591370(0x1d9)+_0x591370(0x261)+'place\x20the\x20'+_0x591370(0x218)+'tension;\x20w'+_0x591370(0x1e0)+'idated).'});return;}const _0x519e82=String(_0x129b61[_0x591370(0x1f3)]||'')[_0x591370(0x19f)](),_0x283fa4=getConfig(),_0x5a069e=resolveDbDir();let _0x4f8443=_0x283fa4&&_0x283fa4['DB_NAME']?String(_0x283fa4[_0x591370(0x1a4)]):_0x591370(0x1a1),_0x3a22f8=_0x3c1cb2[_0x591370(0x1ed)](_0x4f8443)['toLowerCas'+'e']();if(!_0x3a22f8){_0x4f8443=_0x4f8443||_0x591370(0x1a1),_0x3a22f8=_0x3c1cb2[_0x591370(0x1ed)](_0x4f8443)||_0x591370(0x237);if(!_0x3c1cb2[_0x591370(0x1ed)](_0x4f8443))_0x4f8443=''+_0x4f8443+_0x3a22f8;}const _0x41663c=_0x3c1cb2[_0x591370(0x19b)](_0x5a069e,_0x4f8443);try{_0x118cf2[_0x591370(0x180)](_0x5a069e,{'recursive':!![]});}catch(_0x12fa15){}if(!ensureInside(_0x5a069e,_0x41663c)){await safeSend(_0xe9c2a7,{'text':_0x591370(0x1a5)+'destinatio'+_0x591370(0x184)});return;}const _0x265675=_0x3c4bca?_0x52cabe['message']['extendedTe'+_0x591370(0x18e)][_0x591370(0x24e)+'o'][_0x591370(0x178)+_0x591370(0x233)]:_0x52cabe[_0x591370(0x1c4)];let _0x4d0e77;try{_0x4d0e77=await downloadMessageToBuffer(_0x265675);}catch(_0x665f7e){error(_0x665f7e,_0x591370(0x1bf)+_0x591370(0x203)+_0x591370(0x226)+_0x591370(0x1ad)+'B\x20(downloa'+_0x591370(0x1bb));const _0x51e981=_0x665f7e?.['response']?.['status']||_0x665f7e?.['status']||null;_0x51e981===-0x2028+-0xa7*-0x7+0x1d31?await safeSend(_0xe9c2a7,{'text':_0x591370(0x1b2)+_0x591370(0x25f)+':\x20uploaded'+_0x591370(0x1b6)+_0x591370(0x1c3)+_0x591370(0x23e)+'\x20(HTTP\x20410'+').\x20Please\x20'+_0x591370(0x246)+_0x591370(0x1cd)+'nd\x20try\x20aga'+'in.'}):await safeSend(_0xe9c2a7,{'text':_0x591370(0x1b2)+'o\x20download'+'\x20uploaded\x20'+'file:\x20'+(_0x665f7e?.[_0x591370(0x1c4)]||_0x665f7e)});return;}try{const _0x29677b=_0x4d0e77['slice'](0x1b5b+0x4*-0x4e9+-0x7b7,0x9e5+0x25a1+-0x2f76),_0x2c238d=Buffer[_0x591370(0x253)]('SQLite\x20for'+_0x591370(0x25d),_0x591370(0x1d7));if(!_0x29677b[_0x591370(0x244)](_0x2c238d)){await safeSend(_0xe9c2a7,{'text':_0x591370(0x1de)+_0x591370(0x257)+_0x591370(0x19a)+'r\x20to\x20be\x20a\x20'+_0x591370(0x1dc)+_0x591370(0x191)+_0x591370(0x197)+'ch).\x0a'+(_0x591370(0x236)+_0x591370(0x17d)+_0x591370(0x1ee)+_0x591370(0x247)+_0x591370(0x16e)+_0x591370(0x209)+_0x591370(0x235)+_0x591370(0x1a2)+_0x591370(0x249)+'d.')});return;}}catch(_0x1a53a1){error(_0x1a53a1,'[dbbackup]'+_0x591370(0x21e)+_0x591370(0x1b3)+_0x591370(0x207)),await safeSend(_0xe9c2a7,{'text':_0x591370(0x1d3)+_0x591370(0x212)+_0x591370(0x177)+_0x591370(0x208)+_0x591370(0x1f4)+(_0x1a53a1?.[_0x591370(0x1c4)]||_0x1a53a1)});return;}const _0x278e7b=_0x3c1cb2[_0x591370(0x1cf)](_0x5a069e,_0x3c1cb2[_0x591370(0x181)](_0x41663c)+(_0x591370(0x248)+'etdb'));let _0x43e97f=![];try{await shutdownDatabase(),_0x43e97f=!![],info(_0x591370(0x1bf)+'\x20database\x20'+'shutdown\x20c'+_0x591370(0x1a0)+'or\x20restore'+_0x591370(0x17b)+'.');if(_0x118cf2[_0x591370(0x1b8)](_0x41663c))try{_0x118cf2['copyFileSy'+'nc'](_0x41663c,_0x278e7b),info(_0x591370(0x1bf)+'\x20existing\x20'+_0x591370(0x1d5)+_0x591370(0x25b)+_0x278e7b);}catch(_0x544369){warn(_0x591370(0x1bf)+'\x20failed\x20to'+_0x591370(0x1d8)+_0x591370(0x17a)+(_0x544369?.[_0x591370(0x1c4)]||_0x544369)),await safeSend(_0xe9c2a7,{'text':_0x591370(0x234)+_0x591370(0x18c)+_0x591370(0x1d8)+'\x20backup:\x20'+(_0x544369?.['message']||_0x544369)});}_0x118cf2['writeFileS'+_0x591370(0x1bd)](_0x41663c,_0x4d0e77),info('[dbbackup]'+'\x20overwritt'+_0x591370(0x1e3)+_0x591370(0x17e)+_0x41663c),await initializeDatabase(),await safeSend(_0xe9c2a7,{'text':_0x591370(0x175)+'B\x20replaced'+_0x591370(0x213)+'itialized\x20'+'as:\x20'+_0x3c1cb2[_0x591370(0x22d)](PROJECT_ROOT,_0x41663c)}),info(_0x591370(0x1bf)+'\x20DB\x20restor'+_0x591370(0x24a)+_0x591370(0x1af)+_0x591370(0x20b)+_0x591370(0x1fe)+_0xe9c2a7);}catch(_0x1e8e00){error(_0x1e8e00,_0x591370(0x1bf)+_0x591370(0x1fc)+_0x591370(0x1f9)+'d\x20after\x20sh'+'utdown');try{_0x118cf2[_0x591370(0x1b8)](_0x278e7b)&&(_0x118cf2[_0x591370(0x1d6)+'nc'](_0x278e7b,_0x41663c),info(_0x591370(0x1bf)+'\x20restored\x20'+_0x591370(0x188)+'ckup\x20due\x20t'+_0x591370(0x1b4)+'ring\x20resto'+'re'));}catch(_0x81ba9e){error(_0x81ba9e,_0x591370(0x1bf)+_0x591370(0x203)+'\x20restore\x20D'+_0x591370(0x224)+_0x591370(0x18b)+_0x591370(0x190));}try{await initializeDatabase();}catch(_0x2e0b70){error(_0x2e0b70,_0x591370(0x1bf)+_0x591370(0x215)+'eDatabase\x20'+_0x591370(0x20e)+_0x591370(0x221)+_0x591370(0x216)+'y');}await safeSend(_0xe9c2a7,{'text':_0x591370(0x1b2)+_0x591370(0x1ac)+_0x591370(0x170)+(_0x1e8e00?.[_0x591370(0x1c4)]||_0x1e8e00)+(_0x591370(0x1ec)+_0x591370(0x260)+'er\x20the\x20pre'+'vious\x20DB\x20w'+'as\x20made.')});}finally{try{if(_0x118cf2['existsSync'](_0x278e7b))_0x118cf2[_0x591370(0x1fb)](_0x278e7b);}catch(_0x1a1c62){}}return;}if(_0x4787eb===_0x591370(0x23f)){const _0x27583c=findConfigFile();if(_0x27583c){try{const _0x465486=_0x118cf2[_0x591370(0x20f)+'nc'](_0x27583c),_0x3182a=_0x27583c[_0x591370(0x24d)+'e']()['endsWith'](_0x591370(0x1fd))?'applicatio'+'n/json':_0x591370(0x1f0)+'l';await safeSend(_0xe9c2a7,{'document':_0x465486,'fileName':_0x3c1cb2[_0x591370(0x181)](_0x27583c),'mimetype':_0x3182a}),info(_0x591370(0x1bf)+'\x20sent\x20conf'+'ig\x20file\x20'+_0x27583c+'\x20to\x20'+_0xe9c2a7);}catch(_0x44eb64){error(_0x44eb64,_0x591370(0x1bf)+_0x591370(0x240)+_0x591370(0x1f1)+'ed'),await safeSend(_0xe9c2a7,{'text':_0x591370(0x1b2)+_0x591370(0x189)+_0x591370(0x172)+(_0x44eb64?.[_0x591370(0x1c4)]||_0x44eb64)});}return;}const _0x5aac2f=getConfig()||{},_0x30333b=Buffer['from'](JSON['stringify'](_0x5aac2f,null,-0x140*0x13+0x1aed+-0x32b),_0x591370(0x23d));await safeSend(_0xe9c2a7,{'document':_0x30333b,'fileName':_0x591370(0x1ea)+'nfig.json','mimetype':'applicatio'+_0x591370(0x25e)});return;}if(_0x4787eb==='setconfig'){let _0x3dbfe9=getMediaFromMessage(_0x52cabe['message'])||getQuotedMedia(_0x52cabe),_0x429e4c=!getMediaFromMessage(_0x52cabe[_0x591370(0x1c4)])&&!!getQuotedMedia(_0x52cabe);if(!_0x3dbfe9||!_0x3dbfe9[_0x591370(0x1d1)]){await safeSend(_0xe9c2a7,{'text':_0x591370(0x20d)+_0x591370(0x1f8)+_0x591370(0x1d9)+_0x591370(0x1fa)+'e.'});return;}const _0xaf6312=String(_0x3dbfe9[_0x591370(0x1f3)]||'')[_0x591370(0x19f)]()[_0x591370(0x24d)+'e'](),_0x1fc680=[_0x591370(0x25c),_0x591370(0x1ce),_0x591370(0x1fd)],_0x4e80be=_0x3c1cb2[_0x591370(0x1ed)](_0xaf6312||'');if(!_0x1fc680[_0x591370(0x1b7)](_0x4e80be)){await safeSend(_0xe9c2a7,{'text':_0x591370(0x183)+_0x591370(0x22a)+_0x591370(0x1a8)+_0x591370(0x254)+'\x20.json'});return;}const _0x1d8ad0=findConfigFile(),_0x545883=_0x4e80be===_0x591370(0x1fd)?_0x591370(0x1c5)+'n':_0x591370(0x18d),_0x461c7e=_0x3c1cb2[_0x591370(0x19b)](PROJECT_ROOT,_0x545883);if(!ensureInside(PROJECT_ROOT,_0x461c7e)){await safeSend(_0xe9c2a7,{'text':'❌\x20Invalid\x20'+_0x591370(0x1b5)+_0x591370(0x184)});return;}try{const _0x550ba5=_0x429e4c?_0x52cabe[_0x591370(0x1c4)][_0x591370(0x187)+'xtMessage']['contextInf'+'o'][_0x591370(0x178)+_0x591370(0x233)]:_0x52cabe[_0x591370(0x1c4)],_0x1b036c=await downloadMessageToBuffer(_0x550ba5);_0x118cf2['writeFileS'+_0x591370(0x1bd)](_0x461c7e,_0x1b036c,{'encoding':_0x591370(0x23d)});if(_0x1d8ad0&&_0x1d8ad0!==_0x461c7e&&_0x118cf2[_0x591370(0x1b8)](_0x1d8ad0))try{_0x118cf2[_0x591370(0x1fb)](_0x1d8ad0),info('[dbbackup]'+_0x591370(0x22c)+_0x591370(0x24c)+_0x591370(0x1d4)+_0x1d8ad0);}catch(_0xf0d7f7){warn(_0x591370(0x1bf)+_0x591370(0x18c)+_0x591370(0x1db)+_0x591370(0x192)+_0x591370(0x21f)+(_0xf0d7f7?.[_0x591370(0x1c4)]||_0xf0d7f7));}await safeSend(_0xe9c2a7,{'text':_0x591370(0x1be)+_0x591370(0x1f7)+_0x591370(0x22f)+_0x545883+(_0x591370(0x1cc)+'ot\x20restart'+_0x591370(0x1c1)+'quired\x20for'+'\x20some\x20serv'+_0x591370(0x222)+_0x591370(0x1e7)+'config.')}),info(_0x591370(0x1bf)+'\x20replaced\x20'+_0x591370(0x1fa)+'e\x20'+_0x461c7e+_0x591370(0x196)+_0xe9c2a7);}catch(_0x534a40){error(_0x534a40,_0x591370(0x1bf)+_0x591370(0x19c)+_0x591370(0x1b1)),await safeSend(_0xe9c2a7,{'text':'❌\x20Failed\x20t'+_0x591370(0x1d0)+'fig:\x20'+(_0x534a40?.[_0x591370(0x1c4)]||_0x534a40)});}return;}}catch(_0x49e457){error(_0x49e457,_0x591370(0x1bf)+_0x591370(0x16d)+_0x591370(0x24b)+(_0x49e457?.[_0x591370(0x1c4)]||_0x49e457));}}export async function cleanup(){const _0x10f831=_0x4e7c03;try{botRef=null,sendApi=null,processedMessageKeys['forEach'](_0x32afa0=>{try{clearTimeout(_0x32afa0);}catch(_0x27d152){}}),processedMessageKeys[_0x10f831(0x193)](),info('[dbbackup]'+_0x10f831(0x228)+'p');}catch(_0x5b4702){warn('[dbbackup]'+_0x10f831(0x1df)+_0x10f831(0x1f2)+(_0x5b4702?.['message']||_0x5b4702));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};