const _0x2b1436=_0x4f42;(function(_0x4cb821,_0x332f31){const _0x417ee7=_0x4f42,_0x1cf2af=_0x4cb821();while(!![]){try{const _0x3dc9cc=-parseInt(_0x417ee7(0x2b6))/(-0x1*0x5bf+0x636+-0x76)*(parseInt(_0x417ee7(0x25d))/(0x1b68+-0x261b*-0x1+-0x199*0x29))+-parseInt(_0x417ee7(0x25b))/(0x218e*-0x1+0x12*0x8b+-0x17cb*-0x1)+-parseInt(_0x417ee7(0x290))/(0x21ce+0xa07*-0x2+-0xdbc)*(-parseInt(_0x417ee7(0x29b))/(0x1bbe+0x19*-0x115+-0xac))+parseInt(_0x417ee7(0x2be))/(0x20d8+-0x1dca+-0x308)+parseInt(_0x417ee7(0x2e4))/(0x4a2+-0x592+0x1*0xf7)+-parseInt(_0x417ee7(0x2ae))/(-0x2d4*0x6+-0x3*-0x725+-0x46f)+parseInt(_0x417ee7(0x2d4))/(-0x77*0x34+0xef*-0x14+0xe4b*0x3)*(parseInt(_0x417ee7(0x28e))/(-0xff1+0x1b53*0x1+0x18*-0x79));if(_0x3dc9cc===_0x332f31)break;else _0x1cf2af['push'](_0x1cf2af['shift']());}catch(_0x3e6d97){_0x1cf2af['push'](_0x1cf2af['shift']());}}}(_0x1a32,0x356b*0x46+-0x1541+-0x221*0x274));import _0x381c3f from'fs';import _0x9d7f46 from'path';import{downloadContentFromMessage}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,findConfigFile,PROJECT_ROOT}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';import{userJidFromCtx,listSudo,normalizeToJid}from'../utils/sudo.js';import{shutdownDatabase,initializeDatabase}from'../utils/database.js';export const name=_0x2b1436(0x21e);export const version=_0x2b1436(0x2aa);function _0x4f42(_0x30d867,_0x170289){const _0x226f59=_0x1a32();return _0x4f42=function(_0x5c8998,_0x34948e){_0x5c8998=_0x5c8998-(0x1119+-0x1*0x22da+-0x61*-0x34);let _0x37f59a=_0x226f59[_0x5c8998];return _0x37f59a;},_0x4f42(_0x30d867,_0x170289);}export const priority=-0x17*-0x199+0x3*0x156+0x9*-0x47b;export const commands=[_0x2b1436(0x293),_0x2b1436(0x2ca),_0x2b1436(0x255),'setconfig'];let botRef=null,sendApi=null;const DEDUPE_TTL_MS=(0x8a9*-0x1+-0x101a+-0x18cd*-0x1)*(-0x7de*0x3+0x2431+-0x8af),processedMessageKeys=new Map();function markProcessed(_0x24b432){const _0x5aeae0=_0x2b1436;if(!_0x24b432)return;if(processedMessageKeys[_0x5aeae0(0x229)](_0x24b432))try{clearTimeout(processedMessageKeys[_0x5aeae0(0x2b3)](_0x24b432));}catch(_0x14557a){}const _0xf46188=setTimeout(()=>processedMessageKeys['delete'](_0x24b432),DEDUPE_TTL_MS);processedMessageKeys[_0x5aeae0(0x2e1)](_0x24b432,_0xf46188);}function isProcessed(_0x581d06){const _0xd4447c=_0x2b1436;return _0x581d06&&processedMessageKeys[_0xd4447c(0x229)](_0x581d06);}async function resolveFinalDestFromCtx(_0x3a5b68){const _0x4adefc=_0x2b1436;try{if(!_0x3a5b68||!_0x3a5b68[_0x4adefc(0x263)])return null;const _0x51cbd4=getBotJid(),_0x3e36b0=Boolean(_0x3a5b68[_0x4adefc(0x263)][_0x4adefc(0x27b)]);if(_0x3e36b0)return _0x51cbd4||null;const _0x312dea=String(_0x3a5b68['key'][_0x4adefc(0x2e6)]||'');if(!_0x312dea||_0x312dea[_0x4adefc(0x217)](_0x4adefc(0x2b8)))return null;const {findings:_0x9707bb}=userJidFromCtx(_0x3a5b68);if(!Array[_0x4adefc(0x2ce)](_0x9707bb)||_0x9707bb[_0x4adefc(0x284)]===-0x239*0x1+0x5*0x161+-0x4ac)return null;const _0x495bef=await listSudo();if(!Array[_0x4adefc(0x2ce)](_0x495bef)||_0x495bef[_0x4adefc(0x284)]===-0x287+-0x183*0xf+0x1934)return null;const _0x5f3f3a=new Set(_0x495bef['map'](_0x405427=>String(_0x405427)));for(const _0x53cf8e of _0x9707bb){if(!_0x53cf8e?.[_0x4adefc(0x1ff)]||typeof _0x53cf8e[_0x4adefc(0x1ff)]!==_0x4adefc(0x210))continue;let _0x22f19f=null;try{_0x22f19f=normalizeToJid(_0x53cf8e[_0x4adefc(0x1ff)]);}catch(_0xcbeef7){_0x22f19f=null;}if(_0x22f19f&&_0x5f3f3a['has'](_0x22f19f))return _0x22f19f;const _0x58be82=(String(_0x53cf8e[_0x4adefc(0x1ff)])[_0x4adefc(0x23c)]('@')[0xb*-0x26c+0xd18+0xd8c]||'')[_0x4adefc(0x23c)](':')[-0x2f8*-0x1+-0x16bd*0x1+0x13c5]||null;if(_0x58be82)for(const _0x5929b0 of _0x5f3f3a){const _0x38e4fa=String(_0x5929b0)[_0x4adefc(0x23c)]('@')[-0x16b2+-0x1*0x337+0x19e9]||null;if(_0x38e4fa&&_0x58be82===_0x38e4fa)return _0x5929b0;}if(_0x5f3f3a[_0x4adefc(0x229)](_0x53cf8e[_0x4adefc(0x1ff)]))return _0x53cf8e[_0x4adefc(0x1ff)];}return null;}catch(_0x5e4c05){return warn('['+name+(_0x4adefc(0x29f)+_0x4adefc(0x1f5)+'omCtx\x20erro'+_0x4adefc(0x207))+(_0x5e4c05?.[_0x4adefc(0x28b)]||_0x5e4c05)),null;}}function setupSendApi(_0x294bc3){const _0x531172=_0x2b1436;if(!_0x294bc3)return;if(typeof _0x294bc3[_0x531172(0x26d)+'e']===_0x531172(0x2e0))sendApi=async(_0x2f9c87,_0x252eaf)=>await _0x294bc3[_0x531172(0x26d)+'e'](_0x2f9c87,_0x252eaf);else _0x294bc3[_0x531172(0x294)]&&typeof _0x294bc3['sock'][_0x531172(0x26d)+'e']===_0x531172(0x2e0)?sendApi=async(_0x144aeb,_0x406628)=>await _0x294bc3['sock'][_0x531172(0x26d)+'e'](_0x144aeb,_0x406628):sendApi=null;}async function safeSend(_0x1fe1fc,_0x312079){const _0x3bac4d=_0x2b1436;try{if(!_0x1fe1fc||!_0x312079)return;if(sendApi)return await sendApi(_0x1fe1fc,_0x312079);warn(_0x3bac4d(0x211)+_0x3bac4d(0x206)+_0x3bac4d(0x2b7)+_0x3bac4d(0x2a5));}catch(_0x54d05e){error(_0x54d05e,'[dbbackup]'+_0x3bac4d(0x2e8)+_0x3bac4d(0x266)),warn(_0x3bac4d(0x211)+_0x3bac4d(0x2e8)+_0x3bac4d(0x23f)+(_0x54d05e?.[_0x3bac4d(0x28b)]||_0x54d05e));}}function resolveDbDir(){const _0x367536=_0x2b1436,_0x3a2a1b=getConfig(),_0x47152f=_0x3a2a1b&&_0x3a2a1b[_0x367536(0x2c3)]?_0x3a2a1b['DB_PATH']:_0x367536(0x231),_0x2f1044=_0x9d7f46[_0x367536(0x2da)](_0x47152f)?_0x9d7f46[_0x367536(0x256)](_0x47152f):_0x9d7f46[_0x367536(0x256)](PROJECT_ROOT,_0x47152f);return _0x2f1044;}function ensureInside(_0x57ce92,_0x2226ec){const _0x41ffd7=_0x2b1436,_0x13d057=_0x9d7f46[_0x41ffd7(0x256)](_0x57ce92)+_0x9d7f46[_0x41ffd7(0x21c)],_0x31f7a1=_0x9d7f46['resolve'](_0x2226ec);return _0x31f7a1[_0x41ffd7(0x25a)](_0x13d057);}function getMediaFromMessage(_0x3b9c6e){const _0x1f12c4=_0x2b1436;if(!_0x3b9c6e)return null;if(_0x3b9c6e[_0x1f12c4(0x246)+_0x1f12c4(0x2a6)]){const _0x18f0b5=_0x3b9c6e[_0x1f12c4(0x246)+_0x1f12c4(0x2a6)];return{'type':'document','mediaMsg':_0x3b9c6e,'fileName':_0x18f0b5[_0x1f12c4(0x282)]||null,'caption':_0x18f0b5[_0x1f12c4(0x220)]||null};}if(_0x3b9c6e[_0x1f12c4(0x2b5)+'ge']||_0x3b9c6e[_0x1f12c4(0x2a1)+'ge']||_0x3b9c6e[_0x1f12c4(0x233)+'ge']||_0x3b9c6e['stickerMes'+_0x1f12c4(0x29e)]){const _0x562fbd=['imageMessa'+'ge',_0x1f12c4(0x2a1)+'ge','audioMessa'+'ge','stickerMes'+_0x1f12c4(0x29e)];for(const _0x15f158 of _0x562fbd){if(_0x3b9c6e[_0x15f158])return{'type':_0x15f158[_0x1f12c4(0x1fd)](_0x1f12c4(0x257),''),'mediaMsg':_0x3b9c6e,'fileName':null,'caption':null};}}return null;}function getQuotedMedia(_0x12d1a8){const _0x17df10=_0x2b1436,_0x277b60=_0x12d1a8[_0x17df10(0x28b)]&&_0x12d1a8[_0x17df10(0x28b)]['extendedTe'+_0x17df10(0x2c9)];if(!_0x277b60||!_0x277b60[_0x17df10(0x223)+'o']||!_0x277b60[_0x17df10(0x223)+'o']['quotedMess'+_0x17df10(0x28d)])return null;const _0x14fa89=_0x277b60[_0x17df10(0x223)+'o'][_0x17df10(0x2a2)+_0x17df10(0x28d)];return getMediaFromMessage(_0x14fa89);}function _0x1a32(){const _0x5b770=['d\x20after\x20sh','failed\x20aft','config.','\x20and\x20DB\x20re','d\x20media\x20ty','destinatio','✅\x20Config\x20r','\x20from\x20','getconfig','resolve','Message','er\x20getdb\x20f','mediaMsg','startsWith','3106230AnVyMe','❌\x20Failed\x20t','112868ZfxRFH','pe\x20or\x20no\x20m','d\x20re-uploa','ptv','.db','setconfig','key','was\x20made.','audio','failed','B\x20(downloa','Expected\x20S','or\x20restore','\x20initializ','o\x20send\x20con','\x20setconfig','sendMessag','\x20header\x20va','n\x20path.','extendedTe','uploaded\x20D','ialized\x20af','nsions:\x20.y','stringify','response','tension;\x20w','er\x20the\x20pre','shutdown\x20c','ync','file\x20heade','fromMe','Unsupporte','\x5c0\x22.\x20If\x20th','⚠️\x20Warning:','.json','basename','forEach','fileName','o\x20download','length','o\x20restore\x20','o\x20error\x20du','as\x20made.','\x20(HTTP\x20410','ile\x20','\x20database\x20','message','\x0aNote:\x20A\x20b','age','70MKaZjj','\x20restore\x20D','129860HvUMAo','copyFileSy','eply\x20to\x20a\x20','getdb','sock','\x20quick\x20cop','ode\x20found\x20','er\x20attempt','en\x20DB\x20file','\x20.json','n\x20WhatsApp','45ERsnFz','\x20expired\x20o','wnload','sage',']\x20resolveF','requires\x20b','videoMessa','quotedMess','writeFileS','\x20could\x20not','ilable','ssage','file:\x20','client','utdown','2.5.0','B\x20from\x20bac','sticker','config\x20fil','9463216chwRGx','d\x20for\x20','ices\x20to\x20pi','ed\x20a\x20DB,\x20r','up\x20to\x20','get','quired\x20for','imageMessa','1pEgklW','urface\x20ava','@g.us','kup\x20after\x20','operation.','n/octet-st','trim','r\x20to\x20be\x20a\x20','851748GIuhbm','push','\x20may\x20be\x20re','status','readFileSy','DB_PATH','nce\x20not\x20av','DB\x20(any\x20ex','eDatabase\x20','\x20to\x20','er:\x20\x22SQLit','xtMessage','setdb','\x20and\x20re-in','ttach\x20or\x20r','\x20failed\x20to','isArray','mat\x203\x00','video','\x20failed','bot.db','etdb','3001311tjiHCy','ot\x20restart','text','\x20cleaned\x20u','to\x20downloa','\x20file\x20does','isAbsolute','ascii','initialize','e\x20format\x203','No\x20media\x20n','\x20command\x20\x27','function','set','as:\x20','includes','810593viDDlH','ring\x20resto','remoteJid','slice','\x20safeSend\x20','\x20removed\x20o','❌\x20File\x20not','join','ailure','nied.','nd\x20try\x20aga','DB_NAME','inalDestFr','o\x20retrieve','extname','re-upload\x20','concat','ck\x20up\x20new\x20','\x27\x20authoriz','ld\x20config\x20','replace','config.yml','jid','itialized\x20','.yml','\x20onMessage','ed\x20recover','equals','rror:\x20','\x20no\x20send\x20s','r:\x20','\x20overwritt','error','filename\x20/','toLowerCas','edia\x20to\x20do','dbbackup.i','ed\x20for\x20','DB\x20from\x20ba','string','[dbbackup]','d\x20config\x20f','SQLite\x20for','fig:\x20','led','\x20download\x20','endsWith','\x20at\x20','b\x20failure.','❌\x20Please\x20a','.bak_for_g','sep','\x20operation','dbbackup','from','caption','mkdirSync','\x20backup:\x20','contextInf','utf8','applicatio','t\x20validate','te\x20DB\x20(hea','ile:\x20','has','ch).\x0a','ompleted\x20f','❌\x20Invalid\x20','\x20not\x20appea','der\x20mismat','existsSync','place\x20the\x20','./data/db','B\x20replaced','audioMessa','b\x20at\x20','\x20getconfig','file\x20to\x20re','clear','config.jso','nfig.json','\x20error:\x20','\x20cleanup\x20e','split','runtime-co','document','failed:\x20','o\x20save\x20con','image','fig\x20file:\x20','peration.','lidation\x20f','unlinkSync','documentMe','is\x20is\x20inde','n/json','\x20existing\x20','\x20DB\x20reinit','\x20remove\x20ol','ailable.'];_0x1a32=function(){return _0x5b770;};return _0x1a32();}async function downloadMessageToBuffer(_0x35e858){const _0x2c0663=_0x2b1436;if(!_0x35e858||!_0x35e858[_0x2c0663(0x28b)]){const _0x418573=_0x35e858,_0x2b68a6=getMediaFromMessage(_0x418573);if(!_0x2b68a6)throw new Error(_0x2c0663(0x2de)+_0x2c0663(0x296)+_0x2c0663(0x2d8)+'d');_0x35e858={'message':_0x418573};}const _0x40a631=_0x35e858['message']||{},_0x31bfc7=[_0x2c0663(0x23e),_0x2c0663(0x241),_0x2c0663(0x2d0),_0x2c0663(0x260),_0x2c0663(0x265),_0x2c0663(0x2ac)];for(const _0x23b37b of _0x31bfc7){const _0x556662=_0x40a631[_0x23b37b+_0x2c0663(0x257)];if(!_0x556662)continue;const _0x507512=await downloadContentFromMessage(_0x556662,_0x23b37b),_0x8951a5=[];for await(const _0x127340 of _0x507512)_0x8951a5[_0x2c0663(0x2bf)](_0x127340);return Buffer[_0x2c0663(0x1f9)](_0x8951a5);}throw new Error(_0x2c0663(0x27c)+_0x2c0663(0x251)+_0x2c0663(0x25e)+_0x2c0663(0x20c)+_0x2c0663(0x29d));}export async function initialize(_0x2bd6b8){const _0x121047=_0x2b1436;if(!_0x2bd6b8)throw new Error(_0x121047(0x20d)+'nitialize\x20'+_0x121047(0x2a0)+'ot\x20instanc'+'e');botRef=_0x2bd6b8,setupSendApi(botRef),info(_0x121047(0x211)+_0x121047(0x26a)+'ed');}export async function onMessage(_0x5a35cd){const _0x5c0552=_0x2b1436;try{if(!_0x5a35cd||!_0x5a35cd[_0x5c0552(0x263)]||!_0x5a35cd['message'])return;const _0x473345=String(_0x5a35cd[_0x5c0552(0x263)][_0x5c0552(0x2e6)]||'');if(_0x473345[_0x5c0552(0x217)]('@g.us'))return;const _0x2c54eb=_0x473345+'::'+String(_0x5a35cd[_0x5c0552(0x263)]['id']||'');if(isProcessed(_0x2c54eb))return;if(!_0x5a35cd['isCommand'])return;const _0x117de7=_0x5a35cd[_0x5c0552(0x2d6)]&&typeof _0x5a35cd[_0x5c0552(0x2d6)]===_0x5c0552(0x210)?_0x5a35cd[_0x5c0552(0x2d6)][_0x5c0552(0x2bc)]():'';if(!_0x117de7)return;const _0x49505b=_0x117de7[_0x5c0552(0x23c)](/\r?\n/)[-0xd*-0x1b6+-0xff9+0x217*-0x3][_0x5c0552(0x2bc)]()[_0x5c0552(0x23c)](/\s+/),_0x3673a8=(_0x49505b[0x2fa*0x7+-0x48f*-0x8+-0x394e]||'')[_0x5c0552(0x20b)+'e']();if(!commands[_0x5c0552(0x2e3)](_0x3673a8))return;if(!botRef)botRef=_0x5a35cd['bot']||_0x5a35cd[_0x5c0552(0x2a8)]||null;if(!sendApi)setupSendApi(botRef);if(!botRef){warn(_0x5c0552(0x211)+'\x20bot\x20insta'+_0x5c0552(0x2c4)+_0x5c0552(0x24c));return;}const _0x158f93=await resolveFinalDestFromCtx(_0x5a35cd);if(!_0x158f93)return;markProcessed(_0x2c54eb),info('[dbbackup]'+_0x5c0552(0x2df)+_0x3673a8+(_0x5c0552(0x1fb)+_0x5c0552(0x20e))+_0x158f93);if(_0x3673a8===_0x5c0552(0x293)){const _0xb288e6=getConfig(),_0xc153d=resolveDbDir(),_0x3efee9=_0xb288e6&&_0xb288e6[_0x5c0552(0x1f4)]?String(_0xb288e6[_0x5c0552(0x1f4)]):_0x5c0552(0x2d2),_0x3b66c5=_0x49505b['length']>=-0x23f1+-0xaa*0x5+-0x2745*-0x1?_0x49505b[_0x5c0552(0x2e7)](0x4c7+0x890+0x1*-0xd56)[_0x5c0552(0x2eb)]('\x20')[_0x5c0552(0x2bc)]():_0x3efee9,_0x512b95=_0x9d7f46['resolve'](_0xc153d,_0x3b66c5);if(!ensureInside(_0xc153d,_0x512b95)){await safeSend(_0x158f93,{'text':_0x5c0552(0x22c)+_0x5c0552(0x20a)+'\x20access\x20de'+_0x5c0552(0x2ed)});return;}if(!_0x381c3f['existsSync'](_0x512b95)){await safeSend(_0x158f93,{'text':_0x5c0552(0x2ea)+'\x20found:\x20'+_0x3b66c5});return;}const _0x1a09a9=_0x9d7f46['join'](_0xc153d,_0x9d7f46[_0x5c0552(0x280)](_0x512b95)+(_0x5c0552(0x21b)+_0x5c0552(0x2d3)));let _0x51a985=![];try{await shutdownDatabase(),_0x51a985=!![],info('[dbbackup]'+_0x5c0552(0x28a)+_0x5c0552(0x278)+'ompleted\x20f'+'or\x20getdb\x20o'+_0x5c0552(0x243));try{_0x381c3f['copyFileSy'+'nc'](_0x512b95,_0x1a09a9),info('[dbbackup]'+_0x5c0552(0x295)+'y\x20for\x20getd'+_0x5c0552(0x234)+_0x1a09a9);}catch(_0x4d2494){warn(_0x5c0552(0x211)+_0x5c0552(0x295)+'y\x20failed:\x20'+(_0x4d2494?.[_0x5c0552(0x28b)]||_0x4d2494));}const _0x5e1274=_0x381c3f[_0x5c0552(0x2c2)+'nc'](_0x512b95);await safeSend(_0x158f93,{'document':_0x5e1274,'fileName':_0x9d7f46[_0x5c0552(0x280)](_0x512b95),'mimetype':_0x5c0552(0x225)+_0x5c0552(0x2bb)+'ream'}),info(_0x5c0552(0x211)+'\x20sent\x20DB\x20f'+_0x5c0552(0x289)+_0x512b95+'\x20to\x20'+_0x158f93),await initializeDatabase(),info(_0x5c0552(0x211)+_0x5c0552(0x24a)+_0x5c0552(0x272)+'ter\x20getdb\x20'+_0x5c0552(0x2ba));}catch(_0x1b7398){error(_0x1b7398,_0x5c0552(0x211)+'\x20getdb\x20fai'+_0x5c0552(0x215));try{_0x51a985&&(await initializeDatabase(),info(_0x5c0552(0x211)+_0x5c0552(0x26a)+'eDatabase\x20'+'attempted\x20'+'after\x20getd'+_0x5c0552(0x219)));}catch(_0x2921a8){error(_0x2921a8,_0x5c0552(0x211)+_0x5c0552(0x26a)+_0x5c0552(0x2c6)+_0x5c0552(0x24e)+_0x5c0552(0x258)+_0x5c0552(0x2ec));}await safeSend(_0x158f93,{'text':_0x5c0552(0x25c)+_0x5c0552(0x1f6)+'\x20DB:\x20'+(_0x1b7398?.[_0x5c0552(0x28b)]||_0x1b7398)+('\x0aA\x20recover'+'y\x20attempt\x20'+_0x5c0552(0x264))});}finally{try{if(_0x381c3f[_0x5c0552(0x22f)](_0x1a09a9))_0x381c3f[_0x5c0552(0x245)](_0x1a09a9);}catch(_0x42a603){}}return;}if(_0x3673a8===_0x5c0552(0x2ca)){let _0x205f2c=getMediaFromMessage(_0x5a35cd[_0x5c0552(0x28b)])||getQuotedMedia(_0x5a35cd),_0x49b39b=!getMediaFromMessage(_0x5a35cd[_0x5c0552(0x28b)])&&!!getQuotedMedia(_0x5a35cd);if(!_0x205f2c||!_0x205f2c[_0x5c0552(0x259)]){await safeSend(_0x158f93,{'text':_0x5c0552(0x21a)+_0x5c0552(0x2cc)+'eply\x20to\x20a\x20'+_0x5c0552(0x236)+_0x5c0552(0x230)+_0x5c0552(0x2c5)+_0x5c0552(0x276)+'ill\x20be\x20val'+'idated).'});return;}const _0x2242d1=String(_0x205f2c[_0x5c0552(0x282)]||'')[_0x5c0552(0x2bc)](),_0x2aac21=getConfig(),_0x5a7c85=resolveDbDir();let _0x4382ee=_0x2aac21&&_0x2aac21[_0x5c0552(0x1f4)]?String(_0x2aac21[_0x5c0552(0x1f4)]):_0x5c0552(0x2d2),_0x2a92aa=_0x9d7f46['extname'](_0x4382ee)[_0x5c0552(0x20b)+'e']();if(!_0x2a92aa){_0x4382ee=_0x4382ee||'bot.db',_0x2a92aa=_0x9d7f46[_0x5c0552(0x1f7)](_0x4382ee)||_0x5c0552(0x261);if(!_0x9d7f46[_0x5c0552(0x1f7)](_0x4382ee))_0x4382ee=''+_0x4382ee+_0x2a92aa;}const _0x30446f=_0x9d7f46['resolve'](_0x5a7c85,_0x4382ee);try{_0x381c3f[_0x5c0552(0x221)](_0x5a7c85,{'recursive':!![]});}catch(_0xc849c2){}if(!ensureInside(_0x5a7c85,_0x30446f)){await safeSend(_0x158f93,{'text':_0x5c0552(0x22c)+'destinatio'+_0x5c0552(0x26f)});return;}const _0xb5998=_0x49b39b?_0x5a35cd[_0x5c0552(0x28b)][_0x5c0552(0x270)+_0x5c0552(0x2c9)][_0x5c0552(0x223)+'o'][_0x5c0552(0x2a2)+_0x5c0552(0x28d)]:_0x5a35cd[_0x5c0552(0x28b)];let _0x499b7b;try{_0x499b7b=await downloadMessageToBuffer(_0xb5998);}catch(_0x59d0b3){error(_0x59d0b3,_0x5c0552(0x211)+_0x5c0552(0x2cd)+_0x5c0552(0x216)+_0x5c0552(0x271)+_0x5c0552(0x267)+'d\x20step)');const _0x33deaf=_0x59d0b3?.[_0x5c0552(0x275)]?.[_0x5c0552(0x2c1)]||_0x59d0b3?.['status']||null;_0x33deaf===0x1e69+0x10a3+-0x3*0xf26?await safeSend(_0x158f93,{'text':'❌\x20Failed\x20t'+'o\x20download'+':\x20uploaded'+'\x20media\x20has'+_0x5c0552(0x29c)+_0x5c0552(0x29a)+_0x5c0552(0x288)+').\x20Please\x20'+_0x5c0552(0x1f8)+'the\x20file\x20a'+_0x5c0552(0x1f3)+'in.'}):await safeSend(_0x158f93,{'text':_0x5c0552(0x25c)+_0x5c0552(0x283)+'\x20uploaded\x20'+_0x5c0552(0x2a7)+(_0x59d0b3?.[_0x5c0552(0x28b)]||_0x59d0b3)});return;}try{const _0x3c3d15=_0x499b7b[_0x5c0552(0x2e7)](0x469+0x1b81+-0x1fea,0xb*-0x31a+-0x783+0x29b1),_0x7e5461=Buffer[_0x5c0552(0x21f)](_0x5c0552(0x213)+_0x5c0552(0x2cf),_0x5c0552(0x2db));if(!_0x3c3d15[_0x5c0552(0x204)](_0x7e5461)){await safeSend(_0x158f93,{'text':'❌\x20Uploaded'+_0x5c0552(0x2d9)+_0x5c0552(0x22d)+_0x5c0552(0x2bd)+'valid\x20SQLi'+_0x5c0552(0x227)+_0x5c0552(0x22e)+_0x5c0552(0x22a)+(_0x5c0552(0x268)+'QLite\x20head'+_0x5c0552(0x2c8)+_0x5c0552(0x2dd)+_0x5c0552(0x27d)+_0x5c0552(0x247)+_0x5c0552(0x2b1)+'e-check\x20an'+_0x5c0552(0x25f)+'d.')});return;}}catch(_0xf93fd){error(_0xf93fd,_0x5c0552(0x211)+_0x5c0552(0x26e)+_0x5c0552(0x244)+'ailed'),await safeSend(_0x158f93,{'text':'❌\x20Could\x20no'+_0x5c0552(0x226)+'\x20uploaded\x20'+_0x5c0552(0x27a)+_0x5c0552(0x207)+(_0xf93fd?.[_0x5c0552(0x28b)]||_0xf93fd)});return;}const _0xbe1597=_0x9d7f46[_0x5c0552(0x2eb)](_0x5a7c85,_0x9d7f46[_0x5c0552(0x280)](_0x30446f)+('.bak_for_s'+_0x5c0552(0x2d3)));let _0x4433ea=![];try{await shutdownDatabase(),_0x4433ea=!![],info(_0x5c0552(0x211)+_0x5c0552(0x28a)+_0x5c0552(0x278)+_0x5c0552(0x22b)+_0x5c0552(0x269)+_0x5c0552(0x21d)+'.');if(_0x381c3f[_0x5c0552(0x22f)](_0x30446f))try{_0x381c3f['copyFileSy'+'nc'](_0x30446f,_0xbe1597),info('[dbbackup]'+_0x5c0552(0x249)+'DB\x20backed\x20'+_0x5c0552(0x2b2)+_0xbe1597);}catch(_0x232218){warn(_0x5c0552(0x211)+_0x5c0552(0x2cd)+'\x20create\x20DB'+'\x20backup:\x20'+(_0x232218?.[_0x5c0552(0x28b)]||_0x232218)),await safeSend(_0x158f93,{'text':_0x5c0552(0x27e)+_0x5c0552(0x2a4)+'\x20create\x20DB'+_0x5c0552(0x222)+(_0x232218?.[_0x5c0552(0x28b)]||_0x232218)});}_0x381c3f[_0x5c0552(0x2a3)+'ync'](_0x30446f,_0x499b7b),info('[dbbackup]'+_0x5c0552(0x208)+_0x5c0552(0x298)+_0x5c0552(0x218)+_0x30446f),await initializeDatabase(),await safeSend(_0x158f93,{'text':'✅\x20Active\x20D'+_0x5c0552(0x232)+_0x5c0552(0x2cb)+_0x5c0552(0x200)+_0x5c0552(0x2e2)+_0x9d7f46['relative'](PROJECT_ROOT,_0x30446f)}),info('[dbbackup]'+'\x20DB\x20restor'+'e\x20complete'+_0x5c0552(0x250)+_0x5c0552(0x2dc)+_0x5c0552(0x2af)+_0x158f93);}catch(_0x3af931){error(_0x3af931,_0x5c0552(0x211)+'\x20setdb\x20res'+'tore\x20faile'+_0x5c0552(0x24d)+_0x5c0552(0x2a9));try{_0x381c3f[_0x5c0552(0x22f)](_0xbe1597)&&(_0x381c3f[_0x5c0552(0x291)+'nc'](_0xbe1597,_0x30446f),info(_0x5c0552(0x211)+'\x20restored\x20'+_0x5c0552(0x20f)+'ckup\x20due\x20t'+_0x5c0552(0x286)+_0x5c0552(0x2e5)+'re'));}catch(_0x2fb382){error(_0x2fb382,_0x5c0552(0x211)+_0x5c0552(0x2cd)+_0x5c0552(0x28f)+_0x5c0552(0x2ab)+_0x5c0552(0x2b9)+_0x5c0552(0x209));}try{await initializeDatabase();}catch(_0x2629a6){error(_0x2629a6,_0x5c0552(0x211)+_0x5c0552(0x26a)+'eDatabase\x20'+_0x5c0552(0x24e)+_0x5c0552(0x297)+_0x5c0552(0x203)+'y');}await safeSend(_0x158f93,{'text':'❌\x20Failed\x20t'+_0x5c0552(0x285)+'DB:\x20'+(_0x3af931?.['message']||_0x3af931)+('\x0aAn\x20attemp'+'t\x20to\x20recov'+_0x5c0552(0x277)+'vious\x20DB\x20w'+_0x5c0552(0x287))});}finally{try{if(_0x381c3f[_0x5c0552(0x22f)](_0xbe1597))_0x381c3f['unlinkSync'](_0xbe1597);}catch(_0x2fad48){}}return;}if(_0x3673a8===_0x5c0552(0x255)){const _0x4abb4e=findConfigFile();if(_0x4abb4e){try{const _0x2aa2d0=_0x381c3f[_0x5c0552(0x2c2)+'nc'](_0x4abb4e),_0x581010=_0x4abb4e[_0x5c0552(0x20b)+'e']()[_0x5c0552(0x217)](_0x5c0552(0x27f))?_0x5c0552(0x225)+_0x5c0552(0x248):'text/x-yam'+'l';await safeSend(_0x158f93,{'document':_0x2aa2d0,'fileName':_0x9d7f46['basename'](_0x4abb4e),'mimetype':_0x581010}),info(_0x5c0552(0x211)+'\x20sent\x20conf'+'ig\x20file\x20'+_0x4abb4e+_0x5c0552(0x2c7)+_0x158f93);}catch(_0x33b0f1){error(_0x33b0f1,_0x5c0552(0x211)+_0x5c0552(0x235)+'\x20send\x20fail'+'ed'),await safeSend(_0x158f93,{'text':_0x5c0552(0x25c)+_0x5c0552(0x26b)+_0x5c0552(0x242)+(_0x33b0f1?.[_0x5c0552(0x28b)]||_0x33b0f1)});}return;}const _0x59e17e=getConfig()||{},_0x446df8=Buffer[_0x5c0552(0x21f)](JSON[_0x5c0552(0x274)](_0x59e17e,null,-0x1833+-0x2702+0x3f37),_0x5c0552(0x224));await safeSend(_0x158f93,{'document':_0x446df8,'fileName':_0x5c0552(0x23d)+_0x5c0552(0x239),'mimetype':'applicatio'+'n/json'});return;}if(_0x3673a8===_0x5c0552(0x262)){let _0x341def=getMediaFromMessage(_0x5a35cd[_0x5c0552(0x28b)])||getQuotedMedia(_0x5a35cd),_0x107c91=!getMediaFromMessage(_0x5a35cd[_0x5c0552(0x28b)])&&!!getQuotedMedia(_0x5a35cd);if(!_0x341def||!_0x341def[_0x5c0552(0x259)]){await safeSend(_0x158f93,{'text':_0x5c0552(0x21a)+_0x5c0552(0x2cc)+_0x5c0552(0x292)+_0x5c0552(0x2ad)+'e.'});return;}const _0xa90eb4=String(_0x341def[_0x5c0552(0x282)]||'')['trim']()[_0x5c0552(0x20b)+'e'](),_0x5ca247=[_0x5c0552(0x201),'.yaml','.json'],_0x5e3ec5=_0x9d7f46[_0x5c0552(0x1f7)](_0xa90eb4||'');if(!_0x5ca247[_0x5c0552(0x2e3)](_0x5e3ec5)){await safeSend(_0x158f93,{'text':'❌\x20Accepted'+'\x20file\x20exte'+_0x5c0552(0x273)+'ml,\x20.yaml,'+_0x5c0552(0x299)});return;}const _0x4a8af5=findConfigFile(),_0x4b6213=_0x5e3ec5===_0x5c0552(0x27f)?_0x5c0552(0x238)+'n':_0x5c0552(0x1fe),_0x5e2588=_0x9d7f46[_0x5c0552(0x256)](PROJECT_ROOT,_0x4b6213);if(!ensureInside(PROJECT_ROOT,_0x5e2588)){await safeSend(_0x158f93,{'text':_0x5c0552(0x22c)+_0x5c0552(0x252)+'n\x20path.'});return;}try{const _0x1e9523=_0x107c91?_0x5a35cd[_0x5c0552(0x28b)]['extendedTe'+_0x5c0552(0x2c9)]['contextInf'+'o'][_0x5c0552(0x2a2)+_0x5c0552(0x28d)]:_0x5a35cd[_0x5c0552(0x28b)],_0x7359dc=await downloadMessageToBuffer(_0x1e9523);_0x381c3f[_0x5c0552(0x2a3)+_0x5c0552(0x279)](_0x5e2588,_0x7359dc,{'encoding':_0x5c0552(0x224)});if(_0x4a8af5&&_0x4a8af5!==_0x5e2588&&_0x381c3f[_0x5c0552(0x22f)](_0x4a8af5))try{_0x381c3f[_0x5c0552(0x245)](_0x4a8af5),info(_0x5c0552(0x211)+_0x5c0552(0x2e9)+_0x5c0552(0x1fc)+'file:\x20'+_0x4a8af5);}catch(_0x31de07){warn('[dbbackup]'+_0x5c0552(0x2a4)+_0x5c0552(0x24b)+_0x5c0552(0x212)+_0x5c0552(0x228)+(_0x31de07?.[_0x5c0552(0x28b)]||_0x31de07));}await safeSend(_0x158f93,{'text':_0x5c0552(0x253)+'eplaced\x20wi'+'th:\x20'+_0x4b6213+(_0x5c0552(0x28c)+_0x5c0552(0x2d5)+_0x5c0552(0x2c0)+_0x5c0552(0x2b4)+'\x20some\x20serv'+_0x5c0552(0x2b0)+_0x5c0552(0x1fa)+_0x5c0552(0x24f))}),info(_0x5c0552(0x211)+'\x20replaced\x20'+_0x5c0552(0x2ad)+'e\x20'+_0x5e2588+_0x5c0552(0x254)+_0x158f93);}catch(_0x5b8937){error(_0x5b8937,_0x5c0552(0x211)+_0x5c0552(0x26c)+_0x5c0552(0x2d1)),await safeSend(_0x158f93,{'text':_0x5c0552(0x25c)+_0x5c0552(0x240)+_0x5c0552(0x214)+(_0x5b8937?.[_0x5c0552(0x28b)]||_0x5b8937)});}return;}}catch(_0x486551){error(_0x486551,_0x5c0552(0x211)+_0x5c0552(0x202)+_0x5c0552(0x23a)+(_0x486551?.[_0x5c0552(0x28b)]||_0x486551));}}export async function cleanup(){const _0x4c9e98=_0x2b1436;try{botRef=null,sendApi=null,processedMessageKeys[_0x4c9e98(0x281)](_0x38bccc=>{try{clearTimeout(_0x38bccc);}catch(_0x50c656){}}),processedMessageKeys[_0x4c9e98(0x237)](),info(_0x4c9e98(0x211)+_0x4c9e98(0x2d7)+'p');}catch(_0x1501a2){warn(_0x4c9e98(0x211)+_0x4c9e98(0x23b)+_0x4c9e98(0x205)+(_0x1501a2?.['message']||_0x1501a2));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};