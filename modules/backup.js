const _0x38621b=_0x1a46;(function(_0x498356,_0x122f5a){const _0x10bad5=_0x1a46,_0x2a1336=_0x498356();while(!![]){try{const _0x29c928=-parseInt(_0x10bad5(0x2a0))/(-0x16*0x112+0xf70+0x81d)*(parseInt(_0x10bad5(0x299))/(-0xa2*0x1f+-0x2274+0x4*0xd85))+-parseInt(_0x10bad5(0x1fc))/(-0x1*-0x24be+0x1af9+-0xa9e*0x6)+-parseInt(_0x10bad5(0x259))/(-0x1*-0x23ab+0x202*-0x11+0x185*-0x1)*(-parseInt(_0x10bad5(0x1e6))/(-0x4*-0xd1+0x7*-0xc2+0x20f))+-parseInt(_0x10bad5(0x1f8))/(0x1441*0x1+-0x1e*-0x7b+-0x4f3*0x7)*(parseInt(_0x10bad5(0x220))/(0x2166+0x1*-0x92+-0x20cd))+-parseInt(_0x10bad5(0x1c8))/(-0x130d+0x1*-0x13ff+0x2*0x138a)+parseInt(_0x10bad5(0x2a5))/(-0x6*0x2a9+0x1cd9+-0xcda)*(parseInt(_0x10bad5(0x21c))/(0x155+-0x23af+0x4*0x899))+parseInt(_0x10bad5(0x1c5))/(-0xaa9*-0x1+0xea7+-0x1945)*(parseInt(_0x10bad5(0x23e))/(-0x17fc+-0x1*0x23f9+0x3c01));if(_0x29c928===_0x122f5a)break;else _0x2a1336['push'](_0x2a1336['shift']());}catch(_0xf6e965){_0x2a1336['push'](_0x2a1336['shift']());}}}(_0x3a59,0xd*-0xed03+-0x4a8b9+0x188913));import _0x4a5f48 from'fs';function _0x3a59(){const _0x16f24a=['length','ices\x20to\x20pi','\x20quick\x20cop','\x20failed\x20to','ml,\x20.yaml,','\x20file\x20does','audio','\x20getconfig','er\x20the\x20pre','B\x20replaced','string',').\x20Please\x20','fromMe','document','\x20safeSend\x20','caption','177654EIloxN','ailure','split','DB:\x20','2175003MzwGAE','kup\x20after\x20','the\x20file\x20a','tore\x20faile','isArray','B\x20from\x20bac','idated).','\x0aA\x20recover','\x20(HTTP\x20410','2.5.0','y\x20attempt\x20','message','ssage','nfig.json','forEach','replace','\x20DB:\x20','Message','.bak_for_s','ed\x20recover','\x20command\x20\x27',']\x20resolveF','B\x20(downloa','nied.','\x27\x20authoriz','o\x20download','\x20to\x20','d\x20for\x20','e\x20complete','bot','ttach\x20or\x20r','mediaMsg','10fwwsLz','er\x20getdb\x20f','re-upload\x20','\x20no\x20send\x20s','203QyUydc','t\x20validate','utf8','relative','\x20and\x20DB\x20re','sock','fig:\x20','writeFileS','❌\x20Accepted','videoMessa','\x20DB\x20reinit','documentMe','.yml','config.','❌\x20Invalid\x20','\x20remove\x20ol','extendedTe','basename','\x20and\x20re-in','DB_NAME','failed:\x20','\x20getdb\x20fai','ch).\x0a','age','\x20initializ','\x20sent\x20conf','❌\x20Could\x20no','failed\x20aft','QLite\x20head','❌\x20Uploaded','36CRPiwz','y\x20failed:\x20','eDatabase\x20','DB\x20from\x20ba','eply\x20to\x20a\x20','n/json','DB\x20(any\x20ex','after\x20getd','❌\x20Failed\x20t','getconfig','imageMessa','\x20failed','Unsupporte','peration.','\x20download\x20','contextInf','error','\x20media\x20has','.yaml','\x20backup:\x20','image','applicatio','\x20some\x20serv','ync','endsWith','extname','er:\x20\x22SQLit','8IiGflJ','key','isCommand','r:\x20','attempted\x20','stickerMes','fileName','uploaded\x20D','❌\x20File\x20not','from','n/octet-st','\x20at\x20','sticker','ig\x20file\x20','.json','DB_PATH','No\x20media\x20n','o\x20save\x20con','\x20create\x20DB','getdb','nitialize\x20','o\x20send\x20con','\x0aAn\x20attemp','ot\x20restart','ream','dbbackup','\x20replaced\x20','\x20file\x20exte','trim','unlinkSync','ter\x20getdb\x20','set','ialized\x20af','\x20expired\x20o','ompleted\x20f','file\x20heade','sendMessag','\x20onMessage','isAbsolute','o\x20error\x20du','slice','config\x20fil','shutdown\x20c','jid','b\x20failure.','setconfig','d\x20after\x20sh','\x20.json','d\x20config\x20f','[dbbackup]','ot\x20instanc','omCtx\x20erro','includes','sep','nsions:\x20.y','pe\x20or\x20no\x20m','th:\x20','o\x20restore\x20','audioMessa','has','\x20not\x20appea','./data/db','vious\x20DB\x20w','etdb','6732UCOGFx','ailable.','\x20database\x20','map','dbbackup.i','as:\x20','is\x20is\x20inde','297KavyGV','b\x20at\x20','initialize','client','wnload','7302807ScNHLP','ck\x20up\x20new\x20','or\x20getdb\x20o','urface\x20ava','\x20existing\x20','file\x20to\x20re','destinatio','quotedMess','toLowerCas','status','.bak_for_g','bot.db','text','valid\x20SQLi','readFileSy','\x20uploaded\x20','8593233CUkquW','response','d\x20media\x20ty','5901032dxmdEs','ld\x20config\x20','runtime-co','existsSync','\x20setconfig','rror:\x20','\x20send\x20fail','\x20operation','\x20bot\x20insta','failed','ptv','resolve','er\x20attempt','t\x20to\x20recov','d\x20step)','\x20access\x20de','ed\x20for\x20','xtMessage','✅\x20Active\x20D','function','⚠️\x20Warning:','push','ailed','y\x20for\x20getd','led','mkdirSync','copyFileSy','❌\x20Please\x20a','\x20header\x20va','✅\x20Config\x20r','1699510pfrICN','join'];_0x3a59=function(){return _0x16f24a;};return _0x3a59();}import _0x2c0682 from'path';import{downloadContentFromMessage}from'@whiskeysockets/baileys';import{info,warn,error}from'../utils/logger.js';import{getConfig,findConfigFile,PROJECT_ROOT}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';import{userJidFromCtx,listSudo,normalizeToJid}from'../utils/sudo.js';import{shutdownDatabase,initializeDatabase}from'../utils/database.js';export const name=_0x38621b(0x272);export const version=_0x38621b(0x205);export const priority=-0x4*0x8a4+0x1*-0x152a+-0x257*-0x18;export const commands=[_0x38621b(0x26c),'setdb',_0x38621b(0x247),_0x38621b(0x286)];let botRef=null,sendApi=null;const DEDUPE_TTL_MS=(0x2f*0x8+0x661+0x7cf*-0x1)*(0xd3d+-0x11c7+0x872),processedMessageKeys=new Map();function markProcessed(_0x36cc9e){const _0x4897ab=_0x38621b;if(!_0x36cc9e)return;if(processedMessageKeys[_0x4897ab(0x294)](_0x36cc9e))try{clearTimeout(processedMessageKeys['get'](_0x36cc9e));}catch(_0x17f1b5){}const _0x49f39e=setTimeout(()=>processedMessageKeys['delete'](_0x36cc9e),DEDUPE_TTL_MS);processedMessageKeys[_0x4897ab(0x278)](_0x36cc9e,_0x49f39e);}function isProcessed(_0x56d387){const _0xdeb700=_0x38621b;return _0x56d387&&processedMessageKeys[_0xdeb700(0x294)](_0x56d387);}async function resolveFinalDestFromCtx(_0x171189){const _0x4fd013=_0x38621b;try{if(!_0x171189||!_0x171189[_0x4fd013(0x25a)])return null;const _0x3325f3=getBotJid(),_0x45fc27=Boolean(_0x171189[_0x4fd013(0x25a)][_0x4fd013(0x1f4)]);if(_0x45fc27)return _0x3325f3||null;const _0x5a3c0f=String(_0x171189[_0x4fd013(0x25a)]['remoteJid']||'');if(!_0x5a3c0f||_0x5a3c0f[_0x4fd013(0x256)]('@g.us'))return null;const {findings:_0xd2d17b}=userJidFromCtx(_0x171189);if(!Array[_0x4fd013(0x200)](_0xd2d17b)||_0xd2d17b[_0x4fd013(0x1e8)]===0x25c3*0x1+0x26d9+-0x4c9c)return null;const _0xfd6765=await listSudo();if(!Array['isArray'](_0xfd6765)||_0xfd6765['length']===-0x1*0xa37+-0xdd8+0x180f)return null;const _0x2926c6=new Set(_0xfd6765[_0x4fd013(0x29c)](_0xf8d21a=>String(_0xf8d21a)));for(const _0x3606b9 of _0xd2d17b){if(!_0x3606b9?.[_0x4fd013(0x284)]||typeof _0x3606b9[_0x4fd013(0x284)]!==_0x4fd013(0x1f2))continue;let _0x257c42=null;try{_0x257c42=normalizeToJid(_0x3606b9[_0x4fd013(0x284)]);}catch(_0x3725f5){_0x257c42=null;}if(_0x257c42&&_0x2926c6[_0x4fd013(0x294)](_0x257c42))return _0x257c42;const _0x5b977e=(String(_0x3606b9[_0x4fd013(0x284)])[_0x4fd013(0x1fa)]('@')[-0x2485*-0x1+-0x51f*0x2+-0x1*0x1a47]||'')[_0x4fd013(0x1fa)](':')[0x56c+-0x936+0x3ca]||null;if(_0x5b977e)for(const _0x3156a5 of _0x2926c6){const _0x3cfb52=String(_0x3156a5)[_0x4fd013(0x1fa)]('@')[0x1*-0x587+0x3b*0xa3+0x1*-0x200a]||null;if(_0x3cfb52&&_0x5b977e===_0x3cfb52)return _0x3156a5;}if(_0x2926c6[_0x4fd013(0x294)](_0x3606b9[_0x4fd013(0x284)]))return _0x3606b9[_0x4fd013(0x284)];}return null;}catch(_0xa48514){return warn('['+name+(_0x4fd013(0x211)+'inalDestFr'+_0x4fd013(0x28c)+_0x4fd013(0x25c))+(_0xa48514?.[_0x4fd013(0x207)]||_0xa48514)),null;}}function setupSendApi(_0x4cbe92){const _0x58258f=_0x38621b;if(!_0x4cbe92)return;if(typeof _0x4cbe92['sendMessag'+'e']===_0x58258f(0x1db))sendApi=async(_0x2ae43e,_0x559436)=>await _0x4cbe92[_0x58258f(0x27d)+'e'](_0x2ae43e,_0x559436);else _0x4cbe92[_0x58258f(0x225)]&&typeof _0x4cbe92['sock']['sendMessag'+'e']===_0x58258f(0x1db)?sendApi=async(_0xb5648a,_0xab8bb4)=>await _0x4cbe92[_0x58258f(0x225)][_0x58258f(0x27d)+'e'](_0xb5648a,_0xab8bb4):sendApi=null;}async function safeSend(_0x234969,_0x2cfb27){const _0x19e831=_0x38621b;try{if(!_0x234969||!_0x2cfb27)return;if(sendApi)return await sendApi(_0x234969,_0x2cfb27);warn('[dbbackup]'+_0x19e831(0x21f)+_0x19e831(0x2a8)+'ilable');}catch(_0x2b7c0b){error(_0x2b7c0b,'[dbbackup]'+_0x19e831(0x1f6)+_0x19e831(0x1d1)),warn('[dbbackup]'+_0x19e831(0x1f6)+_0x19e831(0x234)+(_0x2b7c0b?.[_0x19e831(0x207)]||_0x2b7c0b));}}function resolveDbDir(){const _0x2a90ee=_0x38621b,_0x3e7cd6=getConfig(),_0x42f1eb=_0x3e7cd6&&_0x3e7cd6[_0x2a90ee(0x268)]?_0x3e7cd6[_0x2a90ee(0x268)]:_0x2a90ee(0x296),_0x370162=_0x2c0682[_0x2a90ee(0x27f)](_0x42f1eb)?_0x2c0682[_0x2a90ee(0x1d3)](_0x42f1eb):_0x2c0682[_0x2a90ee(0x1d3)](PROJECT_ROOT,_0x42f1eb);return _0x370162;}function ensureInside(_0xbb94ad,_0x5973b1){const _0x535052=_0x38621b,_0x290022=_0x2c0682['resolve'](_0xbb94ad)+_0x2c0682[_0x535052(0x28e)],_0x2c469f=_0x2c0682['resolve'](_0x5973b1);return _0x2c469f['startsWith'](_0x290022);}function getMediaFromMessage(_0x2ef9ab){const _0x11cba0=_0x38621b;if(!_0x2ef9ab)return null;if(_0x2ef9ab[_0x11cba0(0x22b)+_0x11cba0(0x208)]){const _0x3b0aa7=_0x2ef9ab[_0x11cba0(0x22b)+_0x11cba0(0x208)];return{'type':_0x11cba0(0x1f5),'mediaMsg':_0x2ef9ab,'fileName':_0x3b0aa7[_0x11cba0(0x25f)]||null,'caption':_0x3b0aa7[_0x11cba0(0x1f7)]||null};}if(_0x2ef9ab[_0x11cba0(0x248)+'ge']||_0x2ef9ab['videoMessa'+'ge']||_0x2ef9ab[_0x11cba0(0x293)+'ge']||_0x2ef9ab['stickerMes'+'sage']){const _0x4a3833=[_0x11cba0(0x248)+'ge',_0x11cba0(0x229)+'ge',_0x11cba0(0x293)+'ge',_0x11cba0(0x25e)+'sage'];for(const _0x2b6578 of _0x4a3833){if(_0x2ef9ab[_0x2b6578])return{'type':_0x2b6578[_0x11cba0(0x20b)](_0x11cba0(0x20d),''),'mediaMsg':_0x2ef9ab,'fileName':null,'caption':null};}}return null;}function getQuotedMedia(_0x111802){const _0x5cdc99=_0x38621b,_0x5b8208=_0x111802[_0x5cdc99(0x207)]&&_0x111802['message'][_0x5cdc99(0x230)+'xtMessage'];if(!_0x5b8208||!_0x5b8208[_0x5cdc99(0x24d)+'o']||!_0x5b8208[_0x5cdc99(0x24d)+'o']['quotedMess'+_0x5cdc99(0x237)])return null;const _0x16b757=_0x5b8208['contextInf'+'o']['quotedMess'+_0x5cdc99(0x237)];return getMediaFromMessage(_0x16b757);}async function downloadMessageToBuffer(_0x51ae99){const _0x1941c1=_0x38621b;if(!_0x51ae99||!_0x51ae99['message']){const _0x12cb6c=_0x51ae99,_0x5063b0=getMediaFromMessage(_0x12cb6c);if(!_0x5063b0)throw new Error(_0x1941c1(0x269)+'ode\x20found\x20'+'to\x20downloa'+'d');_0x51ae99={'message':_0x12cb6c};}const _0x4dbd45=_0x51ae99[_0x1941c1(0x207)]||{},_0x3b7b4d=[_0x1941c1(0x1f5),_0x1941c1(0x252),'video',_0x1941c1(0x1d2),_0x1941c1(0x1ee),_0x1941c1(0x265)];for(const _0x57cd07 of _0x3b7b4d){const _0x582ae5=_0x4dbd45[_0x57cd07+_0x1941c1(0x20d)];if(!_0x582ae5)continue;const _0xb9cb51=await downloadContentFromMessage(_0x582ae5,_0x57cd07),_0x1a87f2=[];for await(const _0x33245a of _0xb9cb51)_0x1a87f2[_0x1941c1(0x1dd)](_0x33245a);return Buffer['concat'](_0x1a87f2);}throw new Error(_0x1941c1(0x24a)+_0x1941c1(0x1c7)+_0x1941c1(0x290)+'edia\x20to\x20do'+_0x1941c1(0x2a4));}export async function initialize(_0x50430a){const _0x33ce56=_0x38621b;if(!_0x50430a)throw new Error(_0x33ce56(0x29d)+_0x33ce56(0x26d)+'requires\x20b'+_0x33ce56(0x28b)+'e');botRef=_0x50430a,setupSendApi(botRef),info(_0x33ce56(0x28a)+'\x20initializ'+'ed');}function _0x1a46(_0xb252d0,_0x2bd6ee){const _0x3fa7a4=_0x3a59();return _0x1a46=function(_0x581aa9,_0x15dadd){_0x581aa9=_0x581aa9-(-0x19*0x119+-0x1*0x13ed+0x3120);let _0x2ff2f5=_0x3fa7a4[_0x581aa9];return _0x2ff2f5;},_0x1a46(_0xb252d0,_0x2bd6ee);}export async function onMessage(_0x200eef){const _0xf499e7=_0x38621b;try{if(!_0x200eef||!_0x200eef[_0xf499e7(0x25a)]||!_0x200eef[_0xf499e7(0x207)])return;const _0x4d2696=String(_0x200eef[_0xf499e7(0x25a)]['remoteJid']||'');if(_0x4d2696[_0xf499e7(0x256)]('@g.us'))return;const _0x40aeac=_0x4d2696+'::'+String(_0x200eef[_0xf499e7(0x25a)]['id']||'');if(isProcessed(_0x40aeac))return;if(!_0x200eef[_0xf499e7(0x25b)])return;const _0x4834bd=_0x200eef[_0xf499e7(0x2b1)]&&typeof _0x200eef['text']===_0xf499e7(0x1f2)?_0x200eef[_0xf499e7(0x2b1)][_0xf499e7(0x275)]():'';if(!_0x4834bd)return;const _0x3ff201=_0x4834bd[_0xf499e7(0x1fa)](/\r?\n/)[0x10c*0x24+0xb07+0x103d*-0x3][_0xf499e7(0x275)]()[_0xf499e7(0x1fa)](/\s+/),_0x3532e9=(_0x3ff201[0x1e6a+0xb*-0x238+0x2*-0x301]||'')['toLowerCas'+'e']();if(!commands[_0xf499e7(0x28d)](_0x3532e9))return;if(!botRef)botRef=_0x200eef[_0xf499e7(0x219)]||_0x200eef[_0xf499e7(0x2a3)]||null;if(!sendApi)setupSendApi(botRef);if(!botRef){warn(_0xf499e7(0x28a)+_0xf499e7(0x1d0)+'nce\x20not\x20av'+_0xf499e7(0x29a));return;}const _0x1d6f7d=await resolveFinalDestFromCtx(_0x200eef);if(!_0x1d6f7d)return;markProcessed(_0x40aeac),info(_0xf499e7(0x28a)+_0xf499e7(0x210)+_0x3532e9+(_0xf499e7(0x214)+_0xf499e7(0x1d8))+_0x1d6f7d);if(_0x3532e9===_0xf499e7(0x26c)){const _0x2ce630=getConfig(),_0x402bb4=resolveDbDir(),_0x2e6cc4=_0x2ce630&&_0x2ce630[_0xf499e7(0x233)]?String(_0x2ce630[_0xf499e7(0x233)]):_0xf499e7(0x2b0),_0x27da6d=_0x3ff201[_0xf499e7(0x1e8)]>=0x268b+-0x15a6+-0x83*0x21?_0x3ff201['slice'](-0x2173+-0x1*-0xe91+0x1*0x12e3)['join']('\x20')[_0xf499e7(0x275)]():_0x2e6cc4,_0x2e2e62=_0x2c0682[_0xf499e7(0x1d3)](_0x402bb4,_0x27da6d);if(!ensureInside(_0x402bb4,_0x2e2e62)){await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x22e)+'filename\x20/'+_0xf499e7(0x1d7)+_0xf499e7(0x213)});return;}if(!_0x4a5f48['existsSync'](_0x2e2e62)){await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x261)+'\x20found:\x20'+_0x27da6d});return;}const _0x33d7fb=_0x2c0682[_0xf499e7(0x1e7)](_0x402bb4,_0x2c0682[_0xf499e7(0x231)](_0x2e2e62)+(_0xf499e7(0x2af)+_0xf499e7(0x298)));let _0x2291fa=![];try{await shutdownDatabase(),_0x2291fa=!![],info(_0xf499e7(0x28a)+'\x20database\x20'+'shutdown\x20c'+_0xf499e7(0x27b)+_0xf499e7(0x2a7)+_0xf499e7(0x24b));try{_0x4a5f48[_0xf499e7(0x1e2)+'nc'](_0x2e2e62,_0x33d7fb),info(_0xf499e7(0x28a)+'\x20quick\x20cop'+_0xf499e7(0x1df)+_0xf499e7(0x2a1)+_0x33d7fb);}catch(_0x6dd104){warn(_0xf499e7(0x28a)+_0xf499e7(0x1ea)+_0xf499e7(0x23f)+(_0x6dd104?.['message']||_0x6dd104));}const _0x50cb12=_0x4a5f48['readFileSy'+'nc'](_0x2e2e62);await safeSend(_0x1d6f7d,{'document':_0x50cb12,'fileName':_0x2c0682['basename'](_0x2e2e62),'mimetype':'applicatio'+_0xf499e7(0x263)+_0xf499e7(0x271)}),info(_0xf499e7(0x28a)+'\x20sent\x20DB\x20f'+'ile\x20'+_0x2e2e62+_0xf499e7(0x216)+_0x1d6f7d),await initializeDatabase(),info(_0xf499e7(0x28a)+_0xf499e7(0x22a)+_0xf499e7(0x279)+_0xf499e7(0x277)+'operation.');}catch(_0x1bb334){error(_0x1bb334,_0xf499e7(0x28a)+_0xf499e7(0x235)+_0xf499e7(0x1e0));try{_0x2291fa&&(await initializeDatabase(),info('[dbbackup]'+_0xf499e7(0x238)+_0xf499e7(0x240)+_0xf499e7(0x25d)+_0xf499e7(0x245)+_0xf499e7(0x285)));}catch(_0x436fdd){error(_0x436fdd,_0xf499e7(0x28a)+_0xf499e7(0x238)+_0xf499e7(0x240)+_0xf499e7(0x23b)+_0xf499e7(0x21d)+_0xf499e7(0x1f9));}await safeSend(_0x1d6f7d,{'text':'❌\x20Failed\x20t'+'o\x20retrieve'+_0xf499e7(0x20c)+(_0x1bb334?.[_0xf499e7(0x207)]||_0x1bb334)+(_0xf499e7(0x203)+_0xf499e7(0x206)+'was\x20made.')});}finally{try{if(_0x4a5f48['existsSync'](_0x33d7fb))_0x4a5f48[_0xf499e7(0x276)](_0x33d7fb);}catch(_0x2d70f5){}}return;}if(_0x3532e9==='setdb'){let _0x5d7251=getMediaFromMessage(_0x200eef[_0xf499e7(0x207)])||getQuotedMedia(_0x200eef),_0x152939=!getMediaFromMessage(_0x200eef[_0xf499e7(0x207)])&&!!getQuotedMedia(_0x200eef);if(!_0x5d7251||!_0x5d7251[_0xf499e7(0x21b)]){await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x1e3)+'ttach\x20or\x20r'+_0xf499e7(0x242)+_0xf499e7(0x2aa)+'place\x20the\x20'+_0xf499e7(0x244)+'tension;\x20w'+'ill\x20be\x20val'+_0xf499e7(0x202)});return;}const _0x530028=String(_0x5d7251['fileName']||'')['trim'](),_0x430154=getConfig(),_0x12e838=resolveDbDir();let _0x25840b=_0x430154&&_0x430154['DB_NAME']?String(_0x430154[_0xf499e7(0x233)]):_0xf499e7(0x2b0),_0x5c7cc6=_0x2c0682[_0xf499e7(0x257)](_0x25840b)[_0xf499e7(0x2ad)+'e']();if(!_0x5c7cc6){_0x25840b=_0x25840b||_0xf499e7(0x2b0),_0x5c7cc6=_0x2c0682[_0xf499e7(0x257)](_0x25840b)||'.db';if(!_0x2c0682[_0xf499e7(0x257)](_0x25840b))_0x25840b=''+_0x25840b+_0x5c7cc6;}const _0x57e6fa=_0x2c0682[_0xf499e7(0x1d3)](_0x12e838,_0x25840b);try{_0x4a5f48[_0xf499e7(0x1e1)](_0x12e838,{'recursive':!![]});}catch(_0x4d2925){}if(!ensureInside(_0x12e838,_0x57e6fa)){await safeSend(_0x1d6f7d,{'text':'❌\x20Invalid\x20'+_0xf499e7(0x2ab)+'n\x20path.'});return;}const _0x2f85ad=_0x152939?_0x200eef[_0xf499e7(0x207)][_0xf499e7(0x230)+_0xf499e7(0x1d9)][_0xf499e7(0x24d)+'o']['quotedMess'+_0xf499e7(0x237)]:_0x200eef['message'];let _0x2f7728;try{_0x2f7728=await downloadMessageToBuffer(_0x2f85ad);}catch(_0x2b2060){error(_0x2b2060,_0xf499e7(0x28a)+_0xf499e7(0x1eb)+_0xf499e7(0x24c)+_0xf499e7(0x260)+_0xf499e7(0x212)+_0xf499e7(0x1d6));const _0x396068=_0x2b2060?.[_0xf499e7(0x1c6)]?.[_0xf499e7(0x2ae)]||_0x2b2060?.[_0xf499e7(0x2ae)]||null;_0x396068===-0x7a3+-0x1ec7*-0x1+-0x158a?await safeSend(_0x1d6f7d,{'text':'❌\x20Failed\x20t'+_0xf499e7(0x215)+':\x20uploaded'+_0xf499e7(0x24f)+_0xf499e7(0x27a)+'n\x20WhatsApp'+_0xf499e7(0x204)+_0xf499e7(0x1f3)+_0xf499e7(0x21e)+_0xf499e7(0x1fe)+'nd\x20try\x20aga'+'in.'}):await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x246)+_0xf499e7(0x215)+_0xf499e7(0x1c4)+'file:\x20'+(_0x2b2060?.['message']||_0x2b2060)});return;}try{const _0x406e61=_0x2f7728[_0xf499e7(0x281)](0x1f04+0x1*0x1f3c+0x40*-0xf9,0x265f+-0xe53+-0x133*0x14),_0x34260a=Buffer[_0xf499e7(0x262)]('SQLite\x20for'+'mat\x203\x00','ascii');if(!_0x406e61['equals'](_0x34260a)){await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x23d)+_0xf499e7(0x1ed)+_0xf499e7(0x295)+'r\x20to\x20be\x20a\x20'+_0xf499e7(0x1c2)+'te\x20DB\x20(hea'+'der\x20mismat'+_0xf499e7(0x236)+('Expected\x20S'+_0xf499e7(0x23c)+_0xf499e7(0x258)+'e\x20format\x203'+'\x5c0\x22.\x20If\x20th'+_0xf499e7(0x29f)+'ed\x20a\x20DB,\x20r'+'e-check\x20an'+'d\x20re-uploa'+'d.')});return;}}catch(_0xcc4c94){error(_0xcc4c94,'[dbbackup]'+_0xf499e7(0x1e4)+'lidation\x20f'+_0xf499e7(0x1de)),await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x23a)+_0xf499e7(0x221)+_0xf499e7(0x1c4)+_0xf499e7(0x27c)+_0xf499e7(0x25c)+(_0xcc4c94?.[_0xf499e7(0x207)]||_0xcc4c94)});return;}const _0x485649=_0x2c0682[_0xf499e7(0x1e7)](_0x12e838,_0x2c0682[_0xf499e7(0x231)](_0x57e6fa)+(_0xf499e7(0x20e)+_0xf499e7(0x298)));let _0x531cb6=![];try{await shutdownDatabase(),_0x531cb6=!![],info('[dbbackup]'+_0xf499e7(0x29b)+_0xf499e7(0x283)+'ompleted\x20f'+'or\x20restore'+_0xf499e7(0x1cf)+'.');if(_0x4a5f48[_0xf499e7(0x1cb)](_0x57e6fa))try{_0x4a5f48[_0xf499e7(0x1e2)+'nc'](_0x57e6fa,_0x485649),info(_0xf499e7(0x28a)+_0xf499e7(0x2a9)+'DB\x20backed\x20'+'up\x20to\x20'+_0x485649);}catch(_0xd5e073){warn(_0xf499e7(0x28a)+_0xf499e7(0x1eb)+_0xf499e7(0x26b)+_0xf499e7(0x251)+(_0xd5e073?.[_0xf499e7(0x207)]||_0xd5e073)),await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x1dc)+'\x20could\x20not'+'\x20create\x20DB'+'\x20backup:\x20'+(_0xd5e073?.[_0xf499e7(0x207)]||_0xd5e073)});}_0x4a5f48['writeFileS'+'ync'](_0x57e6fa,_0x2f7728),info(_0xf499e7(0x28a)+'\x20overwritt'+'en\x20DB\x20file'+_0xf499e7(0x264)+_0x57e6fa),await initializeDatabase(),await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x1da)+_0xf499e7(0x1f1)+_0xf499e7(0x232)+'itialized\x20'+_0xf499e7(0x29e)+_0x2c0682[_0xf499e7(0x223)](PROJECT_ROOT,_0x57e6fa)}),info(_0xf499e7(0x28a)+'\x20DB\x20restor'+_0xf499e7(0x218)+_0xf499e7(0x224)+_0xf499e7(0x2a2)+_0xf499e7(0x217)+_0x1d6f7d);}catch(_0x3d27f1){error(_0x3d27f1,_0xf499e7(0x28a)+'\x20setdb\x20res'+_0xf499e7(0x1ff)+_0xf499e7(0x287)+'utdown');try{_0x4a5f48[_0xf499e7(0x1cb)](_0x485649)&&(_0x4a5f48[_0xf499e7(0x1e2)+'nc'](_0x485649,_0x57e6fa),info(_0xf499e7(0x28a)+'\x20restored\x20'+_0xf499e7(0x241)+'ckup\x20due\x20t'+_0xf499e7(0x280)+'ring\x20resto'+'re'));}catch(_0x2b1015){error(_0x2b1015,_0xf499e7(0x28a)+_0xf499e7(0x1eb)+'\x20restore\x20D'+_0xf499e7(0x201)+_0xf499e7(0x1fd)+_0xf499e7(0x24e));}try{await initializeDatabase();}catch(_0x59514b){error(_0x59514b,'[dbbackup]'+_0xf499e7(0x238)+_0xf499e7(0x240)+_0xf499e7(0x23b)+_0xf499e7(0x1d4)+_0xf499e7(0x20f)+'y');}await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x246)+_0xf499e7(0x292)+_0xf499e7(0x1fb)+(_0x3d27f1?.[_0xf499e7(0x207)]||_0x3d27f1)+(_0xf499e7(0x26f)+_0xf499e7(0x1d5)+_0xf499e7(0x1f0)+_0xf499e7(0x297)+'as\x20made.')});}finally{try{if(_0x4a5f48[_0xf499e7(0x1cb)](_0x485649))_0x4a5f48[_0xf499e7(0x276)](_0x485649);}catch(_0x662e61){}}return;}if(_0x3532e9===_0xf499e7(0x247)){const _0x2dc476=findConfigFile();if(_0x2dc476){try{const _0x1d1116=_0x4a5f48[_0xf499e7(0x1c3)+'nc'](_0x2dc476),_0x33b7b9=_0x2dc476[_0xf499e7(0x2ad)+'e']()[_0xf499e7(0x256)](_0xf499e7(0x267))?_0xf499e7(0x253)+_0xf499e7(0x243):'text/x-yam'+'l';await safeSend(_0x1d6f7d,{'document':_0x1d1116,'fileName':_0x2c0682['basename'](_0x2dc476),'mimetype':_0x33b7b9}),info(_0xf499e7(0x28a)+_0xf499e7(0x239)+_0xf499e7(0x266)+_0x2dc476+_0xf499e7(0x216)+_0x1d6f7d);}catch(_0x208456){error(_0x208456,_0xf499e7(0x28a)+_0xf499e7(0x1ef)+_0xf499e7(0x1ce)+'ed'),await safeSend(_0x1d6f7d,{'text':'❌\x20Failed\x20t'+_0xf499e7(0x26e)+'fig\x20file:\x20'+(_0x208456?.[_0xf499e7(0x207)]||_0x208456)});}return;}const _0x134e65=getConfig()||{},_0x375e22=Buffer[_0xf499e7(0x262)](JSON['stringify'](_0x134e65,null,-0x2501+-0x1*-0x15dd+0xf26),_0xf499e7(0x222));await safeSend(_0x1d6f7d,{'document':_0x375e22,'fileName':_0xf499e7(0x1ca)+_0xf499e7(0x209),'mimetype':'applicatio'+'n/json'});return;}if(_0x3532e9===_0xf499e7(0x286)){let _0x8dfa4b=getMediaFromMessage(_0x200eef[_0xf499e7(0x207)])||getQuotedMedia(_0x200eef),_0x88509e=!getMediaFromMessage(_0x200eef[_0xf499e7(0x207)])&&!!getQuotedMedia(_0x200eef);if(!_0x8dfa4b||!_0x8dfa4b[_0xf499e7(0x21b)]){await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x1e3)+_0xf499e7(0x21a)+_0xf499e7(0x242)+_0xf499e7(0x282)+'e.'});return;}const _0x37a277=String(_0x8dfa4b[_0xf499e7(0x25f)]||'')[_0xf499e7(0x275)]()[_0xf499e7(0x2ad)+'e'](),_0xcead2b=[_0xf499e7(0x22c),_0xf499e7(0x250),_0xf499e7(0x267)],_0x356948=_0x2c0682[_0xf499e7(0x257)](_0x37a277||'');if(!_0xcead2b['includes'](_0x356948)){await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x228)+_0xf499e7(0x274)+_0xf499e7(0x28f)+_0xf499e7(0x1ec)+_0xf499e7(0x288)});return;}const _0x5f5947=findConfigFile(),_0xcbc255=_0x356948===_0xf499e7(0x267)?'config.jso'+'n':'config.yml',_0xfa0eb4=_0x2c0682[_0xf499e7(0x1d3)](PROJECT_ROOT,_0xcbc255);if(!ensureInside(PROJECT_ROOT,_0xfa0eb4)){await safeSend(_0x1d6f7d,{'text':'❌\x20Invalid\x20'+_0xf499e7(0x2ab)+'n\x20path.'});return;}try{const _0x2a9477=_0x88509e?_0x200eef[_0xf499e7(0x207)][_0xf499e7(0x230)+_0xf499e7(0x1d9)]['contextInf'+'o'][_0xf499e7(0x2ac)+_0xf499e7(0x237)]:_0x200eef[_0xf499e7(0x207)],_0x15bb13=await downloadMessageToBuffer(_0x2a9477);_0x4a5f48[_0xf499e7(0x227)+_0xf499e7(0x255)](_0xfa0eb4,_0x15bb13,{'encoding':_0xf499e7(0x222)});if(_0x5f5947&&_0x5f5947!==_0xfa0eb4&&_0x4a5f48[_0xf499e7(0x1cb)](_0x5f5947))try{_0x4a5f48['unlinkSync'](_0x5f5947),info(_0xf499e7(0x28a)+'\x20removed\x20o'+_0xf499e7(0x1c9)+'file:\x20'+_0x5f5947);}catch(_0x750ab){warn(_0xf499e7(0x28a)+'\x20could\x20not'+_0xf499e7(0x22f)+_0xf499e7(0x289)+'ile:\x20'+(_0x750ab?.[_0xf499e7(0x207)]||_0x750ab));}await safeSend(_0x1d6f7d,{'text':_0xf499e7(0x1e5)+'eplaced\x20wi'+_0xf499e7(0x291)+_0xcbc255+('\x0aNote:\x20A\x20b'+_0xf499e7(0x270)+'\x20may\x20be\x20re'+'quired\x20for'+_0xf499e7(0x254)+_0xf499e7(0x1e9)+_0xf499e7(0x2a6)+_0xf499e7(0x22d))}),info('[dbbackup]'+_0xf499e7(0x273)+_0xf499e7(0x282)+'e\x20'+_0xfa0eb4+'\x20from\x20'+_0x1d6f7d);}catch(_0x3cd207){error(_0x3cd207,_0xf499e7(0x28a)+_0xf499e7(0x1cc)+_0xf499e7(0x249)),await safeSend(_0x1d6f7d,{'text':'❌\x20Failed\x20t'+_0xf499e7(0x26a)+_0xf499e7(0x226)+(_0x3cd207?.[_0xf499e7(0x207)]||_0x3cd207)});}return;}}catch(_0x5b8eda){error(_0x5b8eda,_0xf499e7(0x28a)+_0xf499e7(0x27e)+'\x20error:\x20'+(_0x5b8eda?.[_0xf499e7(0x207)]||_0x5b8eda));}}export async function cleanup(){const _0x39819b=_0x38621b;try{botRef=null,sendApi=null,processedMessageKeys[_0x39819b(0x20a)](_0x6b4cba=>{try{clearTimeout(_0x6b4cba);}catch(_0x2bfcb5){}}),processedMessageKeys['clear'](),info('[dbbackup]'+'\x20cleaned\x20u'+'p');}catch(_0x12903b){warn(_0x39819b(0x28a)+'\x20cleanup\x20e'+_0x39819b(0x1cd)+(_0x12903b?.[_0x39819b(0x207)]||_0x12903b));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};