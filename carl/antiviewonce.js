const _0x2439e3=_0x4aa1;function _0x4aa1(_0x334463,_0x15923b){const _0x1c40e4=_0x51cb();return _0x4aa1=function(_0x54038e,_0x5b23eb){_0x54038e=_0x54038e-(0x4a9*-0x5+-0x5db+-0x62f*-0x5);let _0x2a26d3=_0x1c40e4[_0x54038e];return _0x2a26d3;},_0x4aa1(_0x334463,_0x15923b);}(function(_0x78fb09,_0xc7fac5){const _0x97f37a=_0x4aa1,_0x34d0db=_0x78fb09();while(!![]){try{const _0x7f80b=-parseInt(_0x97f37a(0x1e2))/(-0x20a4+-0x1f*-0xca+0x82f)*(parseInt(_0x97f37a(0x2b5))/(-0x9f4+-0x2*0x355+0x85*0x20))+-parseInt(_0x97f37a(0x1fd))/(0x1a*-0xd9+-0x1f48+0x171*0x25)*(parseInt(_0x97f37a(0x1d0))/(0x25e5+-0x1693+-0xf4e))+parseInt(_0x97f37a(0x242))/(-0xb71+0x19b3+-0xe3d)*(parseInt(_0x97f37a(0x27a))/(-0x2139*0x1+-0x1d78*-0x1+0x3c7))+-parseInt(_0x97f37a(0x2b7))/(-0x4d7*-0x1+0x13*-0x81+0x4c3)*(parseInt(_0x97f37a(0x1de))/(-0x24a*-0x3+0x7*0x223+0x7*-0x31d))+parseInt(_0x97f37a(0x240))/(-0x2*0xe4e+-0x1ce6+0x398b)+parseInt(_0x97f37a(0x288))/(0x1ba2+0x23f+-0x1dd7*0x1)*(parseInt(_0x97f37a(0x222))/(0x20*-0x6+0x229a+0x3*-0xb45))+-parseInt(_0x97f37a(0x2b9))/(0x10de+0xf*-0x8b+-0x1*0x8ad)*(-parseInt(_0x97f37a(0x1e8))/(-0xf22*0x1+-0x2b*-0x57+0x92));if(_0x7f80b===_0xc7fac5)break;else _0x34d0db['push'](_0x34d0db['shift']());}catch(_0x4e8620){_0x34d0db['push'](_0x34d0db['shift']());}}}(_0x51cb,0x9a9*-0x86+0x3*0xf7cf+0xb2ff0));import{info,warn,error}from'../utils/logger.js';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isSudo}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';export const name=_0x2439e3(0x24f);function _0x51cb(){const _0x425fd3=['ngs\x20(PM-On','ument\x20to\x20','\x20p|g`\x0a','\x20set\x20mode.','messages.u','overed\x20vid','ge\x20with\x20a\x20','listRespon','alue\x20TEXT\x20',']\x20no\x20confi','VALUES\x20(?,','caption','nation\x20res','able','seMessage','eo\x20to\x20','KIP_IF_TAR','JID\x20set.','CONFLICT(k','\x0a\x20\x20\x20\x20\x20\x20CRE','error:\x20','Content\x20er','length','very.',']\x20download','et*:\x20','quotedMess','192llPGVp',']\x20hotReloa','emoteJid','SELECT\x20val','\x20group:\x20','nce\x20from\x20','viewOnceMe','not\x20set','and','underscore','_prefs\x20(ke','remoteJid','status@bro','target_jid','10bZIqKK','_COMMANDS_','clear','|off`\x0a','group_comm',']\x20forwardR','alized\x20lis','indexOf','recovered.','r:\x20','no\x20sendMes','delete','pushName','d\x20media\x20ty','NOT\x20NULL,\x0a','ed.value,\x20','IMARY\x20KEY,','selectedBu','GET_EQUALS','_SOURCE','wonce','value','ey\x20TEXT\x20PR','ded:\x20','push','ing\x20recove',']\x20handleCo',',\x20target=','_jid\x27',']\x20pref\x20sav','rget','catch',':\x20DB\x20write','image','\x20inner\x20med','ce_prefs\x20(',']\x20refreshC',']\x20cleanup\x20','to\x20GROUP.\x20','D\x20saved:\x20',']\x20ensureSc','`\x20`viewonc','requires\x20b','*Notificat','Configured','1519906HqUjWl','unset','287YdoFbv',']\x20DB\x20ready','22476eNSVkq','once\x20Setti','dated_at)\x20','\x20message\x20t','imageMessa','unknown\x20us','sock','fs\x20WHERE\x20k','ble;\x20falli','trim','ot\x20instanc','STS\x20viewon','[viewonce]','buttonsRes','\x20-\x20attempt','contextInf','extendedTe','dated_at\x20I','in\x20a\x20view-','add','ey=\x27allow_','once\x20inner',':\x20reload\x20a','isViewOnce','d\x20unavaila','ore)\x20to\x20at','at\x20starts\x20','e\x20handler\x20',']\x20initiali','o\x20download','4828aJFFdA','string','IF\x20NOT\x20EXI','charAt','\x20?,\x20?)\x20ON\x20','\x20that\x20mess','video',',\x20notify=','\x20in\x20','text','\x20save\x20noti','allow_grou','age',']\x20handleUp','209288lnbBut','GROUP\x20(','=excluded.','\x20(mode=','1vRtdRo','\x0a\x0afrom:\x20','*Anti-View','exec','Not\x20set','\x20`viewonce','7449KbTQCB','slice','endsWith','ssage','remove','OFF','rmation\x20ta',']\x20Reply\x20st','concat','ATE\x20TABLE\x20','get','xtMessage','ue\x20FROM\x20vi','*Target\x20JI','wId','dConfig\x20re','selectedRo','notify_vie','ia\x20buffer','ecoveredTo','ly)*\x0a\x0a','339KcGaER','get\x20JID.','Recovered\x0a','hema\x20faile','\x20Notificat','ror:\x20','essage\x20did','updated_at','oup_comman','values','participan','D\x20cleared.','nitialize\x20','\x20\x20\x20);\x0a\x20\x20\x20\x20','o\x20*','\x20error:\x20','ssageV2','isArray','hat\x20*start','tener)','\x20in\x20chat\x20','ey=\x27target','singleSele','fter\x20write','urrently\x20*','ng\x20back\x20to','floor','viewonce.i','ndler\x20erro','ned\x20false','end\x20failed',']\x20quoted\x20v',']\x20Sent\x20rec',']\x20savePref','t\x20supporte','isCommand','ions*:\x20','1483603FmDkEO','\x20ctx.key.r','fromMe','has','message','ey)\x20DO\x20UPD','p_commands','unknown\x20ch','\x20clear\x20tar','ey=\x27notify','lue=exclud',']\x20upsertHa',']\x20failed\x20t','message\x20th','gistration','@g.us','arts\x20with\x20','ewonce_pre','2.0.0-patc','sendMessag','function','iew-once\x20i','mode','👁️\x20Detected','ctReply','NTEGER\x20DEF','\x20Failed\x20to','unknown','Dest\x20retur','nner\x20is\x20no','4303458DzkelU','ttonId','136685nBWkzQ',']\x20onMessag','ands\x27','bin','setting.','applicatio','olved','\x20Target\x20JI','ey=?','\x20\x20\x20\x20\x20\x20\x20\x20up','\x20—\x20','toLowerCas','conversati','viewonce','split','View-Once\x20','LLOW_GROUP','\x20cleaned\x20u','set','VIEWONCE_S','To\x20recover','VIEWONCE_A','ed\x20&\x20reloa','videoMessa','ge\x20to\x20','ATE\x20SET\x20va','\x20notify\x20on','DEFAULT','key'];_0x51cb=function(){return _0x425fd3;};return _0x51cb();}export const version=_0x2439e3(0x234)+'hed';export const priority=0x1dc3+0x239a+-0x2f*0x162;export const commands=['viewonce'];export const configKeys=['VIEWONCE_S'+_0x2439e3(0x26f)+_0x2439e3(0x29a)+_0x2439e3(0x29b),'VIEWONCE_A'+_0x2439e3(0x252)+_0x2439e3(0x289)+_0x2439e3(0x25d)];let botRef=null,SKIP_IF_TARGET_EQUALS_SOURCE=!![],ALLOW_GROUP_COMMANDS_DEFAULT=![],MODE='p',TARGET_JID=null,ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT,NOTIFY_VIEWONCE=![];function refreshConfig(){const _0x4fa96b=_0x2439e3;try{const _0x57e442=getConfig()||{};SKIP_IF_TARGET_EQUALS_SOURCE=_0x57e442['VIEWONCE_S'+_0x4fa96b(0x26f)+_0x4fa96b(0x29a)+_0x4fa96b(0x29b)]!==undefined?Boolean(_0x57e442[_0x4fa96b(0x255)+'KIP_IF_TAR'+_0x4fa96b(0x29a)+_0x4fa96b(0x29b)]):SKIP_IF_TARGET_EQUALS_SOURCE,ALLOW_GROUP_COMMANDS_DEFAULT=Boolean(_0x57e442[_0x4fa96b(0x257)+'LLOW_GROUP'+_0x4fa96b(0x289)+_0x4fa96b(0x25d)]??ALLOW_GROUP_COMMANDS_DEFAULT),info('['+name+(']\x20config\x20r'+'efreshed'));}catch(_0x2675ed){warn('['+name+(_0x4fa96b(0x2ac)+'onfig\x20erro'+_0x4fa96b(0x291))+(_0x2675ed?.[_0x4fa96b(0x226)]||_0x2675ed));}}try{hotReloadConfig&&hotReloadConfig((_0x45c5b9=[])=>{const _0x2a54bf=_0x2439e3,_0x16fc4d=[_0x2a54bf(0x255)+_0x2a54bf(0x26f)+'GET_EQUALS'+_0x2a54bf(0x29b),_0x2a54bf(0x257)+'LLOW_GROUP'+_0x2a54bf(0x289)+'DEFAULT'];if((_0x45c5b9||[])['some'](_0x322a4b=>_0x16fc4d['includes'](_0x322a4b)))refreshConfig();});}catch(_0x4cd468){warn('['+name+(_0x2439e3(0x27b)+_0x2439e3(0x1f7)+_0x2439e3(0x230)+'\x20failed:\x20')+(_0x4cd468?.['message']||_0x4cd468));}refreshConfig();async function ensureSchema(){const _0x46c03c=_0x2439e3;try{await db[_0x46c03c(0x1e5)](_0x46c03c(0x272)+_0x46c03c(0x1f1)+_0x46c03c(0x1d2)+_0x46c03c(0x2c4)+_0x46c03c(0x2ab)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20k'+_0x46c03c(0x29e)+_0x46c03c(0x298)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20v'+_0x46c03c(0x267)+_0x46c03c(0x296)+_0x46c03c(0x24b)+_0x46c03c(0x1c3)+_0x46c03c(0x23b)+'AULT\x200\x0a\x20\x20\x20'+_0x46c03c(0x20a));try{const _0x1f8909=await db[_0x46c03c(0x1f2)](_0x46c03c(0x27d)+_0x46c03c(0x1f4)+_0x46c03c(0x233)+_0x46c03c(0x2c0)+'ey=\x27mode\x27');MODE=_0x1f8909?.['value']==='g'?'g':'p';}catch(_0x21ca61){}try{const _0x4b75da=await db[_0x46c03c(0x1f2)]('SELECT\x20val'+_0x46c03c(0x1f4)+_0x46c03c(0x233)+_0x46c03c(0x2c0)+_0x46c03c(0x212)+_0x46c03c(0x2a4));TARGET_JID=_0x4b75da?.['value']||null;}catch(_0xf06656){TARGET_JID=null;}try{const _0x180cdf=await db[_0x46c03c(0x1f2)](_0x46c03c(0x27d)+_0x46c03c(0x1f4)+_0x46c03c(0x233)+_0x46c03c(0x2c0)+_0x46c03c(0x1c6)+_0x46c03c(0x28c)+_0x46c03c(0x244));ALLOW_GROUP_COMMANDS=_0x180cdf?.[_0x46c03c(0x29d)]==='1';}catch(_0x183baa){ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT;}try{const _0x2377be=await db[_0x46c03c(0x1f2)](_0x46c03c(0x27d)+_0x46c03c(0x1f4)+_0x46c03c(0x233)+_0x46c03c(0x2c0)+_0x46c03c(0x22b)+'_viewonce\x27');NOTIFY_VIEWONCE=_0x2377be?.[_0x46c03c(0x29d)]==='1';}catch(_0x318c63){NOTIFY_VIEWONCE=![];}info('['+name+(_0x46c03c(0x2b8)+_0x46c03c(0x1e1))+MODE+_0x46c03c(0x2a3)+(TARGET_JID||_0x46c03c(0x2b6))+_0x46c03c(0x1d7)+NOTIFY_VIEWONCE+(',\x20allow_gr'+_0x46c03c(0x205)+'ds=')+ALLOW_GROUP_COMMANDS+')');}catch(_0x3c4fe5){error(_0x3c4fe5,'['+name+(_0x46c03c(0x2b0)+_0x46c03c(0x200)+'d'));throw _0x3c4fe5;}}async function savePref(_0x7c0e5,_0x45a573){const _0x2082fc=_0x2439e3;try{const _0x36b4c5=Math[_0x2082fc(0x217)](Date['now']()/(-0x20d1+-0x4ff+0x29b8));await db['run']('INSERT\x20INT'+'O\x20viewonce'+_0x2082fc(0x284)+'y,value,up'+_0x2082fc(0x2bb)+_0x2082fc(0x269)+_0x2082fc(0x1d4)+_0x2082fc(0x271)+_0x2082fc(0x227)+_0x2082fc(0x25b)+_0x2082fc(0x22c)+_0x2082fc(0x297)+_0x2082fc(0x204)+_0x2082fc(0x1e0)+'updated_at',[_0x7c0e5,_0x45a573,_0x36b4c5]);}catch(_0x28629d){return warn('['+name+(_0x2082fc(0x21e)+_0x2082fc(0x2a8)+'\x20failed\x20fo'+'r\x20')+_0x7c0e5+'='+_0x45a573+_0x2082fc(0x24c)+(_0x28629d?.[_0x2082fc(0x226)]||_0x28629d)),![];}try{const _0x4ccaa3=await db[_0x2082fc(0x1f2)](_0x2082fc(0x27d)+_0x2082fc(0x1f4)+_0x2082fc(0x233)+'fs\x20WHERE\x20k'+_0x2082fc(0x24a),[_0x7c0e5]),_0x2cd886=_0x4ccaa3?.[_0x2082fc(0x29d)]??_0x45a573;if(_0x7c0e5===_0x2082fc(0x238))MODE=_0x2cd886==='g'?'g':'p';if(_0x7c0e5==='target_jid')TARGET_JID=_0x2cd886||null;if(_0x7c0e5==='allow_grou'+_0x2082fc(0x228))ALLOW_GROUP_COMMANDS=_0x2cd886==='1';if(_0x7c0e5===_0x2082fc(0x1f9)+_0x2082fc(0x29c))NOTIFY_VIEWONCE=_0x2cd886==='1';return info('['+name+(_0x2082fc(0x2a5)+_0x2082fc(0x258)+_0x2082fc(0x29f))+_0x7c0e5+'='+_0x2cd886),!![];}catch(_0x5e0775){warn('['+name+(_0x2082fc(0x21e)+_0x2082fc(0x1c8)+_0x2082fc(0x214)+'\x20failed\x20fo'+'r\x20')+_0x7c0e5+'='+_0x45a573+'\x20—\x20'+(_0x5e0775?.[_0x2082fc(0x226)]||_0x5e0775));if(_0x7c0e5===_0x2082fc(0x238))MODE=_0x45a573==='g'?'g':'p';if(_0x7c0e5===_0x2082fc(0x287))TARGET_JID=_0x45a573||null;if(_0x7c0e5===_0x2082fc(0x1db)+_0x2082fc(0x228))ALLOW_GROUP_COMMANDS=_0x45a573==='1';if(_0x7c0e5===_0x2082fc(0x1f9)+'wonce')NOTIFY_VIEWONCE=_0x45a573==='1';return!![];}}function normalizeToUserJid(_0x17be31){const _0x22b502=_0x2439e3;try{if(!_0x17be31||typeof _0x17be31!==_0x22b502(0x1d1))return _0x17be31;const _0x579a1d=_0x17be31[_0x22b502(0x28f)]('@');if(_0x579a1d===-(-0x503+0x710+-0x20c))return _0x17be31;const _0x536bcd=_0x17be31[_0x22b502(0x1e9)](0x1e6f+0x24ee+-0x435d,_0x579a1d),_0x5129c2=_0x17be31[_0x22b502(0x1e9)](_0x579a1d),_0x11a49a=_0x536bcd[_0x22b502(0x28f)](':');if(_0x11a49a===-(0x1*0x1e4f+0x9d7*0x3+-0x3fd*0xf))return _0x17be31;return _0x536bcd[_0x22b502(0x1e9)](-0x977+-0x176c*-0x1+-0xdf5,_0x11a49a)+_0x5129c2;}catch(_0x12f130){return _0x17be31;}}async function trySend(_0x2cc1a1,_0x4bbd0a){const _0x1f6704=_0x2439e3;try{const _0x421af9=normalizeToUserJid(String(_0x2cc1a1));if(!_0x421af9)throw new Error('no\x20send\x20ta'+_0x1f6704(0x2a6));if(typeof botRef?.['sendMessag'+'e']==='function'){await botRef[_0x1f6704(0x235)+'e'](_0x421af9,_0x4bbd0a);return;}if(botRef?.[_0x1f6704(0x2bf)]&&typeof botRef[_0x1f6704(0x2bf)][_0x1f6704(0x235)+'e']===_0x1f6704(0x236)){await botRef[_0x1f6704(0x2bf)][_0x1f6704(0x235)+'e'](_0x421af9,_0x4bbd0a);return;}throw new Error(_0x1f6704(0x292)+'sage\x20avail'+_0x1f6704(0x26c));}catch(_0x1a81a3){throw _0x1a81a3;}}const DEDUPE_TTL_MS=(-0x1ea9+-0x4*-0x763+-0x127*-0x1)*(-0x207e*-0x1+-0x156d+-0x729),processedKeys=new Map();function markProcessed(_0x3405ee){const _0x5b4c3c=_0x2439e3;if(!_0x3405ee)return;if(processedKeys[_0x5b4c3c(0x225)](_0x3405ee))try{clearTimeout(processedKeys[_0x5b4c3c(0x1f2)](_0x3405ee));}catch(_0x4c8d26){}const _0x33036f=setTimeout(()=>processedKeys[_0x5b4c3c(0x293)](_0x3405ee),DEDUPE_TTL_MS);processedKeys[_0x5b4c3c(0x254)](_0x3405ee,_0x33036f);}function isProcessed(_0x3338cb){return _0x3338cb&&processedKeys['has'](_0x3338cb);}function extractContextInfo(_0x1bc664){const _0x5ced4d=_0x2439e3;if(!_0x1bc664||!_0x1bc664[_0x5ced4d(0x226)])return null;const _0x56005a=_0x1bc664[_0x5ced4d(0x226)];return _0x56005a['extendedTe'+_0x5ced4d(0x1f3)]?.['contextInf'+'o']||_0x56005a[_0x5ced4d(0x2c8)+'o']||null;}function extractViewOnceInnerFromQuoted(_0x4a5992){const _0x59a146=_0x2439e3;if(!_0x4a5992)return null;return _0x4a5992?.[_0x59a146(0x280)+_0x59a146(0x1eb)]?.[_0x59a146(0x226)]||_0x4a5992?.[_0x59a146(0x280)+_0x59a146(0x20d)]?.['message']||(_0x4a5992[_0x59a146(0x2bd)+'ge']?_0x4a5992:null)||(_0x4a5992[_0x59a146(0x259)+'ge']?_0x4a5992:null)||null;}function getSelfJid(){return getBotJid()||null;}function resolveDestination(_0x3784cf){const _0x1f4940=getSelfJid();if(MODE==='g'&&TARGET_JID){if(SKIP_IF_TARGET_EQUALS_SOURCE&&TARGET_JID===_0x3784cf)return _0x1f4940;return TARGET_JID;}return _0x1f4940;}function stripDomain(_0x319db1){const _0x577e17=_0x2439e3;if(!_0x319db1||typeof _0x319db1!==_0x577e17(0x1d1))return _0x319db1;const _0x580447=_0x319db1['indexOf']('@');if(_0x580447===-(-0x2*-0x727+0x1*0x129c+-0x20e9))return _0x319db1;return _0x319db1[_0x577e17(0x1e9)](0x1f96+-0x2f*-0x1+0x1fc5*-0x1,_0x580447);}async function handleUpsertSingle(_0x459580){const _0x576f7e=_0x2439e3;try{if(!_0x459580||!_0x459580[_0x576f7e(0x25e)])return;if(_0x459580[_0x576f7e(0x25e)]?.[_0x576f7e(0x285)]===_0x576f7e(0x286)+'adcast')return;if(Boolean(_0x459580['key']?.[_0x576f7e(0x224)]))return;const _0x54fd5c=String(_0x459580['key'][_0x576f7e(0x285)]||'')+'::'+String(_0x459580[_0x576f7e(0x25e)]['id']||'');if(isProcessed(_0x54fd5c))return;markProcessed(_0x54fd5c);const _0x271677=Boolean(_0x459580[_0x576f7e(0x25e)]?.[_0x576f7e(0x1c9)]),_0x3da8dc=Boolean(_0x459580[_0x576f7e(0x226)]?.[_0x576f7e(0x280)+_0x576f7e(0x1eb)]||_0x459580[_0x576f7e(0x226)]?.[_0x576f7e(0x280)+'ssageV2']);if(!_0x271677&&!_0x3da8dc)return;if(!NOTIFY_VIEWONCE)return;const _0x1a9a1b=_0x459580[_0x576f7e(0x294)]||_0x459580[_0x576f7e(0x25e)]?.[_0x576f7e(0x207)+'t']||_0x459580['key']?.[_0x576f7e(0x285)]||null,_0x4daa85=_0x1a9a1b?stripDomain(String(_0x1a9a1b)):_0x576f7e(0x23d),_0xd62091=_0x459580[_0x576f7e(0x25e)]?.[_0x576f7e(0x285)]?stripDomain(_0x459580[_0x576f7e(0x25e)][_0x576f7e(0x285)]):_0x576f7e(0x229)+'at',_0x401440=resolveDestination(_0x459580[_0x576f7e(0x25e)]?.[_0x576f7e(0x285)]);if(!_0x401440)return;const _0x3dd77b=_0x576f7e(0x239)+'\x20view-once'+'\x20from\x20'+_0x4daa85+_0x576f7e(0x211)+_0xd62091+('.\x0aReply\x20to'+_0x576f7e(0x1d5)+'age\x20with\x20a'+_0x576f7e(0x2bc)+_0x576f7e(0x20f)+'s\x20with*\x20\x27_'+'\x27\x20(undersc'+_0x576f7e(0x1cb)+'tempt\x20reco'+_0x576f7e(0x276));try{await trySend(_0x401440,{'text':_0x3dd77b}),info('['+name+(']\x20Notified'+'\x20')+_0x401440+('\x20of\x20view-o'+_0x576f7e(0x27f))+_0x4daa85+'\x20in\x20'+_0xd62091);}catch(_0x5b4b4e){warn('['+name+(']\x20notify\x20s'+_0x576f7e(0x21b)+':\x20')+(_0x5b4b4e?.[_0x576f7e(0x226)]||_0x5b4b4e));}}catch(_0x1259d9){warn('['+name+(_0x576f7e(0x1dd)+'sertSingle'+_0x576f7e(0x20c))+(_0x1259d9?.[_0x576f7e(0x226)]||_0x1259d9));}}async function upsertHandler({messages:_0x3c5899}){const _0x1d66e3=_0x2439e3;try{if(!Array[_0x1d66e3(0x20e)](_0x3c5899))return;for(const _0x35bba2 of _0x3c5899)await handleUpsertSingle(_0x35bba2);}catch(_0x33f55c){warn('['+name+(_0x1d66e3(0x22d)+_0x1d66e3(0x219)+_0x1d66e3(0x291))+(_0x33f55c?.[_0x1d66e3(0x226)]||_0x33f55c));}}async function downloadBufferFromContent(_0x5b9529,_0x25d60e){const _0x12300d=_0x2439e3;try{if(!_0x5b9529||!_0x25d60e)return null;const _0x438a83=await downloadContentFromMessage(_0x5b9529,_0x25d60e);if(!_0x438a83)return null;const _0x553339=[];for await(const _0xb8b2c7 of _0x438a83){_0x553339[_0x12300d(0x2a0)](_0xb8b2c7);}if(!_0x553339[_0x12300d(0x275)])return null;return Buffer[_0x12300d(0x1f0)](_0x553339);}catch(_0x338b71){return warn('['+name+(_0x12300d(0x277)+'BufferFrom'+_0x12300d(0x274)+_0x12300d(0x202))+(_0x338b71?.[_0x12300d(0x226)]||_0x338b71)),null;}}async function forwardRecoveredToDest(_0x18238f,_0x40fd01,_0x4635a2,_0x16b454){const _0x4ede62=_0x2439e3,_0x218c12=resolveDestination(_0x4635a2);if(!_0x218c12)return warn('['+name+(']\x20no\x20desti'+_0x4ede62(0x26b)+_0x4ede62(0x248))),![];try{const _0x24a7e5=_0x18238f?.[_0x4ede62(0x2bd)+'ge']?.[_0x4ede62(0x26a)]||_0x18238f?.[_0x4ede62(0x259)+'ge']?.[_0x4ede62(0x26a)]||'',_0x2c1b09=_0x16b454?stripDomain(_0x16b454):_0x4ede62(0x2be)+'er',_0x41194=_0x4635a2?stripDomain(_0x4635a2):'unknown\x20ch'+'at',_0x1b8f30=_0x4ede62(0x1e3)+_0x2c1b09+_0x4ede62(0x1d8)+_0x41194,_0x5bc680=_0x4ede62(0x251)+_0x4ede62(0x1ff)+_0x24a7e5+_0x1b8f30;if(_0x18238f['imageMessa'+'ge'])return await trySend(_0x218c12,{'image':_0x40fd01,'caption':_0x5bc680}),info('['+name+(_0x4ede62(0x21d)+'overed\x20ima'+_0x4ede62(0x25a))+_0x218c12),!![];if(_0x18238f['videoMessa'+'ge']){const _0x5b57ab=Boolean(_0x18238f[_0x4ede62(0x259)+'ge']?.['gifPlaybac'+'k']);return await trySend(_0x218c12,{'video':_0x40fd01,'caption':_0x5bc680,'gifPlayback':_0x5b57ab}),info('['+name+(']\x20Sent\x20rec'+_0x4ede62(0x264)+_0x4ede62(0x26e))+_0x218c12),!![];}return await trySend(_0x218c12,{'document':_0x40fd01,'fileName':_0x4ede62(0x290)+_0x4ede62(0x245),'mimetype':_0x4ede62(0x247)+'n/octet-st'+'ream','caption':_0x5bc680}),info('['+name+(']\x20Sent\x20rec'+'overed\x20doc'+_0x4ede62(0x260))+_0x218c12),!![];}catch(_0x29d857){return warn('['+name+(']\x20forwardR'+_0x4ede62(0x1fb)+'Dest\x20faile'+'d:\x20')+(_0x29d857?.[_0x4ede62(0x226)]||_0x29d857)),![];}}function extractTextFromCtx(_0xb4b5f5){const _0x276c0b=_0x2439e3;if(!_0xb4b5f5||!_0xb4b5f5['message'])return'';const _0x2a3179=_0xb4b5f5[_0x276c0b(0x226)];return _0x2a3179[_0x276c0b(0x24e)+'on']||_0x2a3179['extendedTe'+_0x276c0b(0x1f3)]?.[_0x276c0b(0x1d9)]||_0x2a3179[_0x276c0b(0x2bd)+'ge']?.['caption']||_0x2a3179[_0x276c0b(0x259)+'ge']?.['caption']||'';}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(0x851*0x4+-0x157+-0x1*0x1fcf)*(0x3*-0x5+0x665*-0x2+0x10c1);function markCmdProcessed(_0x151bd9){const _0x5ebf41=_0x2439e3;if(!_0x151bd9)return;if(processedCmdKeys[_0x5ebf41(0x225)](_0x151bd9))try{clearTimeout(processedCmdKeys[_0x5ebf41(0x1f2)](_0x151bd9));}catch(_0x86729f){};const _0x18737f=setTimeout(()=>processedCmdKeys['delete'](_0x151bd9),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x5ebf41(0x254)](_0x151bd9,_0x18737f);}function isCmdProcessed(_0x57d9cc){const _0x557b87=_0x2439e3;return _0x57d9cc&&processedCmdKeys[_0x557b87(0x225)](_0x57d9cc);}const recentResponded=new Set();export async function onMessage(_0x5221db){const _0x3ab1c6=_0x2439e3;try{if(!_0x5221db||!_0x5221db[_0x3ab1c6(0x25e)]||!_0x5221db[_0x3ab1c6(0x226)])return;const _0x2eff48=_0x5221db['key']?.['id']||null;if(_0x2eff48){if(recentResponded[_0x3ab1c6(0x225)](_0x2eff48))return;recentResponded[_0x3ab1c6(0x1c5)](_0x2eff48),setTimeout(()=>recentResponded[_0x3ab1c6(0x293)](_0x2eff48),(-0x44d*0x1+-0x1*0x131e+-0x23*-0xad)*(-0xfab*-0x2+-0x1e*0x1c+-0x1826));}if(_0x5221db[_0x3ab1c6(0x220)]){const _0x8b00ee=_0x5221db[_0x3ab1c6(0x25e)][_0x3ab1c6(0x285)],_0x11f99a=typeof _0x8b00ee===_0x3ab1c6(0x1d1)&&_0x8b00ee[_0x3ab1c6(0x1ea)]('@g.us');if(_0x11f99a&&!ALLOW_GROUP_COMMANDS){}else{const _0x523acc=Boolean(_0x5221db[_0x3ab1c6(0x25e)][_0x3ab1c6(0x224)]);if(!_0x11f99a&&!_0x523acc){const _0x344882=await isSudo(botRef,_0x5221db)[_0x3ab1c6(0x2a7)](()=>![]);if(!_0x344882){}else await handleCommand(_0x5221db)[_0x3ab1c6(0x2a7)](_0x29e9ad=>warn('['+name+(']\x20command\x20'+_0x3ab1c6(0x273))+(_0x29e9ad?.[_0x3ab1c6(0x226)]||_0x29e9ad)));}else{const _0x2863eb=await isSudo(botRef,_0x5221db)['catch'](()=>![]),_0x1246fe=Boolean(_0x5221db[_0x3ab1c6(0x25e)][_0x3ab1c6(0x224)]);(_0x1246fe||_0x2863eb)&&await handleCommand(_0x5221db)['catch'](_0x589d98=>warn('['+name+(']\x20command\x20'+_0x3ab1c6(0x273))+(_0x589d98?.[_0x3ab1c6(0x226)]||_0x589d98)));}}}const _0xb509d2=extractContextInfo(_0x5221db);if(!_0xb509d2||!_0xb509d2[_0x3ab1c6(0x279)+_0x3ab1c6(0x1dc)])return;const _0x28c38a=extractTextFromCtx(_0x5221db)||'';if(!_0x28c38a)return;const _0x13bf2d=_0x28c38a[_0x3ab1c6(0x2c2)]()[_0x3ab1c6(0x1d3)](-0xaa0+0x100f+0x6b*-0xd);if(_0x13bf2d!=='_')return;info('['+name+(_0x3ab1c6(0x1ef)+_0x3ab1c6(0x232)+_0x3ab1c6(0x283)+_0x3ab1c6(0x2c7)+_0x3ab1c6(0x2a1)+'ry'));const _0x663fc8=extractViewOnceInnerFromQuoted(_0xb509d2['quotedMess'+'age']);if(!_0x663fc8){warn('['+name+(']\x20quoted\x20m'+_0x3ab1c6(0x203)+'\x20not\x20conta'+_0x3ab1c6(0x1c4)+_0x3ab1c6(0x1c7)+'\x20message'));return;}let _0xc7b459=null,_0x256666=null;if(_0x663fc8[_0x3ab1c6(0x2bd)+'ge'])_0xc7b459=_0x663fc8[_0x3ab1c6(0x2bd)+'ge'],_0x256666=_0x3ab1c6(0x2a9);else _0x663fc8['videoMessa'+'ge']&&(_0xc7b459=_0x663fc8[_0x3ab1c6(0x259)+'ge'],_0x256666=_0x3ab1c6(0x1d6));if(!_0xc7b459||!_0x256666){warn('['+name+(_0x3ab1c6(0x21c)+_0x3ab1c6(0x237)+_0x3ab1c6(0x23f)+_0x3ab1c6(0x21f)+_0x3ab1c6(0x295)+'pe'));return;}const _0x47289c=await downloadBufferFromContent(_0xc7b459,_0x256666);if(!_0x47289c){warn('['+name+(_0x3ab1c6(0x22e)+_0x3ab1c6(0x1cf)+_0x3ab1c6(0x2aa)+_0x3ab1c6(0x1fa)));return;}const _0x2889ba=_0x5221db[_0x3ab1c6(0x25e)][_0x3ab1c6(0x285)]||null,_0x9abe23=_0xb509d2[_0x3ab1c6(0x207)+'t']||null,_0x35458f=await forwardRecoveredToDest(_0x663fc8,_0x47289c,_0x2889ba,_0x9abe23);if(!_0x35458f)warn('['+name+(_0x3ab1c6(0x28d)+'ecoveredTo'+_0x3ab1c6(0x23e)+_0x3ab1c6(0x21a)));}catch(_0x3477a1){error(_0x3477a1,'['+name+(_0x3ab1c6(0x243)+_0x3ab1c6(0x1cd)+_0x3ab1c6(0x273))+(_0x3477a1?.[_0x3ab1c6(0x226)]||_0x3477a1));}}async function handleCommand(_0x1c035c){const _0x45d1db=_0x2439e3;try{if(!_0x1c035c||!_0x1c035c['key']||!_0x1c035c['message'])return;const _0x388137=_0x1c035c[_0x45d1db(0x25e)][_0x45d1db(0x285)],_0x18127a=typeof _0x388137==='string'&&_0x388137['endsWith'](_0x45d1db(0x231));if(_0x18127a&&!ALLOW_GROUP_COMMANDS)return;const _0x1270d5=Boolean(_0x1c035c[_0x45d1db(0x25e)][_0x45d1db(0x224)]);if(!_0x18127a&&!_0x1270d5){const _0x4d1ff8=await isSudo(botRef,_0x1c035c)[_0x45d1db(0x2a7)](()=>![]);if(!_0x4d1ff8)return;}const _0x29c507=Boolean(_0x1c035c[_0x45d1db(0x25e)]['fromMe']),_0x3aeb18=await isSudo(botRef,_0x1c035c)[_0x45d1db(0x2a7)](()=>![]);let _0x35363c;if(_0x29c507)_0x35363c=getBotJid()||_0x1c035c[_0x45d1db(0x25e)][_0x45d1db(0x285)]||_0x1c035c[_0x45d1db(0x25e)][_0x45d1db(0x207)+'t']||null,!_0x35363c&&(warn('['+name+(']\x20getBotJi'+_0x45d1db(0x1ca)+_0x45d1db(0x2c1)+_0x45d1db(0x216)+_0x45d1db(0x223)+_0x45d1db(0x27c))),_0x35363c=_0x1c035c[_0x45d1db(0x25e)][_0x45d1db(0x285)]||null);else{if(_0x3aeb18)_0x35363c=_0x1c035c[_0x45d1db(0x25e)]['remoteJid'];else return;}if(!_0x35363c){warn('['+name+(_0x45d1db(0x268)+_0x45d1db(0x1ee)+'rget\x20-\x20abo'+'rting\x20comm'+_0x45d1db(0x282)));return;}const _0x59f7b8=String(_0x1c035c[_0x45d1db(0x25e)][_0x45d1db(0x285)]||'')+'::'+String(_0x1c035c['key']['id']||_0x1c035c[_0x45d1db(0x25e)][_0x45d1db(0x207)+'t']||'');if(isCmdProcessed(_0x59f7b8))return;markCmdProcessed(_0x59f7b8);const _0x2e952a=typeof _0x1c035c[_0x45d1db(0x1d9)]===_0x45d1db(0x1d1)&&_0x1c035c[_0x45d1db(0x1d9)][_0x45d1db(0x2c2)]()[_0x45d1db(0x275)]?_0x1c035c['text'][_0x45d1db(0x2c2)]():function _0x1c7ab5(_0x84ba99){const _0x247715=_0x45d1db;if(!_0x84ba99||!_0x84ba99['message'])return'';const _0x13eae3=_0x84ba99['message'];if(_0x13eae3[_0x247715(0x24e)+'on'])return _0x13eae3[_0x247715(0x24e)+'on'];if(_0x13eae3[_0x247715(0x2c9)+_0x247715(0x1f3)]?.[_0x247715(0x1d9)])return _0x13eae3[_0x247715(0x2c9)+_0x247715(0x1f3)][_0x247715(0x1d9)];if(_0x13eae3['imageMessa'+'ge']?.[_0x247715(0x26a)])return _0x13eae3[_0x247715(0x2bd)+'ge'][_0x247715(0x26a)];if(_0x13eae3['videoMessa'+'ge']?.[_0x247715(0x26a)])return _0x13eae3['videoMessa'+'ge'][_0x247715(0x26a)];if(_0x13eae3[_0x247715(0x2c6)+'ponseMessa'+'ge']?.[_0x247715(0x299)+_0x247715(0x241)])return _0x13eae3[_0x247715(0x2c6)+'ponseMessa'+'ge'][_0x247715(0x299)+_0x247715(0x241)];if(_0x13eae3[_0x247715(0x266)+_0x247715(0x26d)]?.[_0x247715(0x213)+_0x247715(0x23a)]?.[_0x247715(0x1f8)+_0x247715(0x1f6)])return _0x13eae3[_0x247715(0x266)+_0x247715(0x26d)][_0x247715(0x213)+_0x247715(0x23a)][_0x247715(0x1f8)+_0x247715(0x1f6)];return'';}(_0x1c035c)||'';if(!_0x2e952a)return;const _0x5bdcfa=(_0x2e952a[_0x45d1db(0x250)](/\r?\n/)[-0xa23+-0x9cd+0x13f0]||'')[_0x45d1db(0x2c2)](),_0x3a36c2=_0x5bdcfa[_0x45d1db(0x250)](/\s+/),_0x3aac90=(_0x3a36c2[-0x135f+0x1*0x87d+-0x2*-0x571]||'')[_0x45d1db(0x24d)+'e']();if(!commands['includes'](_0x3aac90))return;const _0x572347=(_0x3a36c2[-0x1085+0x60d+0xa79]||'')[_0x45d1db(0x24d)+'e']();if(_0x572347==='notify'){const _0x4ea0e4=(_0x3a36c2[-0x1b22+0x34a*-0x1+0x1e6e]||'')[_0x45d1db(0x24d)+'e']();if(!_0x4ea0e4){await trySend(_0x35363c,{'text':_0x45d1db(0x2c5)+_0x45d1db(0x201)+'ions\x20are\x20c'+_0x45d1db(0x215)+(NOTIFY_VIEWONCE?'ON':_0x45d1db(0x1ed))+'*'});return;}const _0x78c801=_0x4ea0e4==='on'||_0x4ea0e4==='1'||_0x4ea0e4==='true',_0x3288eb=await savePref(_0x45d1db(0x1f9)+_0x45d1db(0x29c),_0x78c801?'1':'0');if(!_0x3288eb){await trySend(_0x35363c,{'text':'[viewonce]'+_0x45d1db(0x23c)+_0x45d1db(0x1da)+'fications\x20'+_0x45d1db(0x246)});return;}await trySend(_0x35363c,{'text':_0x45d1db(0x2c5)+_0x45d1db(0x201)+'ions\x20set\x20t'+_0x45d1db(0x20b)+(_0x78c801?'ON':_0x45d1db(0x1ed))+'*'});return;}if(_0x572347==='p'||_0x572347==='pm'){const _0x8d8398=await savePref(_0x45d1db(0x238),'p');if(!_0x8d8398){await trySend(_0x35363c,{'text':_0x45d1db(0x2c5)+_0x45d1db(0x23c)+_0x45d1db(0x262)});return;}await trySend(_0x35363c,{'text':_0x45d1db(0x2c5)+'\x20Mode\x20set\x20'+'to\x20PM.'});return;}if(_0x572347==='g'||_0x572347==='group'||_0x572347==='gp'){const _0x1b35b7=await savePref('mode','g');if(!_0x1b35b7){await trySend(_0x35363c,{'text':_0x45d1db(0x2c5)+_0x45d1db(0x23c)+_0x45d1db(0x262)});return;}const _0x1ba2c3=TARGET_JID?_0x45d1db(0x2b4)+_0x45d1db(0x27e)+TARGET_JID:'No\x20target\x20'+_0x45d1db(0x270);await trySend(_0x35363c,{'text':_0x45d1db(0x2c5)+'\x20Mode\x20set\x20'+_0x45d1db(0x2ae)+_0x1ba2c3});return;}if(_0x572347&&_0x572347['includes']('@')){const _0xa47ab7=normalizeToUserJid(_0x572347),_0x32d096=await savePref(_0x45d1db(0x287),_0xa47ab7);if(_0x32d096)await trySend(_0x35363c,{'text':_0x45d1db(0x2c5)+_0x45d1db(0x249)+_0x45d1db(0x2af)+_0xa47ab7});else await trySend(_0x35363c,{'text':_0x45d1db(0x2c5)+_0x45d1db(0x23c)+'\x20save\x20targ'+'et\x20JID:\x20'+_0xa47ab7});return;}if(_0x572347===_0x45d1db(0x28a)||_0x572347===_0x45d1db(0x2b6)||_0x572347===_0x45d1db(0x1ec)){const _0x4d168d=await savePref(_0x45d1db(0x287),'');if(_0x4d168d)await trySend(_0x35363c,{'text':'[viewonce]'+_0x45d1db(0x249)+_0x45d1db(0x208)});else await trySend(_0x35363c,{'text':'[viewonce]'+_0x45d1db(0x23c)+_0x45d1db(0x22a)+_0x45d1db(0x1fe)});return;}const _0x53aaa8=MODE==='g'?_0x45d1db(0x1df)+(TARGET_JID||_0x45d1db(0x281))+')':'PM';await trySend(_0x35363c,{'text':_0x45d1db(0x1e4)+_0x45d1db(0x2ba)+_0x45d1db(0x25f)+_0x45d1db(0x1fc)+(_0x45d1db(0x2b3)+_0x45d1db(0x221)+(NOTIFY_VIEWONCE?'ON':_0x45d1db(0x1ed))+(_0x45d1db(0x1e7)+_0x45d1db(0x25c)+_0x45d1db(0x28b)))+('*Send\x20Targ'+_0x45d1db(0x278)+_0x53aaa8+(_0x45d1db(0x1e7)+_0x45d1db(0x261)))+(_0x45d1db(0x1f5)+'D*:\x20`'+(TARGET_JID||_0x45d1db(0x1e6))+(_0x45d1db(0x2b1)+'e\x20<jid>`\x0a'))+(_0x45d1db(0x256)+':\x20reply\x20to'+'\x20the\x20view-'+'once\x20messa'+_0x45d1db(0x265)+_0x45d1db(0x22f)+_0x45d1db(0x1cc)+'with\x20\x27_\x27\x20('+'underscore'+').')});}catch(_0x45130a){warn('['+name+(_0x45d1db(0x2a2)+'mmand\x20erro'+_0x45d1db(0x291))+(_0x45130a?.[_0x45d1db(0x226)]||_0x45130a));}}export async function initialize(_0x494919){const _0x2a60d8=_0x2439e3;if(!_0x494919)throw new Error(_0x2a60d8(0x218)+_0x2a60d8(0x209)+_0x2a60d8(0x2b2)+_0x2a60d8(0x2c3)+'e');botRef=_0x494919,await ensureSchema(),refreshConfig(),startManagedListener({'botRef':botRef,'eventName':_0x2a60d8(0x263)+'psert','handler':upsertHandler,'moduleName':name}),info('['+name+(_0x2a60d8(0x1ce)+'zed\x20(centr'+_0x2a60d8(0x28e)+_0x2a60d8(0x210)));}export async function cleanup(){const _0x3f338a=_0x2439e3;try{stopManagedListener(name,_0x3f338a(0x263)+'psert');for(const _0x4c7156 of processedKeys[_0x3f338a(0x206)]())try{clearTimeout(_0x4c7156);}catch(_0x15a813){}processedKeys[_0x3f338a(0x28a)]();}catch(_0x544a69){warn(name+(_0x3f338a(0x2ad)+_0x3f338a(0x273))+(_0x544a69?.[_0x3f338a(0x226)]||_0x544a69));}finally{botRef=null,info(name+(_0x3f338a(0x253)+'p'));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};