const _0x2ef36c=_0x36cb;(function(_0x2b510c,_0x12cca3){const _0xb089b4=_0x36cb,_0x239ddd=_0x2b510c();while(!![]){try{const _0x182ada=-parseInt(_0xb089b4(0x168))/(0x11*0x223+-0x22ab+-0x9*0x2f)*(-parseInt(_0xb089b4(0x1f1))/(0x1*-0xe12+0xa28+0x1f6*0x2))+parseInt(_0xb089b4(0x213))/(-0x7db*0x1+0xcb5+-0x1*0x4d7)+-parseInt(_0xb089b4(0x11c))/(-0x928*0x3+-0x1024+0x2ba0)+parseInt(_0xb089b4(0x198))/(-0x1f*-0x99+0x5fb*-0x2+0x68c*-0x1)*(parseInt(_0xb089b4(0x195))/(0x89a+0x9*-0x2a9+0xf5d))+parseInt(_0xb089b4(0x1a2))/(0x2240+0x1007+0x324*-0x10)+parseInt(_0xb089b4(0x136))/(0x8f6+-0x14d*-0x1c+-0x2d5a)*(parseInt(_0xb089b4(0x1c3))/(0x2ef*0xd+0x3*0x625+-0x3889))+-parseInt(_0xb089b4(0x15b))/(-0x1e57+-0x5*-0x3c7+0xb7e)*(parseInt(_0xb089b4(0x1f0))/(0x4be+-0x232f+0x1e7c));if(_0x182ada===_0x12cca3)break;else _0x239ddd['push'](_0x239ddd['shift']());}catch(_0x13d37e){_0x239ddd['push'](_0x239ddd['shift']());}}}(_0x5d19,-0x1*-0x163229+-0x15ea6e*0x1+0xc53ba));import{info,warn,error}from'../utils/logger.js';import{downloadContentFromMessage,isJidGroup}from'@whiskeysockets/baileys';import{getConfig,hotReloadConfig}from'../utils/config.js';import{db}from'../utils/database.js';import{isSudo}from'../utils/sudo.js';import{getBotJid}from'../utils/bot-state.js';import{startManagedListener,stopManagedListener}from'../utils/listenerManager.js';export const name='viewonce';function _0x36cb(_0x833ec7,_0x3d558c){const _0x317fd5=_0x5d19();return _0x36cb=function(_0x119757,_0x42d5fa){_0x119757=_0x119757-(0x3*0xc02+-0x7*0xef+0x1*-0x1c65);let _0x3cf2c7=_0x317fd5[_0x119757];return _0x3cf2c7;},_0x36cb(_0x833ec7,_0x3d558c);}export const version=_0x2ef36c(0x148)+'hed';export const priority=0x5*0x4c+0x18a9*-0x1+0x178c;export const commands=[_0x2ef36c(0x1df)];export const configKeys=['VIEWONCE_S'+_0x2ef36c(0x1ed)+_0x2ef36c(0x15c)+_0x2ef36c(0x13e),'VIEWONCE_A'+_0x2ef36c(0x176)+_0x2ef36c(0x1b7)+_0x2ef36c(0x1a6)];let botRef=null,SKIP_IF_TARGET_EQUALS_SOURCE=!![],ALLOW_GROUP_COMMANDS_DEFAULT=![],MODE='p',TARGET_JID=null,ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT,NOTIFY_VIEWONCE=![];function refreshConfig(){const _0x53b2ee=_0x2ef36c;try{const _0x2182ab=getConfig()||{};SKIP_IF_TARGET_EQUALS_SOURCE=_0x2182ab[_0x53b2ee(0x1de)+'KIP_IF_TAR'+_0x53b2ee(0x15c)+_0x53b2ee(0x13e)]!==undefined?Boolean(_0x2182ab['VIEWONCE_S'+_0x53b2ee(0x1ed)+'GET_EQUALS'+'_SOURCE']):SKIP_IF_TARGET_EQUALS_SOURCE,ALLOW_GROUP_COMMANDS_DEFAULT=Boolean(_0x2182ab[_0x53b2ee(0x13b)+'LLOW_GROUP'+_0x53b2ee(0x1b7)+'DEFAULT']??ALLOW_GROUP_COMMANDS_DEFAULT),info('['+name+(_0x53b2ee(0x1c8)+_0x53b2ee(0x205)));}catch(_0x3d4816){warn('['+name+(']\x20refreshC'+_0x53b2ee(0x158)+_0x53b2ee(0x129))+(_0x3d4816?.[_0x53b2ee(0x1dc)]||_0x3d4816));}}try{hotReloadConfig&&hotReloadConfig((_0x9b739=[])=>{const _0x1f68f=_0x2ef36c,_0x14dc41=[_0x1f68f(0x1de)+_0x1f68f(0x1ed)+'GET_EQUALS'+'_SOURCE','VIEWONCE_A'+_0x1f68f(0x176)+'_COMMANDS_'+_0x1f68f(0x1a6)];if((_0x9b739||[])['some'](_0x46ae01=>_0x14dc41['includes'](_0x46ae01)))refreshConfig();});}catch(_0x4751a3){warn('['+name+(_0x2ef36c(0x17c)+_0x2ef36c(0x1fe)+_0x2ef36c(0x1cc)+_0x2ef36c(0x1ea))+(_0x4751a3?.[_0x2ef36c(0x1dc)]||_0x4751a3));}refreshConfig();async function ensureSchema(){const _0x7c50b5=_0x2ef36c;try{await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CRE'+_0x7c50b5(0x179)+'IF\x20NOT\x20EXI'+_0x7c50b5(0x223)+'ce_prefs\x20('+_0x7c50b5(0x11f)+_0x7c50b5(0x1f9)+_0x7c50b5(0x165)+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20v'+_0x7c50b5(0x1e0)+'NOT\x20NULL,\x0a'+_0x7c50b5(0x1b0)+_0x7c50b5(0x140)+'NTEGER\x20DEF'+_0x7c50b5(0x19f)+_0x7c50b5(0x14a));try{const _0x56a28c=await db[_0x7c50b5(0x19c)](_0x7c50b5(0x173)+_0x7c50b5(0x123)+_0x7c50b5(0x21b)+_0x7c50b5(0x1af)+_0x7c50b5(0x156));MODE=_0x56a28c?.[_0x7c50b5(0x1be)]==='g'?'g':'p';}catch(_0x51b48e){}try{const _0x44b5d0=await db[_0x7c50b5(0x19c)](_0x7c50b5(0x173)+'ue\x20FROM\x20vi'+_0x7c50b5(0x21b)+_0x7c50b5(0x1af)+_0x7c50b5(0x17d)+_0x7c50b5(0x201));TARGET_JID=_0x44b5d0?.['value']||null;}catch(_0x5aaa80){TARGET_JID=null;}try{const _0x405d9e=await db[_0x7c50b5(0x19c)](_0x7c50b5(0x173)+_0x7c50b5(0x123)+_0x7c50b5(0x21b)+_0x7c50b5(0x1af)+_0x7c50b5(0x12b)+'group_comm'+_0x7c50b5(0x211));ALLOW_GROUP_COMMANDS=_0x405d9e?.[_0x7c50b5(0x1be)]==='1';}catch(_0x3239ee){ALLOW_GROUP_COMMANDS=ALLOW_GROUP_COMMANDS_DEFAULT;}try{const _0x106302=await db[_0x7c50b5(0x19c)](_0x7c50b5(0x173)+'ue\x20FROM\x20vi'+'ewonce_pre'+_0x7c50b5(0x1af)+_0x7c50b5(0x12a)+_0x7c50b5(0x181));NOTIFY_VIEWONCE=_0x106302?.[_0x7c50b5(0x1be)]==='1';}catch(_0xf7b8b1){NOTIFY_VIEWONCE=![];}info('['+name+(_0x7c50b5(0x20d)+'\x20(mode=')+MODE+_0x7c50b5(0x1ae)+(TARGET_JID||'unset')+_0x7c50b5(0x1b4)+NOTIFY_VIEWONCE+(',\x20allow_gr'+_0x7c50b5(0x197)+_0x7c50b5(0x139))+ALLOW_GROUP_COMMANDS+')');}catch(_0x15b960){error(_0x15b960,'['+name+(_0x7c50b5(0x1f7)+_0x7c50b5(0x161)+'d'));throw _0x15b960;}}async function savePref(_0x777d62,_0xb325b2){const _0x25c5cb=_0x2ef36c;try{const _0x283f8d=Math['floor'](Date['now']()/(-0x19a0+0x602*0x4+0x16*0x40));await db[_0x25c5cb(0x141)](_0x25c5cb(0x199)+_0x25c5cb(0x164)+_0x25c5cb(0x221)+_0x25c5cb(0x225)+_0x25c5cb(0x174)+_0x25c5cb(0x16d)+_0x25c5cb(0x19d)+'CONFLICT(k'+_0x25c5cb(0x210)+'ATE\x20SET\x20va'+_0x25c5cb(0x1d2)+'ed.value,\x20'+'updated_at'+_0x25c5cb(0x18a)+_0x25c5cb(0x1b5),[_0x777d62,_0xb325b2,_0x283f8d]);}catch(_0x18a0d3){return warn('['+name+(_0x25c5cb(0x1cd)+':\x20DB\x20write'+_0x25c5cb(0x1fd)+'r\x20')+_0x777d62+'='+_0xb325b2+_0x25c5cb(0x162)+(_0x18a0d3?.[_0x25c5cb(0x1dc)]||_0x18a0d3)),![];}try{const _0x3dd8c0=await db[_0x25c5cb(0x19c)]('SELECT\x20val'+'ue\x20FROM\x20vi'+'ewonce_pre'+'fs\x20WHERE\x20k'+'ey=?',[_0x777d62]),_0x1ecfa1=_0x3dd8c0?.['value']??_0xb325b2;if(_0x777d62===_0x25c5cb(0x1ad))MODE=_0x1ecfa1==='g'?'g':'p';if(_0x777d62===_0x25c5cb(0x228))TARGET_JID=_0x1ecfa1||null;if(_0x777d62===_0x25c5cb(0x1a1)+_0x25c5cb(0x193))ALLOW_GROUP_COMMANDS=_0x1ecfa1==='1';if(_0x777d62===_0x25c5cb(0x11d)+_0x25c5cb(0x137))NOTIFY_VIEWONCE=_0x1ecfa1==='1';return info('['+name+(_0x25c5cb(0x14e)+_0x25c5cb(0x220)+_0x25c5cb(0x13c))+_0x777d62+'='+_0x1ecfa1),!![];}catch(_0x3fc04c){warn('['+name+(_0x25c5cb(0x1cd)+_0x25c5cb(0x1da)+'fter\x20write'+_0x25c5cb(0x1fd)+'r\x20')+_0x777d62+'='+_0xb325b2+'\x20—\x20'+(_0x3fc04c?.[_0x25c5cb(0x1dc)]||_0x3fc04c));if(_0x777d62===_0x25c5cb(0x1ad))MODE=_0xb325b2==='g'?'g':'p';if(_0x777d62===_0x25c5cb(0x228))TARGET_JID=_0xb325b2||null;if(_0x777d62===_0x25c5cb(0x1a1)+_0x25c5cb(0x193))ALLOW_GROUP_COMMANDS=_0xb325b2==='1';if(_0x777d62===_0x25c5cb(0x11d)+_0x25c5cb(0x137))NOTIFY_VIEWONCE=_0xb325b2==='1';return!![];}}function normalizeToUserJid(_0x3b4be2){const _0x27648a=_0x2ef36c;try{if(!_0x3b4be2||typeof _0x3b4be2!=='string')return _0x3b4be2;const _0x1cd0cf=_0x3b4be2[_0x27648a(0x1f4)]('@');if(_0x1cd0cf===-(0x144c+-0xa*-0x15b+-0x21d9))return _0x3b4be2;const _0x204a35=_0x3b4be2[_0x27648a(0x224)](0x1*-0x2b1+-0x1*-0x13c0+-0x110f,_0x1cd0cf),_0xa21ccd=_0x3b4be2[_0x27648a(0x224)](_0x1cd0cf),_0xfe3613=_0x204a35['indexOf'](':');if(_0xfe3613===-(0x13f*0x4+0x13a8+0x11*-0x173))return _0x3b4be2;return _0x204a35[_0x27648a(0x224)](-0x62b+-0x1e4e+0x2479,_0xfe3613)+_0xa21ccd;}catch(_0x14d2f8){return _0x3b4be2;}}async function trySend(_0x2745a4,_0x31cd7e){const _0x43c505=_0x2ef36c;try{const _0x4e7f58=normalizeToUserJid(String(_0x2745a4));if(!_0x4e7f58)throw new Error(_0x43c505(0x1bd)+_0x43c505(0x14f));if(typeof botRef?.[_0x43c505(0x13f)+'e']==='function'){await botRef['sendMessag'+'e'](_0x4e7f58,_0x31cd7e);return;}if(botRef?.['sock']&&typeof botRef[_0x43c505(0x1a7)]['sendMessag'+'e']==='function'){await botRef[_0x43c505(0x1a7)][_0x43c505(0x13f)+'e'](_0x4e7f58,_0x31cd7e);return;}throw new Error(_0x43c505(0x178)+_0x43c505(0x144)+_0x43c505(0x1ef));}catch(_0x48239e){throw _0x48239e;}}const DEDUPE_TTL_MS=(0x2117*-0x1+0x10fb*0x1+0x1026)*(0x1acd+-0x16da+0xb*-0x1),processedKeys=new Map();function markProcessed(_0x2b84f0){const _0x486d86=_0x2ef36c;if(!_0x2b84f0)return;if(processedKeys[_0x486d86(0x1d3)](_0x2b84f0))try{clearTimeout(processedKeys[_0x486d86(0x19c)](_0x2b84f0));}catch(_0x459111){}const _0x2bd79b=setTimeout(()=>processedKeys['delete'](_0x2b84f0),DEDUPE_TTL_MS);processedKeys[_0x486d86(0x1ff)](_0x2b84f0,_0x2bd79b);}function isProcessed(_0x46f8be){const _0x421e24=_0x2ef36c;return _0x46f8be&&processedKeys[_0x421e24(0x1d3)](_0x46f8be);}function extractContextInfo(_0x23035a){const _0x567f58=_0x2ef36c;if(!_0x23035a||!_0x23035a['message'])return null;const _0x476984=_0x23035a[_0x567f58(0x1dc)];return _0x476984['extendedTe'+_0x567f58(0x219)]?.[_0x567f58(0x1c0)+'o']||_0x476984[_0x567f58(0x1c0)+'o']||null;}function extractViewOnceInnerFromQuoted(_0x3a6ec5){const _0x5e1dfe=_0x2ef36c;if(!_0x3a6ec5)return null;return _0x3a6ec5?.['viewOnceMe'+'ssage']?.[_0x5e1dfe(0x1dc)]||_0x3a6ec5?.[_0x5e1dfe(0x226)+_0x5e1dfe(0x202)]?.['message']||(_0x3a6ec5[_0x5e1dfe(0x194)+'ge']?_0x3a6ec5:null)||(_0x3a6ec5[_0x5e1dfe(0x1ce)+'ge']?_0x3a6ec5:null)||null;}function getSelfJid(){return getBotJid()||null;}function resolveDestination(_0x5890bc){const _0x5ea066=getSelfJid();if(MODE==='g'&&TARGET_JID){if(SKIP_IF_TARGET_EQUALS_SOURCE&&TARGET_JID===_0x5890bc)return _0x5ea066;return TARGET_JID;}return _0x5ea066;}function stripDomain(_0x420ab2){const _0x106d75=_0x2ef36c;if(!_0x420ab2||typeof _0x420ab2!==_0x106d75(0x1d4))return _0x420ab2;const _0x53153a=_0x420ab2['indexOf']('@');if(_0x53153a===-(-0xa39+-0x3*-0x6ff+-0x1d*0x5f))return _0x420ab2;return _0x420ab2[_0x106d75(0x224)](0x6fd*0x3+0x594+-0x1a8b,_0x53153a);}async function handleUpsertSingle(_0x4a7114){const _0x2c5b7b=_0x2ef36c;try{if(!_0x4a7114||!_0x4a7114[_0x2c5b7b(0x163)])return;if(_0x4a7114['key']?.[_0x2c5b7b(0x18b)]===_0x2c5b7b(0x143)+'adcast')return;if(Boolean(_0x4a7114[_0x2c5b7b(0x163)]?.[_0x2c5b7b(0x1b1)]))return;const _0x1b07b0=String(_0x4a7114['key'][_0x2c5b7b(0x18b)]||'')+'::'+String(_0x4a7114[_0x2c5b7b(0x163)]['id']||'');if(isProcessed(_0x1b07b0))return;markProcessed(_0x1b07b0);const _0xce1b6=Boolean(_0x4a7114[_0x2c5b7b(0x163)]?.['isViewOnce']),_0xecab2=Boolean(_0x4a7114[_0x2c5b7b(0x1dc)]?.[_0x2c5b7b(0x226)+_0x2c5b7b(0x212)]||_0x4a7114['message']?.[_0x2c5b7b(0x226)+'ssageV2']);if(!_0xce1b6&&!_0xecab2)return;if(!NOTIFY_VIEWONCE)return;const _0x371270=_0x4a7114[_0x2c5b7b(0x19a)]||_0x4a7114[_0x2c5b7b(0x163)]?.[_0x2c5b7b(0x218)+'t']||_0x4a7114[_0x2c5b7b(0x163)]?.[_0x2c5b7b(0x18b)]||null,_0x120cae=_0x371270?stripDomain(String(_0x371270)):_0x2c5b7b(0x17a),_0xe57126=_0x4a7114[_0x2c5b7b(0x163)]?.[_0x2c5b7b(0x18b)]?stripDomain(_0x4a7114[_0x2c5b7b(0x163)][_0x2c5b7b(0x18b)]):_0x2c5b7b(0x1ba)+'at',_0x5f3337=resolveDestination(_0x4a7114['key']?.['remoteJid']);if(!_0x5f3337)return;const _0x214360=_0x2c5b7b(0x1d6)+_0x2c5b7b(0x15e)+_0x2c5b7b(0x160)+_0x120cae+_0x2c5b7b(0x209)+_0xe57126+(_0x2c5b7b(0x1c2)+_0x2c5b7b(0x1fb)+'age\x20with\x20a'+'\x20message\x20t'+_0x2c5b7b(0x1a0)+'s\x20with*\x20\x27_'+_0x2c5b7b(0x14d)+_0x2c5b7b(0x1c1)+_0x2c5b7b(0x146)+'very.');try{await trySend(_0x5f3337,{'text':_0x214360}),info('['+name+(_0x2c5b7b(0x128)+'\x20')+_0x5f3337+('\x20of\x20view-o'+'nce\x20from\x20')+_0x120cae+'\x20in\x20'+_0xe57126);}catch(_0x257e5e){warn('['+name+(_0x2c5b7b(0x12f)+_0x2c5b7b(0x133)+':\x20')+(_0x257e5e?.[_0x2c5b7b(0x1dc)]||_0x257e5e));}}catch(_0x1eecb2){warn('['+name+(_0x2c5b7b(0x21c)+_0x2c5b7b(0x1f3)+'\x20error:\x20')+(_0x1eecb2?.['message']||_0x1eecb2));}}async function upsertHandler({messages:_0x48e44d}){const _0x1c84ac=_0x2ef36c;try{if(!Array[_0x1c84ac(0x14c)](_0x48e44d))return;for(const _0x5ac7e4 of _0x48e44d)await handleUpsertSingle(_0x5ac7e4);}catch(_0xc31ff9){warn('['+name+(_0x1c84ac(0x177)+_0x1c84ac(0x20f)+'r:\x20')+(_0xc31ff9?.[_0x1c84ac(0x1dc)]||_0xc31ff9));}}async function downloadBufferFromContent(_0x7c03a4,_0x5701f7){const _0x5054d4=_0x2ef36c;try{if(!_0x7c03a4||!_0x5701f7)return null;const _0x36cca6=await downloadContentFromMessage(_0x7c03a4,_0x5701f7);if(!_0x36cca6)return null;const _0x4d7ae4=[];for await(const _0x4347db of _0x36cca6){_0x4d7ae4[_0x5054d4(0x200)](_0x4347db);}if(!_0x4d7ae4['length'])return null;return Buffer[_0x5054d4(0x1cf)](_0x4d7ae4);}catch(_0x13535b){return warn('['+name+(_0x5054d4(0x170)+_0x5054d4(0x15d)+_0x5054d4(0x1a5)+'ror:\x20')+(_0x13535b?.['message']||_0x13535b)),null;}}async function forwardRecoveredToDest(_0x826476,_0x1c2c29,_0x5a6ccf,_0x280c6c){const _0x3445b9=_0x2ef36c,_0x4e9884=resolveDestination(_0x5a6ccf);if(!_0x4e9884)return warn('['+name+(_0x3445b9(0x159)+_0x3445b9(0x229)+'olved')),![];try{const _0x4b4e30=_0x826476?.[_0x3445b9(0x194)+'ge']?.[_0x3445b9(0x21a)]||_0x826476?.[_0x3445b9(0x1ce)+'ge']?.[_0x3445b9(0x21a)]||'',_0x8efda3=_0x280c6c?stripDomain(_0x280c6c):_0x3445b9(0x1e1)+'er',_0x280e53=_0x5a6ccf?stripDomain(_0x5a6ccf):_0x3445b9(0x1ba)+'at',_0x3a87dc='\x0a\x0afrom:\x20'+_0x8efda3+'\x20in\x20'+_0x280e53,_0x27d416=_0x3445b9(0x180)+'Recovered\x0a'+_0x4b4e30+_0x3a87dc;if(_0x826476['imageMessa'+'ge'])return await trySend(_0x4e9884,{'image':_0x1c2c29,'caption':_0x27d416}),info('['+name+(_0x3445b9(0x1bc)+'overed\x20ima'+_0x3445b9(0x216))+_0x4e9884),!![];if(_0x826476['videoMessa'+'ge']){const _0x15157e=Boolean(_0x826476[_0x3445b9(0x1ce)+'ge']?.[_0x3445b9(0x1d8)+'k']);return await trySend(_0x4e9884,{'video':_0x1c2c29,'caption':_0x27d416,'gifPlayback':_0x15157e}),info('['+name+(_0x3445b9(0x1bc)+'overed\x20vid'+_0x3445b9(0x154))+_0x4e9884),!![];}return await trySend(_0x4e9884,{'document':_0x1c2c29,'fileName':_0x3445b9(0x21f)+'bin','mimetype':_0x3445b9(0x20e)+_0x3445b9(0x1f5)+_0x3445b9(0x151),'caption':_0x27d416}),info('['+name+(']\x20Sent\x20rec'+_0x3445b9(0x1c5)+_0x3445b9(0x192))+_0x4e9884),!![];}catch(_0x19d2be){return warn('['+name+(_0x3445b9(0x222)+_0x3445b9(0x12e)+_0x3445b9(0x1b6)+_0x3445b9(0x1e6))+(_0x19d2be?.[_0x3445b9(0x1dc)]||_0x19d2be)),![];}}function extractTextFromCtx(_0x3bca07){const _0x4ae44d=_0x2ef36c;if(!_0x3bca07||!_0x3bca07[_0x4ae44d(0x1dc)])return'';const _0x310673=_0x3bca07['message'];return _0x310673[_0x4ae44d(0x17f)+'on']||_0x310673['extendedTe'+_0x4ae44d(0x219)]?.[_0x4ae44d(0x1b9)]||_0x310673[_0x4ae44d(0x194)+'ge']?.[_0x4ae44d(0x21a)]||_0x310673[_0x4ae44d(0x1ce)+'ge']?.[_0x4ae44d(0x21a)]||'';}const processedCmdKeys=new Map(),CMD_DEDUPE_TTL_MS=(-0x1b53+0x2*-0x1+-0x1b73*-0x1)*(0xf7*-0x1a+-0x136*-0x1d+-0x70*0xe);function markCmdProcessed(_0x7613e2){const _0x36a0a0=_0x2ef36c;if(!_0x7613e2)return;if(processedCmdKeys[_0x36a0a0(0x1d3)](_0x7613e2))try{clearTimeout(processedCmdKeys[_0x36a0a0(0x19c)](_0x7613e2));}catch(_0x24afd5){};const _0x284143=setTimeout(()=>processedCmdKeys['delete'](_0x7613e2),CMD_DEDUPE_TTL_MS);processedCmdKeys[_0x36a0a0(0x1ff)](_0x7613e2,_0x284143);}function isCmdProcessed(_0x59a84e){const _0x59aefe=_0x2ef36c;return _0x59a84e&&processedCmdKeys[_0x59aefe(0x1d3)](_0x59a84e);}function _0x5d19(){const _0x6fb29b=['\x20`viewonce','fications\x20',']\x20cleanup\x20','\x20Target\x20JI','To\x20recover','=excluded.','remoteJid','quotedMess',']\x20handleCo','Not\x20set','rget\x20-\x20abo','notify','ngs\x20(PM-On','ument\x20to\x20','p_commands','imageMessa','67650MrmwrM','alized\x20lis','oup_comman','165LxYlkp','INSERT\x20INT','pushName','ions\x20set\x20t','get','\x20?,\x20?)\x20ON\x20','get\x20JID.','AULT\x200\x0a\x20\x20\x20','hat\x20*start','allow_grou','1208221IyZKsq','rting\x20comm','requires\x20b','Content\x20er','DEFAULT','sock','not\x20set','with\x20\x27_\x27\x20(','t\x20supporte','charAt','\x20ctx.key.r','mode',',\x20target=','fs\x20WHERE\x20k','\x20\x20\x20\x20\x20\x20\x20\x20up','fromMe','D*:\x20`','singleSele',',\x20notify=','updated_at','Dest\x20faile','_COMMANDS_','trim','text','unknown\x20ch','\x20set\x20mode.',']\x20Sent\x20rec','no\x20send\x20ta','value','Dest\x20retur','contextInf','ore)\x20to\x20at','.\x0aReply\x20to','1010151jEJUpG','buttonsRes','overed\x20doc','\x20Notificat','\x20Mode\x20set\x20',']\x20config\x20r','remove','ng\x20back\x20to','underscore','gistration',']\x20savePref','videoMessa','concat','extendedTe','isCommand','lue=exclud','has','string','d\x20unavaila','👁️\x20Detected','psert','gifPlaybac','\x20message',':\x20reload\x20a','once\x20inner','message','ia\x20buffer','VIEWONCE_S','viewonce','alue\x20TEXT\x20','unknown\x20us','group','@g.us','\x20notify\x20on','No\x20target\x20','d:\x20','\x20the\x20view-','nner\x20is\x20no','error:\x20','\x20failed:\x20','tener)','iew-once\x20i','KIP_IF_TAR','once\x20Setti','able','77tTpWJe','314MKstEd','ponseMessa','sertSingle','indexOf','n/octet-st','values',']\x20ensureSc','selectedRo','ey\x20TEXT\x20PR','ot\x20instanc','\x20that\x20mess','setting.','\x20failed\x20fo','dConfig\x20re','set','push','_jid\x27','ssageV2',']\x20no\x20confi','ge\x20with\x20a\x20','efreshed','at\x20starts\x20','delete','et*:\x20','\x20in\x20chat\x20',']\x20initiali',']\x20command\x20','e\x20<jid>`\x0a',']\x20DB\x20ready','applicatio','ndler\x20erro','ey)\x20DO\x20UPD','ands\x27','ssage','1438806Qrtynl','*Anti-View','\x20cleaned\x20u','ge\x20to\x20','essage\x20did','participan','xtMessage','caption','ewonce_pre',']\x20handleUp',':\x20reply\x20to','JID\x20set.','recovered.','ed\x20&\x20reloa','_prefs\x20(ke',']\x20forwardR','STS\x20viewon','slice','y,value,up','viewOnceMe','messages.u','target_jid','nation\x20res','urrently\x20*','unset','|off`\x0a',']\x20quoted\x20m','4597560ItDTsk','notify_vie','e\x20handler\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20k','\x20Failed\x20to','selectedBu','clear','ue\x20FROM\x20vi','\x20group:\x20','nitialize\x20','includes','OFF',']\x20Notified','r:\x20','ey=\x27notify','ey=\x27allow_','to\x20GROUP.\x20','Configured','ecoveredTo',']\x20notify\x20s','and','image','split','end\x20failed','rmation\x20ta','mmand\x20erro','88xlNmqX','wonce','once\x20messa','ds=','\x20inner\x20med','VIEWONCE_A','ded:\x20','\x20clear\x20tar','_SOURCE','sendMessag','dated_at\x20I','run','GROUP\x20(','status@bro','sage\x20avail','et\x20JID:\x20','tempt\x20reco',']\x20failed\x20t','2.0.0-patc','D\x20saved:\x20','\x20\x20\x20);\x0a\x20\x20\x20\x20','ing\x20recove','isArray','\x27\x20(undersc',']\x20pref\x20sav','rget','ble;\x20falli','ream','\x20p|g`\x0a',']\x20quoted\x20v','eo\x20to\x20','zed\x20(centr','ey=\x27mode\x27','emoteJid','onfig\x20erro',']\x20no\x20desti','[viewonce]','1227380IOjGPt','GET_EQUALS','BufferFrom','\x20view-once','*Send\x20Targ','\x20from\x20','hema\x20faile','\x20—\x20','key','O\x20viewonce','IMARY\x20KEY,','ions*:\x20','add','3668vuUpoK','ned\x20false','wId','in\x20a\x20view-','toLowerCas','VALUES\x20(?,','seMessage','viewonce.i',']\x20download','length','to\x20PM.','SELECT\x20val','dated_at)\x20','video','LLOW_GROUP',']\x20upsertHa','no\x20sendMes','ATE\x20TABLE\x20','unknown','catch',']\x20hotReloa','ey=\x27target','true','conversati','View-Once\x20','_viewonce\x27','ctReply',']\x20getBotJi','\x20-\x20attempt'];_0x5d19=function(){return _0x6fb29b;};return _0x5d19();}const recentResponded=new Set();export async function onMessage(_0x412d36){const _0x5df3dd=_0x2ef36c;try{if(!_0x412d36||!_0x412d36[_0x5df3dd(0x163)]||!_0x412d36[_0x5df3dd(0x1dc)])return;const _0x56e7c2=_0x412d36['key']?.['id']||null;if(_0x56e7c2){if(recentResponded['has'](_0x56e7c2))return;recentResponded[_0x5df3dd(0x167)](_0x56e7c2),setTimeout(()=>recentResponded[_0x5df3dd(0x207)](_0x56e7c2),(-0x1bdd+-0x234+0x1e4d*0x1)*(-0x1221+0x19e3+-0x3da));}if(_0x412d36[_0x5df3dd(0x1d1)]){const _0x5ef177=_0x412d36[_0x5df3dd(0x163)][_0x5df3dd(0x18b)],_0x501e31=typeof _0x5ef177===_0x5df3dd(0x1d4)&&_0x5ef177['endsWith'](_0x5df3dd(0x1e3));if(_0x501e31&&!ALLOW_GROUP_COMMANDS){}else{const _0x221e90=Boolean(_0x412d36['key'][_0x5df3dd(0x1b1)]);if(!_0x501e31&&!_0x221e90){const _0x49b29a=await isSudo(botRef,_0x412d36)[_0x5df3dd(0x17b)](()=>![]);if(!_0x49b29a){}else await handleCommand(_0x412d36)[_0x5df3dd(0x17b)](_0x384fcf=>warn('['+name+(_0x5df3dd(0x20b)+_0x5df3dd(0x1e9))+(_0x384fcf?.[_0x5df3dd(0x1dc)]||_0x384fcf)));}else{const _0x1ba7f2=await isSudo(botRef,_0x412d36)[_0x5df3dd(0x17b)](()=>![]),_0x176aa7=Boolean(_0x412d36['key'][_0x5df3dd(0x1b1)]);(_0x176aa7||_0x1ba7f2)&&await handleCommand(_0x412d36)[_0x5df3dd(0x17b)](_0x4cfd5e=>warn('['+name+(_0x5df3dd(0x20b)+_0x5df3dd(0x1e9))+(_0x4cfd5e?.[_0x5df3dd(0x1dc)]||_0x4cfd5e)));}}}const _0x3c89e9=extractContextInfo(_0x412d36);if(!_0x3c89e9||!_0x3c89e9[_0x5df3dd(0x18c)+'age'])return;const _0x5ccf63=extractTextFromCtx(_0x412d36)||'';if(!_0x5ccf63)return;const _0x4dc524=_0x5ccf63[_0x5df3dd(0x1b8)]()[_0x5df3dd(0x1ab)](-0x19f5+-0x2432+0x3e27);if(_0x4dc524!=='_')return;info('['+name+(']\x20Reply\x20st'+'arts\x20with\x20'+_0x5df3dd(0x1cb)+_0x5df3dd(0x184)+_0x5df3dd(0x14b)+'ry'));const _0x24c05d=extractViewOnceInnerFromQuoted(_0x3c89e9[_0x5df3dd(0x18c)+'age']);if(!_0x24c05d){warn('['+name+(_0x5df3dd(0x11b)+_0x5df3dd(0x217)+'\x20not\x20conta'+_0x5df3dd(0x16b)+_0x5df3dd(0x1db)+_0x5df3dd(0x1d9)));return;}let _0x29de8d=null,_0x2ab9db=null;if(_0x24c05d[_0x5df3dd(0x194)+'ge'])_0x29de8d=_0x24c05d[_0x5df3dd(0x194)+'ge'],_0x2ab9db=_0x5df3dd(0x131);else _0x24c05d[_0x5df3dd(0x1ce)+'ge']&&(_0x29de8d=_0x24c05d[_0x5df3dd(0x1ce)+'ge'],_0x2ab9db=_0x5df3dd(0x175));if(!_0x29de8d||!_0x2ab9db){warn('['+name+(_0x5df3dd(0x153)+_0x5df3dd(0x1ec)+_0x5df3dd(0x1e8)+_0x5df3dd(0x1aa)+'d\x20media\x20ty'+'pe'));return;}const _0x2000b7=await downloadBufferFromContent(_0x29de8d,_0x2ab9db);if(!_0x2000b7){warn('['+name+(_0x5df3dd(0x147)+'o\x20download'+_0x5df3dd(0x13a)+_0x5df3dd(0x1dd)));return;}const _0x5db33b=_0x412d36['key'][_0x5df3dd(0x18b)]||null,_0x530d47=_0x3c89e9[_0x5df3dd(0x218)+'t']||null,_0x406588=await forwardRecoveredToDest(_0x24c05d,_0x2000b7,_0x5db33b,_0x530d47);if(!_0x406588)warn('['+name+(_0x5df3dd(0x222)+_0x5df3dd(0x12e)+_0x5df3dd(0x1bf)+_0x5df3dd(0x169)));}catch(_0x18fed4){error(_0x18fed4,'['+name+(']\x20onMessag'+_0x5df3dd(0x11e)+_0x5df3dd(0x1e9))+(_0x18fed4?.['message']||_0x18fed4));}}async function handleCommand(_0x35b2b0){const _0x3dda5b=_0x2ef36c;try{if(!_0x35b2b0||!_0x35b2b0[_0x3dda5b(0x163)]||!_0x35b2b0[_0x3dda5b(0x1dc)])return;const _0x58ae40=_0x35b2b0[_0x3dda5b(0x163)][_0x3dda5b(0x18b)],_0x247ed6=typeof _0x58ae40===_0x3dda5b(0x1d4)&&_0x58ae40['endsWith']('@g.us');if(_0x247ed6&&!ALLOW_GROUP_COMMANDS)return;const _0x265ed8=Boolean(_0x35b2b0[_0x3dda5b(0x163)]['fromMe']);if(!_0x247ed6&&!_0x265ed8){const _0xed98ee=await isSudo(botRef,_0x35b2b0)[_0x3dda5b(0x17b)](()=>![]);if(!_0xed98ee)return;}const _0x51700a=Boolean(_0x35b2b0[_0x3dda5b(0x163)][_0x3dda5b(0x1b1)]),_0x3635f1=await isSudo(botRef,_0x35b2b0)[_0x3dda5b(0x17b)](()=>![]);let _0x43b0c1;if(_0x51700a)_0x43b0c1=getBotJid()||_0x35b2b0['key'][_0x3dda5b(0x18b)]||_0x35b2b0[_0x3dda5b(0x163)][_0x3dda5b(0x218)+'t']||null,!_0x43b0c1&&(warn('['+name+(_0x3dda5b(0x183)+_0x3dda5b(0x1d5)+_0x3dda5b(0x150)+_0x3dda5b(0x1ca)+_0x3dda5b(0x1ac)+_0x3dda5b(0x157))),_0x43b0c1=_0x35b2b0[_0x3dda5b(0x163)][_0x3dda5b(0x18b)]||null);else{if(_0x3635f1)_0x43b0c1=_0x35b2b0[_0x3dda5b(0x163)]['remoteJid'];else return;}if(!_0x43b0c1){warn('['+name+(_0x3dda5b(0x203)+_0x3dda5b(0x134)+_0x3dda5b(0x18f)+_0x3dda5b(0x1a3)+_0x3dda5b(0x130)));return;}const _0x11b863=String(_0x35b2b0[_0x3dda5b(0x163)][_0x3dda5b(0x18b)]||'')+'::'+String(_0x35b2b0['key']['id']||_0x35b2b0[_0x3dda5b(0x163)][_0x3dda5b(0x218)+'t']||'');if(isCmdProcessed(_0x11b863))return;markCmdProcessed(_0x11b863);const _0x70ad47=typeof _0x35b2b0[_0x3dda5b(0x1b9)]===_0x3dda5b(0x1d4)&&_0x35b2b0['text'][_0x3dda5b(0x1b8)]()[_0x3dda5b(0x171)]?_0x35b2b0[_0x3dda5b(0x1b9)][_0x3dda5b(0x1b8)]():function _0x4aa689(_0x2edf54){const _0x2152bf=_0x3dda5b;if(!_0x2edf54||!_0x2edf54['message'])return'';const _0x1c6b80=_0x2edf54['message'];if(_0x1c6b80[_0x2152bf(0x17f)+'on'])return _0x1c6b80[_0x2152bf(0x17f)+'on'];if(_0x1c6b80[_0x2152bf(0x1d0)+'xtMessage']?.['text'])return _0x1c6b80[_0x2152bf(0x1d0)+_0x2152bf(0x219)][_0x2152bf(0x1b9)];if(_0x1c6b80[_0x2152bf(0x194)+'ge']?.[_0x2152bf(0x21a)])return _0x1c6b80[_0x2152bf(0x194)+'ge']['caption'];if(_0x1c6b80['videoMessa'+'ge']?.[_0x2152bf(0x21a)])return _0x1c6b80['videoMessa'+'ge'][_0x2152bf(0x21a)];if(_0x1c6b80[_0x2152bf(0x1c4)+_0x2152bf(0x1f2)+'ge']?.[_0x2152bf(0x121)+'ttonId'])return _0x1c6b80[_0x2152bf(0x1c4)+_0x2152bf(0x1f2)+'ge'][_0x2152bf(0x121)+'ttonId'];if(_0x1c6b80['listRespon'+_0x2152bf(0x16e)]?.[_0x2152bf(0x1b3)+_0x2152bf(0x182)]?.[_0x2152bf(0x1f8)+'wId'])return _0x1c6b80['listRespon'+'seMessage'][_0x2152bf(0x1b3)+_0x2152bf(0x182)][_0x2152bf(0x1f8)+_0x2152bf(0x16a)];return'';}(_0x35b2b0)||'';if(!_0x70ad47)return;const _0x75f276=(_0x70ad47[_0x3dda5b(0x132)](/\r?\n/)[-0x10cc+0x2*0x2bb+0xb56]||'')[_0x3dda5b(0x1b8)](),_0x17f556=_0x75f276[_0x3dda5b(0x132)](/\s+/),_0xa657da=(_0x17f556[-0x1300+0x14c6*0x1+-0x1c6]||'')[_0x3dda5b(0x16c)+'e']();if(!commands[_0x3dda5b(0x126)](_0xa657da))return;const _0x1c4448=(_0x17f556[-0xb*0x289+0x2*0x9c5+0x85a*0x1]||'')['toLowerCas'+'e']();if(_0x1c4448===_0x3dda5b(0x190)){const _0x2c9554=(_0x17f556[0x1782+-0x1b*-0x5d+0x214f*-0x1]||'')[_0x3dda5b(0x16c)+'e']();if(!_0x2c9554){await trySend(_0x43b0c1,{'text':_0x3dda5b(0x15a)+_0x3dda5b(0x1c6)+'ions\x20are\x20c'+_0x3dda5b(0x118)+(NOTIFY_VIEWONCE?'ON':'OFF')+'*'});return;}const _0x1f8d8b=_0x2c9554==='on'||_0x2c9554==='1'||_0x2c9554===_0x3dda5b(0x17e),_0x1b3a94=await savePref(_0x3dda5b(0x11d)+'wonce',_0x1f8d8b?'1':'0');if(!_0x1b3a94){await trySend(_0x43b0c1,{'text':'[viewonce]'+_0x3dda5b(0x120)+'\x20save\x20noti'+_0x3dda5b(0x186)+_0x3dda5b(0x1fc)});return;}await trySend(_0x43b0c1,{'text':_0x3dda5b(0x15a)+'\x20Notificat'+_0x3dda5b(0x19b)+'o\x20*'+(_0x1f8d8b?'ON':_0x3dda5b(0x127))+'*'});return;}if(_0x1c4448==='p'||_0x1c4448==='pm'){const _0x40c383=await savePref('mode','p');if(!_0x40c383){await trySend(_0x43b0c1,{'text':'[viewonce]'+_0x3dda5b(0x120)+_0x3dda5b(0x1bb)});return;}await trySend(_0x43b0c1,{'text':_0x3dda5b(0x15a)+_0x3dda5b(0x1c7)+_0x3dda5b(0x172)});return;}if(_0x1c4448==='g'||_0x1c4448===_0x3dda5b(0x1e2)||_0x1c4448==='gp'){const _0x4c9db9=await savePref(_0x3dda5b(0x1ad),'g');if(!_0x4c9db9){await trySend(_0x43b0c1,{'text':'[viewonce]'+'\x20Failed\x20to'+_0x3dda5b(0x1bb)});return;}const _0x28600f=TARGET_JID?_0x3dda5b(0x12d)+_0x3dda5b(0x124)+TARGET_JID:_0x3dda5b(0x1e5)+_0x3dda5b(0x21e);await trySend(_0x43b0c1,{'text':'[viewonce]'+_0x3dda5b(0x1c7)+_0x3dda5b(0x12c)+_0x28600f});return;}if(_0x1c4448&&_0x1c4448['includes']('@')){const _0x481ebd=normalizeToUserJid(_0x1c4448),_0x111f6a=await savePref(_0x3dda5b(0x228),_0x481ebd);if(_0x111f6a)await trySend(_0x43b0c1,{'text':_0x3dda5b(0x15a)+_0x3dda5b(0x188)+_0x3dda5b(0x149)+_0x481ebd});else await trySend(_0x43b0c1,{'text':_0x3dda5b(0x15a)+'\x20Failed\x20to'+'\x20save\x20targ'+_0x3dda5b(0x145)+_0x481ebd});return;}if(_0x1c4448===_0x3dda5b(0x122)||_0x1c4448===_0x3dda5b(0x119)||_0x1c4448===_0x3dda5b(0x1c9)){const _0x37c230=await savePref(_0x3dda5b(0x228),'');if(_0x37c230)await trySend(_0x43b0c1,{'text':_0x3dda5b(0x15a)+'\x20Target\x20JI'+'D\x20cleared.'});else await trySend(_0x43b0c1,{'text':_0x3dda5b(0x15a)+_0x3dda5b(0x120)+_0x3dda5b(0x13d)+_0x3dda5b(0x19e)});return;}const _0x2fa360=MODE==='g'?_0x3dda5b(0x142)+(TARGET_JID||_0x3dda5b(0x1a8))+')':'PM';await trySend(_0x43b0c1,{'text':_0x3dda5b(0x214)+_0x3dda5b(0x1ee)+_0x3dda5b(0x191)+'ly)*\x0a\x0a'+('*Notificat'+_0x3dda5b(0x166)+(NOTIFY_VIEWONCE?'ON':_0x3dda5b(0x127))+(_0x3dda5b(0x185)+_0x3dda5b(0x1e4)+_0x3dda5b(0x11a)))+(_0x3dda5b(0x15f)+_0x3dda5b(0x208)+_0x2fa360+(_0x3dda5b(0x185)+_0x3dda5b(0x152)))+('*Target\x20JI'+_0x3dda5b(0x1b2)+(TARGET_JID||_0x3dda5b(0x18e))+('`\x20`viewonc'+_0x3dda5b(0x20c)))+(_0x3dda5b(0x189)+_0x3dda5b(0x21d)+_0x3dda5b(0x1e7)+_0x3dda5b(0x138)+_0x3dda5b(0x204)+'message\x20th'+_0x3dda5b(0x206)+_0x3dda5b(0x1a9)+_0x3dda5b(0x1cb)+').')});}catch(_0x50a436){warn('['+name+(_0x3dda5b(0x18d)+_0x3dda5b(0x135)+_0x3dda5b(0x129))+(_0x50a436?.['message']||_0x50a436));}}export async function initialize(_0x5da193){const _0x1f855=_0x2ef36c;if(!_0x5da193)throw new Error(_0x1f855(0x16f)+_0x1f855(0x125)+_0x1f855(0x1a4)+_0x1f855(0x1fa)+'e');botRef=_0x5da193,await ensureSchema(),refreshConfig(),startManagedListener({'botRef':botRef,'eventName':_0x1f855(0x227)+_0x1f855(0x1d7),'handler':upsertHandler,'moduleName':name}),info('['+name+(_0x1f855(0x20a)+_0x1f855(0x155)+_0x1f855(0x196)+_0x1f855(0x1eb)));}export async function cleanup(){const _0x153b47=_0x2ef36c;try{stopManagedListener(name,_0x153b47(0x227)+_0x153b47(0x1d7));for(const _0x58bd78 of processedKeys[_0x153b47(0x1f6)]())try{clearTimeout(_0x58bd78);}catch(_0x4aeb05){}processedKeys['clear']();}catch(_0x11144e){warn(name+(_0x153b47(0x187)+_0x153b47(0x1e9))+(_0x11144e?.[_0x153b47(0x1dc)]||_0x11144e));}finally{botRef=null,info(name+(_0x153b47(0x215)+'p'));}}export default{'name':name,'version':version,'priority':priority,'commands':commands,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};