const _0x550617=_0x4346;(function(_0x2d285d,_0x23323d){const _0x30c46e=_0x4346,_0x5ee60c=_0x2d285d();while(!![]){try{const _0x34a24a=parseInt(_0x30c46e(0x120))/(0x24af+0x932+-0x5bc*0x8)*(parseInt(_0x30c46e(0x1ef))/(-0x4*-0x80c+-0x1*0xcbb+-0x1373))+-parseInt(_0x30c46e(0x1f5))/(-0x1942+0x25c1+-0xc7c)*(parseInt(_0x30c46e(0x1be))/(-0xb*-0x350+0x1*0xa0c+-0x2e78))+parseInt(_0x30c46e(0x130))/(0xb8c+-0x14ae*0x1+0x927)*(parseInt(_0x30c46e(0xf4))/(-0x67a*0x2+-0x1*0x76+-0x2*-0x6b8))+parseInt(_0x30c46e(0x19c))/(-0x375*0x7+-0x14c3+-0xeff*-0x3)*(parseInt(_0x30c46e(0x12b))/(-0x241d+-0x5e8+0x2a0d))+parseInt(_0x30c46e(0x1b0))/(0x18d6*-0x1+0x3*-0x9e5+0x1*0x368e)*(parseInt(_0x30c46e(0x18a))/(-0x4*0x14d+-0x1*-0x1421+-0x25*0x67))+-parseInt(_0x30c46e(0x150))/(-0xb*0x29d+-0x85b+0x101*0x25)*(parseInt(_0x30c46e(0x10a))/(-0x3e*-0x5+0x127c+-0x13a6))+parseInt(_0x30c46e(0x1e7))/(0x81*-0x16+0x4*-0x7b8+0x867*0x5)*(parseInt(_0x30c46e(0x191))/(-0xa3d*0x2+0x4a*-0x22+-0x10c*-0x1d));if(_0x34a24a===_0x23323d)break;else _0x5ee60c['push'](_0x5ee60c['shift']());}catch(_0x272cd0){_0x5ee60c['push'](_0x5ee60c['shift']());}}}(_0x17bc,-0x48*-0x1aff+0x3ba7*0x27+-0x90*0x96a));import{DateTime}from'luxon';import{db}from'../utils/database.js';import{info,warn,error}from'../utils/logger.js';import{isadmin}from'../utils/isadmin.js';import{getConfig}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';export const name=_0x550617(0x21c);export const version='1.1.1';export const priority=0x1fe2+-0x2357+-0x41*-0xf;export const commands=[_0x550617(0x21c),_0x550617(0x1b2)];let botRef=null,sendApi=null;const DEFAULTS={'TIME_ZONE':_0x550617(0x1d6),'MAX_DAILY_KEEP_DAYS':0x5a,'ROLLOVER_TO_WEEK_DAYS':0x7,'ROLLOVER_TO_MONTH_DAYS':0x1e,'ROLLOVER_TO_YEAR_DAYS':0x16d,'USERS_LIMIT_RETURN':0xc8,'DEDUPE_TTL_MS':(0x1*-0x18a3+-0xf44+0x2805)*(0xa17+0x6*0x58d+-0x277d)};let CONFIG={...DEFAULTS};function normalizeJid(_0x19e2e9){const _0x3de453=_0x550617;return _0x19e2e9?String(_0x19e2e9)[_0x3de453(0x1cc)]():'';}function sleep(_0x4da9a5){return new Promise(_0x4cd505=>setTimeout(_0x4cd505,_0x4da9a5));}function toLowerRoman(_0x3be214){const _0x2995ba=_0x550617,_0xacd584=[[0x238*0xf+0x34*-0x2f+-0x6c*0x2f,'M'],[-0x25e1*-0x1+0x8f8*0x4+0x1*-0x463d,'CM'],[0x4e1+0x16c2+-0x19af,'D'],[-0xd81*-0x2+-0x145b+-0x517*0x1,'CD'],[-0x1f82+0xf13+0x10d3,'C'],[0x1*0x181+-0xeb*0x1+-0x3c,'XC'],[-0x1e5*-0x2+0x949+-0xce1,'L'],[0x23b+0x6*0x286+0x3*-0x5bd,'XL'],[0x1055*0x2+0x226c+-0x430c*0x1,'X'],[0x28*0xf3+-0x1851+-0x7*0x1f2,'IX'],[-0x2e5+0xaf2+0x2*-0x404,'V'],[0x14*-0x13a+-0x1c3e+0x34ca,'IV'],[0x1*-0x2196+0x24e5*-0x1+-0x1*-0x467c,'I']];let _0x50fb3e=_0x3be214,_0x3b3c1a='';for(const [_0x4e1e41,_0x4df426]of _0xacd584)while(_0x50fb3e>=_0x4e1e41){_0x3b3c1a+=_0x4df426,_0x50fb3e-=_0x4e1e41;}return _0x3b3c1a[_0x2995ba(0x21e)+'e']();}function romanParen(_0x35b7ae){return'('+toLowerRoman(_0x35b7ae)+')';}const processedMessageKeys=new Map();function makeDedupeKey(_0x585316){const _0x417f04=_0x550617,_0xd31c50=_0x585316?.['key'];if(!_0xd31c50)return null;const _0x103122=_0xd31c50['id']||_0xd31c50[_0x417f04(0x1a4)+'t']||'',_0x2edebf=_0xd31c50[_0x417f04(0x1f8)]||'';return _0x2edebf+'::'+_0x103122;}function isMsgProcessed(_0x330ad6){return _0x330ad6&&processedMessageKeys['has'](_0x330ad6);}function markMsgProcessed(_0x2ff2d1){const _0x31471e=_0x550617;if(!_0x2ff2d1)return;if(processedMessageKeys['has'](_0x2ff2d1))clearTimeout(processedMessageKeys[_0x31471e(0x13c)](_0x2ff2d1));const _0x36db3e=setTimeout(()=>processedMessageKeys[_0x31471e(0x1b8)](_0x2ff2d1),CONFIG[_0x31471e(0x1b1)+'_MS']);processedMessageKeys[_0x31471e(0xf8)](_0x2ff2d1,_0x36db3e);}async function ensureSchema(){const _0x22355d=_0x550617;try{await db[_0x22355d(0x11e)](_0x22355d(0x1cf)+_0x22355d(0x168)+'EXISTS\x20act'+_0x22355d(0x152)+_0x22355d(0x1dc)+_0x22355d(0x11f)+_0x22355d(0x156)+_0x22355d(0x1f1)+_0x22355d(0x175)+_0x22355d(0x13d)+_0x22355d(0x19a)+_0x22355d(0x1cd)+_0x22355d(0x207)),await db[_0x22355d(0x11e)](_0x22355d(0x1fd)+_0x22355d(0x21f)+_0x22355d(0x212)+_0x22355d(0x11c)+_0x22355d(0x1a8)+_0x22355d(0xec)+_0x22355d(0x15e)+_0x22355d(0x104)+_0x22355d(0x202)+'ENT,\x0a\x20\x20\x20\x20\x20'+_0x22355d(0x1d0)+_0x22355d(0x115)+_0x22355d(0x19d)+'\x20\x20\x20\x20\x20user_'+_0x22355d(0x10f)+_0x22355d(0x118)+_0x22355d(0xdf)+_0x22355d(0x232)+_0x22355d(0x15b)+',\x20\x20\x20\x20\x20\x20\x20\x20-'+_0x22355d(0x223)+_0x22355d(0x1dd)+_0x22355d(0x222)+_0x22355d(0x233)+_0x22355d(0x22c)+_0x22355d(0x144)+_0x22355d(0x15b)+_0x22355d(0x108)+_0x22355d(0x1ba)+_0x22355d(0xf0)+_0x22355d(0x111)+_0x22355d(0x1f7)+_0x22355d(0x220)+_0x22355d(0x193)+_0x22355d(0x1c6)+_0x22355d(0x14a)+_0x22355d(0x1bc)+'NTEGER\x20DEF'+_0x22355d(0x1e2)+_0x22355d(0x12f)+_0x22355d(0x1fe)+_0x22355d(0x11b)+'T\x20\x27\x27,\x0a\x20\x20\x20\x20'+_0x22355d(0x154)+'pdated\x20INT'+'EGER\x20DEFAU'+_0x22355d(0x19a)+_0x22355d(0x1cd)+'ow\x27)),\x0a\x20\x20\x20'+'\x20\x20\x20\x20\x20UNIQU'+_0x22355d(0x112)+_0x22355d(0x17b)+',\x20timefram'+_0x22355d(0x1c1)+_0x22355d(0x1f6)+_0x22355d(0x1ac)),await db[_0x22355d(0x11e)]('CREATE\x20IND'+'EX\x20IF\x20NOT\x20'+_0x22355d(0xfc)+_0x22355d(0x214)+'ats_chat_t'+'f\x20ON\x20activ'+'e_stats(ch'+_0x22355d(0x211)+_0x22355d(0x197)+_0x22355d(0x20a)+';'),await db[_0x22355d(0x11e)](_0x22355d(0x121)+_0x22355d(0x199)+_0x22355d(0xfc)+_0x22355d(0x214)+_0x22355d(0xde)+_0x22355d(0x21a)+'ive_stats('+'chat_jid,\x20'+'user_jid);'),await db[_0x22355d(0x11e)]('\x0a\x20\x20\x20\x20\x20\x20CRE'+'ATE\x20TABLE\x20'+_0x22355d(0x212)+_0x22355d(0x11c)+_0x22355d(0x196)+'rd_message'+'s\x20(\x0a\x20\x20\x20\x20\x20\x20'+_0x22355d(0x101)+_0x22355d(0x22e)+_0x22355d(0x105)+_0x22355d(0xe4)+_0x22355d(0x1a0)+_0x22355d(0x14e)+_0x22355d(0xda)),info(_0x22355d(0x15c)+'chema\x20ensu'+_0x22355d(0x1bf));}catch(_0x14aba0){error(_0x14aba0,_0x22355d(0x171)+_0x22355d(0x182)+_0x22355d(0x114));throw _0x14aba0;}}export async function trackMessage(_0x243dc6){const _0x49de92=_0x550617;try{if(!_0x243dc6||!_0x243dc6['key']||!_0x243dc6[_0x49de92(0x103)])return;const _0x54ee5a=makeDedupeKey(_0x243dc6);if(!_0x54ee5a)return;if(isMsgProcessed(_0x54ee5a))return;markMsgProcessed(_0x54ee5a);if(_0x243dc6[_0x49de92(0x1a6)][_0x49de92(0x19f)])return;const _0x491665=_0x243dc6[_0x49de92(0x1a6)][_0x49de92(0x1f8)];if(!_0x491665||!_0x491665['endsWith'](_0x49de92(0x16a)))return;const _0x54cff7=_0x243dc6['key'][_0x49de92(0x1a4)+'t']||_0x243dc6['key'][_0x49de92(0x1ff)]||'';if(!_0x54cff7)return;const _0x4cb1f8=normalizeJid(_0x54cff7),_0x950ddf=DateTime['now']()[_0x49de92(0x184)](CONFIG[_0x49de92(0x208)]),_0x1cfe2c=_0x950ddf[_0x49de92(0x1da)](_0x49de92(0xe5));try{const _0x3e2c2a=await db['run'](_0x49de92(0x149)+_0x49de92(0x14f)+'ve_stats\x0a\x20'+_0x49de92(0x189)+'\x20message_c'+'ount\x20=\x20mes'+_0x49de92(0x20d)+_0x49de92(0x20b)+_0x49de92(0x1b4)+_0x49de92(0x10c)+_0x49de92(0x1c4)+_0x49de92(0x1ae)+_0x49de92(0x170)+'jid\x20=\x20?\x20AN'+_0x49de92(0x22f)+_0x49de92(0xfa)+_0x49de92(0x195)+_0x49de92(0x205)+'ND\x20bucket_'+_0x49de92(0x148)+_0x49de92(0x142),[_0x243dc6[_0x49de92(0xe6)]||_0x243dc6[_0x49de92(0x1b9)]||'',Math['floor'](_0x950ddf[_0x49de92(0xff)]()),_0x491665,_0x4cb1f8,_0x1cfe2c]);(!_0x3e2c2a||!_0x3e2c2a[_0x49de92(0x1d4)])&&await db[_0x49de92(0x192)](_0x49de92(0x224)+_0x49de92(0x186)+_0x49de92(0x14d)+_0x49de92(0xd6)+'t_jid,\x20use'+_0x49de92(0x21b)+_0x49de92(0x215)+_0x49de92(0x12e)+_0x49de92(0x10b)+_0x49de92(0x1ed)+_0x49de92(0x119)+_0x49de92(0x190)+'d)\x0a\x20\x20\x20\x20\x20\x20\x20'+'\x20\x20\x20VALUES\x20'+_0x49de92(0x1fc)+_0x49de92(0x167)+_0x49de92(0x1c0)+_0x49de92(0x12d),[_0x491665,_0x4cb1f8,_0x1cfe2c,_0x243dc6[_0x49de92(0xe6)]||_0x243dc6[_0x49de92(0x1b9)]||'',Math[_0x49de92(0x218)](_0x950ddf[_0x49de92(0xff)]())]);}catch(_0x19ede6){warn('[active]\x20t'+_0x49de92(0x1ee)+'e\x20DB\x20error'+':\x20'+(_0x19ede6?.[_0x49de92(0x103)]||_0x19ede6));}}catch(_0x4f0163){warn(_0x49de92(0xe8)+_0x49de92(0x1ee)+_0x49de92(0x164)+_0x49de92(0x128)+(_0x4f0163?.[_0x49de92(0x103)]||_0x4f0163));}}function _0x17bc(){const _0x4081ae=['fromFormat','pdated\x20=\x20?','nMessage\x20f',':\x20YYYY\x0a\x20\x20\x20','[active]\x20o','UPDATE\x20act','weekly','essage_cou','<=\x20?','trim','me(\x27%s\x27,\x27n','erformRoll','CREATE\x20TAB','\x20\x20\x20chat_ji','[active]\x20f','board\x20erro','members\x20in','changes','?,\x20?,\x20\x27wee','UTC','key\x20=\x20?\x20LI','ticipants\x20','|y>\x0aExampl','toFormat','daily\x20rows','ions\x20(vers','\x27weekly\x27|\x27','ECT\x20user_j','he\x20last\x20','DELETE\x20FRO','tive\x207d','AULT\x200,\x0a\x20\x20','IMIT\x201','[active]\x20r','unt\x20+\x20?,\x20d','ðŸ‘¤\x20@','22335703sYayJm','ctive\x20<amo','failed:\x20','e_count\x20=\x20','_count,\x20di','count','unt,\x20displ','rackMessag','2VQwhlH','object','KEY,\x20migra','und\x20in\x20the','ekly\x27','?,\x20?,\x20?)','123IasUWS','key)\x0a\x20\x20\x20\x20\x20','Y-WW,\x20mont','remoteJid','\x20FROM\x20acti','split','?,\x20?,\x20\x27yea','(?,\x20?,\x20\x27da','\x0a\x20\x20\x20\x20\x20\x20CRE','lay_name\x20T','from','found\x20in\x20t','failed\x20for','AUTOINCREM','length','=\x20?\x20AND\x20ti','\x20\x27daily\x27\x20A','T_RETURN','ow\x27)));','TIME_ZONE','rune\x20daily','ucket_key)','\x20+\x201,\x20disp','nitialize\x20','sage_count','AND\x20bucket','e\x201w,\x20inac','KEEP_DAYS','at_jid,\x20ti','IF\x20NOT\x20EXI',')\x20VALUES\x20(','_active_st','eframe,\x20bu','O\x20active_s','\x20active\x20us','floor','determine\x20','ser\x20ON\x20act','r_jid,\x20tim','active','weekNumber','toLowerCas','ATE\x20TABLE\x20','hly:\x20YYYY-','Y\x20user_jid','monthly\x27|\x27','-\x20\x27daily\x27|','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','bucket_key','\x20user_jid,','[active]\x20i',':\x0a\x0a','function','\x20no\x20messag','isCommand','\x20\x20\x20\x20\x20\x20buck','Usage:\x20act','\x20TEXT\x20PRIM','D\x20user_jid','daily\x27\x20AND','\x20bucket_ke','eframe\x20TEX','yearly\x27\x0a\x20\x20','minus','stats\x20(cha','||weekly||','Found\x20','r:\x20',';\x0a\x20\x20\x20\x20','sock','end\x20usage\x20','\x27weekly\x27\x20A','ats_chat_u','\x20\x20\x20\x20\x20\x20\x20tim','string','id\x20=\x20?','es\x0a\x0a','ailed\x20to\x20r','\x20\x20\x20\x20\x20\x20\x20mes','yyyy-LL-dd','pushName','t_key\x20<=\x20?','[active]\x20t','_key\x20=\x20?\x20L','ND\x20bucket_','timeframe','\x20\x20\x20\x20\x20\x20\x20id\x20','\x20=\x20\x27daily\x27','frame,\x20buc','\x27,\x27monthly','Y-MM-DD,\x20w','weekYear','isArray','now','3379818Daniyg','sourceIds','tats\x20(chat','[active]\x20c','set','ive_stats\x20','\x20=\x20?\x20AND\x20t','M\x20active_s','EXISTS\x20idx','y_name,\x20SU','meframe\x20=\x20','toSeconds','padStart','\x20\x20chat_jid','nitialized','message','IMARY\x20KEY\x20','ARY\x20KEY,\x0a\x20','No\x20inactiv','O_YEAR_DAY',',\x20\x20\x20\x20\x20\x20--\x20','last_ts','12XkLnlE','message_co','\x20?,\x20last_u','clear','HERE\x20timef','jid\x20TEXT\x20N','st_updated','eekly:\x20YYY','E(chat_jid','_ts\x0a\x20\x20\x20\x20\x20\x20','a\x20failed','d\x20TEXT\x20NOT','ollups\x20com','_jid,\x20user','OT\x20NULL,\x0a\x20','ay_name,\x20l','\x27,\x27yearly\x27','EXT\x20DEFAUL','STS\x20active','values','exec','ion\x20INTEGE','247193qguxKd','CREATE\x20IND','\x20failed:\x20','id\x20=\x20?\x20AND','yearly','\x20AND\x20bucke',',\x20?,\x20?)','ERE\x20chat_j','ed:\x20','y_name,\x20la','ers\x20in\x20the','15368oOugYP','e\x20members\x20','\x20\x20\x20\x20\x20\x20','cket_key,\x20','\x20\x20\x20\x20\x20\x20disp','10emzPTx','text','[active]\x20p','unit','\x20the\x20last\x20','stats\x20WHER','group\x20part','SELECT\x20id\x20','t_updated\x20','fromObject','join','O_MONTH_DA','get','EGER\x20DEFAU','ailed:\x20','day','thly\x27,\x20?,\x20','nt,\x20displa','\x20\x20\x20\x20','eframe\x20=\x20\x27','et_key\x20TEX','ve_stats\x20W','ACTIVE','members\x20fo','key\x20=\x20?\x0a\x20\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20U','\x20\x20\x20\x20\x20messa','es:\x20active','FROM\x20activ','TO\x20active_','XT\x0a\x20\x20\x20\x20\x20\x20)','PDATE\x20acti','13252349pCGjaX','y,\x20message','ive_migrat','MIT\x201','\x20\x20\x20\x20last_u','N\x20(\x27weekly','R\x20PRIMARY\x20','nthly\x27','SELECT\x20use','unt','all','T\x20NOT\x20NULL','[active]\x20s','No\x20active\x20','INTEGER\x20PR','t><d|w|m|y','monthly','sendMessag','filter','\x20id\x20IN\x20(','e\x20unexpect','\x20messages\x0a','id,\x20displa','ily\x27,\x20?,\x201','LE\x20IF\x20NOT\x20','\x20last\x20','@g.us','chat_jid','\x20timeframe','slice','amount','count)\x20AS\x20','HERE\x20chat_','[active]\x20e','e_stats\x0a\x20\x20','isplay_nam','USERS_LIMI','ted_at\x20INT','\x20inactive\x20','match','ROLLOVER_T','ay_name\x20FR','.ACTIVE:\x20',',\x20user_jid','kly\x27,\x20?,\x20?','ily\x27\x20AND\x20b','ket_key,\x20m','ucket_key\x20','\x0a\x20\x20\x20\x20\x20\x20SEL','\x20\x20\x20GROUP\x20B','nsureSchem','groupMetad','setZone','ata','\x20INSERT\x20IN','display_na','month','\x20\x20\x20\x20\x20\x20\x20SET','590FOvHHw','rly\x27,\x20?,\x20?','year','map','push','INSERT\x20INT','ast_update','14vPmmkw','run','MM,\x20yearly','_jid,\x20time','imeframe\x20=','_leaderboa','meframe,\x20b','tats\x20WHERE','EX\x20IF\x20NOT\x20','LT\x20(strfti','startOf','301SxtSbb','\x20NULL,\x0a\x20\x20\x20','>\x20\x20OR\x20\x20ina','fromMe','sage_id\x20TE','=\x20?\x20WHERE\x20','uildLeader','has','participan','cnt,\x20MAX(l','key','\x20chat_jid,','_stats\x20(\x0a\x20','elete\x20old\x20','[active]\x20d','\x27monthly\x27\x20','\x20);\x0a\x20\x20\x20\x20','Could\x20not\x20','\x0a\x20\x20\x20\x20\x20\x20\x20\x20W','e\x20=\x20?,\x20las','2907Qpqenk','DEDUPE_TTL','inactive','rame\x20=\x20\x27we','lay_name\x20=','\x27yearly\x27\x20A','e_stats\x20WH','sort','delete','senderName','daily:\x20YYY','d)\x20AS\x20last','ge_count\x20I','user_jid','121240UShKJF','red',',\x20?,\x20?)\x0a\x20\x20','e,\x20bucket_','ead\x20config'];_0x17bc=function(){return _0x4081ae;};return _0x17bc();}async function performRollups(){const _0xe87262=_0x550617;try{const _0x297472=DateTime[_0xe87262(0xf3)]()['setZone'](CONFIG['TIME_ZONE']),_0x2cc8d8=_0x297472[_0xe87262(0xd5)]({'days':CONFIG['ROLLOVER_T'+'O_WEEK_DAY'+'S']})[_0xe87262(0x19b)](_0xe87262(0x13f)),_0x4fa329=_0x2cc8d8[_0xe87262(0x1da)](_0xe87262(0xe5)),_0x2405a4=await db[_0xe87262(0x15a)]('SELECT\x20id,'+_0xe87262(0x1a7)+'\x20user_jid,'+_0xe87262(0x231)+_0xe87262(0x151)+_0xe87262(0x1eb)+'splay_name'+_0xe87262(0x1f9)+_0xe87262(0x145)+_0xe87262(0x10e)+'rame\x20=\x20\x27da'+_0xe87262(0x17d)+_0xe87262(0x17f)+_0xe87262(0x1cb),[_0x4fa329]);if(_0x2405a4&&_0x2405a4[_0xe87262(0x203)]){const _0x2a7c8e=new Map();for(const _0x50e423 of _0x2405a4){const _0x2f037d=DateTime[_0xe87262(0x1c3)](_0x50e423[_0xe87262(0x225)],_0xe87262(0xe5),{'zone':CONFIG[_0xe87262(0x208)]}),_0x45ba26=_0x2f037d[_0xe87262(0xf1)]+'-'+String(_0x2f037d[_0xe87262(0x21d)])['padStart'](0xc*0x92+-0x3b*-0x25+-0xf5d,'0'),_0x46ee16=_0x50e423['chat_jid']+'||'+_0x50e423['user_jid']+_0xe87262(0xd7)+_0x45ba26;if(!_0x2a7c8e['has'](_0x46ee16))_0x2a7c8e[_0xe87262(0xf8)](_0x46ee16,{'chat_jid':_0x50e423[_0xe87262(0x16b)],'user_jid':_0x50e423[_0xe87262(0x1bd)],'timeframe':_0xe87262(0x1c9),'bucket_key':_0x45ba26,'message_count':0x0,'display_name':_0x50e423[_0xe87262(0x187)+'me']||''});const _0x374ae5=_0x2a7c8e['get'](_0x46ee16);_0x374ae5[_0xe87262(0x10b)+_0xe87262(0x159)]+=Number(_0x50e423[_0xe87262(0x10b)+_0xe87262(0x159)]||-0x10dc+-0xdc6+0x1ea2);}for(const _0x4e4a1f of _0x2a7c8e['values']()){const _0x1a2b67=await db['get'](_0xe87262(0x137)+_0xe87262(0x14c)+_0xe87262(0x1b6)+_0xe87262(0x127)+_0xe87262(0x123)+'\x20user_jid\x20'+_0xe87262(0x204)+_0xe87262(0xfe)+_0xe87262(0xdd)+'ND\x20bucket_'+_0xe87262(0x1d7)+_0xe87262(0x153),[_0x4e4a1f['chat_jid'],_0x4e4a1f['user_jid'],_0x4e4a1f['bucket_key']]);!_0x1a2b67?await db[_0xe87262(0x192)]('INSERT\x20INT'+'O\x20active_s'+_0xe87262(0xf6)+_0xe87262(0x117)+_0xe87262(0x194)+_0xe87262(0xee)+'ket_key,\x20m'+'essage_cou'+'nt,\x20displa'+_0xe87262(0x129)+_0xe87262(0x110)+_0xe87262(0x213)+_0xe87262(0x1d5)+_0xe87262(0x17c)+_0xe87262(0x126),[_0x4e4a1f['chat_jid'],_0x4e4a1f['user_jid'],_0x4e4a1f[_0xe87262(0x225)],_0x4e4a1f[_0xe87262(0x10b)+_0xe87262(0x159)],_0x4e4a1f['display_na'+'me']||'',Math['floor'](_0x297472[_0xe87262(0xff)]())]):await db['run']('UPDATE\x20act'+_0xe87262(0xf9)+'SET\x20messag'+_0xe87262(0x1ea)+_0xe87262(0x10b)+_0xe87262(0x1e5)+'isplay_nam'+_0xe87262(0x1af)+_0xe87262(0x138)+_0xe87262(0x1a1)+_0xe87262(0xe1),[_0x4e4a1f[_0xe87262(0x10b)+_0xe87262(0x159)],_0x4e4a1f['display_na'+'me']||'',Math['floor'](_0x297472[_0xe87262(0xff)]()),_0x1a2b67['id']]);}try{const _0x555372=_0x2405a4[_0xe87262(0x18d)](_0x10e0f6=>_0x10e0f6['id']);for(let _0x224e4f=0xc97+0x1fe*-0xa+0x755;_0x224e4f<_0x555372[_0xe87262(0x203)];_0x224e4f+=-0x139f+-0x5d6+0x1*0x1b69){const _0x7f384d=_0x555372[_0xe87262(0x16d)](_0x224e4f,_0x224e4f+(0x3*0x981+0x1748*-0x1+-0x347*0x1)),_0x40933f=_0xe87262(0x1e0)+_0xe87262(0xfb)+_0xe87262(0x198)+'\x20id\x20IN\x20('+_0x7f384d[_0xe87262(0x18d)](()=>'?')[_0xe87262(0x13a)](',')+')';await db['run'](_0x40933f,_0x7f384d);}}catch(_0x2ba746){warn(_0xe87262(0x1aa)+_0xe87262(0x1a9)+_0xe87262(0x1db)+_0xe87262(0x122)+(_0x2ba746?.[_0xe87262(0x103)]||_0x2ba746));}}const _0xd17a42=_0x297472[_0xe87262(0xd5)]({'days':CONFIG[_0xe87262(0x178)+_0xe87262(0x13b)+'YS']})['toSeconds'](),_0x4a96cb=await db[_0xe87262(0x15a)]('SELECT\x20id,'+_0xe87262(0x1a7)+_0xe87262(0x226)+_0xe87262(0x231)+_0xe87262(0x151)+_0xe87262(0x1eb)+'splay_name'+_0xe87262(0x1f9)+_0xe87262(0x145)+'HERE\x20timef'+_0xe87262(0x1b3)+_0xe87262(0x1f3));if(_0x4a96cb&&_0x4a96cb['length']){const _0x52d12e=new Map();for(const _0x54239a of _0x4a96cb){const _0x3f9eaf=String(_0x54239a[_0xe87262(0x225)]||'')['split']('-'),_0x23928d=Number(_0x3f9eaf[0x1*-0xd87+-0x1*-0x1602+-0xd*0xa7])||-0x1*-0x104f+0xb70+0x57*-0x3b,_0x10038b=Number(_0x3f9eaf[-0x25fa+0x2f*0xc1+0x28c])||-0x275+-0x182*0x18+0x26a6,_0x10f1a9=DateTime[_0xe87262(0x139)]({'weekYear':_0x23928d,'weekNumber':_0x10038b,'weekday':0x1,'zone':CONFIG[_0xe87262(0x208)]});if(_0x10f1a9[_0xe87262(0xff)]()>_0xd17a42)continue;const _0x280808=_0x10f1a9[_0xe87262(0x18c)]+'-'+String(_0x10f1a9[_0xe87262(0x188)])[_0xe87262(0x100)](0x17*0x124+0x14e*0x1d+-0x4010,'0'),_0x5a3dcd=_0x54239a[_0xe87262(0x16b)]+'||'+_0x54239a['user_jid']+('||monthly|'+'|')+_0x280808;if(!_0x52d12e[_0xe87262(0x1a3)](_0x5a3dcd))_0x52d12e[_0xe87262(0xf8)](_0x5a3dcd,{'chat_jid':_0x54239a[_0xe87262(0x16b)],'user_jid':_0x54239a[_0xe87262(0x1bd)],'timeframe':_0xe87262(0x160),'bucket_key':_0x280808,'message_count':0x0,'display_name':_0x54239a[_0xe87262(0x187)+'me']||'','sourceIds':[]});const _0x146739=_0x52d12e['get'](_0x5a3dcd);_0x146739[_0xe87262(0x10b)+_0xe87262(0x159)]+=Number(_0x54239a[_0xe87262(0x10b)+_0xe87262(0x159)]||-0x132d*-0x2+0x1*0xb4d+-0x31a7),_0x146739[_0xe87262(0xf5)][_0xe87262(0x18e)](_0x54239a['id']);}for(const _0x1d860a of _0x52d12e[_0xe87262(0x11d)]()){const _0x4ee07b=await db[_0xe87262(0x13c)](_0xe87262(0x137)+_0xe87262(0x14c)+_0xe87262(0x1b6)+_0xe87262(0x127)+'id\x20=\x20?\x20AND'+'\x20user_jid\x20'+_0xe87262(0x204)+'meframe\x20=\x20'+_0xe87262(0x1ab)+_0xe87262(0x20e)+_0xe87262(0xe9)+_0xe87262(0x1e3),[_0x1d860a[_0xe87262(0x16b)],_0x1d860a['user_jid'],_0x1d860a[_0xe87262(0x225)]]);!_0x4ee07b?await db[_0xe87262(0x192)](_0xe87262(0x18f)+_0xe87262(0x216)+_0xe87262(0xf6)+'_jid,\x20user'+_0xe87262(0x194)+_0xe87262(0xee)+_0xe87262(0x17e)+_0xe87262(0x1ca)+_0xe87262(0x141)+'y_name,\x20la'+'st_updated'+_0xe87262(0x213)+'?,\x20?,\x20\x27mon'+_0xe87262(0x140)+_0xe87262(0x1f4),[_0x1d860a[_0xe87262(0x16b)],_0x1d860a[_0xe87262(0x1bd)],_0x1d860a['bucket_key'],_0x1d860a[_0xe87262(0x10b)+_0xe87262(0x159)],_0x1d860a[_0xe87262(0x187)+'me']||'',Math[_0xe87262(0x218)](_0x297472['toSeconds']())]):await db['run'](_0xe87262(0x1c8)+_0xe87262(0xf9)+'SET\x20messag'+'e_count\x20=\x20'+_0xe87262(0x10b)+_0xe87262(0x1e5)+_0xe87262(0x173)+_0xe87262(0x1af)+'t_updated\x20'+'=\x20?\x20WHERE\x20'+_0xe87262(0xe1),[_0x1d860a[_0xe87262(0x10b)+_0xe87262(0x159)],_0x1d860a['display_na'+'me']||'',Math[_0xe87262(0x218)](_0x297472['toSeconds']()),_0x4ee07b['id']]);if(Array['isArray'](_0x1d860a['sourceIds'])&&_0x1d860a[_0xe87262(0xf5)][_0xe87262(0x203)])for(let _0xe61f1d=0xe6a+0xf12+-0x1d7c;_0xe61f1d<_0x1d860a['sourceIds'][_0xe87262(0x203)];_0xe61f1d+=0x1227*-0x2+0x1*0x21dd+0x7d*0x9){const _0x43fa3b=_0x1d860a[_0xe87262(0xf5)][_0xe87262(0x16d)](_0xe61f1d,_0xe61f1d+(0x36+0x666+0x254*-0x2)),_0x47427d=_0xe87262(0x1e0)+_0xe87262(0xfb)+_0xe87262(0x198)+_0xe87262(0x163)+_0x43fa3b['map'](()=>'?')[_0xe87262(0x13a)](',')+')';await db[_0xe87262(0x192)](_0x47427d,_0x43fa3b);}}}const _0x2537c8=_0x297472[_0xe87262(0xd5)]({'days':CONFIG[_0xe87262(0x178)+_0xe87262(0x107)+'S']})['toSeconds'](),_0x3329d0=await db['all']('SELECT\x20id,'+_0xe87262(0x1a7)+_0xe87262(0x226)+_0xe87262(0x231)+_0xe87262(0x151)+_0xe87262(0x1eb)+'splay_name'+_0xe87262(0x1f9)+_0xe87262(0x145)+_0xe87262(0x10e)+'rame\x20=\x20\x27mo'+_0xe87262(0x157));if(_0x3329d0&&_0x3329d0['length']){const _0x3a75d=new Map();for(const _0x133866 of _0x3329d0){const _0x116dba=String(_0x133866[_0xe87262(0x225)]||'')[_0xe87262(0x1fa)]('-'),_0xe3178f=Number(_0x116dba[0x2*-0x2a4+-0x1088+0x15d0])||0x780+0x16f+0x13d*-0x1,_0x499d7d=DateTime['fromObject']({'year':_0xe3178f,'month':0x1,'day':0x1,'zone':CONFIG['TIME_ZONE']});if(_0x499d7d[_0xe87262(0xff)]()>_0x2537c8)continue;const _0x5b7670=''+_0xe3178f,_0x2473fe=_0x133866['chat_jid']+'||'+_0x133866[_0xe87262(0x1bd)]+'||yearly||'+_0x5b7670;if(!_0x3a75d[_0xe87262(0x1a3)](_0x2473fe))_0x3a75d[_0xe87262(0xf8)](_0x2473fe,{'chat_jid':_0x133866[_0xe87262(0x16b)],'user_jid':_0x133866['user_jid'],'timeframe':_0xe87262(0x124),'bucket_key':_0x5b7670,'message_count':0x0,'display_name':_0x133866[_0xe87262(0x187)+'me']||'','sourceIds':[]});const _0x473b0b=_0x3a75d['get'](_0x2473fe);_0x473b0b[_0xe87262(0x10b)+'unt']+=Number(_0x133866[_0xe87262(0x10b)+'unt']||-0x12d*-0x5+0xd*-0x103+0x746),_0x473b0b['sourceIds'][_0xe87262(0x18e)](_0x133866['id']);}for(const _0x1fab8d of _0x3a75d[_0xe87262(0x11d)]()){const _0x46f03c=await db[_0xe87262(0x13c)]('SELECT\x20id\x20'+_0xe87262(0x14c)+_0xe87262(0x1b6)+_0xe87262(0x127)+_0xe87262(0x123)+'\x20user_jid\x20'+_0xe87262(0x204)+'meframe\x20=\x20'+_0xe87262(0x1b5)+_0xe87262(0xea)+_0xe87262(0x1d7)+_0xe87262(0x153),[_0x1fab8d[_0xe87262(0x16b)],_0x1fab8d[_0xe87262(0x1bd)],_0x1fab8d[_0xe87262(0x225)]]);!_0x46f03c?await db[_0xe87262(0x192)]('INSERT\x20INT'+_0xe87262(0x216)+_0xe87262(0xf6)+_0xe87262(0x117)+_0xe87262(0x194)+_0xe87262(0xee)+_0xe87262(0x17e)+_0xe87262(0x1ca)+_0xe87262(0x141)+_0xe87262(0x129)+_0xe87262(0x110)+_0xe87262(0x213)+_0xe87262(0x1fb)+_0xe87262(0x18b)+',\x20?,\x20?)',[_0x1fab8d[_0xe87262(0x16b)],_0x1fab8d['user_jid'],_0x1fab8d[_0xe87262(0x225)],_0x1fab8d['message_co'+'unt'],_0x1fab8d[_0xe87262(0x187)+'me']||'',Math[_0xe87262(0x218)](_0x297472['toSeconds']())]):await db[_0xe87262(0x192)](_0xe87262(0x1c8)+_0xe87262(0xf9)+'SET\x20messag'+_0xe87262(0x1ea)+_0xe87262(0x10b)+_0xe87262(0x1e5)+_0xe87262(0x173)+_0xe87262(0x1af)+_0xe87262(0x138)+_0xe87262(0x1a1)+_0xe87262(0xe1),[_0x1fab8d[_0xe87262(0x10b)+_0xe87262(0x159)],_0x1fab8d[_0xe87262(0x187)+'me']||'',Math[_0xe87262(0x218)](_0x297472['toSeconds']()),_0x46f03c['id']]);if(Array[_0xe87262(0xf2)](_0x1fab8d[_0xe87262(0xf5)])&&_0x1fab8d[_0xe87262(0xf5)][_0xe87262(0x203)])for(let _0x591145=0x5*0x3ef+0x23ff+-0x37aa;_0x591145<_0x1fab8d['sourceIds'][_0xe87262(0x203)];_0x591145+=0x1c76+0x2085+-0x3b07){const _0x151ae2=_0x1fab8d[_0xe87262(0xf5)][_0xe87262(0x16d)](_0x591145,_0x591145+(-0x14*0x185+0x1d7b+0x2dd)),_0x277682=_0xe87262(0x1e0)+'M\x20active_s'+_0xe87262(0x198)+_0xe87262(0x163)+_0x151ae2[_0xe87262(0x18d)](()=>'?')[_0xe87262(0x13a)](',')+')';await db[_0xe87262(0x192)](_0x277682,_0x151ae2);}}}try{const _0x44af02=DateTime[_0xe87262(0xf3)]()[_0xe87262(0x184)](CONFIG[_0xe87262(0x208)])['minus']({'days':CONFIG['MAX_DAILY_'+_0xe87262(0x210)]})['toFormat'](_0xe87262(0xe5));await db[_0xe87262(0x192)](_0xe87262(0x1e0)+'M\x20active_s'+_0xe87262(0x198)+_0xe87262(0x16c)+_0xe87262(0xed)+_0xe87262(0x125)+_0xe87262(0xe7),[_0x44af02]);}catch(_0x4c5aa9){warn(_0xe87262(0x132)+_0xe87262(0x209)+_0xe87262(0x122)+(_0x4c5aa9?.[_0xe87262(0x103)]||_0x4c5aa9));}info(_0xe87262(0x1e4)+_0xe87262(0x116)+'plete');}catch(_0x37439f){error(_0x37439f,_0xe87262(0x132)+_0xe87262(0x1ce)+'ups\x20failed'+':\x20'+(_0x37439f?.['message']||_0x37439f));}}function parsePeriodArg(_0x26e041){const _0x4526e7=_0x550617;if(!_0x26e041)return null;const _0x5d38c8=String(_0x26e041)[_0x4526e7(0x1cc)]()[_0x4526e7(0x21e)+'e']()[_0x4526e7(0x177)](/^(\d+)\s*([dwmy])$/);if(!_0x5d38c8)return null;return{'amount':Number(_0x5d38c8[-0x2*-0x19b+-0x2*0xdb5+0x1835]),'unit':_0x5d38c8[0x1306+0x218f*-0x1+0xe8b]};}function computeCutoffSeconds(_0x4ce6b6,_0x419192){const _0xb8bd72=_0x550617,_0x5d3604=DateTime['now']()[_0xb8bd72(0x184)](CONFIG[_0xb8bd72(0x208)]);let _0x2d215d;if(_0x419192==='d')_0x2d215d=_0x5d3604['minus']({'days':_0x4ce6b6});else{if(_0x419192==='w')_0x2d215d=_0x5d3604[_0xb8bd72(0xd5)]({'weeks':_0x4ce6b6});else{if(_0x419192==='m')_0x2d215d=_0x5d3604['minus']({'months':_0x4ce6b6});else{if(_0x419192==='y')_0x2d215d=_0x5d3604[_0xb8bd72(0xd5)]({'years':_0x4ce6b6});else _0x2d215d=_0x5d3604[_0xb8bd72(0xd5)]({'days':_0x4ce6b6});}}}return Math['floor'](_0x2d215d[_0xb8bd72(0xff)]());}async function buildLeaderboardForChat(_0x49db5c,_0x271035,_0x50e578=CONFIG[_0x550617(0x174)+'T_RETURN']){const _0x50e006=_0x550617;try{const _0x46dd9a=DateTime['fromSecond'+'s'](_0x271035)[_0x50e006(0x184)](CONFIG[_0x50e006(0x208)]),_0x1594ea=_0x46dd9a[_0x50e006(0x1da)](_0x50e006(0xe5)),_0x235bf6=await db[_0x50e006(0x15a)](_0x50e006(0x180)+_0x50e006(0x1de)+_0x50e006(0x166)+_0x50e006(0xfd)+'M(message_'+_0x50e006(0x16f)+_0x50e006(0x1a5)+'ast_update'+_0x50e006(0x1bb)+_0x50e006(0x113)+'FROM\x20activ'+_0x50e006(0x172)+'\x20\x20\x20\x20WHERE\x20'+'chat_jid\x20='+'\x20?\x20AND\x20tim'+_0x50e006(0x143)+_0x50e006(0x230)+_0x50e006(0x231)+'y\x20>=\x20?\x0a\x20\x20\x20'+_0x50e006(0x181)+_0x50e006(0x221)+'\x0a\x20\x20\x20\x20',[_0x49db5c,_0x1594ea]),_0x587f97=new Map();for(const _0x5ecdcd of _0x235bf6||[]){const _0x3ccf3e=normalizeJid(_0x5ecdcd[_0x50e006(0x1bd)]);_0x587f97['set'](_0x3ccf3e,{'user_jid':_0x3ccf3e,'display_name':_0x5ecdcd[_0x50e006(0x187)+'me']||_0x3ccf3e[_0x50e006(0x1fa)]('@')[-0x1343*-0x1+0xd4f*0x1+-0x1*0x2092],'count':Number(_0x5ecdcd['cnt']||-0x1fbf+0x12b3+0xa7*0x14),'last_ts':Number(_0x5ecdcd[_0x50e006(0x109)]||0xad*-0x2+-0x1*-0x255c+-0x2402)});}const _0x51d368=await db['all'](_0x50e006(0x158)+'r_jid,\x20tim'+_0x50e006(0x215)+_0x50e006(0x12e)+_0x50e006(0x10b)+_0x50e006(0x1ed)+_0x50e006(0x179)+'OM\x20active_'+_0x50e006(0x135)+'E\x20chat_jid'+_0x50e006(0xfa)+'imeframe\x20I'+_0x50e006(0x155)+_0x50e006(0xef)+_0x50e006(0x11a)+')',[_0x49db5c]);for(const _0x4636f5 of _0x51d368||[]){let _0x5b27bb=![];try{if(_0x4636f5['timeframe']===_0x50e006(0x1c9)){const _0x1591d6=String(_0x4636f5[_0x50e006(0x225)]||'')[_0x50e006(0x1fa)]('-'),_0x5aca12=Number(_0x1591d6[0x11e5+0x1*-0x116f+-0x76*0x1])||-0xe68+-0x6f1+0x1d0b,_0x21cf31=Number(_0x1591d6[-0x1c92+0x7d+0x1c16])||-0x5*0x1bb+0x2296+0x1*-0x19ee,_0x17b6b2=DateTime[_0x50e006(0x139)]({'weekYear':_0x5aca12,'weekNumber':_0x21cf31,'weekday':0x1})[_0x50e006(0x184)](CONFIG[_0x50e006(0x208)]);if(_0x17b6b2[_0x50e006(0xff)]()>=_0x271035)_0x5b27bb=!![];}else{if(_0x4636f5[_0x50e006(0xeb)]===_0x50e006(0x160)){const _0x4294a3=String(_0x4636f5[_0x50e006(0x225)]||'')['split']('-'),_0x4260e0=Number(_0x4294a3[-0xf*0x9+-0x1c1d+0x1ca4])||-0xa1*-0x17+-0xc*0x189+0xba7,_0x35c602=Number(_0x4294a3[0x1f5d+-0x1d*-0x72+-0x3*0xec2])||-0x9*-0x36d+-0x22f6+0x1*0x422,_0x3c814a=DateTime[_0x50e006(0x139)]({'year':_0x4260e0,'month':_0x35c602,'day':0x1})[_0x50e006(0x184)](CONFIG[_0x50e006(0x208)]);if(_0x3c814a[_0x50e006(0xff)]()>=_0x271035)_0x5b27bb=!![];}else{if(_0x4636f5[_0x50e006(0xeb)]===_0x50e006(0x124)){const _0x263880=Number(String(_0x4636f5['bucket_key']||'')[_0x50e006(0x1fa)]('-')[-0x899+0x1fdc+-0x1743])||-0x7d6+-0x1*-0x11a5+-0x1*0x21d,_0x13c674=DateTime[_0x50e006(0x139)]({'year':_0x263880,'month':0x1,'day':0x1})[_0x50e006(0x184)](CONFIG['TIME_ZONE']);if(_0x13c674[_0x50e006(0xff)]()>=_0x271035)_0x5b27bb=!![];}else _0x5b27bb=!![];}}}catch(_0x219adb){_0x5b27bb=!![];}if(!_0x5b27bb)continue;const _0x1d328d=normalizeJid(_0x4636f5[_0x50e006(0x1bd)]);if(!_0x587f97[_0x50e006(0x1a3)](_0x1d328d))_0x587f97['set'](_0x1d328d,{'user_jid':_0x1d328d,'display_name':_0x4636f5['display_na'+'me']||_0x1d328d['split']('@')[-0x11*-0x8a+0x16f+0x1*-0xa99],'count':0x0,'last_ts':0x0});_0x587f97[_0x50e006(0x13c)](_0x1d328d)[_0x50e006(0x1ec)]+=Number(_0x4636f5[_0x50e006(0x10b)+'unt']||0x22*-0xef+-0x3f*0x50+0x1c6*0x1d);}const _0x557c9a=Array[_0x50e006(0x1ff)](_0x587f97[_0x50e006(0x11d)]())[_0x50e006(0x1b7)]((_0x51e06a,_0x1a2103)=>_0x1a2103[_0x50e006(0x1ec)]-_0x51e06a[_0x50e006(0x1ec)]||_0x1a2103[_0x50e006(0x109)]-_0x51e06a[_0x50e006(0x109)]);return _0x557c9a['slice'](-0x68*-0xf+0x7fd*0x2+-0x1612,_0x50e578);}catch(_0x233c43){return warn('[active]\x20b'+_0x50e006(0x1a2)+_0x50e006(0x1d2)+_0x50e006(0xd9)+(_0x233c43?.[_0x50e006(0x103)]||_0x233c43)),[];}}async function getGroupParticipants(_0x3a1186,_0x27958a){const _0x2bd36a=_0x550617;try{if(!_0x3a1186||typeof _0x3a1186[_0x2bd36a(0x183)+_0x2bd36a(0x185)]!==_0x2bd36a(0x229))return[];const _0x263133=await _0x3a1186[_0x2bd36a(0x183)+_0x2bd36a(0x185)](_0x27958a),_0x52bd0a=Array[_0x2bd36a(0xf2)](_0x263133?.[_0x2bd36a(0x1a4)+'ts'])?_0x263133['participan'+'ts']:Object[_0x2bd36a(0x11d)](_0x263133?.[_0x2bd36a(0x1a4)+'ts']||{}),_0x245eea=_0x52bd0a[_0x2bd36a(0x18d)](_0x343b86=>_0x343b86['id'])[_0x2bd36a(0x162)](Boolean)[_0x2bd36a(0x18d)](normalizeJid);return _0x245eea;}catch(_0x3c03fd){return warn('[active]\x20g'+'etGroupPar'+_0x2bd36a(0x1d8)+_0x2bd36a(0x201)+'\x20'+_0x27958a+':\x20'+(_0x3c03fd?.[_0x2bd36a(0x103)]||_0x3c03fd)),[];}}function _0x4346(_0x10a26b,_0x4837d9){const _0x36255b=_0x17bc();return _0x4346=function(_0xcd1078,_0x569995){_0xcd1078=_0xcd1078-(0x4ce+-0x3*-0x4de+-0x1293);let _0x48ded9=_0x36255b[_0xcd1078];return _0x48ded9;},_0x4346(_0x10a26b,_0x4837d9);}export async function initialize(_0x157ad1){const _0x4ebb61=_0x550617;try{botRef=_0x157ad1;if(botRef){if(typeof botRef[_0x4ebb61(0x161)+'e']===_0x4ebb61(0x229))sendApi=(_0x1ce696,_0x658d4e)=>botRef[_0x4ebb61(0x161)+'e'](_0x1ce696,_0x658d4e);else{if(botRef[_0x4ebb61(0xdb)]&&typeof botRef[_0x4ebb61(0xdb)][_0x4ebb61(0x161)+'e']==='function')sendApi=(_0x22f9ee,_0x1b6392)=>botRef[_0x4ebb61(0xdb)][_0x4ebb61(0x161)+'e'](_0x22f9ee,_0x1b6392);else sendApi=null;}}try{const _0x564df2=getConfig()||{};if(_0x564df2[_0x4ebb61(0x146)]&&typeof _0x564df2[_0x4ebb61(0x146)]===_0x4ebb61(0x1f0))CONFIG={...CONFIG,..._0x564df2[_0x4ebb61(0x146)]};}catch(_0x34a73e){warn(_0x4ebb61(0x1d1)+_0x4ebb61(0xe3)+_0x4ebb61(0x1c2)+_0x4ebb61(0x17a)+(_0x34a73e?.[_0x4ebb61(0x103)]||_0x34a73e));}await ensureSchema(),await performRollups(),info('[active]\x20i'+_0x4ebb61(0x102));}catch(_0x35b093){error(_0x35b093,_0x4ebb61(0x227)+_0x4ebb61(0x20c)+_0x4ebb61(0x1e9)+(_0x35b093?.[_0x4ebb61(0x103)]||_0x35b093));throw _0x35b093;}}export async function onMessage(_0x6b1795){const _0xe9f809=_0x550617;try{await trackMessage(_0x6b1795);if(!_0x6b1795?.[_0xe9f809(0x22b)])return;const _0x3bcd01=_0x6b1795[_0xe9f809(0x1a6)]?.[_0xe9f809(0x1f8)];if(!_0x3bcd01||!_0x3bcd01['endsWith'](_0xe9f809(0x16a)))return;const _0x32f17c=await isadmin(botRef,_0x6b1795)['catch'](()=>![]);if(!_0x32f17c)return;const _0x505e96=typeof _0x6b1795[_0xe9f809(0x131)]===_0xe9f809(0xe0)&&_0x6b1795[_0xe9f809(0x131)][_0xe9f809(0x1cc)]()?_0x6b1795[_0xe9f809(0x131)]['trim']():'';if(!_0x505e96)return;const _0x5dc68e=_0x505e96[_0xe9f809(0x1fa)](/\s+/)[_0xe9f809(0x162)](Boolean),_0x4d3206=_0x5dc68e[0x2f*0x69+-0x2*-0xfb2+-0x32ab*0x1][_0xe9f809(0x21e)+'e']();if(_0x4d3206!==_0xe9f809(0x21c)&&_0x4d3206!==_0xe9f809(0x1b2))return;const _0x36a4af=_0x5dc68e[0x14*-0x29+0xae*0x7+-0x18d]||'1w';let _0x58ebb3=parsePeriodArg(_0x36a4af);if(!_0x58ebb3){const _0x52ad3a=parseInt(_0x36a4af,0x201c+0x62e+-0x2640);if(!isNaN(_0x52ad3a))_0x58ebb3={'amount':_0x52ad3a,'unit':'d'};else{const _0x2e3df1=_0xe9f809(0x22d)+'ive\x20<amoun'+_0xe9f809(0x15f)+_0xe9f809(0x19e)+_0xe9f809(0x1e8)+'unt><d|w|m'+_0xe9f809(0x1d9)+_0xe9f809(0x14b)+'\x201d,\x20activ'+_0xe9f809(0x20f)+_0xe9f809(0x1e1);try{await sendApi(_0x3bcd01,{'text':_0x2e3df1});}catch(_0x1115ce){warn(_0xe9f809(0x15c)+_0xe9f809(0xdc)+_0xe9f809(0x1e9)+(_0x1115ce?.[_0xe9f809(0x103)]||_0x1115ce));}return;}}try{await performRollups();}catch(_0x520d0a){}const _0x5e2544=computeCutoffSeconds(_0x58ebb3['amount'],_0x58ebb3[_0xe9f809(0x133)]);if(_0x4d3206==='active'){const _0x87722b=await buildLeaderboardForChat(_0x3bcd01,_0x5e2544,CONFIG['USERS_LIMI'+_0xe9f809(0x206)]);if(!_0x87722b||_0x87722b[_0xe9f809(0x203)]===-0x3ee*-0x2+0x23c5*-0x1+0x1be9){await sendApi(_0x3bcd01,{'text':_0xe9f809(0x15d)+_0xe9f809(0x147)+_0xe9f809(0x1f2)+_0xe9f809(0x169)+_0x58ebb3[_0xe9f809(0x16e)]+_0x58ebb3[_0xe9f809(0x133)]+'.'});return;}let _0x117640='Found\x20'+_0x87722b[_0xe9f809(0x203)]+(_0xe9f809(0x217)+_0xe9f809(0x12a)+'\x20last\x20')+_0x58ebb3[_0xe9f809(0x16e)]+_0x58ebb3[_0xe9f809(0x133)]+':\x0a\x0a';const _0x1303b6=[];let _0x9b9a85=0x15*-0x5d+0xa24+-0x283;for(const _0x33029f of _0x87722b){_0x9b9a85++;const _0x537762=_0x33029f[_0xe9f809(0x1bd)][_0xe9f809(0x1fa)]('@')[0xf84+-0x21c3+0x123f];_0x117640+=_0xe9f809(0x1e6)+_0x537762+'\x20('+(_0x33029f[_0xe9f809(0x187)+'me']||_0x537762)+')\x0a',_0x117640+=romanParen(_0x9b9a85)+'\x20'+_0x33029f[_0xe9f809(0x1ec)]+(_0xe9f809(0x165)+'\x0a'),_0x1303b6[_0xe9f809(0x18e)](_0x33029f[_0xe9f809(0x1bd)]);}const _0xb0a059=0x17f8+0x15*-0x38+-0x3c0;if(_0x117640[_0xe9f809(0x203)]<=_0xb0a059)await sendApi(_0x3bcd01,{'text':_0x117640,'mentions':_0x1303b6});else{const _0x15941a=_0x117640['split']('\x0a\x0a');let _0x4248ff='';for(const _0x3c2157 of _0x15941a){if((_0x4248ff+'\x0a\x0a'+_0x3c2157)['length']>_0xb0a059)await sendApi(_0x3bcd01,{'text':_0x4248ff,'mentions':_0x1303b6}),_0x4248ff=_0x3c2157+'\x0a\x0a';else _0x4248ff+=(_0x4248ff?'\x0a\x0a':'')+_0x3c2157;}if(_0x4248ff[_0xe9f809(0x1cc)]())await sendApi(_0x3bcd01,{'text':_0x4248ff,'mentions':_0x1303b6});}return;}if(_0x4d3206===_0xe9f809(0x1b2)){const _0x18d36b=botRef?.[_0xe9f809(0xdb)]||botRef,_0x2499e9=await getGroupParticipants(_0x18d36b,_0x3bcd01);if(!_0x2499e9||_0x2499e9[_0xe9f809(0x203)]===0x1*0x1245+-0x1bbd+-0x12f*-0x8){await sendApi(_0x3bcd01,{'text':_0xe9f809(0x1ad)+_0xe9f809(0x219)+_0xe9f809(0x136)+'icipants.'});return;}const _0x11c06e=await buildLeaderboardForChat(_0x3bcd01,_0x5e2544,0x1b546b+0x1b241a+0x273645*-0x1),_0x42ee9a=new Set((_0x11c06e||[])[_0xe9f809(0x18d)](_0x197577=>normalizeJid(_0x197577['user_jid']))),_0xa49558=_0x2499e9['filter'](_0x38c3ad=>!_0x42ee9a['has'](normalizeJid(_0x38c3ad)));if(!_0xa49558['length']){await sendApi(_0x3bcd01,{'text':_0xe9f809(0x106)+_0xe9f809(0x12c)+_0xe9f809(0x200)+_0xe9f809(0x1df)+_0x58ebb3[_0xe9f809(0x16e)]+_0x58ebb3['unit']+'.'});return;}let _0x23976c=_0xe9f809(0xd8)+_0xa49558[_0xe9f809(0x203)]+(_0xe9f809(0x176)+_0xe9f809(0x1d3)+_0xe9f809(0x134))+_0x58ebb3[_0xe9f809(0x16e)]+_0x58ebb3[_0xe9f809(0x133)]+_0xe9f809(0x228);const _0x1d531e=[];let _0x553dec=0x4ab+0x265+-0x710;for(const _0x33ebc0 of _0xa49558){_0x553dec++;const _0xece0a8=_0x33ebc0[_0xe9f809(0x1fa)]('@')[-0x1cd5*0x1+0x67*0x26+0xd8b*0x1];_0x23976c+=_0xe9f809(0x1e6)+_0xece0a8+'\x20('+_0xece0a8+')\x0a',_0x23976c+=romanParen(_0x553dec)+(_0xe9f809(0x22a)+_0xe9f809(0xe2)),_0x1d531e[_0xe9f809(0x18e)](_0x33ebc0);}await sendApi(_0x3bcd01,{'text':_0x23976c,'mentions':_0x1d531e});return;}}catch(_0x2c8567){error(_0x2c8567,_0xe9f809(0x1c7)+_0xe9f809(0x1c5)+_0xe9f809(0x13e)+(_0x2c8567?.[_0xe9f809(0x103)]||_0x2c8567));}}export async function cleanup(){const _0xaec7a8=_0x550617;try{for(const _0x452113 of processedMessageKeys[_0xaec7a8(0x11d)]())try{clearTimeout(_0x452113);}catch(_0x43b35e){}processedMessageKeys[_0xaec7a8(0x10d)]();}catch(_0x5f56d6){}botRef=null,sendApi=null,info(_0xaec7a8(0xf7)+'leaned\x20up');}export default{'name':name,'version':version,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};