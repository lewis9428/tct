const _0x5bc8ed=_0x6aca;(function(_0x51677e,_0xe0259b){const _0x14dea4=_0x6aca,_0x44cd48=_0x51677e();while(!![]){try{const _0x4f75e6=parseInt(_0x14dea4(0x155))/(0x392*-0x7+-0x1*0x5de+0x1edd)+-parseInt(_0x14dea4(0x100))/(0x77*-0x14+-0x8a6+0x11f4)*(parseInt(_0x14dea4(0x192))/(0x13*0x148+0x465+-0x1cba))+-parseInt(_0x14dea4(0x1d7))/(0x1dfc+-0xbde+-0x7*0x296)*(parseInt(_0x14dea4(0x166))/(0x758+0xa7*-0x13+0x512))+-parseInt(_0x14dea4(0x12b))/(0x4b9+-0x17c2+0x130f)+-parseInt(_0x14dea4(0x14e))/(-0x3*-0x44d+0x231+-0xf11)+-parseInt(_0x14dea4(0x107))/(-0x1c5f+0x1297*-0x2+-0x67*-0xa3)*(-parseInt(_0x14dea4(0xf7))/(0x11c*0x10+0x1ac9*0x1+-0x59*0x80))+-parseInt(_0x14dea4(0x177))/(0x844+0x13f5+-0x1c2f)*(-parseInt(_0x14dea4(0x156))/(-0x1cf9+-0x11*0x4b+0x3*0xb55));if(_0x4f75e6===_0xe0259b)break;else _0x44cd48['push'](_0x44cd48['shift']());}catch(_0x1dd0df){_0x44cd48['push'](_0x44cd48['shift']());}}}(_0x3982,0x12340+-0x2fbe6+-0x25*-0x314f));import{DateTime}from'luxon';import{db}from'../utils/database.js';import{info,warn,error}from'../utils/logger.js';import{isadmin}from'../utils/isadmin.js';import{getConfig}from'../utils/config.js';import{getBotJid}from'../utils/bot-state.js';export const name='active';export const version=_0x5bc8ed(0x228);export const priority=0x7*0x2c1+0x360*0x9+-0x3*0x106f;export const commands=[_0x5bc8ed(0x11e),'inactive'];let botRef=null,sendApi=null;const DEFAULTS={'TIME_ZONE':_0x5bc8ed(0x1a9),'MAX_DAILY_KEEP_DAYS':0x5a,'ROLLOVER_TO_WEEK_DAYS':0x7,'ROLLOVER_TO_MONTH_DAYS':0x1e,'ROLLOVER_TO_YEAR_DAYS':0x16d,'USERS_LIMIT_RETURN':0xc8,'DEDUPE_TTL_MS':(0x1*0x179+-0x4b*-0xf+-0x5c0)*(0x394+-0x1f88+0x1fdc)};let CONFIG={...DEFAULTS};function normalizeJid(_0x119d15){const _0xfa81e=_0x5bc8ed;return _0x119d15?String(_0x119d15)[_0xfa81e(0x1e5)]():'';}function sleep(_0x4f884c){return new Promise(_0x7ccbcd=>setTimeout(_0x7ccbcd,_0x4f884c));}function toLowerRoman(_0x592e8e){const _0x798209=_0x5bc8ed,_0x54df25=[[0x25dc+-0x1a5*0x4+0x2*-0xdb0,'M'],[-0x298*0x1+0x1f1*0x5+0x1*-0x399,'CM'],[-0x7*-0x251+0x1ed7+-0x2d1a,'D'],[0x8d*0x2b+0x14*-0x177+0xa7*0xb,'CD'],[0x55c+-0x12e0+-0xa*-0x164,'C'],[0x1d*-0x1d+-0x2*0x9f7+0x1791*0x1,'XC'],[-0x3*-0x2b3+-0x1047+0x860,'L'],[0xf14+-0x2a5*-0x7+0x216f*-0x1,'XL'],[0x11*-0x91+0x24aa+-0x1aff,'X'],[-0x3*-0x241+-0x212f+-0x1*-0x1a75,'IX'],[-0xae+-0x2*0x1094+0x21db,'V'],[-0x1238+0x22f7+-0x10bb,'IV'],[0xe28+0x145*0x12+-0x2501*0x1,'I']];let _0x557f4c=_0x592e8e,_0x3c57bc='';for(const [_0x47b7a7,_0x106ccd]of _0x54df25)while(_0x557f4c>=_0x47b7a7){_0x3c57bc+=_0x106ccd,_0x557f4c-=_0x47b7a7;}return _0x3c57bc[_0x798209(0x1a8)+'e']();}function romanParen(_0x31710f){return'('+toLowerRoman(_0x31710f)+')';}const processedMessageKeys=new Map();function makeDedupeKey(_0x46256c){const _0x48b21c=_0x5bc8ed,_0x41f335=_0x46256c?.[_0x48b21c(0x189)];if(!_0x41f335)return null;const _0x4e2517=_0x41f335['id']||_0x41f335['participan'+'t']||'',_0x51978d=_0x41f335[_0x48b21c(0x159)]||'';return _0x51978d+'::'+_0x4e2517;}function isMsgProcessed(_0x27157b){return _0x27157b&&processedMessageKeys['has'](_0x27157b);}function markMsgProcessed(_0x2f5141){const _0x5028a7=_0x5bc8ed;if(!_0x2f5141)return;if(processedMessageKeys[_0x5028a7(0x1e7)](_0x2f5141))clearTimeout(processedMessageKeys[_0x5028a7(0x1fe)](_0x2f5141));const _0x79b27d=setTimeout(()=>processedMessageKeys[_0x5028a7(0x108)](_0x2f5141),CONFIG[_0x5028a7(0x15e)+'_MS']);processedMessageKeys['set'](_0x2f5141,_0x79b27d);}function _0x6aca(_0x15a95c,_0x78d0ba){const _0x4737f5=_0x3982();return _0x6aca=function(_0x54c351,_0x5c07fa){_0x54c351=_0x54c351-(-0x44d*-0x1+0x13a*-0x5+-0x8b*-0x5);let _0x3a2d6d=_0x4737f5[_0x54c351];return _0x3a2d6d;},_0x6aca(_0x15a95c,_0x78d0ba);}async function ensureSchema(){const _0x5648e4=_0x5bc8ed;try{await db[_0x5648e4(0x238)]('CREATE\x20TAB'+_0x5648e4(0x185)+_0x5648e4(0x226)+'ive_migrat'+_0x5648e4(0x19a)+_0x5648e4(0x1d1)+_0x5648e4(0x10d)+_0x5648e4(0x1fb)+_0x5648e4(0x191)+_0x5648e4(0x14a)+'LT\x20(strfti'+_0x5648e4(0x20f)+'ow\x27)));'),await db[_0x5648e4(0x238)](_0x5648e4(0xfd)+_0x5648e4(0x163)+'IF\x20NOT\x20EXI'+'STS\x20active'+'_stats\x20(\x0a\x20'+'\x20\x20\x20\x20\x20\x20\x20id\x20'+'INTEGER\x20PR'+_0x5648e4(0x16f)+_0x5648e4(0x210)+_0x5648e4(0x18e)+_0x5648e4(0x1ba)+'d\x20TEXT\x20NOT'+_0x5648e4(0x21b)+_0x5648e4(0xec)+_0x5648e4(0x223)+_0x5648e4(0x1be)+_0x5648e4(0x122)+'eframe\x20TEX'+_0x5648e4(0x22d)+_0x5648e4(0x1d8)+_0x5648e4(0x102)+_0x5648e4(0x18a)+_0x5648e4(0x1db)+'yearly\x27\x0a\x20\x20'+'\x20\x20\x20\x20\x20\x20buck'+_0x5648e4(0x14f)+_0x5648e4(0x22d)+_0x5648e4(0x239)+_0x5648e4(0xf0)+_0x5648e4(0x232)+_0x5648e4(0x1f7)+_0x5648e4(0x21e)+_0x5648e4(0x1f5)+_0x5648e4(0x12f)+_0x5648e4(0x1e4)+_0x5648e4(0x10f)+_0x5648e4(0x152)+_0x5648e4(0x180)+_0x5648e4(0x101)+_0x5648e4(0x202)+'lay_name\x20T'+_0x5648e4(0x198)+_0x5648e4(0xf2)+'\x20\x20\x20\x20last_u'+_0x5648e4(0x1c7)+_0x5648e4(0x14a)+_0x5648e4(0x103)+_0x5648e4(0x20f)+'ow\x27)),\x0a\x20\x20\x20'+_0x5648e4(0x199)+_0x5648e4(0x20b)+_0x5648e4(0x22f)+_0x5648e4(0xf4)+_0x5648e4(0x127)+'key)\x0a\x20\x20\x20\x20\x20'+'\x20);\x0a\x20\x20\x20\x20'),await db[_0x5648e4(0x238)](_0x5648e4(0x161)+_0x5648e4(0x1ff)+_0x5648e4(0x1fc)+_0x5648e4(0x112)+_0x5648e4(0x13f)+_0x5648e4(0x106)+_0x5648e4(0x176)+_0x5648e4(0x1f0)+_0x5648e4(0xe4)+_0x5648e4(0x1e8)+';'),await db['exec'](_0x5648e4(0x161)+_0x5648e4(0x1ff)+_0x5648e4(0x1fc)+_0x5648e4(0x112)+_0x5648e4(0x114)+_0x5648e4(0x224)+'ive_stats('+_0x5648e4(0x184)+_0x5648e4(0x183)),await db['exec']('\x0a\x20\x20\x20\x20\x20\x20CRE'+_0x5648e4(0x163)+_0x5648e4(0x16b)+'STS\x20active'+_0x5648e4(0x187)+_0x5648e4(0x19c)+_0x5648e4(0x121)+_0x5648e4(0x135)+_0x5648e4(0x20e)+_0x5648e4(0x1b9)+_0x5648e4(0x216)+_0x5648e4(0x18f)+'XT\x0a\x20\x20\x20\x20\x20\x20)'+_0x5648e4(0xff)),info(_0x5648e4(0x1f1)+_0x5648e4(0x203)+_0x5648e4(0x144));}catch(_0x3f00e8){error(_0x3f00e8,_0x5648e4(0x1e3)+'nsureSchem'+'a\x20failed');throw _0x3f00e8;}}export async function trackMessage(_0x143dd2){const _0x2f49de=_0x5bc8ed;try{if(!_0x143dd2||!_0x143dd2[_0x2f49de(0x189)]||!_0x143dd2[_0x2f49de(0x22e)])return;const _0x50adc5=makeDedupeKey(_0x143dd2);if(!_0x50adc5)return;if(isMsgProcessed(_0x50adc5))return;markMsgProcessed(_0x50adc5);if(_0x143dd2[_0x2f49de(0x189)]['fromMe'])return;const _0x4b7e75=_0x143dd2[_0x2f49de(0x189)]['remoteJid'];if(!_0x4b7e75||!_0x4b7e75['endsWith'](_0x2f49de(0x21c)))return;const _0x26bf83=_0x143dd2[_0x2f49de(0x189)]['participan'+'t']||_0x143dd2[_0x2f49de(0x189)]['from']||'';if(!_0x26bf83)return;const _0x148155=normalizeJid(_0x26bf83),_0x20dfd9=DateTime[_0x2f49de(0x15c)]()[_0x2f49de(0xe8)](CONFIG[_0x2f49de(0x195)]),_0x3097ed=_0x20dfd9[_0x2f49de(0x236)](_0x2f49de(0x170));try{const _0x4f687e=await db[_0x2f49de(0x15d)](_0x2f49de(0x1ac)+'PDATE\x20acti'+_0x2f49de(0xe5)+'\x20\x20\x20\x20\x20\x20\x20SET'+_0x2f49de(0x207)+_0x2f49de(0x1d6)+'sage_count'+_0x2f49de(0x14d)+_0x2f49de(0x193)+_0x2f49de(0x1cb)+_0x2f49de(0x186)+_0x2f49de(0x1a2)+_0x2f49de(0xe9)+'jid\x20=\x20?\x20AN'+_0x2f49de(0x1ab)+_0x2f49de(0xf9)+_0x2f49de(0x1de)+_0x2f49de(0x175)+_0x2f49de(0x190)+_0x2f49de(0x21a)+'\x20\x20\x20\x20',[_0x143dd2[_0x2f49de(0x19e)]||_0x143dd2[_0x2f49de(0x1d3)]||'',Math[_0x2f49de(0xf6)](_0x20dfd9[_0x2f49de(0x162)]()),_0x4b7e75,_0x148155,_0x3097ed]);(!_0x4f687e||!_0x4f687e[_0x2f49de(0x131)])&&await db[_0x2f49de(0x15d)](_0x2f49de(0x1c6)+'\x20INSERT\x20IN'+_0x2f49de(0x200)+'stats\x20(cha'+_0x2f49de(0x149)+_0x2f49de(0x174)+_0x2f49de(0xea)+'cket_key,\x20'+_0x2f49de(0x1c9)+_0x2f49de(0x214)+_0x2f49de(0x1ea)+_0x2f49de(0x11c)+'d)\x0a\x20\x20\x20\x20\x20\x20\x20'+_0x2f49de(0x1b3)+_0x2f49de(0x124)+_0x2f49de(0x215)+_0x2f49de(0x1c3)+_0x2f49de(0x142),[_0x4b7e75,_0x148155,_0x3097ed,_0x143dd2[_0x2f49de(0x19e)]||_0x143dd2[_0x2f49de(0x1d3)]||'',Math[_0x2f49de(0xf6)](_0x20dfd9['toSeconds']())]);}catch(_0x329f21){warn(_0x2f49de(0x1ec)+'rackMessag'+_0x2f49de(0x123)+':\x20'+(_0x329f21?.[_0x2f49de(0x22e)]||_0x329f21));}}catch(_0x4e04a8){warn('[active]\x20t'+'rackMessag'+_0x2f49de(0x133)+_0x2f49de(0x169)+(_0x4e04a8?.['message']||_0x4e04a8));}}async function performRollups(){const _0x5a8732=_0x5bc8ed;try{const _0x54c9d1=DateTime[_0x5a8732(0x15c)]()[_0x5a8732(0xe8)](CONFIG[_0x5a8732(0x195)]),_0x2a58af=_0x54c9d1[_0x5a8732(0x171)]({'days':CONFIG[_0x5a8732(0x115)+_0x5a8732(0x1eb)+'S']})[_0x5a8732(0x16d)]('day'),_0x1579d3=_0x2a58af[_0x5a8732(0x236)](_0x5a8732(0x170)),_0x330bc7=await db['all'](_0x5a8732(0x12d)+_0x5a8732(0xe3)+_0x5a8732(0x1f4)+'\x20bucket_ke'+_0x5a8732(0x141)+_0x5a8732(0x1d2)+_0x5a8732(0x227)+_0x5a8732(0x1f8)+_0x5a8732(0x19d)+'HERE\x20timef'+_0x5a8732(0x126)+_0x5a8732(0x117)+_0x5a8732(0x19b)+'<=\x20?',[_0x1579d3]);if(_0x330bc7&&_0x330bc7[_0x5a8732(0x119)]){const _0x3bd640=new Map();for(const _0x536eea of _0x330bc7){const _0x2daed1=DateTime['fromFormat'](_0x536eea[_0x5a8732(0x13d)],'yyyy-LL-dd',{'zone':CONFIG[_0x5a8732(0x195)]}),_0x57337d=_0x2daed1['weekYear']+'-'+String(_0x2daed1[_0x5a8732(0x130)])[_0x5a8732(0x234)](-0xaca*-0x3+0x665+-0x26c1,'0'),_0x386569=_0x536eea['chat_jid']+'||'+_0x536eea['user_jid']+_0x5a8732(0x13a)+_0x57337d;if(!_0x3bd640[_0x5a8732(0x1e7)](_0x386569))_0x3bd640[_0x5a8732(0x237)](_0x386569,{'chat_jid':_0x536eea['chat_jid'],'user_jid':_0x536eea[_0x5a8732(0x209)],'timeframe':_0x5a8732(0x148),'bucket_key':_0x57337d,'message_count':0x0,'display_name':_0x536eea[_0x5a8732(0x137)+'me']||''});const _0x23b56f=_0x3bd640[_0x5a8732(0x1fe)](_0x386569);_0x23b56f[_0x5a8732(0x1c9)+_0x5a8732(0xfe)]+=Number(_0x536eea['message_co'+'unt']||0x65*0x7+0x569*-0x7+0x2*0x118e);}for(const _0x4f564d of _0x3bd640[_0x5a8732(0xed)]()){const _0x52829b=await db[_0x5a8732(0x1fe)](_0x5a8732(0x151)+_0x5a8732(0x194)+_0x5a8732(0x104)+_0x5a8732(0x225)+_0x5a8732(0x1b1)+_0x5a8732(0x18b)+_0x5a8732(0x1b2)+_0x5a8732(0x173)+'\x27weekly\x27\x20A'+_0x5a8732(0x190)+_0x5a8732(0x17a)+_0x5a8732(0xee),[_0x4f564d[_0x5a8732(0x1df)],_0x4f564d[_0x5a8732(0x209)],_0x4f564d['bucket_key']]);!_0x52829b?await db[_0x5a8732(0x15d)]('INSERT\x20INT'+_0x5a8732(0x1b4)+_0x5a8732(0x10a)+_0x5a8732(0x10e)+_0x5a8732(0x23a)+_0x5a8732(0x211)+'ket_key,\x20m'+_0x5a8732(0x1a6)+'nt,\x20displa'+_0x5a8732(0x197)+_0x5a8732(0x182)+')\x20VALUES\x20('+_0x5a8732(0x22b)+_0x5a8732(0x1a1)+_0x5a8732(0x1b6),[_0x4f564d[_0x5a8732(0x1df)],_0x4f564d['user_jid'],_0x4f564d['bucket_key'],_0x4f564d[_0x5a8732(0x1c9)+'unt'],_0x4f564d[_0x5a8732(0x137)+'me']||'',Math['floor'](_0x54c9d1[_0x5a8732(0x162)]())]):await db[_0x5a8732(0x15d)](_0x5a8732(0xfc)+'ive_stats\x20'+_0x5a8732(0x1d0)+_0x5a8732(0x229)+_0x5a8732(0x1c9)+'unt\x20+\x20?,\x20d'+'isplay_nam'+_0x5a8732(0x1af)+'t_updated\x20'+_0x5a8732(0x18d)+_0x5a8732(0x1bf),[_0x4f564d[_0x5a8732(0x1c9)+'unt'],_0x4f564d[_0x5a8732(0x137)+'me']||'',Math[_0x5a8732(0xf6)](_0x54c9d1[_0x5a8732(0x162)]()),_0x52829b['id']]);}try{const _0x43396d=_0x330bc7['map'](_0x3cf330=>_0x3cf330['id']);for(let _0x16ceb6=0x208b+-0xc9+-0x1fc2;_0x16ceb6<_0x43396d[_0x5a8732(0x119)];_0x16ceb6+=-0x1*-0x147+0x383*-0x1+0x430*0x1){const _0x18a168=_0x43396d['slice'](_0x16ceb6,_0x16ceb6+(0x1265+0x435*0x3+-0x1d10)),_0x1e978d=_0x5a8732(0x16a)+_0x5a8732(0x110)+_0x5a8732(0x13b)+_0x5a8732(0x1a0)+_0x18a168[_0x5a8732(0x132)](()=>'?')[_0x5a8732(0x125)](',')+')';await db[_0x5a8732(0x15d)](_0x1e978d,_0x18a168);}}catch(_0x8925f6){warn(_0x5a8732(0x1da)+_0x5a8732(0x1dc)+'daily\x20rows'+_0x5a8732(0x17d)+(_0x8925f6?.['message']||_0x8925f6));}}const _0x224350=_0x54c9d1['minus']({'days':CONFIG[_0x5a8732(0x115)+'O_MONTH_DA'+'YS']})[_0x5a8732(0x162)](),_0x3e0f93=await db[_0x5a8732(0xe7)](_0x5a8732(0x12d)+_0x5a8732(0xe3)+_0x5a8732(0x1f4)+_0x5a8732(0x1bd)+_0x5a8732(0x141)+_0x5a8732(0x1d2)+_0x5a8732(0x227)+'\x20FROM\x20acti'+'ve_stats\x20W'+_0x5a8732(0x14b)+_0x5a8732(0x230)+_0x5a8732(0x129));if(_0x3e0f93&&_0x3e0f93[_0x5a8732(0x119)]){const _0x3117a0=new Map();for(const _0x422931 of _0x3e0f93){const _0x32e9c2=String(_0x422931[_0x5a8732(0x13d)]||'')[_0x5a8732(0x168)]('-'),_0x33bb6b=Number(_0x32e9c2[0xae1+-0x2391+0x18b0])||0x1b3d+-0x1b2f+0x6*0x146,_0x2cf00f=Number(_0x32e9c2[-0x887*-0x2+0x1ebc+0xd*-0x3ad])||-0x1b96+-0x19b7+0x354e,_0x1f8b93=DateTime[_0x5a8732(0x1aa)]({'weekYear':_0x33bb6b,'weekNumber':_0x2cf00f,'weekday':0x1,'zone':CONFIG[_0x5a8732(0x195)]});if(_0x1f8b93[_0x5a8732(0x162)]()>_0x224350)continue;const _0x4bd9ec=_0x1f8b93[_0x5a8732(0x1d4)]+'-'+String(_0x1f8b93[_0x5a8732(0x11f)])['padStart'](-0x23a2+-0x2138*0x1+0x44dc,'0'),_0x5f4ba3=_0x422931[_0x5a8732(0x1df)]+'||'+_0x422931[_0x5a8732(0x209)]+(_0x5a8732(0x1a3)+'|')+_0x4bd9ec;if(!_0x3117a0[_0x5a8732(0x1e7)](_0x5f4ba3))_0x3117a0[_0x5a8732(0x237)](_0x5f4ba3,{'chat_jid':_0x422931[_0x5a8732(0x1df)],'user_jid':_0x422931[_0x5a8732(0x209)],'timeframe':_0x5a8732(0x138),'bucket_key':_0x4bd9ec,'message_count':0x0,'display_name':_0x422931[_0x5a8732(0x137)+'me']||'','sourceIds':[]});const _0x1bb338=_0x3117a0['get'](_0x5f4ba3);_0x1bb338[_0x5a8732(0x1c9)+'unt']+=Number(_0x422931[_0x5a8732(0x1c9)+_0x5a8732(0xfe)]||0x607*0x4+-0x2356+0xb3a),_0x1bb338[_0x5a8732(0x1c8)][_0x5a8732(0x136)](_0x422931['id']);}for(const _0x195d77 of _0x3117a0[_0x5a8732(0xed)]()){const _0x1f908c=await db[_0x5a8732(0x1fe)]('SELECT\x20id\x20'+_0x5a8732(0x194)+_0x5a8732(0x104)+'ERE\x20chat_j'+_0x5a8732(0x1b1)+_0x5a8732(0x18b)+_0x5a8732(0x1b2)+'meframe\x20=\x20'+_0x5a8732(0xf5)+_0x5a8732(0x1ee)+_0x5a8732(0x14c)+_0x5a8732(0x1fa),[_0x195d77['chat_jid'],_0x195d77['user_jid'],_0x195d77[_0x5a8732(0x13d)]]);!_0x1f908c?await db[_0x5a8732(0x15d)]('INSERT\x20INT'+'O\x20active_s'+'tats\x20(chat'+'_jid,\x20user'+'_jid,\x20time'+_0x5a8732(0x211)+_0x5a8732(0x109)+_0x5a8732(0x1a6)+_0x5a8732(0x1cc)+_0x5a8732(0x197)+'st_updated'+_0x5a8732(0x208)+'?,\x20?,\x20\x27mon'+_0x5a8732(0xfb)+'?,\x20?,\x20?)',[_0x195d77[_0x5a8732(0x1df)],_0x195d77[_0x5a8732(0x209)],_0x195d77[_0x5a8732(0x13d)],_0x195d77[_0x5a8732(0x1c9)+'unt'],_0x195d77['display_na'+'me']||'',Math[_0x5a8732(0xf6)](_0x54c9d1[_0x5a8732(0x162)]())]):await db[_0x5a8732(0x15d)](_0x5a8732(0xfc)+'ive_stats\x20'+_0x5a8732(0x1d0)+_0x5a8732(0x229)+_0x5a8732(0x1c9)+_0x5a8732(0x1b5)+'isplay_nam'+_0x5a8732(0x1af)+'t_updated\x20'+'=\x20?\x20WHERE\x20'+_0x5a8732(0x1bf),[_0x195d77[_0x5a8732(0x1c9)+_0x5a8732(0xfe)],_0x195d77['display_na'+'me']||'',Math[_0x5a8732(0xf6)](_0x54c9d1['toSeconds']()),_0x1f908c['id']]);if(Array[_0x5a8732(0x146)](_0x195d77[_0x5a8732(0x1c8)])&&_0x195d77[_0x5a8732(0x1c8)][_0x5a8732(0x119)])for(let _0x915df3=-0x1b4*-0xb+-0x1ccf+0xa13;_0x915df3<_0x195d77['sourceIds'][_0x5a8732(0x119)];_0x915df3+=0xe*-0x10c+0x788+-0xa6*-0xe){const _0xbf86a7=_0x195d77[_0x5a8732(0x1c8)][_0x5a8732(0x1bc)](_0x915df3,_0x915df3+(-0x605+-0x1e11*-0x1+-0x1618)),_0x5ce629=_0x5a8732(0x16a)+_0x5a8732(0x110)+_0x5a8732(0x13b)+'\x20id\x20IN\x20('+_0xbf86a7[_0x5a8732(0x132)](()=>'?')[_0x5a8732(0x125)](',')+')';await db[_0x5a8732(0x15d)](_0x5ce629,_0xbf86a7);}}}const _0x9dcab4=_0x54c9d1[_0x5a8732(0x171)]({'days':CONFIG[_0x5a8732(0x115)+_0x5a8732(0x17b)+'S']})['toSeconds'](),_0x3cecdc=await db[_0x5a8732(0xe7)](_0x5a8732(0x12d)+_0x5a8732(0xe3)+_0x5a8732(0x1f4)+'\x20bucket_ke'+_0x5a8732(0x141)+_0x5a8732(0x1d2)+_0x5a8732(0x227)+_0x5a8732(0x1f8)+_0x5a8732(0x19d)+_0x5a8732(0x14b)+'rame\x20=\x20\x27mo'+_0x5a8732(0x181));if(_0x3cecdc&&_0x3cecdc['length']){const _0x1904c2=new Map();for(const _0x44fab0 of _0x3cecdc){const _0x41eba1=String(_0x44fab0['bucket_key']||'')[_0x5a8732(0x168)]('-'),_0x177403=Number(_0x41eba1[-0x1*-0x22fd+0xa*0x3ac+-0x47b5])||0x269d+0x1*0x229d+0x12*-0x3a4,_0x43f39c=DateTime['fromObject']({'year':_0x177403,'month':0x1,'day':0x1,'zone':CONFIG[_0x5a8732(0x195)]});if(_0x43f39c[_0x5a8732(0x162)]()>_0x9dcab4)continue;const _0x42eb79=''+_0x177403,_0x10f0c0=_0x44fab0[_0x5a8732(0x1df)]+'||'+_0x44fab0[_0x5a8732(0x209)]+'||yearly||'+_0x42eb79;if(!_0x1904c2[_0x5a8732(0x1e7)](_0x10f0c0))_0x1904c2[_0x5a8732(0x237)](_0x10f0c0,{'chat_jid':_0x44fab0[_0x5a8732(0x1df)],'user_jid':_0x44fab0[_0x5a8732(0x209)],'timeframe':_0x5a8732(0x1ca),'bucket_key':_0x42eb79,'message_count':0x0,'display_name':_0x44fab0[_0x5a8732(0x137)+'me']||'','sourceIds':[]});const _0x40b4d1=_0x1904c2[_0x5a8732(0x1fe)](_0x10f0c0);_0x40b4d1[_0x5a8732(0x1c9)+_0x5a8732(0xfe)]+=Number(_0x44fab0['message_co'+_0x5a8732(0xfe)]||-0x495+-0x1*0xc9d+0x1132),_0x40b4d1[_0x5a8732(0x1c8)][_0x5a8732(0x136)](_0x44fab0['id']);}for(const _0x1b41c7 of _0x1904c2[_0x5a8732(0xed)]()){const _0x4a821f=await db[_0x5a8732(0x1fe)](_0x5a8732(0x151)+'FROM\x20activ'+'e_stats\x20WH'+'ERE\x20chat_j'+_0x5a8732(0x1b1)+_0x5a8732(0x18b)+_0x5a8732(0x1b2)+_0x5a8732(0x173)+_0x5a8732(0x218)+_0x5a8732(0x190)+_0x5a8732(0x17a)+_0x5a8732(0xee),[_0x1b41c7[_0x5a8732(0x1df)],_0x1b41c7[_0x5a8732(0x209)],_0x1b41c7[_0x5a8732(0x13d)]]);!_0x4a821f?await db['run'](_0x5a8732(0xef)+_0x5a8732(0x1b4)+'tats\x20(chat'+_0x5a8732(0x10e)+_0x5a8732(0x23a)+'frame,\x20buc'+'ket_key,\x20m'+_0x5a8732(0x1a6)+_0x5a8732(0x1cc)+_0x5a8732(0x197)+_0x5a8732(0x182)+')\x20VALUES\x20('+_0x5a8732(0x179)+_0x5a8732(0x147)+',\x20?,\x20?)',[_0x1b41c7['chat_jid'],_0x1b41c7['user_jid'],_0x1b41c7['bucket_key'],_0x1b41c7['message_co'+_0x5a8732(0xfe)],_0x1b41c7[_0x5a8732(0x137)+'me']||'',Math['floor'](_0x54c9d1[_0x5a8732(0x162)]())]):await db[_0x5a8732(0x15d)](_0x5a8732(0xfc)+_0x5a8732(0x11b)+_0x5a8732(0x1d0)+'e_count\x20=\x20'+_0x5a8732(0x1c9)+_0x5a8732(0x1b5)+_0x5a8732(0x157)+_0x5a8732(0x1af)+_0x5a8732(0x154)+'=\x20?\x20WHERE\x20'+'id\x20=\x20?',[_0x1b41c7[_0x5a8732(0x1c9)+'unt'],_0x1b41c7[_0x5a8732(0x137)+'me']||'',Math['floor'](_0x54c9d1[_0x5a8732(0x162)]()),_0x4a821f['id']]);if(Array[_0x5a8732(0x146)](_0x1b41c7[_0x5a8732(0x1c8)])&&_0x1b41c7['sourceIds'][_0x5a8732(0x119)])for(let _0x2fb631=-0x40*-0x7d+-0x10df*-0x1+-0x301f;_0x2fb631<_0x1b41c7['sourceIds'][_0x5a8732(0x119)];_0x2fb631+=-0x2027+-0x7*-0x9b+0x1dde){const _0x47a526=_0x1b41c7[_0x5a8732(0x1c8)][_0x5a8732(0x1bc)](_0x2fb631,_0x2fb631+(0x10f9+0xb5b*0x1+-0x1a60)),_0x57b14c=_0x5a8732(0x16a)+_0x5a8732(0x110)+_0x5a8732(0x13b)+'\x20id\x20IN\x20('+_0x47a526[_0x5a8732(0x132)](()=>'?')['join'](',')+')';await db[_0x5a8732(0x15d)](_0x57b14c,_0x47a526);}}}try{const _0x447d9a=DateTime[_0x5a8732(0x15c)]()['setZone'](CONFIG[_0x5a8732(0x195)])[_0x5a8732(0x171)]({'days':CONFIG['MAX_DAILY_'+_0x5a8732(0x150)]})['toFormat'](_0x5a8732(0x170));await db['run'](_0x5a8732(0x16a)+_0x5a8732(0x110)+_0x5a8732(0x13b)+_0x5a8732(0x1e1)+_0x5a8732(0x18c)+_0x5a8732(0x1a4)+_0x5a8732(0x16c),[_0x447d9a]);}catch(_0x266720){warn(_0x5a8732(0x1c4)+'rune\x20daily'+'\x20failed:\x20'+(_0x266720?.[_0x5a8732(0x22e)]||_0x266720));}info(_0x5a8732(0x153)+_0x5a8732(0x1a7)+_0x5a8732(0x1d9));}catch(_0x134d1f){error(_0x134d1f,_0x5a8732(0x1c4)+_0x5a8732(0x205)+'ups\x20failed'+':\x20'+(_0x134d1f?.[_0x5a8732(0x22e)]||_0x134d1f));}}function parsePeriodArg(_0x2f1b35){const _0x1eaf98=_0x5bc8ed;if(!_0x2f1b35)return null;const _0x2ba304=String(_0x2f1b35)[_0x1eaf98(0x1e5)]()[_0x1eaf98(0x1a8)+'e']()[_0x1eaf98(0x201)](/^(\d+)\s*([dwmy])$/);if(!_0x2ba304)return null;return{'amount':Number(_0x2ba304[0x1ac*0x13+0xee9*0x1+-0x1*0x2eac]),'unit':_0x2ba304[0x6*-0x106+0x20a9+-0x1a83]};}function computeCutoffSeconds(_0xddf64e,_0x44c4ac){const _0x2df125=_0x5bc8ed,_0x2387e1=DateTime['now']()[_0x2df125(0xe8)](CONFIG[_0x2df125(0x195)]);let _0x51e874;if(_0x44c4ac==='d')_0x51e874=_0x2387e1['minus']({'days':_0xddf64e});else{if(_0x44c4ac==='w')_0x51e874=_0x2387e1[_0x2df125(0x171)]({'weeks':_0xddf64e});else{if(_0x44c4ac==='m')_0x51e874=_0x2387e1['minus']({'months':_0xddf64e});else{if(_0x44c4ac==='y')_0x51e874=_0x2387e1['minus']({'years':_0xddf64e});else _0x51e874=_0x2387e1[_0x2df125(0x171)]({'days':_0xddf64e});}}}return Math[_0x2df125(0xf6)](_0x51e874['toSeconds']());}async function buildLeaderboardForChat(_0x489d75,_0x1c138c,_0x3cd87f=CONFIG['USERS_LIMI'+_0x5bc8ed(0xeb)]){const _0x59266c=_0x5bc8ed;try{const _0x561707=DateTime[_0x59266c(0x204)+'s'](_0x1c138c)[_0x59266c(0xe8)](CONFIG[_0x59266c(0x195)]),_0x5f350a=_0x561707[_0x59266c(0x236)](_0x59266c(0x170)),_0x15c8c2=await db[_0x59266c(0xe7)]('\x0a\x20\x20\x20\x20\x20\x20SEL'+_0x59266c(0xe6)+_0x59266c(0x1dd)+_0x59266c(0x20c)+_0x59266c(0x1e9)+_0x59266c(0x220)+_0x59266c(0x217)+_0x59266c(0x11c)+_0x59266c(0x105)+_0x59266c(0x1e2)+_0x59266c(0x194)+_0x59266c(0x10b)+_0x59266c(0x1f9)+'chat_jid\x20='+_0x59266c(0x17e)+_0x59266c(0x10c)+_0x59266c(0x1e6)+_0x59266c(0x1bd)+_0x59266c(0x1c2)+'\x20\x20\x20GROUP\x20B'+_0x59266c(0x1e0)+_0x59266c(0x221),[_0x489d75,_0x5f350a]),_0x353c99=new Map();for(const _0x562705 of _0x15c8c2||[]){const _0x1f5d69=normalizeJid(_0x562705[_0x59266c(0x209)]);_0x353c99[_0x59266c(0x237)](_0x1f5d69,{'user_jid':_0x1f5d69,'display_name':_0x562705[_0x59266c(0x137)+'me']||_0x1f5d69[_0x59266c(0x168)]('@')[0x5cf*-0x1+0x23d*-0x4+0xec3],'count':Number(_0x562705[_0x59266c(0x1b8)]||-0x9*-0x42f+0x7c9*0x2+-0x3539),'last_ts':Number(_0x562705[_0x59266c(0x219)]||-0xa45+-0x25ce+-0x1*-0x3013)});}const _0x383264=await db[_0x59266c(0xe7)](_0x59266c(0x17c)+_0x59266c(0x174)+_0x59266c(0xea)+_0x59266c(0x222)+'message_co'+_0x59266c(0x214)+_0x59266c(0x1c5)+'OM\x20active_'+_0x59266c(0x1c0)+_0x59266c(0x1b7)+_0x59266c(0xf9)+_0x59266c(0x164)+_0x59266c(0x158)+_0x59266c(0x15f)+_0x59266c(0x1cd)+')',[_0x489d75]);for(const _0x119002 of _0x383264||[]){let _0x9ecb59=![];try{if(_0x119002['timeframe']==='weekly'){const _0x3ff71d=String(_0x119002['bucket_key']||'')[_0x59266c(0x168)]('-'),_0x59e990=Number(_0x3ff71d[0x1771+-0x1d0b*0x1+0x59a])||0xe87+-0x14cb*0x1+0x1*0xdf6,_0x530161=Number(_0x3ff71d[-0x12e9+-0x18d*-0xc+0x4e])||-0x2257+-0x3d+-0xb87*-0x3,_0x12e5ef=DateTime[_0x59266c(0x1aa)]({'weekYear':_0x59e990,'weekNumber':_0x530161,'weekday':0x1})[_0x59266c(0xe8)](CONFIG[_0x59266c(0x195)]);if(_0x12e5ef[_0x59266c(0x162)]()>=_0x1c138c)_0x9ecb59=!![];}else{if(_0x119002['timeframe']===_0x59266c(0x138)){const _0x16da27=String(_0x119002[_0x59266c(0x13d)]||'')[_0x59266c(0x168)]('-'),_0x3e244c=Number(_0x16da27[0x631+-0x1a7d+-0x6c4*-0x3])||-0x1342+0x11d2+-0x922*-0x1,_0x1da216=Number(_0x16da27[-0x1007+0x1165+-0x15d])||-0x6e*0x3e+-0x7*-0x3e5+-0x9e,_0x4aa815=DateTime[_0x59266c(0x1aa)]({'year':_0x3e244c,'month':_0x1da216,'day':0x1})[_0x59266c(0xe8)](CONFIG[_0x59266c(0x195)]);if(_0x4aa815[_0x59266c(0x162)]()>=_0x1c138c)_0x9ecb59=!![];}else{if(_0x119002['timeframe']==='yearly'){const _0x1a74b7=Number(String(_0x119002[_0x59266c(0x13d)]||'')['split']('-')[0x2617+0x295*-0x1+-0xf*0x25e])||0x1*0xf4d+-0x7e*-0x19+-0x13e9*0x1,_0x187a56=DateTime['fromObject']({'year':_0x1a74b7,'month':0x1,'day':0x1})[_0x59266c(0xe8)](CONFIG[_0x59266c(0x195)]);if(_0x187a56[_0x59266c(0x162)]()>=_0x1c138c)_0x9ecb59=!![];}else _0x9ecb59=!![];}}}catch(_0x367e11){_0x9ecb59=!![];}if(!_0x9ecb59)continue;const _0x240007=normalizeJid(_0x119002['user_jid']);if(!_0x353c99['has'](_0x240007))_0x353c99[_0x59266c(0x237)](_0x240007,{'user_jid':_0x240007,'display_name':_0x119002[_0x59266c(0x137)+'me']||_0x240007[_0x59266c(0x168)]('@')[-0x122d+0x1b37+-0x1a*0x59],'count':0x0,'last_ts':0x0});_0x353c99['get'](_0x240007)[_0x59266c(0x213)]+=Number(_0x119002[_0x59266c(0x1c9)+_0x59266c(0xfe)]||0xe31*0x2+-0x11f7+-0xa6b);}const _0x3cbe0b=Array['from'](_0x353c99[_0x59266c(0xed)]())['sort']((_0x2033d8,_0x533c4f)=>_0x533c4f[_0x59266c(0x213)]-_0x2033d8[_0x59266c(0x213)]||_0x533c4f[_0x59266c(0x219)]-_0x2033d8[_0x59266c(0x219)]);return _0x3cbe0b[_0x59266c(0x1bc)](-0x154c+-0x1c7f+0x31cb,_0x3cd87f);}catch(_0x434c35){return warn(_0x59266c(0x212)+'uildLeader'+_0x59266c(0x118)+_0x59266c(0x1f2)+(_0x434c35?.[_0x59266c(0x22e)]||_0x434c35)),[];}}function _0x3982(){const _0x521793=['\x20\x20\x20\x20\x20\x20\x20tim','e\x20DB\x20error','(?,\x20?,\x20\x27da','join','rame\x20=\x20\x27da','e,\x20bucket_','sendMessag','ekly\x27','\x20last\x20','1130496YZzViS','e\x201w,\x20inac','SELECT\x20id,','tive\x207d','MM,\x20yearly','weekNumber','changes','map','e\x20unexpect','[active]\x20o','\x20\x20chat_jid','push','display_na','monthly','failed:\x20','||weekly||','tats\x20WHERE','👤\x20@','bucket_key','inactive','ats_chat_t','sock','y,\x20message','\x20\x20\x20\x20\x20\x20','string','red','filter','isArray','rly\x27,\x20?,\x20?','weekly','t_jid,\x20use','EGER\x20DEFAU','HERE\x20timef','_key\x20=\x20?\x20L','\x20+\x201,\x20disp','46319TBDryg','et_key\x20TEX','KEEP_DAYS','SELECT\x20id\x20','ge_count\x20I','[active]\x20r','t_updated\x20','682704YuaXcU','33HDcfru','isplay_nam','N\x20(\x27weekly','remoteJid','nitialize\x20','nMessage\x20f','now','run','DEDUPE_TTL','\x27,\x27monthly','ACTIVE','CREATE\x20IND','toSeconds','ATE\x20TABLE\x20','imeframe\x20I','ailed:\x20','2568385ocsMkx','found\x20in\x20t','split','ed:\x20','DELETE\x20FRO','IF\x20NOT\x20EXI','t_key\x20<=\x20?','startOf','unit','IMARY\x20KEY\x20','yyyy-LL-dd','minus','endsWith','meframe\x20=\x20','r_jid,\x20tim','\x20\x27daily\x27\x20A','e_stats(ch','1292420GClwMk','es:\x20active','?,\x20?,\x20\x27yea','key\x20=\x20?\x20LI','O_YEAR_DAY','SELECT\x20use','\x20failed:\x20','\x20?\x20AND\x20tim','[active]\x20i','NTEGER\x20DEF','nthly\x27','st_updated','user_jid);','chat_jid,\x20','LE\x20IF\x20NOT\x20','pdated\x20=\x20?','_leaderboa','>\x20\x20OR\x20\x20ina','key','\x27weekly\x27|\x27','\x20user_jid\x20','\x20=\x20\x27daily\x27','=\x20?\x20WHERE\x20','ENT,\x0a\x20\x20\x20\x20\x20','sage_id\x20TE','ND\x20bucket_','ted_at\x20INT','3nIlqFE','lay_name\x20=','FROM\x20activ','TIME_ZONE','leaned\x20up','y_name,\x20la','EXT\x20DEFAUL','\x20\x20\x20\x20\x20UNIQU','ions\x20(vers','ucket_key\x20','rd_message','ve_stats\x20W','pushName','amount','\x20id\x20IN\x20(','kly\x27,\x20?,\x20?','\x0a\x20\x20\x20\x20\x20\x20\x20\x20W','||monthly|','\x20AND\x20bucke','clear','essage_cou','ollups\x20com','toLowerCas','UTC','fromObject','D\x20user_jid','\x0a\x20\x20\x20\x20\x20\x20\x20\x20U','\x201d,\x20activ','function','e\x20=\x20?,\x20las','Usage:\x20act','id\x20=\x20?\x20AND','=\x20?\x20AND\x20ti','\x20\x20\x20VALUES\x20','O\x20active_s','unt\x20+\x20?,\x20d',',\x20?,\x20?)','E\x20chat_jid','cnt','ARY\x20KEY,\x0a\x20','\x20\x20\x20chat_ji','members\x20fo','slice','\x20bucket_ke','OT\x20NULL,\x0a\x20','id\x20=\x20?','stats\x20WHER','[active]\x20c','y\x20>=\x20?\x0a\x20\x20\x20',',\x20?,\x20?)\x0a\x20\x20','[active]\x20p','ay_name\x20FR','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20','pdated\x20INT','sourceIds','message_co','yearly','\x20?,\x20last_u','nt,\x20displa','\x27,\x27yearly\x27','object','ead\x20config','SET\x20messag','ion\x20INTEGE','_count,\x20di','senderName','year','es\x0a\x0a','ount\x20=\x20mes','4DfhQsx',',\x20\x20\x20\x20\x20\x20\x20\x20-','plete','[active]\x20d','monthly\x27|\x27','elete\x20old\x20','id,\x20displa','imeframe\x20=','chat_jid','Y\x20user_jid','\x20timeframe','_ts\x0a\x20\x20\x20\x20\x20\x20','[active]\x20e',':\x20YYYY\x0a\x20\x20\x20','trim','daily\x27\x20AND','has','ucket_key)','M(message_','ay_name,\x20l','O_WEEK_DAY','[active]\x20t','ata','AND\x20bucket','\x20no\x20messag','at_jid,\x20ti','[active]\x20s','r:\x20','e\x20members\x20','\x20user_jid,','hly:\x20YYYY-','\x20inactive\x20','eekly:\x20YYY','\x20FROM\x20acti','\x20\x20\x20\x20WHERE\x20','IMIT\x201','KEY,\x20migra','EXISTS\x20idx','participan','get','EX\x20IF\x20NOT\x20','TO\x20active_','match','\x20\x20\x20\x20\x20\x20disp','chema\x20ensu','fromSecond','erformRoll','isCommand','\x20message_c',')\x20VALUES\x20(','user_jid','group\x20part','E(chat_jid','y_name,\x20SU','ers\x20in\x20the','\x20TEXT\x20PRIM','me(\x27%s\x27,\x27n','AUTOINCREM','frame,\x20buc','[active]\x20b','count','unt,\x20displ','ily\x27,\x20?,\x201','\x20\x20\x20\x20\x20\x20\x20mes','cnt,\x20MAX(l','\x27yearly\x27\x20A','last_ts','key\x20=\x20?\x0a\x20\x20','\x20NULL,\x0a\x20\x20\x20','@g.us','USERS_LIMI','Y-WW,\x20mont',':\x0a\x0a','count)\x20AS\x20','\x0a\x20\x20\x20\x20','cket_key,\x20','jid\x20TEXT\x20N','ser\x20ON\x20act','ERE\x20chat_j','EXISTS\x20act','splay_name','1.1.1','e_count\x20=\x20','ive\x20<amoun','?,\x20?,\x20\x27wee','ailed\x20to\x20r','T\x20NOT\x20NULL','message',',\x20user_jid','rame\x20=\x20\x27we','groupMetad','Y-MM-DD,\x20w','catch','padStart','[active]\x20f','toFormat','set','exec',',\x20\x20\x20\x20\x20\x20--\x20','_jid,\x20time','end\x20usage\x20','\x20chat_jid,','meframe,\x20b','ve_stats\x0a\x20','ECT\x20user_j','all','setZone','HERE\x20chat_','eframe,\x20bu','T_RETURN','\x20\x20\x20\x20\x20user_','values','MIT\x201','INSERT\x20INT','daily:\x20YYY','nitialized','T\x20\x27\x27,\x0a\x20\x20\x20\x20','Found\x20',',\x20timefram','\x27monthly\x27\x20','floor','342vrqbUb','text','\x20=\x20?\x20AND\x20t','\x20active\x20us','thly\x27,\x20?,\x20','UPDATE\x20act','\x0a\x20\x20\x20\x20\x20\x20CRE','unt',';\x0a\x20\x20\x20\x20','156506TSRUeX','AULT\x200,\x0a\x20\x20','-\x20\x27daily\x27|','LT\x20(strfti','e_stats\x20WH','d)\x20AS\x20last','f\x20ON\x20activ','13176bOnwUI','delete','ket_key,\x20m','tats\x20(chat','e_stats\x0a\x20\x20','eframe\x20=\x20\x27','R\x20PRIMARY\x20','_jid,\x20user','\x20\x20\x20\x20\x20messa','M\x20active_s','he\x20last\x20','_active_st','Could\x20not\x20','ats_chat_u','ROLLOVER_T','\x20messages\x0a','ily\x27\x20AND\x20b','board\x20erro','length','\x20the\x20last\x20','ive_stats\x20','ast_update','etGroupPar','active','month','No\x20inactiv','s\x20(\x0a\x20\x20\x20\x20\x20\x20'];_0x3982=function(){return _0x521793;};return _0x3982();}async function getGroupParticipants(_0x4c5847,_0x569993){const _0x49a71a=_0x5bc8ed;try{if(!_0x4c5847||typeof _0x4c5847[_0x49a71a(0x231)+'ata']!==_0x49a71a(0x1ae))return[];const _0x1b6d4a=await _0x4c5847['groupMetad'+_0x49a71a(0x1ed)](_0x569993),_0x1b5e8d=Array[_0x49a71a(0x146)](_0x1b6d4a?.['participan'+'ts'])?_0x1b6d4a[_0x49a71a(0x1fd)+'ts']:Object['values'](_0x1b6d4a?.['participan'+'ts']||{}),_0x453ed7=_0x1b5e8d[_0x49a71a(0x132)](_0x22c805=>_0x22c805['id'])[_0x49a71a(0x145)](Boolean)[_0x49a71a(0x132)](normalizeJid);return _0x453ed7;}catch(_0x4105ae){return warn('[active]\x20g'+_0x49a71a(0x11d)+'ticipants\x20'+'failed\x20for'+'\x20'+_0x569993+':\x20'+(_0x4105ae?.[_0x49a71a(0x22e)]||_0x4105ae)),[];}}export async function initialize(_0x495786){const _0x5b436f=_0x5bc8ed;try{botRef=_0x495786;if(botRef){if(typeof botRef['sendMessag'+'e']===_0x5b436f(0x1ae))sendApi=(_0x1291e9,_0x58af2d)=>botRef[_0x5b436f(0x128)+'e'](_0x1291e9,_0x58af2d);else{if(botRef[_0x5b436f(0x140)]&&typeof botRef[_0x5b436f(0x140)][_0x5b436f(0x128)+'e']==='function')sendApi=(_0x3bfb80,_0x138614)=>botRef['sock'][_0x5b436f(0x128)+'e'](_0x3bfb80,_0x138614);else sendApi=null;}}try{const _0x4f1727=getConfig()||{};if(_0x4f1727[_0x5b436f(0x160)]&&typeof _0x4f1727['ACTIVE']===_0x5b436f(0x1ce))CONFIG={...CONFIG,..._0x4f1727[_0x5b436f(0x160)]};}catch(_0x91cd48){warn(_0x5b436f(0x235)+_0x5b436f(0x22c)+_0x5b436f(0x1cf)+'.ACTIVE:\x20'+(_0x91cd48?.[_0x5b436f(0x22e)]||_0x91cd48));}await ensureSchema(),await performRollups(),info(_0x5b436f(0x17f)+_0x5b436f(0xf1));}catch(_0x2ed19a){error(_0x2ed19a,_0x5b436f(0x17f)+_0x5b436f(0x15a)+_0x5b436f(0x139)+(_0x2ed19a?.[_0x5b436f(0x22e)]||_0x2ed19a));throw _0x2ed19a;}}export async function onMessage(_0x5ea050){const _0x4ce720=_0x5bc8ed;try{await trackMessage(_0x5ea050);if(!_0x5ea050?.[_0x4ce720(0x206)])return;const _0x514013=_0x5ea050[_0x4ce720(0x189)]?.[_0x4ce720(0x159)];if(!_0x514013||!_0x514013[_0x4ce720(0x172)](_0x4ce720(0x21c)))return;const _0x4c0724=await isadmin(botRef,_0x5ea050)[_0x4ce720(0x233)](()=>![]);if(!_0x4c0724)return;const _0x36e671=typeof _0x5ea050[_0x4ce720(0xf8)]===_0x4ce720(0x143)&&_0x5ea050[_0x4ce720(0xf8)][_0x4ce720(0x1e5)]()?_0x5ea050[_0x4ce720(0xf8)][_0x4ce720(0x1e5)]():'';if(!_0x36e671)return;const _0x4b6b20=_0x36e671[_0x4ce720(0x168)](/\s+/)['filter'](Boolean),_0x49317a=_0x4b6b20[-0x1d71*0x1+-0x18*-0x81+0x1159*0x1][_0x4ce720(0x1a8)+'e']();if(_0x49317a!==_0x4ce720(0x11e)&&_0x49317a!==_0x4ce720(0x13e))return;const _0x483864=_0x4b6b20[-0xb0b+0x2*0xc7+0x9*0x10e]||'1w';let _0xd71c0e=parsePeriodArg(_0x483864);if(!_0xd71c0e){const _0xd9bca5=parseInt(_0x483864,-0x6d*0x3b+-0x17*0x133+-0x2b*-0x13a);if(!isNaN(_0xd9bca5))_0xd71c0e={'amount':_0xd9bca5,'unit':'d'};else{const _0x4b2f75=_0x4ce720(0x1b0)+_0x4ce720(0x22a)+'t><d|w|m|y'+_0x4ce720(0x188)+'ctive\x20<amo'+'unt><d|w|m'+'|y>\x0aExampl'+_0x4ce720(0x178)+_0x4ce720(0x1ad)+_0x4ce720(0x12c)+_0x4ce720(0x12e);try{await sendApi(_0x514013,{'text':_0x4b2f75});}catch(_0x20c106){warn('[active]\x20s'+_0x4ce720(0xe2)+'failed:\x20'+(_0x20c106?.[_0x4ce720(0x22e)]||_0x20c106));}return;}}try{await performRollups();}catch(_0x4e79e9){}const _0x45ccee=computeCutoffSeconds(_0xd71c0e[_0x4ce720(0x19f)],_0xd71c0e[_0x4ce720(0x16e)]);if(_0x49317a==='active'){const _0x37593c=await buildLeaderboardForChat(_0x514013,_0x45ccee,CONFIG[_0x4ce720(0x21d)+_0x4ce720(0xeb)]);if(!_0x37593c||_0x37593c['length']===-0x1*0x1c9a+0xe8a*0x1+0xe1*0x10){await sendApi(_0x514013,{'text':'No\x20active\x20'+_0x4ce720(0x1bb)+'und\x20in\x20the'+_0x4ce720(0x12a)+_0xd71c0e['amount']+_0xd71c0e[_0x4ce720(0x16e)]+'.'});return;}let _0x594345=_0x4ce720(0xf3)+_0x37593c[_0x4ce720(0x119)]+(_0x4ce720(0xfa)+_0x4ce720(0x20d)+_0x4ce720(0x12a))+_0xd71c0e['amount']+_0xd71c0e['unit']+_0x4ce720(0x21f);const _0x4c4ab3=[];let _0x3d7be4=-0x3*-0x7b1+-0x1a64+0x351;for(const _0x11794d of _0x37593c){_0x3d7be4++;const _0x58e37b=_0x11794d['user_jid'][_0x4ce720(0x168)]('@')[-0x16ce+-0x117f+0x284d];_0x594345+=_0x4ce720(0x13c)+_0x58e37b+'\x20('+(_0x11794d[_0x4ce720(0x137)+'me']||_0x58e37b)+')\x0a',_0x594345+=romanParen(_0x3d7be4)+'\x20'+_0x11794d['count']+(_0x4ce720(0x116)+'\x0a'),_0x4c4ab3[_0x4ce720(0x136)](_0x11794d['user_jid']);}const _0x22cb5d=-0x5*-0x49f+-0x1ed4+0x1759;if(_0x594345[_0x4ce720(0x119)]<=_0x22cb5d)await sendApi(_0x514013,{'text':_0x594345,'mentions':_0x4c4ab3});else{const _0x375f4c=_0x594345[_0x4ce720(0x168)]('\x0a\x0a');let _0xe43323='';for(const _0x2c5edf of _0x375f4c){if((_0xe43323+'\x0a\x0a'+_0x2c5edf)[_0x4ce720(0x119)]>_0x22cb5d)await sendApi(_0x514013,{'text':_0xe43323,'mentions':_0x4c4ab3}),_0xe43323=_0x2c5edf+'\x0a\x0a';else _0xe43323+=(_0xe43323?'\x0a\x0a':'')+_0x2c5edf;}if(_0xe43323[_0x4ce720(0x1e5)]())await sendApi(_0x514013,{'text':_0xe43323,'mentions':_0x4c4ab3});}return;}if(_0x49317a==='inactive'){const _0x40147c=botRef?.['sock']||botRef,_0x2f8a9f=await getGroupParticipants(_0x40147c,_0x514013);if(!_0x2f8a9f||_0x2f8a9f['length']===-0x2380+0x101c+0x1364){await sendApi(_0x514013,{'text':_0x4ce720(0x113)+'determine\x20'+_0x4ce720(0x20a)+'icipants.'});return;}const _0x3b09d7=await buildLeaderboardForChat(_0x514013,_0x45ccee,0x10ef5d+0x12ec80+-0x14999d),_0x213937=new Set((_0x3b09d7||[])[_0x4ce720(0x132)](_0x396707=>normalizeJid(_0x396707[_0x4ce720(0x209)]))),_0x30f900=_0x2f8a9f[_0x4ce720(0x145)](_0xf2b492=>!_0x213937[_0x4ce720(0x1e7)](normalizeJid(_0xf2b492)));if(!_0x30f900[_0x4ce720(0x119)]){await sendApi(_0x514013,{'text':_0x4ce720(0x120)+_0x4ce720(0x1f3)+_0x4ce720(0x167)+_0x4ce720(0x111)+_0xd71c0e[_0x4ce720(0x19f)]+_0xd71c0e[_0x4ce720(0x16e)]+'.'});return;}let _0x11dbe8=_0x4ce720(0xf3)+_0x30f900[_0x4ce720(0x119)]+(_0x4ce720(0x1f6)+'members\x20in'+_0x4ce720(0x11a))+_0xd71c0e[_0x4ce720(0x19f)]+_0xd71c0e[_0x4ce720(0x16e)]+_0x4ce720(0x21f);const _0x4f0b5e=[];let _0x4bb62f=-0x1c52+-0xad*0x2b+0x3961;for(const _0x3b9f44 of _0x30f900){_0x4bb62f++;const _0x610d4c=_0x3b9f44[_0x4ce720(0x168)]('@')[0x574+-0x5*-0x527+0x1*-0x1f37];_0x11dbe8+=_0x4ce720(0x13c)+_0x610d4c+'\x20('+_0x610d4c+')\x0a',_0x11dbe8+=romanParen(_0x4bb62f)+(_0x4ce720(0x1ef)+_0x4ce720(0x1d5)),_0x4f0b5e[_0x4ce720(0x136)](_0x3b9f44);}await sendApi(_0x514013,{'text':_0x11dbe8,'mentions':_0x4f0b5e});return;}}catch(_0x5923f4){error(_0x5923f4,_0x4ce720(0x134)+_0x4ce720(0x15b)+_0x4ce720(0x165)+(_0x5923f4?.['message']||_0x5923f4));}}export async function cleanup(){const _0x513e9a=_0x5bc8ed;try{for(const _0x58ec68 of processedMessageKeys['values']())try{clearTimeout(_0x58ec68);}catch(_0x394cf4){}processedMessageKeys[_0x513e9a(0x1a5)]();}catch(_0x276cef){}botRef=null,sendApi=null,info(_0x513e9a(0x1c1)+_0x513e9a(0x196));}export default{'name':name,'version':version,'initialize':initialize,'onMessage':onMessage,'cleanup':cleanup};