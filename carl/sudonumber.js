const _0x5d8677=_0x4b2a;(function(_0xa50c4c,_0x4874fc){const _0x28b2e6=_0x4b2a,_0x6a138=_0xa50c4c();while(!![]){try{const _0x6084d0=parseInt(_0x28b2e6(0x21f))/(0x1c23+-0x1d43+-0x121*-0x1)+-parseInt(_0x28b2e6(0x20c))/(0x60a+-0x5f2+0x2*-0xb)*(-parseInt(_0x28b2e6(0x246))/(0x761*0x3+-0x22d3+0x1*0xcb3))+parseInt(_0x28b2e6(0x204))/(0x1*-0x1b4a+0x2*0x24d+-0x4*-0x5ad)+parseInt(_0x28b2e6(0x1f1))/(0x4d*0x2b+-0xf09+0x21f)*(parseInt(_0x28b2e6(0x1e4))/(-0x2190+-0x17b9+0x394f))+-parseInt(_0x28b2e6(0x20a))/(0x1f*0x6b+0x1*-0x997+0xf*-0x39)*(-parseInt(_0x28b2e6(0x228))/(0x5*0x6b9+0xba+-0x224f))+-parseInt(_0x28b2e6(0x1ff))/(-0xb3*0x7+-0x1*0x26c3+-0x5*-0x8bd)*(parseInt(_0x28b2e6(0x247))/(0x1*-0x1edb+-0x150b+0x10*0x33f))+-parseInt(_0x28b2e6(0x1ef))/(-0xf31+0x20e*-0x10+0x1*0x301c);if(_0x6084d0===_0x4874fc)break;else _0x6a138['push'](_0x6a138['shift']());}catch(_0x432342){_0x6a138['push'](_0x6a138['shift']());}}}(_0x2619,-0x1930d6+0x118d59+-0xb5d72*-0x2));import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';function _0x2619(){const _0x4d5af1=['RETENTION_','message','dler\x20error','jid','key','\x20VALUES\x20(?','148353aFIzJD','7122180UxKlOZ','indexOf','\x20\x20\x20chat_ji','O\x20message_','msg_id','r]\x20getSend','IGNORE\x20INT','ener','\x20saved_at\x20','sg_id,\x20sen','LE\x20IF\x20NOT\x20','6LWekEY','ender_numb','length','d\x20TEXT,\x0a\x20\x20','essage_sen','findings','der_number','ized','M\x20message_','senders\x20WH','d_at\x20<\x20?','49474678JIdRqT','id,\x20saved_','7890290CpEPlY','string','_id\x20FROM\x20m','r\x20rows','removeList','TERVAL_MS','EXISTS\x20mes','nder_jid\x20T','IS\x20NOT\x20NUL','catch','\x20error:\x20','rs\x20(\x0a\x20\x20\x20\x20m','ng\x20failed:',',\x20saved_at','9FwhlCc','participan','CREATE\x20TAB','r]\x20cleaned','sender_pn','4176336BtkIIg',',\x20?,\x20?,\x20?,','SELECT\x20msg','\x20initializ','exec','\x20\x20saved_at','21rVKvBo','psert','38tsUlIQ','r]\x20userjid','psert:\x20','sage_sende','tAlt','field','rror:\x20','g_id\x20=\x20?','\x20failed:\x20','sg_id\x20TEXT','_id,\x20sende','lid','erForMsg\x20e','now','map','er\x20TEXT,\x0a\x20','replace','messages.u','r]\x20saveSen','981515ZBNJAH','join','\x20threw:\x20','MINUTES','to\x20attach\x20','r]\x20failed\x20','r]\x20cleanup',',\x20chat_jid','CLEANUP_IN','4415256uYnGHF','at)\x0a\x20\x20\x20\x20\x20\x20','EXT,\x0a\x20\x20\x20\x20s','r]\x20attache','er,\x20chat_j','all','find','senders\x20(m','remoteJid','d\x20to\x20messa','\x20bot\x20arg','get','INSERT\x20OR\x20','floor','sUpsertHan','slice','r]\x20per-mes','run','\x20FROM\x20mess','[sudonumbe','sudonumber','\x20);','s\x20WHERE\x20ms','Old\x20error:'];_0x2619=function(){return _0x4d5af1;};return _0x2619();}import{userJidFromCtx as _0x531cce}from'../utils/sudo.js';export const name=_0x5d8677(0x23c);export const version='1.0.1';export const priority=-0x5*0x62a+0x1e28+0xaf;let botInstance=null,cleanupInterval=null;const FALLBACKS={'RETENTION_MINUTES':0xf,'CLEANUP_INTERVAL_MS':(-0x1a3e*-0x1+-0x387+-0x167b)*(0x22f3*0x1+-0x445+0x17*-0x12a)};let RETENTION_MINUTES=FALLBACKS['RETENTION_'+_0x5d8677(0x222)],CLEANUP_INTERVAL_MS=FALLBACKS[_0x5d8677(0x227)+_0x5d8677(0x1f6)];function nowSeconds(){const _0xeaac78=_0x5d8677;return Math[_0xeaac78(0x235)](Date[_0xeaac78(0x219)]()/(-0x26ab+-0x1*-0xf0a+-0x1b89*-0x1));}async function ensureTable(){const _0x3d39e2=_0x5d8677;await db[_0x3d39e2(0x208)](_0x3d39e2(0x201)+_0x3d39e2(0x251)+_0x3d39e2(0x1f7)+_0x3d39e2(0x20f)+_0x3d39e2(0x1fc)+_0x3d39e2(0x215)+'\x20PRIMARY\x20K'+'EY,\x0a\x20\x20\x20\x20se'+_0x3d39e2(0x1f8)+_0x3d39e2(0x22a)+_0x3d39e2(0x1e5)+_0x3d39e2(0x21b)+_0x3d39e2(0x249)+_0x3d39e2(0x1e7)+_0x3d39e2(0x209)+'\x20INTEGER\x0a\x20'+_0x3d39e2(0x23d));}function normalizeNumberFromSudoJid(_0xae00b0){const _0x40eb68=_0x5d8677;if(!_0xae00b0)return'';try{const _0x4b50ab=String(_0xae00b0),_0x15f782=_0x4b50ab[_0x40eb68(0x248)]('@'),_0xc304db=_0x15f782===-(0x43*0xc+0x1ea3+-0x21c6)?_0x4b50ab:_0x4b50ab[_0x40eb68(0x237)](0x15b+-0x1*-0x13eb+-0x185*0xe,_0x15f782),_0x280a4a=_0xc304db[_0x40eb68(0x248)](':'),_0xec6a19=_0x280a4a===-(-0x1310+-0x4d0+0x17e1)?_0xc304db:_0xc304db[_0x40eb68(0x237)](-0x1*0x87b+0x13*0x1b5+-0x17f4,_0x280a4a);return _0xec6a19[_0x40eb68(0x21c)](/^\+/,'');}catch{return String(_0xae00b0||'');}}async function saveSenderIfMissing(_0x59a408,_0x3a52f8,_0x320d80){const _0x428b19=_0x5d8677;if(!_0x59a408||!_0x3a52f8)return![];const _0x7c0bf1=normalizeNumberFromSudoJid(_0x3a52f8),_0x141d35=nowSeconds();try{return await db[_0x428b19(0x239)](_0x428b19(0x234)+_0x428b19(0x24d)+_0x428b19(0x24a)+_0x428b19(0x22f)+_0x428b19(0x250)+'der_jid,\x20s'+_0x428b19(0x1e5)+_0x428b19(0x22c)+_0x428b19(0x1f0)+_0x428b19(0x229)+_0x428b19(0x245)+_0x428b19(0x205)+'\x20?)',[_0x59a408,_0x3a52f8,_0x7c0bf1||null,_0x320d80||null,_0x141d35]),!![];}catch(_0x2fea94){return warn(_0x428b19(0x23b)+_0x428b19(0x21e)+'derIfMissi'+_0x428b19(0x1fd)+'\x20'+(_0x2fea94?.[_0x428b19(0x241)]||_0x2fea94)),![];}}export async function getSenderForMsg(_0x341784){const _0x26e30d=_0x5d8677;if(!_0x341784)return null;try{const _0x5581f9=await db[_0x26e30d(0x233)](_0x26e30d(0x206)+_0x26e30d(0x216)+'r_jid,\x20sen'+_0x26e30d(0x1ea)+_0x26e30d(0x226)+_0x26e30d(0x1fe)+_0x26e30d(0x23a)+'age_sender'+_0x26e30d(0x23e)+_0x26e30d(0x213),[_0x341784]);return _0x5581f9||null;}catch(_0x49dd61){return warn(_0x26e30d(0x23b)+_0x26e30d(0x24c)+_0x26e30d(0x218)+_0x26e30d(0x212)+(_0x49dd61?.['message']||_0x49dd61)),null;}}async function cleanupOld(){const _0x3ea131=_0x5d8677;try{const _0x2d5326=nowSeconds()-Number(RETENTION_MINUTES||FALLBACKS[_0x3ea131(0x240)+_0x3ea131(0x222)])*(-0x7*-0x581+0x1*-0x1da7+-0x13c*0x7),_0x14a370=await db[_0x3ea131(0x22d)](_0x3ea131(0x206)+_0x3ea131(0x1f3)+_0x3ea131(0x1e8)+'ders\x20WHERE'+_0x3ea131(0x24f)+_0x3ea131(0x1f9)+'L\x20AND\x20save'+_0x3ea131(0x1ee),[_0x2d5326]);if(!_0x14a370||_0x14a370[_0x3ea131(0x1e6)]===0x2159*0x1+0x1893+-0x39ec)return;const _0x420763=_0x14a370[_0x3ea131(0x21a)](_0xae260f=>_0xae260f[_0x3ea131(0x24b)]),_0x2d5da4=0x1*0x153d+-0x86b+-0xc0a;for(let _0x30e990=0x163a+0x2c*0x16+-0x1a02;_0x30e990<_0x420763['length'];_0x30e990+=_0x2d5da4){const _0x298c3b=_0x420763[_0x3ea131(0x237)](_0x30e990,_0x30e990+_0x2d5da4),_0x5787d8=_0x298c3b[_0x3ea131(0x21a)](()=>'?')[_0x3ea131(0x220)](',');await db[_0x3ea131(0x239)]('DELETE\x20FRO'+_0x3ea131(0x1ec)+_0x3ea131(0x1ed)+'ERE\x20msg_id'+'\x20IN\x20('+_0x5787d8+')',_0x298c3b);}info(_0x3ea131(0x23b)+_0x3ea131(0x202)+'\x20'+_0x14a370[_0x3ea131(0x1e6)]+('\x20old\x20sende'+_0x3ea131(0x1f4)));}catch(_0x3a3915){warn(_0x3ea131(0x23b)+'r]\x20cleanup'+_0x3ea131(0x23f)+'\x20'+(_0x3a3915?.[_0x3ea131(0x241)]||_0x3a3915));}}async function messagesUpsertHandler({messages:_0x2845a4}){const _0x25ff07=_0x5d8677;try{if(!_0x2845a4||!Array['isArray'](_0x2845a4))return;for(const _0x4da580 of _0x2845a4){try{if(!_0x4da580||!_0x4da580[_0x25ff07(0x244)])continue;if(_0x4da580[_0x25ff07(0x244)]['fromMe'])continue;const _0x32dcdb=_0x4da580[_0x25ff07(0x244)]?.['id']||_0x4da580['id']||_0x4da580[_0x25ff07(0x241)]&&_0x4da580[_0x25ff07(0x241)][_0x25ff07(0x244)]&&_0x4da580[_0x25ff07(0x241)][_0x25ff07(0x244)]['id']||null;if(!_0x32dcdb)continue;const _0xdd980b=await getSenderForMsg(_0x32dcdb);if(_0xdd980b)continue;let _0x4048e4=[];try{const _0x2c66da=_0x531cce(_0x4da580);_0x4048e4=_0x2c66da&&Array['isArray'](_0x2c66da[_0x25ff07(0x1e9)])?_0x2c66da[_0x25ff07(0x1e9)]:[];}catch(_0x5ef1dd){warn(_0x25ff07(0x23b)+_0x25ff07(0x20d)+_0x25ff07(0x221)+(_0x5ef1dd?.['message']||_0x5ef1dd)),_0x4048e4=[];}if(!_0x4048e4['length'])continue;const _0x546dc0=['remoteJidA'+'lt',_0x25ff07(0x203),_0x25ff07(0x200)+_0x25ff07(0x210),_0x25ff07(0x200)+'t_pn'];let _0x1e6582=null;for(const _0x34f068 of _0x546dc0){_0x1e6582=_0x4048e4[_0x25ff07(0x22e)](_0x526333=>_0x526333[_0x25ff07(0x211)]===_0x34f068&&typeof _0x526333[_0x25ff07(0x243)]===_0x25ff07(0x1f2));if(_0x1e6582)break;}if(!_0x1e6582)_0x1e6582=_0x4048e4[0x3*-0x8d6+-0x18e8+0x336a];if(!_0x1e6582||!_0x1e6582[_0x25ff07(0x243)]||typeof _0x1e6582['jid']!==_0x25ff07(0x1f2))continue;const _0xb0ca9f=_0x1e6582['jid'][_0x25ff07(0x248)]('@'),_0x257184=_0xb0ca9f===-(0x140+-0x2*-0x166+-0xf*0x45)?'':_0x1e6582[_0x25ff07(0x243)]['slice'](_0xb0ca9f+(0x722+-0x2515+0x1df4));if(!_0x257184||_0x257184['toLowerCas'+'e']()===_0x25ff07(0x217))continue;await saveSenderIfMissing(_0x32dcdb,_0x1e6582[_0x25ff07(0x243)],_0x4da580[_0x25ff07(0x244)]?.[_0x25ff07(0x230)]||null);}catch(_0x30a07d){warn(_0x25ff07(0x23b)+_0x25ff07(0x238)+'sage\x20handl'+'er\x20error:\x20'+(_0x30a07d?.['message']||_0x30a07d));}}}catch(_0x568c0d){warn(_0x25ff07(0x23b)+'r]\x20message'+_0x25ff07(0x236)+_0x25ff07(0x242)+':\x20'+(_0x568c0d?.[_0x25ff07(0x241)]||_0x568c0d));}}function _0x4b2a(_0x20dc50,_0x379898){const _0x1adbd5=_0x2619();return _0x4b2a=function(_0xa12370,_0x547f26){_0xa12370=_0xa12370-(-0x53b+0x8*0x43b+-0x1ab9*0x1);let _0x53fffb=_0x1adbd5[_0xa12370];return _0x53fffb;},_0x4b2a(_0x20dc50,_0x379898);}export async function initialize(_0x2ad6d0){const _0x4f0cd4=_0x5d8677;if(!_0x2ad6d0)throw new Error(_0x4f0cd4(0x23c)+_0x4f0cd4(0x207)+'e\x20requires'+_0x4f0cd4(0x232));botInstance=_0x2ad6d0,await ensureTable()[_0x4f0cd4(0x1fa)](_0x243169=>{const _0x57b8ac=_0x4f0cd4;error(_0x243169,_0x57b8ac(0x23b)+'r]\x20DB\x20init'+_0x57b8ac(0x214)+(_0x243169?.[_0x57b8ac(0x241)]||_0x243169));throw _0x243169;});try{botInstance['on'](_0x4f0cd4(0x21d)+_0x4f0cd4(0x20b),messagesUpsertHandler),info('[sudonumbe'+_0x4f0cd4(0x22b)+_0x4f0cd4(0x231)+'ges.upsert');}catch(_0x3bb6ce){warn(_0x4f0cd4(0x23b)+_0x4f0cd4(0x224)+_0x4f0cd4(0x223)+_0x4f0cd4(0x21d)+_0x4f0cd4(0x20e)+(_0x3bb6ce?.['message']||_0x3bb6ce));}if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(cleanupOld,Number(CLEANUP_INTERVAL_MS||FALLBACKS[_0x4f0cd4(0x227)+_0x4f0cd4(0x1f6)])),info(_0x4f0cd4(0x23b)+'r]\x20initial'+_0x4f0cd4(0x1eb));}export async function cleanup(){const _0x33f3b2=_0x5d8677;try{if(botInstance&&typeof botInstance[_0x33f3b2(0x1f5)+_0x33f3b2(0x24e)]==='function')botInstance[_0x33f3b2(0x1f5)+_0x33f3b2(0x24e)](_0x33f3b2(0x21d)+_0x33f3b2(0x20b),messagesUpsertHandler);if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=null;}catch(_0x5dd098){warn('[sudonumbe'+_0x33f3b2(0x225)+_0x33f3b2(0x1fb)+(_0x5dd098?.[_0x33f3b2(0x241)]||_0x5dd098));}finally{botInstance=null;}}export default{'name':name,'version':version,'initialize':initialize,'cleanup':cleanup,'getSenderForMsg':getSenderForMsg};