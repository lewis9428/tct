const _0x48ec4f=_0x236a;(function(_0x75fd9f,_0xc18b04){const _0x18e458=_0x236a,_0x488bfe=_0x75fd9f();while(!![]){try{const _0x2bdc5e=parseInt(_0x18e458(0x1b6))/(-0x7a*-0x5+-0xc49*0x1+-0x4*-0x27a)*(parseInt(_0x18e458(0x1ad))/(0x1*-0x641+-0x4*0x18d+0xc77))+parseInt(_0x18e458(0x163))/(0x1*-0xa85+-0x1e4a*-0x1+-0x9*0x232)*(parseInt(_0x18e458(0x1b8))/(-0x13*-0x18c+-0x175*0x15+0x139))+-parseInt(_0x18e458(0x194))/(0x132a+0x1c21+0x3*-0xfc2)+parseInt(_0x18e458(0x17e))/(0x60b+0x1a02+-0x2007)*(-parseInt(_0x18e458(0x175))/(0x1e75+-0x1f00+0x92))+-parseInt(_0x18e458(0x192))/(-0x6*0x1a0+0xae1+-0x1*0x119)*(parseInt(_0x18e458(0x1a7))/(-0x22c5+0x69c+-0x12*-0x191))+-parseInt(_0x18e458(0x16c))/(0x11d1+0x204a+-0x3211)+parseInt(_0x18e458(0x1b7))/(0x1090*-0x2+-0x165b+0x135*0x2e);if(_0x2bdc5e===_0xc18b04)break;else _0x488bfe['push'](_0x488bfe['shift']());}catch(_0x990a6a){_0x488bfe['push'](_0x488bfe['shift']());}}}(_0x1360,-0xb9*0x743+0x69aed+0x61797));import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';function _0x236a(_0x341ede,_0x22a6b3){const _0x2a5ebe=_0x1360();return _0x236a=function(_0x1f3295,_0x197ceb){_0x1f3295=_0x1f3295-(-0x1da+-0x233b+0x265f);let _0x3df6b9=_0x2a5ebe[_0x1f3295];return _0x3df6b9;},_0x236a(_0x341ede,_0x22a6b3);}function _0x1360(){const _0x494c62=['IGNORE\x20INT','IS\x20NOT\x20NUL','field','lid','isArray','r]\x20getSend','now','r_jid,\x20sen','r]\x20cleanup','age_sender','sUpsertHan','get','EY,\x0a\x20\x20\x20\x20se','_id,\x20sende','t_pn','3AmqAxm','\x20\x20saved_at','s\x20WHERE\x20ms','findings','1.0.1','string','ERE\x20msg_id','r]\x20DB\x20init','indexOf','7999760oRPbPK','d_at\x20<\x20?','TERVAL_MS','remoteJidA','\x20old\x20sende','ender_numb','psert','M\x20message_','er\x20TEXT,\x0a\x20','7fJqNXw','RETENTION_','derIfMissi','er,\x20chat_j','LE\x20IF\x20NOT\x20','psert:\x20','rs\x20(\x0a\x20\x20\x20\x20m','Old\x20error:','senders\x20(m','4461612rzsUJA','ener','message','L\x20AND\x20save','function','CLEANUP_IN','sage\x20handl','r]\x20userjid','length','EXISTS\x20mes','\x20VALUES\x20(?','removeList','slice','g_id\x20=\x20?','_id\x20FROM\x20m','e\x20requires','floor','SELECT\x20msg','EXT,\x0a\x20\x20\x20\x20s','erForMsg\x20e','3498648gjrDSi','dler\x20error','1135905oLOIQo','key','r]\x20attache','r]\x20message','r]\x20saveSen','catch','[sudonumbe','\x20threw:\x20','\x20);','remoteJid','MINUTES','id,\x20saved_',',\x20saved_at','\x20initializ','\x20PRIMARY\x20K','\x20FROM\x20mess','sudonumber','nder_jid\x20T','sg_id\x20TEXT','9yeMIOD','r\x20rows','der_number','ges.upsert','tAlt','\x20INTEGER\x0a\x20','4JOJWvg','essage_sen','participan','\x20failed:\x20','\x20?)','r]\x20failed\x20','all','msg_id','CREATE\x20TAB','54039EvqcUS','20649717bqeLrK','2843928qLsIwk','sg_id,\x20sen','d\x20to\x20messa','\x20\x20\x20chat_ji','ized','messages.u','jid','join','map','sage_sende','toLowerCas','at)\x0a\x20\x20\x20\x20\x20\x20','replace','run','\x20error:\x20'];_0x1360=function(){return _0x494c62;};return _0x1360();}import{userJidFromCtx as _0x2484c3}from'../utils/sudo.js';export const name=_0x48ec4f(0x1a4);export const version=_0x48ec4f(0x167);export const priority=0xbb2+-0x23f6+0x1849;let botInstance=null,cleanupInterval=null;const FALLBACKS={'RETENTION_MINUTES':0xf,'CLEANUP_INTERVAL_MS':(-0x1255+0x1*0x4ee+0x1*0xda3)*(0x1cfe+-0x7*0x404+0x183*0x2)};let RETENTION_MINUTES=FALLBACKS[_0x48ec4f(0x176)+_0x48ec4f(0x19e)],CLEANUP_INTERVAL_MS=FALLBACKS[_0x48ec4f(0x183)+_0x48ec4f(0x16e)];function nowSeconds(){const _0x40af1a=_0x48ec4f;return Math[_0x40af1a(0x18e)](Date[_0x40af1a(0x15a)]()/(-0xab7+0x1df2*0x1+-0x1*0xf53));}async function ensureTable(){const _0x6622c9=_0x48ec4f;await db['exec'](_0x6622c9(0x1b5)+_0x6622c9(0x179)+_0x6622c9(0x187)+_0x6622c9(0x14e)+_0x6622c9(0x17b)+_0x6622c9(0x1a6)+_0x6622c9(0x1a2)+_0x6622c9(0x160)+_0x6622c9(0x1a5)+_0x6622c9(0x190)+_0x6622c9(0x171)+_0x6622c9(0x174)+_0x6622c9(0x1bb)+'d\x20TEXT,\x0a\x20\x20'+_0x6622c9(0x164)+_0x6622c9(0x1ac)+_0x6622c9(0x19c));}function normalizeNumberFromSudoJid(_0x352845){const _0x5e8eb0=_0x48ec4f;if(!_0x352845)return'';try{const _0x5c3889=String(_0x352845),_0x1df075=_0x5c3889[_0x5e8eb0(0x16b)]('@'),_0x44577d=_0x1df075===-(0x18*0x29+-0x207*-0x6+0xf1*-0x11)?_0x5c3889:_0x5c3889['slice'](-0xc9f*-0x3+0x15bb+-0x3b98,_0x1df075),_0x33eaa6=_0x44577d[_0x5e8eb0(0x16b)](':'),_0x35ca38=_0x33eaa6===-(-0x214b+0x2102+0x2*0x25)?_0x44577d:_0x44577d['slice'](-0x1324+0x5b1+0x139*0xb,_0x33eaa6);return _0x35ca38[_0x5e8eb0(0x151)](/^\+/,'');}catch{return String(_0x352845||'');}}async function saveSenderIfMissing(_0xbf3246,_0x4f505a,_0x42bfac){const _0x4e64cb=_0x48ec4f;if(!_0xbf3246||!_0x4f505a)return![];const _0x2c8ddb=normalizeNumberFromSudoJid(_0x4f505a),_0xea8a06=nowSeconds();try{return await db[_0x4e64cb(0x152)]('INSERT\x20OR\x20'+_0x4e64cb(0x154)+'O\x20message_'+_0x4e64cb(0x17d)+_0x4e64cb(0x1b9)+'der_jid,\x20s'+'ender_numb'+_0x4e64cb(0x178)+_0x4e64cb(0x19f)+_0x4e64cb(0x150)+_0x4e64cb(0x188)+',\x20?,\x20?,\x20?,'+_0x4e64cb(0x1b1),[_0xbf3246,_0x4f505a,_0x2c8ddb||null,_0x42bfac||null,_0xea8a06]),!![];}catch(_0x5cd3fb){return warn('[sudonumbe'+_0x4e64cb(0x198)+_0x4e64cb(0x177)+'ng\x20failed:'+'\x20'+(_0x5cd3fb?.[_0x4e64cb(0x180)]||_0x5cd3fb)),![];}}export async function getSenderForMsg(_0x119ddc){const _0x349e4b=_0x48ec4f;if(!_0x119ddc)return null;try{const _0x58c83f=await db[_0x349e4b(0x15f)](_0x349e4b(0x18f)+_0x349e4b(0x161)+_0x349e4b(0x15b)+_0x349e4b(0x1a9)+',\x20chat_jid'+_0x349e4b(0x1a0)+_0x349e4b(0x1a3)+_0x349e4b(0x15d)+_0x349e4b(0x165)+_0x349e4b(0x18b),[_0x119ddc]);return _0x58c83f||null;}catch(_0xf99b54){return warn(_0x349e4b(0x19a)+_0x349e4b(0x159)+_0x349e4b(0x191)+'rror:\x20'+(_0xf99b54?.['message']||_0xf99b54)),null;}}async function cleanupOld(){const _0x1d173f=_0x48ec4f;try{const _0x48a63a=nowSeconds()-Number(RETENTION_MINUTES||FALLBACKS[_0x1d173f(0x176)+_0x1d173f(0x19e)])*(-0x2b*-0xb3+-0x2441*0x1+0x3*0x224),_0x1c1fb5=await db[_0x1d173f(0x1b3)](_0x1d173f(0x18f)+_0x1d173f(0x18c)+_0x1d173f(0x1ae)+'ders\x20WHERE'+'\x20saved_at\x20'+_0x1d173f(0x155)+_0x1d173f(0x181)+_0x1d173f(0x16d),[_0x48a63a]);if(!_0x1c1fb5||_0x1c1fb5[_0x1d173f(0x186)]===-0x8e9+-0x20d2+-0x1*-0x29bb)return;const _0x9d5a0e=_0x1c1fb5[_0x1d173f(0x14d)](_0x4841b4=>_0x4841b4[_0x1d173f(0x1b4)]),_0x2675dc=-0x2658+0x6bd+0x2063;for(let _0x2983f8=-0x3d*0xa3+0x15*-0xe3+0x3976;_0x2983f8<_0x9d5a0e[_0x1d173f(0x186)];_0x2983f8+=_0x2675dc){const _0x59ff27=_0x9d5a0e[_0x1d173f(0x18a)](_0x2983f8,_0x2983f8+_0x2675dc),_0x185c75=_0x59ff27[_0x1d173f(0x14d)](()=>'?')[_0x1d173f(0x14c)](',');await db[_0x1d173f(0x152)]('DELETE\x20FRO'+_0x1d173f(0x173)+'senders\x20WH'+_0x1d173f(0x169)+'\x20IN\x20('+_0x185c75+')',_0x59ff27);}info(_0x1d173f(0x19a)+'r]\x20cleaned'+'\x20'+_0x1c1fb5['length']+(_0x1d173f(0x170)+_0x1d173f(0x1a8)));}catch(_0x4db3b3){warn('[sudonumbe'+'r]\x20cleanup'+_0x1d173f(0x17c)+'\x20'+(_0x4db3b3?.['message']||_0x4db3b3));}}async function messagesUpsertHandler({messages:_0x8a431c}){const _0x45c4fe=_0x48ec4f;try{if(!_0x8a431c||!Array[_0x45c4fe(0x158)](_0x8a431c))return;for(const _0xf7d85a of _0x8a431c){try{if(!_0xf7d85a||!_0xf7d85a[_0x45c4fe(0x195)])continue;if(_0xf7d85a[_0x45c4fe(0x195)]['fromMe'])continue;const _0x551158=_0xf7d85a[_0x45c4fe(0x195)]?.['id']||_0xf7d85a['id']||_0xf7d85a['message']&&_0xf7d85a[_0x45c4fe(0x180)]['key']&&_0xf7d85a['message'][_0x45c4fe(0x195)]['id']||null;if(!_0x551158)continue;const _0x5d2960=await getSenderForMsg(_0x551158);if(_0x5d2960)continue;let _0x52653a=[];try{const _0x2d6f0a=_0x2484c3(_0xf7d85a);_0x52653a=_0x2d6f0a&&Array['isArray'](_0x2d6f0a[_0x45c4fe(0x166)])?_0x2d6f0a[_0x45c4fe(0x166)]:[];}catch(_0x39dde2){warn(_0x45c4fe(0x19a)+_0x45c4fe(0x185)+_0x45c4fe(0x19b)+(_0x39dde2?.[_0x45c4fe(0x180)]||_0x39dde2)),_0x52653a=[];}if(!_0x52653a['length'])continue;const _0x4260cf=[_0x45c4fe(0x16f)+'lt','sender_pn',_0x45c4fe(0x1af)+_0x45c4fe(0x1ab),_0x45c4fe(0x1af)+_0x45c4fe(0x162)];let _0x5427e7=null;for(const _0x598248 of _0x4260cf){_0x5427e7=_0x52653a['find'](_0xeb0f45=>_0xeb0f45[_0x45c4fe(0x156)]===_0x598248&&typeof _0xeb0f45[_0x45c4fe(0x14b)]===_0x45c4fe(0x168));if(_0x5427e7)break;}if(!_0x5427e7)_0x5427e7=_0x52653a[0x26f2+0x10ea+-0x37dc];if(!_0x5427e7||!_0x5427e7[_0x45c4fe(0x14b)]||typeof _0x5427e7[_0x45c4fe(0x14b)]!==_0x45c4fe(0x168))continue;const _0x10be50=_0x5427e7[_0x45c4fe(0x14b)][_0x45c4fe(0x16b)]('@'),_0x262577=_0x10be50===-(-0x176c+0xc70*-0x2+0x304d)?'':_0x5427e7[_0x45c4fe(0x14b)]['slice'](_0x10be50+(-0xc1+-0x77*0x39+0x1*0x1b41));if(!_0x262577||_0x262577[_0x45c4fe(0x14f)+'e']()===_0x45c4fe(0x157))continue;await saveSenderIfMissing(_0x551158,_0x5427e7['jid'],_0xf7d85a[_0x45c4fe(0x195)]?.[_0x45c4fe(0x19d)]||null);}catch(_0x24e4aa){warn(_0x45c4fe(0x19a)+'r]\x20per-mes'+_0x45c4fe(0x184)+'er\x20error:\x20'+(_0x24e4aa?.[_0x45c4fe(0x180)]||_0x24e4aa));}}}catch(_0x39b91d){warn(_0x45c4fe(0x19a)+_0x45c4fe(0x197)+_0x45c4fe(0x15e)+_0x45c4fe(0x193)+':\x20'+(_0x39b91d?.[_0x45c4fe(0x180)]||_0x39b91d));}}export async function initialize(_0x5024f5){const _0xff18bc=_0x48ec4f;if(!_0x5024f5)throw new Error(_0xff18bc(0x1a4)+_0xff18bc(0x1a1)+_0xff18bc(0x18d)+'\x20bot\x20arg');botInstance=_0x5024f5,await ensureTable()[_0xff18bc(0x199)](_0x4dfb59=>{const _0x37190b=_0xff18bc;error(_0x4dfb59,_0x37190b(0x19a)+_0x37190b(0x16a)+_0x37190b(0x1b0)+(_0x4dfb59?.[_0x37190b(0x180)]||_0x4dfb59));throw _0x4dfb59;});try{botInstance['on']('messages.u'+_0xff18bc(0x172),messagesUpsertHandler),info('[sudonumbe'+_0xff18bc(0x196)+_0xff18bc(0x1ba)+_0xff18bc(0x1aa));}catch(_0x401642){warn(_0xff18bc(0x19a)+_0xff18bc(0x1b2)+'to\x20attach\x20'+_0xff18bc(0x14a)+_0xff18bc(0x17a)+(_0x401642?.['message']||_0x401642));}if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(cleanupOld,Number(CLEANUP_INTERVAL_MS||FALLBACKS['CLEANUP_IN'+_0xff18bc(0x16e)])),info(_0xff18bc(0x19a)+'r]\x20initial'+_0xff18bc(0x1bc));}export async function cleanup(){const _0x1b5d4e=_0x48ec4f;try{if(botInstance&&typeof botInstance[_0x1b5d4e(0x189)+_0x1b5d4e(0x17f)]===_0x1b5d4e(0x182))botInstance[_0x1b5d4e(0x189)+_0x1b5d4e(0x17f)](_0x1b5d4e(0x14a)+_0x1b5d4e(0x172),messagesUpsertHandler);if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=null;}catch(_0x15defc){warn(_0x1b5d4e(0x19a)+_0x1b5d4e(0x15c)+_0x1b5d4e(0x153)+(_0x15defc?.[_0x1b5d4e(0x180)]||_0x15defc));}finally{botInstance=null;}}export default{'name':name,'version':version,'initialize':initialize,'cleanup':cleanup,'getSenderForMsg':getSenderForMsg};