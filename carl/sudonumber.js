const _0x527c33=_0x5b98;(function(_0x51f4c4,_0x1b332e){const _0x50d1fc=_0x5b98,_0x55ed8d=_0x51f4c4();while(!![]){try{const _0x302249=parseInt(_0x50d1fc(0x132))/(-0x206a+-0x3*-0x7ed+-0x2*-0x452)*(-parseInt(_0x50d1fc(0xf2))/(0xbf+0x3*-0x23d+0x5fa))+parseInt(_0x50d1fc(0x112))/(0x25*-0x74+0x77*-0x25+-0x1*-0x21fa)*(-parseInt(_0x50d1fc(0xd7))/(0x4*0x7a2+-0x14d2+-0x9b2))+-parseInt(_0x50d1fc(0x123))/(-0x1549*0x1+-0x748*-0x1+0xe06)*(parseInt(_0x50d1fc(0x12d))/(0x133*0x17+0x1949+-0x1a6c*0x2))+parseInt(_0x50d1fc(0x120))/(0xadf*0x1+-0x2*-0x117a+0x3d1*-0xc)*(parseInt(_0x50d1fc(0xc2))/(-0xa*-0x1ca+-0x166*-0x5+-0x18da*0x1))+parseInt(_0x50d1fc(0x11a))/(-0x1d74+-0x1a48+0x37c5)*(-parseInt(_0x50d1fc(0xd0))/(0x4e4*-0x5+0x1e2+0x4*0x5a7))+parseInt(_0x50d1fc(0x118))/(0x1b4*-0xe+0xc4f+0xb94)*(-parseInt(_0x50d1fc(0x106))/(0x196b+0x1e*0x55+0x14f*-0x1b))+parseInt(_0x50d1fc(0xe5))/(-0x22*-0x41+-0x160*0xe+0x1*0xaab);if(_0x302249===_0x1b332e)break;else _0x55ed8d['push'](_0x55ed8d['shift']());}catch(_0xd736b2){_0x55ed8d['push'](_0x55ed8d['shift']());}}}(_0x2e16,-0x547eb*0x1+0x169*0xce6+-0x2ba10));import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{userJidFromCtx as _0x12af5f}from'../utils/sudo.js';export const name=_0x527c33(0x102);function _0x5b98(_0xe54f23,_0x3e9d71){const _0x480eed=_0x2e16();return _0x5b98=function(_0x50a023,_0x541df0){_0x50a023=_0x50a023-(-0x1bff+-0x4*-0x50a+0x896);let _0x276f62=_0x480eed[_0x50a023];return _0x276f62;},_0x5b98(_0xe54f23,_0x3e9d71);}export const version=_0x527c33(0xd3);function _0x2e16(){const _0x5d4b3c=['\x20saved_at\x20','erForMsg\x20e','7431SBseFP','sender_pn','ized','ener','CREATE\x20TAB','EXISTS\x20mes','1001oFvWrj','function','2677599btVgyV','er\x20error:\x20','r_jid,\x20sen','L\x20AND\x20save','remoteJidA','\x20threw:\x20','711844osjLdW','r]\x20message','\x20IN\x20(','70jgsIoq','\x20FROM\x20mess','d\x20TEXT,\x0a\x20\x20','s\x20WHERE\x20ms','jid','catch','r]\x20failed\x20','now','M\x20message_','indexOf','360540TYwDCw','run','SELECT\x20msg','r]\x20userjid','key','61943RRejfc','\x20bot\x20arg','removeList','\x20);','r]\x20cleanup','IS\x20NOT\x20NUL','map','r]\x20saveSen','64FtAbSW','EXT,\x0a\x20\x20\x20\x20s','er,\x20chat_j','ders\x20WHERE','sage\x20handl','LE\x20IF\x20NOT\x20','ERE\x20msg_id','\x20\x20\x20chat_ji','d\x20to\x20messa','sg_id,\x20sen','der_number','replace','[sudonumbe','sg_id\x20TEXT','10kCdStg','\x20\x20saved_at','all','1.0.1','\x20failed:\x20','fromMe',',\x20chat_jid','804UEwSmD','slice','r]\x20per-mes','RETENTION_','IGNORE\x20INT','age_sender','msg_id','er\x20TEXT,\x0a\x20',',\x20?,\x20?,\x20?,','rror:\x20','psert','_id\x20FROM\x20m','O\x20message_','ges.upsert','36439000QGfkzr','find','ender_numb','ng\x20failed:','findings','\x20INTEGER\x0a\x20','remoteJid','INSERT\x20OR\x20','\x20old\x20sende','sage_sende','nder_jid\x20T','length','_id,\x20sende','40MOkfKN','isArray','exec','EY,\x0a\x20\x20\x20\x20se','r]\x20getSend','senders\x20(m','Old\x20error:','essage_sen','get','floor','psert:\x20','messages.u','tAlt','join','r]\x20cleaned','\x20error:\x20','sudonumber','CLEANUP_IN','r]\x20attache','TERVAL_MS','9732rtGcVZ','lid','message','field','participan','senders\x20WH','t_pn','\x20?)','r\x20rows','dler\x20error'];_0x2e16=function(){return _0x5d4b3c;};return _0x2e16();}export const priority=0x1dd9+-0x6c3+-0x1711*0x1;let botInstance=null,cleanupInterval=null;const FALLBACKS={'RETENTION_MINUTES':0xf,'CLEANUP_INTERVAL_MS':(0x2*0x1037+-0x2a*-0xed+-0x4*0x11c5)*(-0x1e10+-0x2*0x833+0x10ca*0x3)};let RETENTION_MINUTES=FALLBACKS['RETENTION_'+'MINUTES'],CLEANUP_INTERVAL_MS=FALLBACKS[_0x527c33(0x103)+'TERVAL_MS'];function nowSeconds(){const _0x600b7e=_0x527c33;return Math[_0x600b7e(0xfb)](Date[_0x600b7e(0x12a)]()/(0xc5*-0x19+0x4*0x704+-0x4eb*0x1));}async function ensureTable(){const _0x393788=_0x527c33;await db[_0x393788(0xf4)](_0x393788(0x116)+_0x393788(0xc7)+_0x393788(0x117)+_0x393788(0xee)+'rs\x20(\x0a\x20\x20\x20\x20m'+_0x393788(0xcf)+'\x20PRIMARY\x20K'+_0x393788(0xf5)+_0x393788(0xef)+_0x393788(0xc3)+_0x393788(0xe7)+_0x393788(0xde)+_0x393788(0xc9)+_0x393788(0x125)+_0x393788(0xd1)+_0x393788(0xea)+_0x393788(0x135));}function normalizeNumberFromSudoJid(_0x1cfee6){const _0x44b613=_0x527c33;if(!_0x1cfee6)return'';try{const _0x439afa=String(_0x1cfee6),_0x44554d=_0x439afa[_0x44b613(0x12c)]('@'),_0x4b3f7d=_0x44554d===-(0x202*0x11+-0x2fd*-0x7+0x1b86*-0x2)?_0x439afa:_0x439afa[_0x44b613(0xd8)](0x3ab*0x3+0x2*-0x76d+0x3d9,_0x44554d),_0x261d55=_0x4b3f7d[_0x44b613(0x12c)](':'),_0x21d5d6=_0x261d55===-(-0x12f9+0x2240+-0xf46)?_0x4b3f7d:_0x4b3f7d[_0x44b613(0xd8)](0x16c+-0x105a+-0xd*-0x126,_0x261d55);return _0x21d5d6[_0x44b613(0xcd)](/^\+/,'');}catch{return String(_0x1cfee6||'');}}async function saveSenderIfMissing(_0x2242ce,_0xef229c,_0xdb5747){const _0xd033c5=_0x527c33;if(!_0x2242ce||!_0xef229c)return![];const _0x5ba8d8=normalizeNumberFromSudoJid(_0xef229c),_0x5dae8c=nowSeconds();try{return await db[_0xd033c5(0x12e)](_0xd033c5(0xec)+_0xd033c5(0xdb)+_0xd033c5(0xe3)+_0xd033c5(0xf7)+_0xd033c5(0xcb)+'der_jid,\x20s'+'ender_numb'+_0xd033c5(0xc4)+'id,\x20saved_'+'at)\x0a\x20\x20\x20\x20\x20\x20'+'\x20VALUES\x20(?'+_0xd033c5(0xdf)+_0xd033c5(0x10d),[_0x2242ce,_0xef229c,_0x5ba8d8||null,_0xdb5747||null,_0x5dae8c]),!![];}catch(_0x514bf1){return warn(_0xd033c5(0xce)+_0xd033c5(0xc1)+'derIfMissi'+_0xd033c5(0xe8)+'\x20'+(_0x514bf1?.[_0xd033c5(0x108)]||_0x514bf1)),![];}}export async function getSenderForMsg(_0x2a8d65){const _0x3b60d0=_0x527c33;if(!_0x2a8d65)return null;try{const _0x12d863=await db[_0x3b60d0(0xfa)](_0x3b60d0(0x12f)+_0x3b60d0(0xf1)+_0x3b60d0(0x11c)+_0x3b60d0(0xcc)+_0x3b60d0(0xd6)+',\x20saved_at'+_0x3b60d0(0x124)+_0x3b60d0(0xdc)+_0x3b60d0(0x126)+'g_id\x20=\x20?',[_0x2a8d65]);return _0x12d863||null;}catch(_0x2a4cf8){return warn('[sudonumbe'+_0x3b60d0(0xf6)+_0x3b60d0(0x111)+_0x3b60d0(0xe0)+(_0x2a4cf8?.['message']||_0x2a4cf8)),null;}}async function cleanupOld(){const _0x108604=_0x527c33;try{const _0x88ed94=nowSeconds()-Number(RETENTION_MINUTES||FALLBACKS[_0x108604(0xda)+'MINUTES'])*(-0x1d5a+0x7*0x1e8+0x103e),_0x4f185b=await db[_0x108604(0xd2)]('SELECT\x20msg'+_0x108604(0xe2)+_0x108604(0xf9)+_0x108604(0xc5)+_0x108604(0x110)+_0x108604(0xbf)+_0x108604(0x11d)+'d_at\x20<\x20?',[_0x88ed94]);if(!_0x4f185b||_0x4f185b[_0x108604(0xf0)]===0x1*0x3bf+0x67a*0x1+-0xa39)return;const _0x603705=_0x4f185b[_0x108604(0xc0)](_0x327a07=>_0x327a07[_0x108604(0xdd)]),_0xb7b310=0xdec+-0x1*-0xca7+-0xd5*0x1f;for(let _0x59678c=0x815+0x1fde*0x1+0xd51*-0x3;_0x59678c<_0x603705['length'];_0x59678c+=_0xb7b310){const _0x438909=_0x603705[_0x108604(0xd8)](_0x59678c,_0x59678c+_0xb7b310),_0x7e673f=_0x438909['map'](()=>'?')[_0x108604(0xff)](',');await db[_0x108604(0x12e)]('DELETE\x20FRO'+_0x108604(0x12b)+_0x108604(0x10b)+_0x108604(0xc8)+_0x108604(0x122)+_0x7e673f+')',_0x438909);}info(_0x108604(0xce)+_0x108604(0x100)+'\x20'+_0x4f185b[_0x108604(0xf0)]+(_0x108604(0xed)+_0x108604(0x10e)));}catch(_0x4acf34){warn(_0x108604(0xce)+_0x108604(0x136)+_0x108604(0xf8)+'\x20'+(_0x4acf34?.[_0x108604(0x108)]||_0x4acf34));}}async function messagesUpsertHandler({messages:_0x3e1088}){const _0x844794=_0x527c33;try{if(!_0x3e1088||!Array[_0x844794(0xf3)](_0x3e1088))return;for(const _0x3297c4 of _0x3e1088){try{if(!_0x3297c4||!_0x3297c4[_0x844794(0x131)])continue;if(_0x3297c4[_0x844794(0x131)][_0x844794(0xd5)])continue;const _0x5dfdce=_0x3297c4[_0x844794(0x131)]?.['id']||_0x3297c4['id']||_0x3297c4['message']&&_0x3297c4[_0x844794(0x108)]['key']&&_0x3297c4['message'][_0x844794(0x131)]['id']||null;if(!_0x5dfdce)continue;const _0x2027d0=await getSenderForMsg(_0x5dfdce);if(_0x2027d0)continue;let _0x3f6c7a=[];try{const _0x4c3e25=_0x12af5f(_0x3297c4);_0x3f6c7a=_0x4c3e25&&Array['isArray'](_0x4c3e25[_0x844794(0xe9)])?_0x4c3e25[_0x844794(0xe9)]:[];}catch(_0x96295f){warn(_0x844794(0xce)+_0x844794(0x130)+_0x844794(0x11f)+(_0x96295f?.[_0x844794(0x108)]||_0x96295f)),_0x3f6c7a=[];}if(!_0x3f6c7a[_0x844794(0xf0)])continue;const _0x2d9164=[_0x844794(0x11e)+'lt',_0x844794(0x113),_0x844794(0x10a)+_0x844794(0xfe),_0x844794(0x10a)+_0x844794(0x10c)];let _0x57b5ed=null;for(const _0x16d0bb of _0x2d9164){_0x57b5ed=_0x3f6c7a[_0x844794(0xe6)](_0x2d7d96=>_0x2d7d96[_0x844794(0x109)]===_0x16d0bb&&typeof _0x2d7d96[_0x844794(0x127)]==='string');if(_0x57b5ed)break;}if(!_0x57b5ed)_0x57b5ed=_0x3f6c7a[0x1cd3*0x1+-0x1*-0x1984+-0x1*0x3657];if(!_0x57b5ed||!_0x57b5ed[_0x844794(0x127)]||typeof _0x57b5ed[_0x844794(0x127)]!=='string')continue;const _0x5999af=_0x57b5ed[_0x844794(0x127)][_0x844794(0x12c)]('@'),_0x3b5c5b=_0x5999af===-(0x15e7+0x2*0x3f8+-0x1dd6)?'':_0x57b5ed[_0x844794(0x127)]['slice'](_0x5999af+(0x92*0x1a+-0x1*-0x2452+0x1*-0x3325));if(!_0x3b5c5b||_0x3b5c5b['toLowerCas'+'e']()===_0x844794(0x107))continue;await saveSenderIfMissing(_0x5dfdce,_0x57b5ed[_0x844794(0x127)],_0x3297c4[_0x844794(0x131)]?.[_0x844794(0xeb)]||null);}catch(_0x409c8c){warn(_0x844794(0xce)+_0x844794(0xd9)+_0x844794(0xc6)+_0x844794(0x11b)+(_0x409c8c?.[_0x844794(0x108)]||_0x409c8c));}}}catch(_0x4d9c04){warn('[sudonumbe'+_0x844794(0x121)+'sUpsertHan'+_0x844794(0x10f)+':\x20'+(_0x4d9c04?.[_0x844794(0x108)]||_0x4d9c04));}}export async function initialize(_0x5435d6){const _0x2b64c3=_0x527c33;if(!_0x5435d6)throw new Error(_0x2b64c3(0x102)+'\x20initializ'+'e\x20requires'+_0x2b64c3(0x133));botInstance=_0x5435d6,await ensureTable()[_0x2b64c3(0x128)](_0xf14dd4=>{const _0x4b30a9=_0x2b64c3;error(_0xf14dd4,_0x4b30a9(0xce)+'r]\x20DB\x20init'+_0x4b30a9(0xd4)+(_0xf14dd4?.['message']||_0xf14dd4));throw _0xf14dd4;});try{botInstance['on']('messages.u'+_0x2b64c3(0xe1),messagesUpsertHandler),info(_0x2b64c3(0xce)+_0x2b64c3(0x104)+_0x2b64c3(0xca)+_0x2b64c3(0xe4));}catch(_0x2939f9){warn('[sudonumbe'+_0x2b64c3(0x129)+'to\x20attach\x20'+_0x2b64c3(0xfd)+_0x2b64c3(0xfc)+(_0x2939f9?.['message']||_0x2939f9));}if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(cleanupOld,Number(CLEANUP_INTERVAL_MS||FALLBACKS[_0x2b64c3(0x103)+_0x2b64c3(0x105)])),info(_0x2b64c3(0xce)+'r]\x20initial'+_0x2b64c3(0x114));}export async function cleanup(){const _0xfee61b=_0x527c33;try{if(botInstance&&typeof botInstance[_0xfee61b(0x134)+_0xfee61b(0x115)]===_0xfee61b(0x119))botInstance[_0xfee61b(0x134)+_0xfee61b(0x115)](_0xfee61b(0xfd)+_0xfee61b(0xe1),messagesUpsertHandler);if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=null;}catch(_0x20c3ac){warn('[sudonumbe'+_0xfee61b(0x136)+_0xfee61b(0x101)+(_0x20c3ac?.['message']||_0x20c3ac));}finally{botInstance=null;}}export default{'name':name,'version':version,'initialize':initialize,'cleanup':cleanup,'getSenderForMsg':getSenderForMsg};