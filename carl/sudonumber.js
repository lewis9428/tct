const _0x18c39c=_0x289d;(function(_0x4640e7,_0x301ba7){const _0x1902b5=_0x289d,_0xe5adac=_0x4640e7();while(!![]){try{const _0x269c63=parseInt(_0x1902b5(0xff))/(0x1ee0+-0x749*-0x5+-0x434c)*(-parseInt(_0x1902b5(0xea))/(-0x15*-0x76+0x156f+-0x1f1b))+-parseInt(_0x1902b5(0xe6))/(-0x1*0x4f3+0x8*-0x388+0x3*0xb12)*(parseInt(_0x1902b5(0xec))/(0x1*-0x2044+0x1*0x2006+-0x2*-0x21))+parseInt(_0x1902b5(0xfb))/(-0x8f*-0x2b+-0x83e*0x1+-0x2*0x7e1)+-parseInt(_0x1902b5(0xb0))/(0x1*-0x2582+0x2646+-0xbe)+parseInt(_0x1902b5(0xc1))/(0x8*0x3e7+0x62*0x53+-0x14fd*0x3)+-parseInt(_0x1902b5(0xe2))/(-0x49*0x47+0x144a+-0x3)+parseInt(_0x1902b5(0x102))/(-0x1a32+-0x2a1*0x1+-0x2*-0xe6e)*(parseInt(_0x1902b5(0xfa))/(0x82b+-0x1*-0x1763+-0x4*0x7e1));if(_0x269c63===_0x301ba7)break;else _0xe5adac['push'](_0xe5adac['shift']());}catch(_0x968781){_0xe5adac['push'](_0xe5adac['shift']());}}}(_0x5668,0x7c*0x748+-0x1*-0x2f558+-0x42ef9));import{info,warn,error}from'../utils/logger.js';import{db}from'../utils/database.js';import{userJidFromCtx as _0x26864a}from'../utils/sudo.js';export const name=_0x18c39c(0xf7);export const version=_0x18c39c(0xd6);export const priority=-0x2*0xf92+0x51b*0x7+-0x494;let botInstance=null,cleanupInterval=null;const FALLBACKS={'RETENTION_MINUTES':0xf,'CLEANUP_INTERVAL_MS':(-0xa29+-0x1602+0x2067)*(-0x1229*-0x2+0x2*0xa39+0x44*-0xc7)};let RETENTION_MINUTES=FALLBACKS[_0x18c39c(0x10e)+'MINUTES'],CLEANUP_INTERVAL_MS=FALLBACKS['CLEANUP_IN'+_0x18c39c(0x101)];function nowSeconds(){const _0x5eb406=_0x18c39c;return Math['floor'](Date[_0x5eb406(0xe7)]()/(-0x20a+0xba*0x1b+-0xfa*0xe));}async function ensureTable(){const _0x360f98=_0x18c39c;await db[_0x360f98(0xf8)](_0x360f98(0x110)+'LE\x20IF\x20NOT\x20'+_0x360f98(0x10c)+_0x360f98(0xcd)+_0x360f98(0xc6)+_0x360f98(0x105)+'\x20PRIMARY\x20K'+_0x360f98(0xd0)+_0x360f98(0xda)+_0x360f98(0x10d)+_0x360f98(0xf1)+_0x360f98(0xbd)+'\x20\x20\x20chat_ji'+_0x360f98(0x111)+_0x360f98(0xe9)+_0x360f98(0x103)+_0x360f98(0xbc));}function normalizeNumberFromSudoJid(_0x1fb0af){const _0x49a6a9=_0x18c39c;if(!_0x1fb0af)return'';try{const _0xbc656c=String(_0x1fb0af),_0x10648d=_0xbc656c[_0x49a6a9(0xe0)]('@'),_0x598c36=_0x10648d===-(-0xd01*-0x1+-0x152b+-0x3*-0x2b9)?_0xbc656c:_0xbc656c[_0x49a6a9(0x107)](-0x10cb*-0x1+0x55e+-0x1629,_0x10648d),_0x390fd6=_0x598c36['indexOf'](':'),_0x81d7a7=_0x390fd6===-(-0x184d+-0x1452+0x2ca0)?_0x598c36:_0x598c36[_0x49a6a9(0x107)](0x192c+-0x2*0x1093+0x7fa,_0x390fd6);return _0x81d7a7[_0x49a6a9(0x10b)](/^\+/,'');}catch{return String(_0x1fb0af||'');}}function _0x5668(){const _0x4ee912=['\x20INTEGER\x0a\x20','to\x20attach\x20','sg_id\x20TEXT','string','slice','run','\x20failed:\x20','psert:\x20','replace','EXISTS\x20mes','EXT,\x0a\x20\x20\x20\x20s','RETENTION_','toLowerCas','CREATE\x20TAB','d\x20TEXT,\x0a\x20\x20','s\x20WHERE\x20ms','function','participan','[sudonumbe','er\x20error:\x20','CLEANUP_IN','sUpsertHan','r\x20rows','1631106aQjbsx','_id,\x20sende','\x20?)','at)\x0a\x20\x20\x20\x20\x20\x20','r]\x20getSend','ERE\x20msg_id','remoteJid','fromMe','map','\x20FROM\x20mess','remoteJidA','M\x20message_','\x20);','er\x20TEXT,\x0a\x20','find','L\x20AND\x20save','id,\x20saved_','599627NQuoJF','derIfMissi','r]\x20per-mes','senders\x20WH','message','rs\x20(\x0a\x20\x20\x20\x20m','lid','key','length','erForMsg\x20e','sg_id,\x20sen','ders\x20WHERE','sage_sende','all','g_id\x20=\x20?','EY,\x0a\x20\x20\x20\x20se','\x20IN\x20(','\x20initializ','r]\x20cleanup','DELETE\x20FRO','jid','1.0.1','\x20error:\x20','age_sender','dler\x20error','nder_jid\x20T','psert','INSERT\x20OR\x20','msg_id','d_at\x20<\x20?','get','indexOf','O\x20message_','1961440CsCGNU','messages.u','d\x20to\x20messa','catch','2742iROZKN','now',',\x20saved_at','\x20\x20saved_at','189556cLjSDw','tAlt','656qPlCSn','ener','\x20bot\x20arg','\x20old\x20sende','findings','ender_numb','er,\x20chat_j','essage_sen','join','r]\x20userjid','isArray','sudonumber','exec','r]\x20initial','153030trOCgo','844310Fbkzbb','\x20threw:\x20','r]\x20message','ized','1HDmTrv','r]\x20failed\x20','TERVAL_MS','387auKWBt'];_0x5668=function(){return _0x4ee912;};return _0x5668();}function _0x289d(_0x30180a,_0x284ac0){const _0x9ae03f=_0x5668();return _0x289d=function(_0x5b4f2a,_0x4f59ab){_0x5b4f2a=_0x5b4f2a-(-0x1973*-0x1+-0x4ef*-0x2+0xb8d*-0x3);let _0x2201f4=_0x9ae03f[_0x5b4f2a];return _0x2201f4;},_0x289d(_0x30180a,_0x284ac0);}async function saveSenderIfMissing(_0x4d2ea9,_0x5da1ee,_0x2cc4ff){const _0x34d726=_0x18c39c;if(!_0x4d2ea9||!_0x5da1ee)return![];const _0x438e12=normalizeNumberFromSudoJid(_0x5da1ee),_0x2417a6=nowSeconds();try{return await db['run'](_0x34d726(0xdc)+'IGNORE\x20INT'+_0x34d726(0xe1)+'senders\x20(m'+_0x34d726(0xcb)+'der_jid,\x20s'+'ender_numb'+_0x34d726(0xf2)+_0x34d726(0xc0)+_0x34d726(0xb3)+'\x20VALUES\x20(?'+',\x20?,\x20?,\x20?,'+_0x34d726(0xb2),[_0x4d2ea9,_0x5da1ee,_0x438e12||null,_0x2cc4ff||null,_0x2417a6]),!![];}catch(_0x3f0984){return warn(_0x34d726(0xab)+'r]\x20saveSen'+_0x34d726(0xc2)+'ng\x20failed:'+'\x20'+(_0x3f0984?.[_0x34d726(0xc5)]||_0x3f0984)),![];}}export async function getSenderForMsg(_0x249218){const _0x1a51ea=_0x18c39c;if(!_0x249218)return null;try{const _0x4fdab1=await db[_0x1a51ea(0xdf)]('SELECT\x20msg'+_0x1a51ea(0xb1)+'r_jid,\x20sen'+'der_number'+',\x20chat_jid'+_0x1a51ea(0xe8)+_0x1a51ea(0xb9)+_0x1a51ea(0xd8)+_0x1a51ea(0x112)+_0x1a51ea(0xcf),[_0x249218]);return _0x4fdab1||null;}catch(_0x23b866){return warn(_0x1a51ea(0xab)+_0x1a51ea(0xb4)+_0x1a51ea(0xca)+'rror:\x20'+(_0x23b866?.['message']||_0x23b866)),null;}}async function cleanupOld(){const _0x3ba651=_0x18c39c;try{const _0x12cdf9=nowSeconds()-Number(RETENTION_MINUTES||FALLBACKS['RETENTION_'+'MINUTES'])*(-0x47*0x54+-0x904+0x208c),_0x168a0a=await db[_0x3ba651(0xce)]('SELECT\x20msg'+'_id\x20FROM\x20m'+_0x3ba651(0xf3)+_0x3ba651(0xcc)+'\x20saved_at\x20'+'IS\x20NOT\x20NUL'+_0x3ba651(0xbf)+_0x3ba651(0xde),[_0x12cdf9]);if(!_0x168a0a||_0x168a0a[_0x3ba651(0xc9)]===0x168*0x8+-0x4*0x9d+-0x8cc)return;const _0xc92143=_0x168a0a[_0x3ba651(0xb8)](_0x4c662e=>_0x4c662e[_0x3ba651(0xdd)]),_0x176b7c=-0x113c+-0x52f*-0x4+-0x2b8;for(let _0x1d312e=0x1514+0x603*-0x6+-0xca*-0x13;_0x1d312e<_0xc92143[_0x3ba651(0xc9)];_0x1d312e+=_0x176b7c){const _0x41bad3=_0xc92143[_0x3ba651(0x107)](_0x1d312e,_0x1d312e+_0x176b7c),_0x47fb9f=_0x41bad3[_0x3ba651(0xb8)](()=>'?')[_0x3ba651(0xf4)](',');await db[_0x3ba651(0x108)](_0x3ba651(0xd4)+_0x3ba651(0xbb)+_0x3ba651(0xc4)+_0x3ba651(0xb5)+_0x3ba651(0xd1)+_0x47fb9f+')',_0x41bad3);}info(_0x3ba651(0xab)+'r]\x20cleaned'+'\x20'+_0x168a0a[_0x3ba651(0xc9)]+(_0x3ba651(0xef)+_0x3ba651(0xaf)));}catch(_0xd489ff){warn('[sudonumbe'+_0x3ba651(0xd3)+'Old\x20error:'+'\x20'+(_0xd489ff?.[_0x3ba651(0xc5)]||_0xd489ff));}}async function messagesUpsertHandler({messages:_0x216ac0}){const _0x1df089=_0x18c39c;try{if(!_0x216ac0||!Array[_0x1df089(0xf6)](_0x216ac0))return;for(const _0x3a7a6a of _0x216ac0){try{if(!_0x3a7a6a||!_0x3a7a6a[_0x1df089(0xc8)])continue;if(_0x3a7a6a['key'][_0x1df089(0xb7)])continue;const _0x4e1a6f=_0x3a7a6a[_0x1df089(0xc8)]?.['id']||_0x3a7a6a['id']||_0x3a7a6a[_0x1df089(0xc5)]&&_0x3a7a6a[_0x1df089(0xc5)]['key']&&_0x3a7a6a[_0x1df089(0xc5)][_0x1df089(0xc8)]['id']||null;if(!_0x4e1a6f)continue;const _0x52b15d=await getSenderForMsg(_0x4e1a6f);if(_0x52b15d)continue;let _0x5e2c3b=[];try{const _0xcb5ac9=_0x26864a(_0x3a7a6a);_0x5e2c3b=_0xcb5ac9&&Array[_0x1df089(0xf6)](_0xcb5ac9[_0x1df089(0xf0)])?_0xcb5ac9[_0x1df089(0xf0)]:[];}catch(_0x402425){warn('[sudonumbe'+_0x1df089(0xf5)+_0x1df089(0xfc)+(_0x402425?.[_0x1df089(0xc5)]||_0x402425)),_0x5e2c3b=[];}if(!_0x5e2c3b[_0x1df089(0xc9)])continue;const _0x17fd50=[_0x1df089(0xba)+'lt','sender_pn',_0x1df089(0xaa)+_0x1df089(0xeb),_0x1df089(0xaa)+'t_pn'];let _0x2f560d=null;for(const _0x4a7df5 of _0x17fd50){_0x2f560d=_0x5e2c3b[_0x1df089(0xbe)](_0x55b8e1=>_0x55b8e1['field']===_0x4a7df5&&typeof _0x55b8e1[_0x1df089(0xd5)]==='string');if(_0x2f560d)break;}if(!_0x2f560d)_0x2f560d=_0x5e2c3b[-0xbc*0x2b+0x441*-0x9+0x45dd];if(!_0x2f560d||!_0x2f560d[_0x1df089(0xd5)]||typeof _0x2f560d['jid']!==_0x1df089(0x106))continue;const _0x5c7479=_0x2f560d[_0x1df089(0xd5)][_0x1df089(0xe0)]('@'),_0x58ac82=_0x5c7479===-(0x1b66+0x16c2+0x3227*-0x1)?'':_0x2f560d[_0x1df089(0xd5)][_0x1df089(0x107)](_0x5c7479+(-0x5*0x97+0x2c*-0x12+-0x6*-0x102));if(!_0x58ac82||_0x58ac82[_0x1df089(0x10f)+'e']()===_0x1df089(0xc7))continue;await saveSenderIfMissing(_0x4e1a6f,_0x2f560d[_0x1df089(0xd5)],_0x3a7a6a[_0x1df089(0xc8)]?.[_0x1df089(0xb6)]||null);}catch(_0x228c9b){warn(_0x1df089(0xab)+_0x1df089(0xc3)+'sage\x20handl'+_0x1df089(0xac)+(_0x228c9b?.[_0x1df089(0xc5)]||_0x228c9b));}}}catch(_0x282eb7){warn('[sudonumbe'+_0x1df089(0xfd)+_0x1df089(0xae)+_0x1df089(0xd9)+':\x20'+(_0x282eb7?.[_0x1df089(0xc5)]||_0x282eb7));}}export async function initialize(_0x2b25cf){const _0x57677a=_0x18c39c;if(!_0x2b25cf)throw new Error(_0x57677a(0xf7)+_0x57677a(0xd2)+'e\x20requires'+_0x57677a(0xee));botInstance=_0x2b25cf,await ensureTable()[_0x57677a(0xe5)](_0x4a0372=>{const _0x122f6f=_0x57677a;error(_0x4a0372,_0x122f6f(0xab)+'r]\x20DB\x20init'+_0x122f6f(0x109)+(_0x4a0372?.[_0x122f6f(0xc5)]||_0x4a0372));throw _0x4a0372;});try{botInstance['on'](_0x57677a(0xe3)+_0x57677a(0xdb),messagesUpsertHandler),info(_0x57677a(0xab)+'r]\x20attache'+_0x57677a(0xe4)+'ges.upsert');}catch(_0x11f60f){warn(_0x57677a(0xab)+_0x57677a(0x100)+_0x57677a(0x104)+_0x57677a(0xe3)+_0x57677a(0x10a)+(_0x11f60f?.[_0x57677a(0xc5)]||_0x11f60f));}if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=setInterval(cleanupOld,Number(CLEANUP_INTERVAL_MS||FALLBACKS[_0x57677a(0xad)+_0x57677a(0x101)])),info('[sudonumbe'+_0x57677a(0xf9)+_0x57677a(0xfe));}export async function cleanup(){const _0x10d7a2=_0x18c39c;try{if(botInstance&&typeof botInstance['removeList'+_0x10d7a2(0xed)]===_0x10d7a2(0x113))botInstance['removeList'+'ener'](_0x10d7a2(0xe3)+_0x10d7a2(0xdb),messagesUpsertHandler);if(cleanupInterval)clearInterval(cleanupInterval);cleanupInterval=null;}catch(_0x442896){warn(_0x10d7a2(0xab)+_0x10d7a2(0xd3)+_0x10d7a2(0xd7)+(_0x442896?.[_0x10d7a2(0xc5)]||_0x442896));}finally{botInstance=null;}}export default{'name':name,'version':version,'initialize':initialize,'cleanup':cleanup,'getSenderForMsg':getSenderForMsg};